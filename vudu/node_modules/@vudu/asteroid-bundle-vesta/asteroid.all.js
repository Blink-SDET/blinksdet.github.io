var requirejs,require,define;!function(global){function isFunction(a){return"[object Function]"===ostring.call(a)}function isArray(a){return"[object Array]"===ostring.call(a)}function each(a,b){if(a){var c;for(c=0;c<a.length&&(!a[c]||!b(a[c],c,a));c+=1);}}function eachReverse(a,b){if(a){var c;for(c=a.length-1;c>-1&&(!a[c]||!b(a[c],c,a));c-=1);}}function hasProp(a,b){return hasOwn.call(a,b)}function getOwn(a,b){return hasProp(a,b)&&a[b]}function eachProp(a,b){var c;for(c in a)if(hasProp(a,c)&&b(a[c],c))break}function mixin(a,b,c,d){return b&&eachProp(b,function(b,e){!c&&hasProp(a,e)||(!d||"object"!=typeof b||!b||isArray(b)||isFunction(b)||b instanceof RegExp?a[e]=b:(a[e]||(a[e]={}),mixin(a[e],b,c,d)))}),a}function bind(a,b){return function(){return b.apply(a,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(a){throw a}function getGlobal(a){if(!a)return a;var b=global;return each(a.split("."),function(a){b=b[a]}),b}function makeError(a,b,c,d){var e=new Error(b+"\nhttp://requirejs.org/docs/errors.html#"+a);return e.requireType=a,e.requireModules=d,c&&(e.originalError=c),e}function newContext(a){function b(a){var b,c;for(b=0;b<a.length;b++)if(c=a[b],"."===c)a.splice(b,1),b-=1;else if(".."===c){if(0===b||1===b&&".."===a[2]||".."===a[b-1])continue;b>0&&(a.splice(b-1,2),b-=2)}}function c(a,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q=c&&c.split("/"),r=x.map,s=r&&r["*"];if(a&&(a=a.split("/"),k=a.length-1,x.nodeIdCompat&&jsSuffixRegExp.test(a[k])&&(a[k]=a[k].replace(jsSuffixRegExp,"")),"."===a[0].charAt(0)&&q&&(p=q.slice(0,q.length-1),a=p.concat(a)),b(a),a=a.join("/")),d&&r&&(q||s)){g=a.split("/");a:for(h=g.length;h>0;h-=1){if(j=g.slice(0,h).join("/"),q)for(i=q.length;i>0;i-=1)if(f=getOwn(r,q.slice(0,i).join("/")),f&&(f=getOwn(f,j))){l=f,m=h;break a}!n&&s&&getOwn(s,j)&&(n=getOwn(s,j),o=h)}!l&&n&&(l=n,m=o),l&&(g.splice(0,m,l),a=g.join("/"))}return e=getOwn(x.pkgs,a),e?e:a}function d(a){isBrowser&&each(scripts(),function(b){if(b.getAttribute("data-requiremodule")===a&&b.getAttribute("data-requirecontext")===u.contextName)return b.parentNode.removeChild(b),!0})}function e(a){var b=getOwn(x.paths,a);if(b&&isArray(b)&&b.length>1)return b.shift(),u.require.undef(a),u.makeRequire(null,{skipMap:!0})([a]),!0}function f(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function g(a,b,d,e){var g,h,i,j,k=null,l=b?b.name:null,m=a,n=!0,o="";return a||(n=!1,a="_@r"+(F+=1)),j=f(a),k=j[0],a=j[1],k&&(k=c(k,l,e),h=getOwn(C,k)),a&&(k?o=h&&h.normalize?h.normalize(a,function(a){return c(a,l,e)}):a.indexOf("!")===-1?c(a,l,e):a:(o=c(a,l,e),j=f(o),k=j[0],o=j[1],d=!0,g=u.nameToUrl(o))),i=!k||h||d?"":"_unnormalized"+(G+=1),{prefix:k,name:o,parentMap:b,unnormalized:!!i,url:g,originalName:m,isDefine:n,id:(k?k+"!"+o:o)+i}}function h(a){var b=a.id,c=getOwn(y,b);return c||(c=y[b]=new u.Module(a)),c}function i(a,b,c){var d=a.id,e=getOwn(y,d);!hasProp(C,d)||e&&!e.defineEmitComplete?(e=h(a),e.error&&"error"===b?c(e.error):e.on(b,c)):"defined"===b&&c(C[d])}function j(a,b){var c=a.requireModules,d=!1;b?b(a):(each(c,function(b){var c=getOwn(y,b);c&&(c.error=a,c.events.error&&(d=!0,c.emit("error",a)))}),d||req.onError(a))}function k(){globalDefQueue.length&&(each(globalDefQueue,function(a){var b=a[0];"string"==typeof b&&(u.defQueueMap[b]=!0),B.push(a)}),globalDefQueue=[])}function l(a){delete y[a],delete z[a]}function m(a,b,c){var d=a.map.id;a.error?a.emit("error",a.error):(b[d]=!0,each(a.depMaps,function(d,e){var f=d.id,g=getOwn(y,f);!g||a.depMatched[e]||c[f]||(getOwn(b,f)?(a.defineDep(e,C[f]),a.check()):m(g,b,c))}),c[d]=!0)}function n(){var a,b,c=1e3*x.waitSeconds,f=c&&u.startTime+c<(new Date).getTime(),g=[],h=[],i=!1,k=!0;if(!s){if(s=!0,eachProp(z,function(a){var c=a.map,j=c.id;if(a.enabled&&(c.isDefine||h.push(a),!a.error))if(!a.inited&&f)e(j)?(b=!0,i=!0):(g.push(j),d(j));else if(!a.inited&&a.fetched&&c.isDefine&&(i=!0,!c.prefix))return k=!1}),f&&g.length)return a=makeError("timeout","Load timeout for modules: "+g,null,g),a.contextName=u.contextName,j(a);k&&each(h,function(a){m(a,{},{})}),f&&!b||!i||!isBrowser&&!isWebWorker||w||(w=setTimeout(function(){w=0,n()},50)),s=!1}}function o(a){hasProp(C,a[0])||h(g(a[0],null,!0)).init(a[1],a[2])}function p(a,b,c,d){a.detachEvent&&!isOpera?d&&a.detachEvent(d,b):a.removeEventListener(c,b,!1)}function q(a){var b=a.currentTarget||a.srcElement;return p(b,u.onScriptLoad,"load","onreadystatechange"),p(b,u.onScriptError,"error"),{node:b,id:b&&b.getAttribute("data-requiremodule")}}function r(){var a;for(k();B.length;){if(a=B.shift(),null===a[0])return j(makeError("mismatch","Mismatched anonymous define() module: "+a[a.length-1]));o(a)}u.defQueueMap={}}var s,t,u,v,w,x={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},y={},z={},A={},B=[],C={},D={},E={},F=1,G=1;return v={require:function(a){return a.require?a.require:a.require=u.makeRequire(a.map)},exports:function(a){if(a.usingExports=!0,a.map.isDefine)return a.exports?C[a.map.id]=a.exports:a.exports=C[a.map.id]={}},module:function(a){return a.module?a.module:a.module={id:a.map.id,uri:a.map.url,config:function(){return getOwn(x.config,a.map.id)||{}},exports:a.exports||(a.exports={})}}},t=function(a){this.events=getOwn(A,a.id)||{},this.map=a,this.shim=getOwn(x.shim,a.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},t.prototype={init:function(a,b,c,d){d=d||{},this.inited||(this.factory=b,c?this.on("error",c):this.events.error&&(c=bind(this,function(a){this.emit("error",a)})),this.depMaps=a&&a.slice(0),this.errback=c,this.inited=!0,this.ignore=d.ignore,d.enabled||this.enabled?this.enable():this.check())},defineDep:function(a,b){this.depMatched[a]||(this.depMatched[a]=!0,this.depCount-=1,this.depExports[a]=b)},fetch:function(){if(!this.fetched){this.fetched=!0,u.startTime=(new Date).getTime();var a=this.map;return this.shim?void u.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return a.prefix?this.callPlugin():this.load()})):a.prefix?this.callPlugin():this.load()}},load:function(){var a=this.map.url;D[a]||(D[a]=!0,u.load(this.map.id,a))},check:function(){if(this.enabled&&!this.enabling){var a,b,c=this.map.id,d=this.depExports,e=this.exports,f=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(f)){try{e=u.execCb(c,f,d,e)}catch(g){a=g}if(this.map.isDefine&&void 0===e&&(b=this.module,b?e=b.exports:this.usingExports&&(e=this.exports)),a){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)return a.requireMap=this.map,a.requireModules=this.map.isDefine?[this.map.id]:null,a.requireType=this.map.isDefine?"define":"require",j(this.error=a);"undefined"!=typeof console&&console.error?console.error(a):req.onError(a)}}else e=f;if(this.exports=e,this.map.isDefine&&!this.ignore&&(C[c]=e,req.onResourceLoad)){var h=[];each(this.depMaps,function(a){h.push(a.normalizedMap||a)}),req.onResourceLoad(u,this.map,h)}l(c),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else hasProp(u.defQueueMap,c)||this.fetch()}},callPlugin:function(){var a=this.map,b=a.id,d=g(a.prefix);this.depMaps.push(d),i(d,"defined",bind(this,function(d){var e,f,k,m=getOwn(E,this.map.id),n=this.map.name,o=this.map.parentMap?this.map.parentMap.name:null,p=u.makeRequire(a.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(d.normalize&&(n=d.normalize(n,function(a){return c(a,o,!0)})||""),f=g(a.prefix+"!"+n,this.map.parentMap),i(f,"defined",bind(this,function(a){this.map.normalizedMap=f,this.init([],function(){return a},null,{enabled:!0,ignore:!0})})),k=getOwn(y,f.id),void(k&&(this.depMaps.push(f),this.events.error&&k.on("error",bind(this,function(a){this.emit("error",a)})),k.enable()))):m?(this.map.url=u.nameToUrl(m),void this.load()):(e=bind(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),e.error=bind(this,function(a){this.inited=!0,this.error=a,a.requireModules=[b],eachProp(y,function(a){0===a.map.id.indexOf(b+"_unnormalized")&&l(a.map.id)}),j(a)}),e.fromText=bind(this,function(c,d){var f=a.name,i=g(f),k=useInteractive;d&&(c=d),k&&(useInteractive=!1),h(i),hasProp(x.config,b)&&(x.config[f]=x.config[b]);try{req.exec(c)}catch(l){return j(makeError("fromtexteval","fromText eval for "+b+" failed: "+l,l,[b]))}k&&(useInteractive=!0),this.depMaps.push(i),u.completeLoad(f),p([f],e)}),void d.load(a.name,p,e,x))})),u.enable(d,this),this.pluginMaps[d.id]=d},enable:function(){z[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(a,b){var c,d,e;if("string"==typeof a){if(a=g(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[b]=a,e=getOwn(v,a.id))return void(this.depExports[b]=e(this));this.depCount+=1,i(a,"defined",bind(this,function(a){this.undefed||(this.defineDep(b,a),this.check())})),this.errback?i(a,"error",bind(this,this.errback)):this.events.error&&i(a,"error",bind(this,function(a){this.emit("error",a)}))}c=a.id,d=y[c],hasProp(v,c)||!d||d.enabled||u.enable(a,this)})),eachProp(this.pluginMaps,bind(this,function(a){var b=getOwn(y,a.id);b&&!b.enabled&&u.enable(a,this)})),this.enabling=!1,this.check()},on:function(a,b){var c=this.events[a];c||(c=this.events[a]=[]),c.push(b)},emit:function(a,b){each(this.events[a],function(a){a(b)}),"error"===a&&delete this.events[a]}},u={config:x,contextName:a,registry:y,defined:C,urlFetched:D,defQueue:B,defQueueMap:{},Module:t,makeModuleMap:g,nextTick:req.nextTick,onError:j,configure:function(a){a.baseUrl&&"/"!==a.baseUrl.charAt(a.baseUrl.length-1)&&(a.baseUrl+="/");var b=x.shim,c={paths:!0,bundles:!0,config:!0,map:!0};eachProp(a,function(a,b){c[b]?(x[b]||(x[b]={}),mixin(x[b],a,!0,!0)):x[b]=a}),a.bundles&&eachProp(a.bundles,function(a,b){each(a,function(a){a!==b&&(E[a]=b)})}),a.shim&&(eachProp(a.shim,function(a,c){isArray(a)&&(a={deps:a}),!a.exports&&!a.init||a.exportsFn||(a.exportsFn=u.makeShimExports(a)),b[c]=a}),x.shim=b),a.packages&&each(a.packages,function(a){var b,c;a="string"==typeof a?{name:a}:a,c=a.name,b=a.location,b&&(x.paths[c]=a.location),x.pkgs[c]=a.name+"/"+(a.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(y,function(a,b){a.inited||a.map.unnormalized||(a.map=g(b,null,!0))}),(a.deps||a.callback)&&u.require(a.deps||[],a.callback)},makeShimExports:function(a){function b(){var b;return a.init&&(b=a.init.apply(global,arguments)),b||a.exports&&getGlobal(a.exports)}return b},makeRequire:function(b,e){function f(c,d,i){var k,l,m;return e.enableBuildCallback&&d&&isFunction(d)&&(d.__requireJsBuild=!0),"string"==typeof c?isFunction(d)?j(makeError("requireargs","Invalid require call"),i):b&&hasProp(v,c)?v[c](y[b.id]):req.get?req.get(u,c,b,f):(l=g(c,b,!1,!0),k=l.id,hasProp(C,k)?C[k]:j(makeError("notloaded",'Module name "'+k+'" has not been loaded yet for context: '+a+(b?"":". Use require([])")))):(r(),u.nextTick(function(){r(),m=h(g(null,b)),m.skipMap=e.skipMap,m.init(c,d,i,{enabled:!0}),n()}),f)}return e=e||{},mixin(f,{isBrowser:isBrowser,toUrl:function(a){var d,e=a.lastIndexOf("."),f=a.split("/")[0],g="."===f||".."===f;return e!==-1&&(!g||e>1)&&(d=a.substring(e,a.length),a=a.substring(0,e)),u.nameToUrl(c(a,b&&b.id,!0),d,!0)},defined:function(a){return hasProp(C,g(a,b,!1,!0).id)},specified:function(a){return a=g(a,b,!1,!0).id,hasProp(C,a)||hasProp(y,a)}}),b||(f.undef=function(a){k();var c=g(a,b,!0),e=getOwn(y,a);e.undefed=!0,d(a),delete C[a],delete D[c.url],delete A[a],eachReverse(B,function(b,c){b[0]===a&&B.splice(c,1)}),delete u.defQueueMap[a],e&&(e.events.defined&&(A[a]=e.events),l(a))}),f},enable:function(a){var b=getOwn(y,a.id);b&&h(a).enable()},completeLoad:function(a){var b,c,d,f=getOwn(x.shim,a)||{},g=f.exports;for(k();B.length;){if(c=B.shift(),null===c[0]){if(c[0]=a,b)break;b=!0}else c[0]===a&&(b=!0);o(c)}if(u.defQueueMap={},d=getOwn(y,a),!b&&!hasProp(C,a)&&d&&!d.inited){if(!(!x.enforceDefine||g&&getGlobal(g)))return e(a)?void 0:j(makeError("nodefine","No define call for "+a,null,[a]));o([a,f.deps||[],f.exportsFn])}n()},nameToUrl:function(a,b,c){var d,e,f,g,h,i,j,k=getOwn(x.pkgs,a);if(k&&(a=k),j=getOwn(E,a))return u.nameToUrl(j,b,c);if(req.jsExtRegExp.test(a))h=a+(b||"");else{for(d=x.paths,e=a.split("/"),f=e.length;f>0;f-=1)if(g=e.slice(0,f).join("/"),i=getOwn(d,g)){isArray(i)&&(i=i[0]),e.splice(0,f,i);break}h=e.join("/"),h+=b||(/^data\:|\?/.test(h)||c?"":".js"),h=("/"===h.charAt(0)||h.match(/^[\w\+\.\-]+:/)?"":x.baseUrl)+h}return x.urlArgs?h+((h.indexOf("?")===-1?"?":"&")+x.urlArgs):h},load:function(a,b){req.load(u,a,b)},execCb:function(a,b,c,d){return b.apply(d,c)},onScriptLoad:function(a){if("load"===a.type||readyRegExp.test((a.currentTarget||a.srcElement).readyState)){interactiveScript=null;var b=q(a);u.completeLoad(b.id)}},onScriptError:function(a){var b=q(a);if(!e(b.id)){var c=[];return eachProp(y,function(a,d){0!==d.indexOf("_@r")&&each(a.depMaps,function(a){return a.id===b.id&&c.push(d),!0})}),j(makeError("scripterror",'Script error for "'+b.id+(c.length?'", needed by: '+c.join(", "):'"'),a,[b.id]))}}},u.require=u.makeRequire(),u}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(a){if("interactive"===a.readyState)return interactiveScript=a}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.22",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}"undefined"==typeof require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(a,b,c,d){var e,f,g=defContextName;return isArray(a)||"string"==typeof a||(f=a,isArray(b)?(a=b,b=c,c=d):a=[]),f&&f.context&&(g=f.context),e=getOwn(contexts,g),e||(e=contexts[g]=req.s.newContext(g)),f&&e.configure(f),e.require(a,b,c)},req.config=function(a){return req(a)},req.nextTick="undefined"!=typeof setTimeout?function(a){setTimeout(a,4)}:function(a){a()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(a){req[a]=function(){var b=contexts[defContextName];return b.require[a].apply(b,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(a,b,c){var d=a.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return d.type=a.scriptType||"text/javascript",d.charset="utf-8",d.async=!0,d},req.load=function(a,b,c){var d,e=a&&a.config||{};if(isBrowser)return d=req.createNode(e,b,c),e.onNodeCreated&&e.onNodeCreated(d,e,b,c),d.setAttribute("data-requirecontext",a.contextName),d.setAttribute("data-requiremodule",b),!d.attachEvent||d.attachEvent.toString&&d.attachEvent.toString().indexOf("[native code")<0||isOpera?(d.addEventListener("load",a.onScriptLoad,!1),d.addEventListener("error",a.onScriptError,!1)):(useInteractive=!0,d.attachEvent("onreadystatechange",a.onScriptLoad)),d.src=c,currentlyAddingScript=d,baseElement?head.insertBefore(d,baseElement):head.appendChild(d),currentlyAddingScript=null,d;if(isWebWorker)try{importScripts(c),a.completeLoad(b)}catch(f){a.onError(makeError("importscripts","importScripts failed for "+b+" at "+c,f,[b]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(a){if(head||(head=a.parentNode),dataMain=a.getAttribute("data-main"))return mainScript=dataMain,cfg.baseUrl||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(a,b,c){var d,e;"string"!=typeof a&&(c=b,b=a,a=null),isArray(b)||(c=b,b=null),!b&&isFunction(c)&&(b=[],c.length&&(c.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(a,c){b.push(c)}),b=(1===c.length?["require"]:["require","exports","module"]).concat(b))),useInteractive&&(d=currentlyAddingScript||getInteractiveScript(),d&&(a||(a=d.getAttribute("data-requiremodule")),e=contexts[d.getAttribute("data-requirecontext")])),e?(e.defQueue.push([a,b,c]),e.defQueueMap[a]=!0):globalDefQueue.push([a,b,c])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this),window.Asteroid||(window.Asteroid={},Asteroid.ReadyEvent="com.vudu.asteroid.asteroid-ready",Asteroid.ready=!1),requirejs.config({config:{"ensis/logger/logger":{ASYNC:"error",MetricsHandler:"error",initdata:"error",AggStatV3:"warn","default":"log"},"asteroid/vuduplayer":{dashjs:{log:{timestamp:!1,name:!1,console:!1,event:!0}},resources:!0},"asteroid/config":{aggStatsSendInterval:300}}}),define("build/config/release/require_config_ensis_main.js",function(){}),define("ensis/data/format",[],function(){function a(a){var b=a/3600|0,c=(a-3600*b)/60|0,d=a-60*(60*b+c)|0,e=""+b;return e+=":",c<10&&(e+="0"),e+=c,e+=":",d<10&&(e+="0"),e+=d}function b(a){if(0==a)return"0x";if(a<0)return"-"+b(~a+1);var c=15&a;return c<10?c=""+c:(c-=10,c+="A".charCodeAt(0),c=String.fromCharCode(c)),b(a/16|0)+c}function c(a){return"number"!=typeof a||0==a?"0x0":b(a)}function d(a){if("string"!=typeof a)return!1;var b=a[0];return b>="a"&&b<="f"||(b>="A"&&b<="F"||b>="0"&&b<="9")}function e(a,b){var c="<n/a>("+b+")";try{c=Object.keys(a).reduce(function(c,d){return a[d]===b?d:c})}catch(d){c="<invalid key/value for lookup>"}return c}function f(){return{timeToString:a,toHex:c,isHexChar:d,keyLookup:e}}return f()}),define("ensis/logger/logclient",["module","ensis/data/format"],function(a,b){"use strict";function c(){function a(a,b){throw new Error("report function must be overridden in LogClient")}return{report:a}}function d(){return{report:function(){},isNullClient:function(){return!0}}}function e(){function c(a,c){var d=m[a];if("function"!=typeof d&&(d=m.log),j){var e=Date.now();e/=1e3,e|=0,e!==l&&(i=b.timeToString(e-k),l=e),e=i,d.call(console,["[",e,"] ",c].join(""))}else d.call(console,c)}var d=console.error,e=console.warn,f=console.log,g=console.debug,h=a.config();h&&h.console&&h.console.timestamp&&(j=h.console.timestamp);var i,k=Date.now()/1e3|0,l=0,m={error:d,warn:e,log:f,trace:g};return{report:c}}function f(a){function b(b){a.report(k.error,b)}function c(b){a.report(k.warn,b)}function d(b){a.report(k.log,b)}function e(b){a.report(k.trace,b)}return{error:b,warn:c,log:d,trace:e}}function g(){return h=d(),i=e(),{Level:k,createAbstractClient:c,getConsoleClient:function(){return i},getNullClient:function(){return h},createLogMapper:f}}var h,i,j=!1,k={error:"error",warn:"warn",log:"log",trace:"trace"};return g()}),define("ensis/logger/logger",["module","ensis/logger/logclient"],function(a,b){"use strict";function c(a){var b;return b=m[a]?m[a]:k}function d(a){var b={},d=0,e=null;return b.getName=function(){return a},b.setClient=function(a){e=a},b.getClient=function(){return e},b.getConfigTime=function(){return d},b.configureLoggerLevels=function(){function e(a,b,c){return function(){a.call(b,c,Array.apply(null,arguments))}}var f=c(a),i=n[f];for(var j in i)i[j]?b[j]=e(g,b,j):b[j]=e(h,b,j);d=Date.now()},b.configureLoggerLevels(),b}function e(a){o=a}function f(a){k=a,l=Date.now()}function g(a,b){var c=this,d=c.getName();if(i(c.getConfigTime()))return c.configureLoggerLevels(),void c[a].apply(c,b);var e=c.getClient();if("undefined"==typeof e||null===e)e=o;else if("function"==typeof e.isNullClient&&e.isNullClient())return;var f=b.map(function(a){if("undefined"==typeof a)return"<undefined>";if(null===a)return"<null>";if("object"==typeof a){var b;try{b=JSON.stringify(a)}catch(c){try{b="[Object] (E): "+Object.keys(a).join()}catch(d){b="[Object] (E): "+d.message}}return b}return a});f.unshift(d,": "),e.report(a,f.join(""))}function h(a,b){var c=this;if(i(c.getConfigTime()))return c.configureLoggerLevels(),void c[a].apply(c,b)}function i(a){return a<l}function j(){return{create:d,setDefaultClient:e,setDefaultLogLevel:f}}var k,l=0,m=a.config();m||(m={}),k=m["default"]?m["default"]:"log";var n={error:{trace:!1,log:!1,warn:!1,error:!0},warn:{trace:!1,log:!1,warn:!0,error:!0},log:{trace:!1,log:!0,warn:!0,error:!0},trace:{trace:!0,log:!0,warn:!0,error:!0}},o=b.getConsoleClient();return j()}),define("ensis/lang/object",[],function(){function a(a,b){var c=b||{};for(var d in a)c.hasOwnProperty(d)||(c[d]=a[d]);return c}function b(){return{extend:a}}return b()}),define("ensis/lang/arguments",[],function(){"use strict";function a(a){return[].splice.call(a,0)}return{toArray:a}}),define("ensis/lang/function",["ensis/logger/logger"],function(a){function b(){}function c(a){return function(){e.trace("Call to NOP: ",a,": ",arguments)}}function d(a){function b(b){try{var c=[].splice.call(arguments,1);if("function"==typeof b)return b.apply(this,c);"function"==typeof a.missing&&a.missing(b,c)}catch(d){"function"==typeof a["catch"]&&a["catch"](d)}}return a=a||{},b}var e=a.create("lang/fn"),f=d();return{NOP:b,namedNOP:c,checked:f,makeChecked:d}}),define("ensis/lang/error",[],function(){"use strict";function a(a,b){this.message=a,this.code=b}function b(){return{Error:a}}return a.prototype=new Error,a.create=function(){var b,c,d=[].splice.call(arguments,0);return b="string"==typeof d[0]?d.shift():"Generic Error based on ensis library","number"==typeof d[0]&&(c=d.shift()),new a(b,c)},b()}),define("ensis/async/async2",["ensis/logger/logger","ensis/lang/function","ensis/lang/error"],function(a,b,c){"use strict";function d(a,b){this.message=a,this.code=b,this.ErrorCode=k}function e(){function a(a){if(s(a),y)throw d.create("can call init when already working",k.INVALID_INITIALIZATION);if(z)throw d.create("can call init when already completed",k.INVALID_INITIALIZATION);t(function(){y=!0,a.call(B)})}function c(a){if(z)throw d.create("already completed",k.ALREADY_COMPLETED);return u.push(a),B}function e(a){if(s(a),null!==v)throw d.create("catch handler already defined",k.INVALID_INITIALIZATION);return v=a,B}function i(a){if(s(a),null!==w)throw d.create("done handler already defined",k.INVALID_INITIALIZATION);return w=a,B}function l(a){t(function(){o(a)})}function m(a){A=!0;try{b.checked(B.onCancelled,B)}catch(c){}B.onCancelled=null,p(h(d.create(a,k.CANCELLED))),q(B)}function n(){if(x)return x.getValue()}function o(a){var c=C;try{if(a instanceof Error)throw"undefined"!=typeof a.rethrow?a.rethrown:a;if(A)z||j.error("Should be completed if we're cancelled");else if(u.length<=c)z||(p(g(a)),q(B));else{var d=u[c];++C;var e;e="function"==typeof d?d(a):d,"undefined"==typeof e?e=f():e.isDeferred||(e=f(e)),e.onAfterCompleted=function(a){return function(b){r(b,a)}}(c)}}catch(i){b.checked(v,i,c),p(h(i)),q()}}function p(a){z=!0,y=!1,x=a,b.checked(w,B),u=[],v=null,w=null}function q(){try{b.checked(B.onAfterCompleted,B)}catch(a){j.error(a.message)}}function r(a,c){var d;try{d=a.getFinalValue(),l(d)}catch(e){b.checked(v,e,c),p(h(e)),q(B)}}function s(a){if("function"!=typeof a)throw d.create("invalid function",k.INVALID_VALUE)}function t(a){setTimeout(a,0)}var u=[],v=null,w=null,x=null,y=!1,z=!1,A=!1,B={execute:a,then:c,"catch":e,done:i,cancel:m,onComplete:l,onAfterCompleted:null,onCancelled:null,getFinalValue:n,isDeferred:!0},C=0;return B}function f(a){var b=e();return b.execute(function(){b.onComplete(a)}),b}function g(a,b){return{getValue:function(){if("undefined"!=typeof b)throw b;return a}}}function h(a){return g(null,a)}function i(){return{Deferred:e,Error:d,Result:g,ResultError:h}}var j=a.create("Async2"),k={ALREADY_STARTED:0,ALREADY_COMPLETED:1,INVALID_VALUE:16,INVALID_INITIALIZATION:17,CANCELLED:32,RETHROWN:33};return d.prototype=new Error,d.ErrorCode=k,d.create=function(a,b){return new d(a,b)},d.makeRethrowable=function(a){var b=d.create("Rethrown error -- "+a.message,k.RETHROWN);return b.rethrown=a,b},i()}),define("ensis/media/types",[],function(){"use strict";var a={AUDIO:"audio",VIDEO:"video"},b={SD:"sd",SD_HIGHP:"sd-highp",SD_MAIN10:"sd-main10",HD:"hd",HDX:"hdx",HDX_HIGHP:"hdx-highp",HDX_MAIN10:"hdx-main10",UHD:"uhd",SDR:"uhd-sdr",HDR10:"uhd-hdr10",DOVI:"uhd-dolbyvision",DOVI4:"uhd-dovi-4",DOVI5:"uhd-dovi-5",UHD_SDR:"uhd-sdr",UHD_MAIN10:"uhd-main10",UHD_HDR10:"uhd-hdr10",UHD_DOVI4:"uhd-dovi-4",UHD_DOVI5:"uhd-dovi-5"},c={AAC:"aac",DD:"dd",DDP:"ddp",ATMOS:"atmos",PCM_STEREO:"pcm_stereo",PCM_SURROUND:"pcm_surround"},d={Audio:c,Video:b},e={widevine:"EDEF8BA9-79D6-4ACE-A3C8-27DCD51D21ED",playready:"9A04F079-9840-4286-AB92-E65BE0885F95",dash:"mp4protection:2011",dash2011:"mp4protection:2011"},f=function(){function a(a){var b=c.unknown;return a&&(b=0===a.indexOf("audio/")?c.audio:0===a.indexOf("video/")?c.video:c.other),b}function b(a){return a>c._media}var c={unknown:0,other:1,_media:256,audio:257,video:258};return{unknown:c.unknown,other:c.other,audio:c.audio,video:c.video,getType:a,isMedia:b}}(),g=function(){function a(a){return a==h.AUDIO||(a==h.VIDEO||a==h.TEXT)}function b(b){var c=b&i,d=b&j;if(!a(d))throw new Error("Type must be non-zero: "+b+" ("+d+")");return{index:c,type:d}}function c(b,c){if(!a(b))throw new Error("Type must be one of type: "+JSON.stringify(h));if(c>i)throw new Error("Can't have more than "+i+" tracks per type");return b|c}function d(a){var c=b(a);return c.index}function e(a){var c=b(a);return c.type}function f(a,b){var d=0;switch(a){case cast.receiver.media.TrackType.VIDEO:d=h.VIDEO;break;case cast.receiver.media.TrackType.AUDIO:d=h.AUDIO;break;case cast.receiver.media.TrackType.TEXT:d=h.TEXT}return c(d,b)}function g(a){var c=b(a),d=0;switch(c.type){case h.VIDEO:d=cast.receiver.media.TrackType.VIDEO;break;case h.AUDIO:d=cast.receiver.media.TrackType.AUDIO;break;case h.TEXT:d=cast.receiver.media.TrackType.TEXT}return{type:d,index:c.index}}var h={AUDIO:16,VIDEO:32,TEXT:64},i=15,j=h.AUDIO|h.VIDEO|h.TEXT;if(0!==(i&j))throw new Error("Masks overlap");return{Type:h,toIndex:d,toType:e,toTuple:b,makeCastId:f,makeCastTuple:g}}();return{MediaType:a,MediaFormat:d,Track:g,AdaptationType:f,DrmSchemeUUID:e}}),define("ensis/isoreader/boxreader/base",["ensis/lang/object","ensis/logger/logger"],function(a,b){"use strict";function c(a){return"undefined"!=typeof a&&"undefined"!=typeof a.offset&&"undefined"!=typeof a.bytearray}function d(a){"undefined"==typeof a?a=[]:"function"!=typeof a.forEach&&(a=[]);var b=new Uint8Array(a);return new DataView(b.buffer)}function e(a,b){return"undefined"==typeof a||null==a?(h.trace("createStreamInterface called with no object.  Returning empty stream"),a=d()):"function"==typeof a.getUint8||("object"==typeof a&&"function"==typeof a.forEach?a=d(a):(h.warn("createStream interface given object that can't directly massage to DataView.  Returning empty stream"),a=d())),"number"!=typeof b?b=0:b>=a.byteLength&&(b=0),{bytearray:a,offset:b}}function f(a,b){var c,d=null;if("string"!=typeof b){var f=a.split("");f=Uint8Array.from([].map.call(f,function(a){return a.charCodeAt(0)})),c=new DataView(f.buffer)}else switch(b=b.toLowerCase()){case"base64":if("undefined"!=typeof window&&"function"==typeof window.atob)try{var g=atob(a);g=Uint8Array.from([].map.call(g,function(a){return a.charCodeAt(0)})),c=new DataView(g.buffer)}catch(i){d="Invalid data: "+i.message}else if("undefined"==typeof Buffer)d="Unsupported encoding 'base64'";else try{c="function"==typeof Buffer.from?Buffer.from(a,"base64"):new Buffer(a,"base64")}catch(i){d="Invalid format: "+i.message}break;case"hex":d="Unsupported format: "+b;break;default:d="Invalid encoding: "+b}if(a&&!c&&!d&&a.length&&h.warn("createStreamFromString: Unexpected empty stream when data had content: ",a.substr(0,16),"...",a.length),null!==d)throw h.error("createStreamFromString: Conversion failed with error: ",d),new Error(d);return e(c)}function g(){return{BoxParsers:q,createStream:e,createStreamFromString:f,isStream:c,ValueField:r,Box:j,FullBox:k,SidxBox:o,HierarchyBoxes:l}}var h=b.create("boxreader/base"),i=a.extend,j=function(){function a(a,b,c,d){var e={};if(1==c){if("string"!=typeof d)throw new Error("Wrong storage type for ui64");c=Number.NaN}else 0==c&&(c=Number.POSITIVE_INFINITY);return e.getType=function(){return a},e.getSize=function(){return isNaN(c)?d:c},e}function b(b){var c,d=0,e=b.offset,f=b.bytearray,g=f.getUint32(e);if(e+=4,1==g){var h=f.getUint32(e);e+=4;var i=f.getUint32(e);e+=4,c=""+h+":"+i}for(var j=[];4!=d;){var k=f.getUint8(e);j.push(String.fromCharCode(k)),++e,++d}j=j.join("");var l;return b.offset=e,a(j,l,g,c)}var c={};return c.create=a,c.fromStream=b,c}(),k=function(){function a(a,c,e,g,h){var i=j.create(a,null,g,h);return i.getVersion=function(){return c},i.getFlag=function(a){return b(e,a)},i.getFlags=function(){return e},i.setFlags=function(a){return e=a},i.setFlag=function(a,b){return e=d(e,a,b)},i.asStream=function(a){return f(i,a)},i}function b(a,b){var c=a;return c<<=b,c&=21,!!c}function d(a,b,c){var d=1<<b,e=c?1:0;e<<=b;var f=a&~d;return f|=e}function e(a){var c=(a.offset,j.fromStream(a)),d={},e=a.offset,g=a.bytearray,h=g.getUint8(e);++e;for(var i=0,k=0;3!=k;++k)i<<=8,i|=g.getUint8(e),++e;return a.offset=e,d.getVersion=function(){return h},d.getFlag=function(a){return b(i,a)},d.getFlags=function(){return i},d.getSize=c.getSize,d.getType=c.getType,d.asStream=function(a){return f(d,a)},d}function f(a,b){var d=a.getType(),e=a.getSize();if(!c(b)){var f=new ArrayBuffer(e);b={bytearray:new DataView(f),offset:0}}var g=b.offset,h=b.bytearray;h.setUint32(g,e),g+=4;for(var i=0;4!=i;++i)h.setUint8(g++,d.charCodeAt(i));h.setUint8(g++,a.getVersion());var j=a.getFlags(),k=255&j;j>>=8;var l=255&j;j>>=8;var m=255&j;return h.setUint8(g++,m),h.setUint8(g++,l),h.setUint8(g++,k),b.offset=g,b}var g={};return g.create=a,g.fromStream=e,g}(),l=function(){function a(a,b,c){function d(){var a=0;return r.forEach(function(b){a+=b.getSize()}),a}function e(){return r.length}function f(){return r}function g(a){return r[a]}function i(a){r=a}function k(a){r.splice(a,1)}function l(a,b){r.splice(a,0,b)}function m(a){var b=function(a){return{get:function(b){return g(a[b])},position:function(b){return a[b]},count:function(){return a.length}}},c=[];r.forEach(function(b,d){a===b.getType()&&c.push(d)});var d=b(c);return d}function n(){throw new Error("Size of HierarchyBox must be implemented in subclass: "+c)}function o(){return c}for(var p=a.offset,r=[],s=p;s!=p+b;){h.trace("idx: ",s,"; size: ",a.bytearray.byteLength);var t=j.fromStream(a);h.trace("Subbox type: ",t.getType(),"; of parent: ",c);var u=q.getParser(t.getType());a.offset=s,t=u.fromStream(a),r.push(t),s+=t.getSize()}return a.offset=p+b,{getSize:n,getType:o,getChildBox:g,removeChildBox:k,insertChildBox:l,getChildBoxes:f,setChildBoxes:i,getChildBoxesByType:m,getChildBoxesSize:d,getChildBoxesCount:e}}function b(a,b){if(!c(b)){var d=new ArrayBuffer(a.getSize());b={bytearray:new DataView(d),offset:0}}var e=b.offset;b.bytearray.setUint32(b.offset,a.getSize()),b.offset+=4;for(var f=a.getType(),g=0;4!=g;++g)b.bytearray.setUint8(b.offset++,f.charCodeAt(g));var h=a.getChildBoxes();h.forEach(function(a){
a.asStream(b)});var i=b.offset-e;return b.bytearray.setUint32(e,i),b}return{create:a,asStream:b}}(),m=function(){function a(a){var b=a.offset,d=j.fromStream(a),e=i(d),f=a.bytearray.buffer.slice(b,b+e.getSize());return a.offset=b+f.byteLength,e.asStream=function(a){var b,d;if(c(a)){b=a.bytearray,d=a.offset;for(var e=new Uint8Array(b.buffer),g=new Uint8Array(f),h=0;h!=g.byteLength;++h)e[d+h]=g[h];d+=g.byteLength,a.offset=d}else b=f.slice(0,f.byteLength),d=f.byteLength;return{bytearray:b,offset:d}},e}function b(){return{fromStream:a}}return b()}(),n=function(){function a(a){return m.fromStream(a)}function b(){return{fromStream:a}}return b()}(),o=function(){function a(a){var b=(a.offset,k.fromStream(a)),e=i(b),f=a.offset,g=a.bytearray,h=g.getUint32(f);f+=4;var j=g.getUint32(f);f+=4;var l=Number.NaN,m=Number.NaN;if(0!=b.getVersion())throw new Error("Too big!");l=g.getUint32(f),f+=4,m=g.getUint32(f),f+=4,f+=2;var n=g.getUint16(f);f+=2;for(var o=[],p=0;p!=n;++p){var q={ref_info:null,subsegment_duration:0,sap_info:null},r=g.getUint32(f);q.ref_info=c(r),f+=4,q.subsegment_duration=g.getUint32(f),f+=4;var s=g.getUint32(f);q.sap_info=d(s),f+=4,o.push(q)}return a.offset=f,e.getReferenceId=function(){return h},e.getTimescale=function(){return j},e.getEarliestPresentationTime=function(){return l},e.getFirstOffset=function(){return m},e.getReferenceCount=function(){return n},e.getReference=function(a){return o[a]},e}function b(){return e.fromStream=a,e}function c(a){return{type:2147483648&a?"sidx":"moof",size:34359738367&a}}function d(a){return{start_with_sap:!!(2147483648&a),sap_type:(1879048192&a)>>28,delta_time:268435455&a}}var e={};return b()}(),p={sidx:o,ftyp:n},q={getParser:function(a){var b=p[a];return b||(h.trace("No box parser for '",a,"'; handle as 'BoxOfStuff'"),b=m),b},registerParser:function(a,b){p[a]&&h.warn("Overwriting parser for '",a,"'"),p[a]=b},getRegisteredParsers:function(){var a=[];for(var b in p)"function"==typeof p[b].fromStream&&a.push(b);return a},parseBox:function(a){if(!c(a))throw new Error(q.Error.stream);var b,d,e,f;try{b=a.offset,d=j.fromStream(a),e=d.getType(),f=q.getParser(e),a.offset=b,d=f.fromStream(a)}catch(g){throw h.error("Problem while parsing Box: ",g.message,"; at offset: ",a.offset),new Error(q.Error.parse)}return h.trace("Found box: ",e,"; in stream at offset: ",b),d},parseAllBoxes:function(a){if(!c(a))throw new Error(q.Error.stream);var b=[];try{for(;a.offset<a.bytearray.buffer.byteLength;)b.push(q.parseBox(a))}catch(d){throw h.error("Problem parsing boxlist: ",d.message,"; at position: ",b.length),new Error(q.Error.parse)}return b},Error:{parse:"parse_error",stream:"stream_error"}},r=function(){function a(a,b,c){return{getValue:function(){return a?[b,c].join(":"):b},getFloatValue:function(){return r.toFloatValue(b,c)},getBitCount:function(){return a?64:32},getByteCount:function(){return a?8:4},getAsArray:function(){return a?[b,c]:[b]}}}function b(b){if("number"!=typeof b)throw new Error("Invalid initializer: must be a number: "+b);return a(!1,b)}function c(b){var c;if("string"==typeof b){var d=b.split(":");if(2!==d.length)throw new Error("Invalid initializer: string must have single ':': "+b);c=a(!0,0|d[0],0|d[1])}else{if(!Array.isArray(b))throw new Error("Invalid initializer: must be a two element array or string: "+b);if(2!==b.length)throw new Error("Invalid initializer: list must have two elements: "+b);if("number"!=typeof b[0]||"number"!=typeof b[1])throw new Error("Invalid initializer: list elements must be numbers: "+b);c=a(!0,b[0],b[1])}return c}function d(a,b){var d=[];"string"==typeof a?d=c(a).getAsArray():"number"==typeof a&&(d=[a],"number"==typeof b&&d.push(b));var e=d.reduce(function(a,b){return a*=34,a+=b},0);return e}function e(){return{create32:b,create64:c,toFloatValue:d}}return e()}();return g()}),define("ensis/isoreader/boxreader/ssig",["ensis/logger/logger","ensis/lang/object","ensis/isoreader/boxreader/base","ensis/lang/error"],function(a,b,c,d){"use strict";function e(){c.BoxParsers.registerParser("ssig",i)}function f(){return{SegmentSignatureBox:i,registerParsers:e}}var g=a.create("iso/ssig"),h=b.extend,i=function(){function a(a){a||(a=[]);var b=0,d=0,e=16+32*a.length,f=c.FullBox.create("ssig",b,d,e),g=h(f);return g.getSize=function(){return e},g.getSegmentSignature=function(b){return a[b]},g.getEntryCount=function(){return a.length},g.asStream=function(b){if(!c.isStream(b)){var d=new ArrayBuffer(g.getSize());b={offset:0,bytearray:new DataView(d)}}var e=b.offset;f.asStream(b);var h=b.offset,i=b.bytearray;i.setUint32(h,a.length),h+=4,a.forEach(function(a){for(var b=0;b<a.byteLength;b++)i.setUint8(h,a[b]);h+=a.byteLength});var j=h-e;return i.setUint32(e,j),b.offset=h,b},g}function b(b){var d=b.offset,e=[],f=(c.FullBox.fromStream(b),b.offset),h=b.bytearray,i=h.getUint32(f);f+=4;for(var j=32,k=0;k<i;++k){try{var l=new Uint8Array(h.buffer,f,j);l?e[k]=l:g.error("no ssig from buffer")}catch(m){g.error("failed to get ssig: ",m.message)}f+=j}return b.offset=d+f,a(e)}function d(){return{create:a,fromStream:b}}return d()}();return f()}),define("ensis/dash/initdatacache",["ensis/logger/logger","ensis/async/async2","ensis/lang/object","ensis/lang/error","ensis/media/types","ensis/isoreader/boxreader/base","ensis/isoreader/boxreader/ssig"],function(a,b,c,d,e,f,g){"use strict";function h(a,b,c,e){if(4!==arguments.length)throw d.Error.create("Invalid arguments");return{baseUrl:a,anchor:b,init:c,sidx:e}}function i(a,b){C=a;var c;for(var d in b){var e=b[d].ancr,g=b[d].init,i=b[d].sidx,j=b[d].ssig;g=atob(g),i=atob(i);var k=Uint8Array.from(g.split("").map(function(a){return a.charCodeAt(0)})),l=Uint8Array.from(i.split("").map(function(a){return a.charCodeAt(0)}));if(c=h(d,e,k.buffer,l.buffer),B[d]&&(B[d].vini=c,j)){var m=f.createStreamFromString(j,"base64"),n=f.BoxParsers.parseBox(m);B[d].ssigBox=n}}}function j(a){function b(a,b,c){for(var d,e,f,g,h=a.getElementsByTagName("Representation"),i=[],j=0;j!=h.length;++j){var l=h[j];g=l.getAttribute("mimeType"),g=g||c;for(var n=l.firstChild;n;){switch(n.nodeName){case"SegmentBase":e=n.getAttribute("indexRange");var o=n.getElementsByTagName("Initialization");1===o.length&&(f=o[0].getAttribute("range"));break;case"BaseURL":d=k(n),d=d.trim()}n=n.nextSibling}var p=m(d,g,f,e);p.adaptationId=b,p.representationId=j,i.push(p)}i.sort(function(a,b){var c=h[a.representationId].getAttribute("bandwidth"),d=h[b.representationId].getAttribute("bandwidth");return c=Number.parseInt(c),d=Number.parseInt(d),c>d?1:-1}),i.forEach(function(a,b){a.quality=b,B[a.url]=a})}B={};for(var c=a.getElementsByTagName("AdaptationSet"),d=0;d!=c.length;++d){var e=c[d],f=e.getAttribute("mimeType");b(e,d,f)}}function k(a){if(!a.hasChildNodes())return"";for(var b=[],c=0;c!=a.childNodes.length;++c){var d=a.childNodes[c];d.nodeType===Node.TEXT_NODE&&b.push(d.nodeValue)}return b.join("")}function l(a){var b=null;if(Array.isArray(a))b=[],a.forEach(function(a,c){b[c]=parseInt(a)});else if("string"==typeof a){var c=a.split("-");c.forEach(function(a,b){c[b]=parseInt(c[b])}),b=c}return b}function m(a,b,c,d){return{url:a,mimeType:b,initRange:l(c),segmentBaseRange:l(d),vini:null}}function n(a){function c(){if(i)if(200<=k.status&&k.status<300){if(null!==k.response){var c=k.response;if("json"!==k.responseType)try{c=JSON.parse(k.response)}catch(d){c=null}c&&(j=!0,g.onComplete({url:a,initdata:c}))}}else A.warn("HTTP response: ",k.status);else A.warn("Failed to get initdata");j||g.onComplete(b.Error.create("Failed to retreive"))}function d(){A.warn("Request aborted")}function e(){A.log("Received good HTTP response: ",k.status," - ",k.statusText),i=!0}function f(){A.warn("XHR request being aborted"),k.abort(),k=null}var g=b.Deferred(),h=g.cancel,i=!1,j=!1,k=new XMLHttpRequest;return g.execute(function(){k.open("GET",a,!0),k.onload=e,k.onloadend=c,k.onabort=d,k.responseType="json";try{k.send()}catch(f){g.onComplete(b.Error.makeRethrowable(f))}}),g.cancel=function(){f(),h.call(g,"SIDX request aborted")},g}function o(a){function c(){j?200<=l.status&&l.status<300?(l.responseXML?k=!0:"string"==typeof l.response&&l.response.length>=7&&(k=!0),k&&("string"==typeof l.responseURL&&l.responseURL.length>0&&a!==l.responseURL&&(A.log("Updating URL for subsequent resources, based on manifest response:",a," => ",l.responseURL),a=l.responseURL),h.onComplete({url:a,manifestText:l.response,manifestDOM:l.responseXML}))):A.error("HTTP response: ",l.status):A.error("Failed to get manifest"),k||h.onComplete(d.Error.create("Failed to retreive manifest"))}function e(){A.warn("Request aborted")}function f(){A.log("Received good HTTP response: ",l.status," - ",l.statusText),j=!0}function g(){A.log("XHR request being aborted"),l.abort(),l=null}var h=b.Deferred(),i=h.cancel,j=!1,k=!1,l=new XMLHttpRequest;return h.execute(function(){l.open("GET",a,!0),l.onload=f,l.onloadend=c,l.onabort=e,l.responseType;try{l.send()}catch(d){A.error("Failed to fetch manifest: "+d.message),h.onComplete(b.makeRethrowable(d))}}),h.cancel=function(){g(),i.call(h,"Manifest request aborted")},h}function p(a){var c=b.Deferred(),e=!1;return c.execute(function(){o(a).then(function(a){e=!0;var b=a.manifestDOM;if(!b){if("string"!=typeof a.manifestText||a.manifestText.length<=0)throw d.Error.create("Unable to download manifest");var c=new DOMParser;b=c.parseFromString(a.manifestText,"text/xml")}j(b);var f=a.url.replace("manifest.mpd","sidxs.json");return A.log("Looking for SIDX info at: ",f),n(f)}).then(function(a){i(a.url,a.initdata)})["catch"](function(a){A.error("Problem populating initdata: ",a.message)}).done(function(){c.onComplete(!!e||d.Error.create("manifest not found"))})}),c}function q(){return B}function r(a){if("undefined"==typeof B[a])throw d.Error.create("Representation not found: "+a);return B[a]}function s(a,b){var c=a===e.MediaType.VIDEO?e.AdaptationType.video:e.AdaptationType.audio;return t(c)}function t(a,b){var c=[];if("undefined"==typeof b&&(b=Number.NaN),e.AdaptationType.video!==a&&e.AdaptationType.audio!==a)throw d.Error.create("Invalid argument");for(var f in B){var g=B[f];e.AdaptationType.getType(g.mimeType)===a&&(Number.isNaN(b)||g.adaptationId===b)&&c.push(g)}return c}function u(a,b,c){"undefined"==typeof c&&(c=Number.NaN);for(var f in B){var g=B[f];if(g.quality===b&&e.AdaptationType.getType(g.mimeType)===a&&(Number.isNaN(c)||g.adaptationId===c))return g}throw d.Error.create("Invalid argument")}function v(a){return!!B[a]&&!!B[a].ssigBox}function w(a,b,c){var d=!1,e=B[a];if("undefined"==typeof e)return A.warn(a," is not included in cache"),!1;if(!e.vini)return A.trace("No cache data for ",a),!1;var f=[e.initRange,e.segmentBaseRange].sort(function(a,b){return a[0]<b[0]?-1:1});if(1!==f[1][0]-f[0][1])A.trace("init data ranges are not contiguous, can't concat");else{var g=[f[0][0],f[1][1]];f=[g]}for(;0!==f.length;){var h=f.shift();b>=h[0]&&c<=h[1]&&(d=!0)}return A.trace("Range ",b,"-",c,d?"can ":"can't ","be extracted from cache"),d}function x(a,b){return B[a].ssigBox.getSegmentSignature(b)}function y(a,b,c){var d;if(b=Number.parseInt(b),c=Number.parseInt(c),b>c)return void A.error("start > end: ",b,"-",c);var e=B[a];if("undefined"==typeof e)return void A.warn(a," is not included in cache");if(!e.vini)return void A.trace("No cache data for ",a);var f=[{range:e.initRange,data:e.vini.init},{range:e.segmentBaseRange,data:e.vini.sidx}].sort(function(a,b){return a.range[0]<b.range[0]?-1:1}),g={NONE:0,PARTIAL:1,COMPLETE:2},h=g.NONE,i=g.NONE;b>=f[0].range[0]&&(c<=f[0].range[1]?h=g.COMPLETE:b<=f[0].range[1]&&(h=g.PARTIAL)),g.COMPLETE!==h&&c<=f[1].range[1]&&(b>=f[1].range[0]?i=g.COMPLETE:c>=f[1].range[0]&&(i=g.PARTIAL));var j,k;if(g.COMPLETE===h)A.trace("Cached data found in single cache object: ",a,"; range: ",b,"-",c),j=b-f[0].range[0],k=c-b+1,d=f[0].data.slice(j,j+k);else if(g.COMPLETE===i)A.trace("Cache data found in single cached object: ",a,"; range: ",b,"-",c),j=b-f[1].range[0],k=c-b+1,d=f[1].data.slice(j,j+k);else if(g.PARTIAL===h&&g.PARTIAL===i)if(1!==f[1].range[0]-f[0].range[1])A.warn("Cached objects are not contiguous, can't return data from cache: ",a,"; range: ",b,"-",c);else{A.trace("Cache data found, but spans both cached object: ",a,"; range: ",b,"-",c),j=b-f[0].range[0],k=c-b+1,d=new Uint8Array(k);var l=new Uint8Array(f[0].data,j);k-=l.byteLength;var m=new Uint8Array(f[1].data,0,k);d.set(l),d.set(m,l.byteLength),d=d.buffer}else A.trace("Requested range not held in cache: ",a,"; range: ",b,"-",c);return d}function z(){return{VidxItem:h,RepresentationItem:m,cacheInitData:i,buildRepresentations:j,fetchInitData:n,fetchManifest:o,populateFromManifestUrl:p,getData:q,getFragmentSignature:x,getCacheRange:y,getRepresentationForUrl:r,getRepresentationsForType:s,getRepresentationsForAdaptationType:t,getRepresentationForAdaptationAndQuality:u,isRangeIncluded:w,isWatermarked:v}}var A=a.create("initdata");g.registerParsers();var B,C;return z()}),define("asteroid/target/target",{target:"vesta"}),"undefined"==typeof Uint8Array.from&&(Uint8Array.from=function(a,b,c){if("undefined"==typeof a)return new Uint8Array(0);if("string"==typeof a&&(a=a.split("")),!Array.isArray(a))return new Uint8Array(0);"function"!=typeof b&&(b=null);var d=new Uint8Array(a.length);return a.forEach(function(a,e){b&&(a=b.call(c,a)),d[e]=255&(0|a)}),d}),define("asteroid/target/fills/browser_engine_fill",function(){}),define("asteroid/target/fills",["./fills/browser_engine_fill"],function(){return{}}),define("ensis/media/codec",["ensis/media/types","ensis/logger/logger"],function(a,b){function c(a,b){var c=!1,d=a.split(";");if(2!==d.length)e.error("Codec string must have a ';': ",a);else{var f=d[1];d=f.split("="),2!==d.length?e.error("Codec string must have a '=': ",a):(f=d[1],-1!==f.indexOf(b)&&(c=!0))}return e.trace("codec ",b,c?" is":" not"," present in ",a),c}function d(a,b){var c,d=null,f=a.split(","),g=f.length;Array.isArray(b)?c=b:"string"==typeof b&&(c=[b]);var h={};f.forEach(function(a){a=a.trim(),h[a]=!0}),c.forEach(function(a){a=a.trim(),delete h[a]}),f=[];for(var i in h)f.push(i);d=0===f.length?"":f.join(",");var j=f.length;return g!==j&&e.log("Codec string modified: ",a," -> ",d),d}var e=b.create("Codec"),f={type:a.Track.Type.AUDIO,name:"AAC-LC","class":a.MediaFormat.Audio.AAC,codecs:"mp4a.40.2",priority:1},g={type:a.Track.Type.AUDIO,name:"AAC-HE","class":a.MediaFormat.Audio.AAC,codecs:"mp4a.40.5",priority:1},h={type:a.Track.Type.AUDIO,name:"Dolby Digital","class":a.MediaFormat.Audio.DD,codecs:"ac-3",priority:2},i={type:a.Track.Type.AUDIO,name:"Dolby Digital Plus","class":a.MediaFormat.Audio.DDP,codecs:"ec-3",priority:3},j={type:a.Track.Type.VIDEO,name:"AVC(1)","class":[a.MediaFormat.Video.SD,a.MediaFormat.Video.SD_HIGHP,a.MediaFormat.Video.HD,a.MediaFormat.Video.HDX,a.MediaFormat.Video.HDX_HIGHP],codecs:"avc1.640029",priority:1},k={type:a.Track.Type.VIDEO,name:"AVC(3)","class":[a.MediaFormat.Video.SD,a.MediaFormat.Video.SD_HIGHP,a.MediaFormat.Video.HD,a.MediaFormat.Video.HDX,a.MediaFormat.Video.HDX_HIGHP],codecs:"avc3.640029",priority:1},l={type:a.Track.Type.VIDEO,name:"HEVC/H265 2K","class":[a.MediaFormat.Video.SD_MAIN10,a.MediaFormat.Video.HDX_MAIN10,a.MediaFormat.Video.UHD_MAIN10,a.MediaFormat.Video.UHD_SDR],codecs:"hev1.2.4.L150.B0",priority:2},m=({type:a.Track.Type.VIDEO,name:"HDR10 2K","class":a.MediaFormat.Video.UHD_HDR10,codecs:"hev1.2.4.L120.B0",eotf:"smpte2084",priority:3},{type:a.Track.Type.VIDEO,name:"HDR10 4K","class":a.MediaFormat.Video.UHD_HDR10,codecs:"hev1.2.4.L150.B0",eotf:"smpte2084",priority:3}),n={type:a.Track.Type.VIDEO,name:"Dolby Vision Profile 4","class":[a.MediaFormat.Video.DOVI,a.MediaFormat.Video.DOVI4],codecs:"hev1.2.4.L150.B0,dvhe.dtr",priority:4,canbe:["hev1.2.4.L120.B0"]},o={type:a.Track.Type.VIDEO,name:"Dolby Vision P4 2K 24fps","class":a.MediaFormat.Video.UHD_DOVI4,codecs:"hev1.2.4.L120.B0,dvhe.04.03",priority:4,canbe:["hev1.2.4.L120.B0"]},p={type:a.Track.Type.VIDEO,name:"Dolby Vision P4 2K 30fps","class":a.MediaFormat.Video.UHD_DOVI4,codecs:"hev1.2.4.L120.B0,dvhe.04.04",priority:4,canbe:["hev1.2.4.L120.B0"]},q={type:a.Track.Type.VIDEO,name:"Dolby Vision P4 4K 24fps","class":a.MediaFormat.Video.UHD_DOVI4,codecs:"hev1.2.4.L150.B0,dvhe.04.06",priority:4,canbe:["hev1.2.4.L150.B0"]},r={type:a.Track.Type.VIDEO,name:"Dolby Vision P4 4K 30fps","class":a.MediaFormat.Video.UHD_DOVI4,codecs:"hev1.2.4.L150.B0,dvhe.04.07",priority:4,canbe:["hev1.2.4.L150.B0"]},s={type:a.Track.Type.VIDEO,name:"Dolby Vision P5 2K 24fps","class":a.MediaFormat.Video.UHD_DOVI5,codecs:"dvhe.05.03",priority:5},t={type:a.Track.Type.VIDEO,name:"Dolby Vision P5 2K 30fps","class":a.MediaFormat.Video.UHD_DOVI5,codecs:"dvhe.05.04",priority:5},u={type:a.Track.Type.VIDEO,name:"Dolby Vision P5 4K 24fps","class":a.MediaFormat.Video.UHD_DOVI5,codecs:"dvhe.05.06",priority:5},v={type:a.Track.Type.VIDEO,name:"Dolby Vision P5 4K 30fps","class":a.MediaFormat.Video.UHD_DOVI5,codecs:"dvhe.05.07",priority:5},w={makeCodecsString:function(a,b){var c=a+'; codecs="'+b+'"';return c},checkCodecsString:c,removeCodecs:d,PROBABLY:"probably",MAYBE:"maybe",NONE:"",Formats:{audio:[f,g,h,i],video:[j,k,l,m,n,o,p,q,r,s,t,u,v]},Names:{audio:{AACLC:0,AACHE:1,DolbyDigital:2,DolbyDigitalPlus:3},video:{H264:0,H264DASH:1,H265:2,HDR10:3,DOVI:4,DOVI_2k_24:5,DOVI_2k_30:6,DOVI_4k_24:7,DOVI_4k_30:8,DOVI4_2k_24:5,DOVI4_2k_30:6,DOVI4_4k_24:7,DOVI4_4k_30:8,DOVI4:8,DOVI5_2k_24:9,DOVI5_2k_30:10,DOVI5_4k_24:11,DOVI5_4k_30:12,DOVI5:12}}};return w}),define("ensis/media/fc/mediaelement",["ensis/logger/logger","ensis/media/codec"],function(a,b){"use strict";function c(a){var c=a&&"function"==typeof a.createElement?a.createElement:function(){return document.createElement("video")},d=c(),f=function(a){var c;try{c=d.canPlayType(a)}catch(f){e.error("canplay threw ",f.message)}return"string"==typeof c&&b.PROBABLY===c.toLowerCase()};return f}function d(){return{createElement:null,type:null}}var e=a.create("formatcheck/htmlME");return{createParameters:d,makeCheckFunction:c}}),define("ensis/media/fc/mediasource",[],function(){"use strict";function a(a){var c;return c=a&&"function"==typeof a.isTypeSupported?a.isTypeSupported:b}function b(a){return MediaSource.isTypeSupported(a)}function c(){return{isTypeSupported:null,type:null}}return{createParameters:c,makeCheckFunction:a}}),define("ensis/media/formatcheckV2",["ensis/logger/logger","ensis/media/types","ensis/media/codec","./fc/mediaelement","./fc/mediasource"],function(a,b,c,d,e){"use strict";function f(a,d){var e,f,g,h=[b.MediaFormat.Video.SD,b.MediaFormat.Video.HD,b.MediaFormat.Video.HDX,b.MediaFormat.Video.SD_HIGHP,b.MediaFormat.Video.HDX_HIGHP,b.MediaFormat.Video.SD_MAIN10,b.MediaFormat.Video.HDX_MAIN10,b.MediaFormat.Video.UHD_SDR,b.MediaFormat.Video.UHD_MAIN10,b.MediaFormat.Video.UHD_HDR10,b.MediaFormat.Video.UHD_DOVI4,b.MediaFormat.Video.UHD_DOVI5],i=[b.MediaFormat.Audio.AAC,b.MediaFormat.Audio.DD,b.MediaFormat.Audio.DDP],k=[c.Formats.video[c.Names.video.H264],c.Formats.video[c.Names.video.H264DASH],c.Formats.video[c.Names.video.H265],c.Formats.video[c.Names.video.HDR10],c.Formats.video[c.Names.video.DOVI4],c.Formats.video[c.Names.video.DOVI5]],l=[c.Formats.audio[c.Names.audio.AACLC],c.Formats.audio[c.Names.audio.DolbyDigital],c.Formats.audio[c.Names.audio.DolbyDigitalPlus]];b.MediaType.AUDIO===a?(e=i,f=l,g="audio/mp4"):(e=h,f=k,g="video/mp4");var m={};e.forEach(function(a,b){m[a]={pri:b,found:!1}}),f.forEach(function(a){var b=c.makeCodecsString(g,a.codecs);j.log("Checking: ",b),!1===d(b)?j.log("  Format check failed: ",b):(j.log("  Format supported: ",b),Array.isArray(a["class"])?a["class"].forEach(function(a){j.trace("item.class: ",a),m[a]&&(m[a].found=!0)}):(j.trace("type.class: ",a["class"]),m[a["class"]]&&(m[a["class"]].found=!0)))});var n=[];for(var o in m)j.trace("filtering: ",m[o]),m[o].found&&(n[m[o].pri]=o);return n=n.filter(function(a){return"string"==typeof a}),j.trace("returning: ",n),n}function g(){return{check:function(){throw new Error(m.NotImplemented)},createParameters:function(){throw new Error(m.NotImplemented)},Format:null}}function h(a,c){var h,i=g();switch(c){case l.MediaSource:h=e;break;case l.MediaElement:h=d;break;default:throw j.error("Invalid: ",c),new Error(m.InvalidParameter)}return i.createParameters=function(){var b=h.createParameters();return b.type=a,b},i.Format=a===k.AUDIO?b.MediaFormat.Audio:b.MediaFormat.Video,i.check=function(b){var c=h.makeCheckFunction(b);return f(a,c)},i}function i(){return{Type:k,Variant:l,Error:m,get:h}}var j=a.create("FormatCheck"),k=b.MediaType,l={MediaElement:"mediaelement",MediaSource:"mediasource"},m={NotImplemented:"Not currently Implemented",InvalidParameter:"Invalid parameter"};return i()}),define("asteroid/features",["ensis/lang/function"],function(a){function b(a,c){this.message=a||"HDMI error",this.code=c||b.Codes.DEFAULT,this.Codes=b.Codes}function c(){return{init:a.namedNOP("init"),stop:a.namedNOP("stop"),get3DSupport:a.namedNOP("get3DSupport"),getAudioSupport:a.namedNOP("getAudioSupport"),getVideoSupport:a.namedNOP("getVideoSupport"),getHdmiSupport:a.namedNOP("getHdmiSupport"),getDrmSupport:a.namedNOP("getDrmSupport"),registerHdmiChangeListener:a.namedNOP("registerHdmiChangeListener"),unregisterHdmiChangeListener:a.namedNOP("unregisterHdmiChangeListener")}}function d(){return{DrmScheme:e,HdmiError:b,HdmiState:f,createTargetFeatures:c}}b.create=function(){var a,c;return"string"==typeof arguments[0]&&(a=[].shift.call(arguments)),"number"==typeof arguments[0]&&(c=[].shift.call(arguments)),new b(a,c)},b.Codes={DEFAULT:0,UNKNOWN:1,NOT_SUPPORTED:16};var e={PLAYREADY:"playready",WIDEVINE:"widevine"},f={ACTIVATED:"ACTIVATED",DEACTIVATED:"DEACTIVATED"};return d()}),define("asteroid/target/features",["ensis/media/formatcheckV2","ensis/media/types","asteroid/features"],function(a,b,c){"use strict";function d(a){if(a=m(a),n=window.webOS||window.parent.window.webOS,!n)throw new Error(o.nowebos);if(p.ready)a();else{if(p.pending)throw new Error(o.pending);k(a)}}function e(){}function f(){if(!p.ready)throw new Error(o.noinit);return p.has3D}function g(){if(!p.ready)throw new Error(o.noinit);var c=a.get(a.Type.AUDIO,a.Variant.MediaSource),d=c.check();return-1!==d.indexOf(b.MediaFormat.Audio.DDP)&&d.push(b.MediaFormat.Audio.ATMOS),d}function h(){if(!p.ready)throw new Error(o.noinit);var c=[],d=a.get(a.Type.VIDEO,a.Variant.MediaSource),e=d.check(),f=[b.MediaFormat.Video.SD,b.MediaFormat.Video.HD,b.MediaFormat.Video.HDX,b.MediaFormat.Video.SD_HIGHP,b.MediaFormat.Video.HDX_HIGHP,b.MediaFormat.Video.SD_MAIN10,b.MediaFormat.Video.HDX_MAIN10];return f.forEach(function(a){-1!==e.indexOf(a)&&c.push(a)}),p.hasUHD&&(c.push(d.Format.SDR),c.push(d.Format.UHD_MAIN10),[d.Format.UHD_HDR10,d.Format.UHD_DOVI4,d.Format.UHD_DOVI5].forEach(function(a){-1!==e.indexOf(a)&&c.push(a)})),c}function i(){throw c.HdmiError.create("LG devices do not have HDMI output",c.HdmiError.Codes.NOT_SUPPORTED)}function j(){return[c.DrmScheme.PLAYREADY]}function k(a){p.pending=n.service.request("luna://com.webos.service.tv.systemproperty",{method:"getSystemInfo",parameters:{keys:["UHD","_3d"],subscribe:!1},onComplete:function(b){p.pending=null,b.returnValue&&(p.ready=!0,p.has3D=b._3d,p.hasUHD=b.UHD),a()}})}function l(){}function m(a){return"function"!=typeof a?l:a}var n,o={noinit:"Called before init()",pending:"init is active",nowebos:"Couldn't get reference to webOS"},p={pending:null,ready:!1,hasUHD:!1,has3D:!1};return{init:d,stop:e,get3DSupport:f,getAudioSupport:g,getVideoSupport:h,getHdmiSupport:i,getDrmSupport:j}}),define("ensis/async/async",["ensis/logger/logger"],function(a){function b(){}function c(){function a(a){return j.push(a),f.trace("Chain length: ",j.length),h&&!i&&d(e),g}function c(a){if(0!==j.length)throw new Error("Callback already exists");j=a}function d(a){if(h=!0,0==j.length)return f.trace("no callbacks"),void(e=a);var c=j.shift(),d=c(a);i=!0,d instanceof b&&d.setChain(j)}var e,g=new b,h=!1,i=!1,j=[];return g.then=a,g.setChain=c,g.onComplete=d,g}function d(a,b){return{get:function(){if("undefined"!=typeof b)throw b;return a}}}function e(){return{Deferred:c,DeferredImpl:b,Result:d}}var f;return f=a.create("ASYNC"),e()}),define("asteroid/controls",["ensis/async/async","ensis/logger/logger"],function(a,b){"use strict";function c(b){var c=a.Deferred();return f.OFF===b.videoMode3D?c.onComplete(a.Result(!0)):(e.error("Only expect 2D mode in base implementation"),c.onComplete(a.Result(!1,new Error(h.invalid_params)))),c}function d(b){var c=a.Deferred();return g.OFF!==b.videoModeHDR&&e.warn("No HDR Override only expected SDR mode in base implementation"),c.onComplete(a.Result(!0)),c}var e=b.create("controls"),f={OFF:0,LEFT_RIGHT:1,RIGHT_LEFT:2,TOP_BOTTOM:3,BOTTOM_TOP:4,INTERLEAVE_V:11,INTERLEAVE_H:12,SEQUENTIAL:21,FRAME_PACKED:22,FIELD_ALTERNATE:23,CHECKERBOARD:24,fromDirectorString:function(a){switch(a){case"leftRight":return f.LEFT_RIGHT;case"topBottom":return f.TOP_BOTTOM;default:return f.OFF}}},g={OFF:0,SDR:1,HDR10:2,DOVI:4,DOVI_LL_FLAG:8,FPS_24:16,FPS_30:32,FPS_50:48,FPS_60:64,RES_720:256,RES_1080:512,RES_2160:768,fromDirectorString:function(a){switch(a){case"main10":return g.SDR;case"hdr10":return g.HDR10;case"dvheStn":return g.DOVI;case"dvheDtr":return g.DOVI;default:return g.OFF}}},h={invalid_params:"Invalid parameters",failed_3D_mode:"Couldn't set 3D mode",failed_HDR_mode:"Couldn't set HDR mode"};return{ERROR:h,VideoMode3D:f,VideoModeHDR:g,setVideoMode3D:c,setVideoModeHDR:d}}),define("asteroid/target/webosutil",["ensis/async/async"],function(a){"use strict";function b(a,b){function c(b){this.webOS.service.request(a,b)}var e;if(window.webOS)e=window;else{if(!window.parent.window.webOS)throw new Error(d.webos_object);e=window.parent.window}c.call(e,b)}function c(){var c=a.Deferred();return b(e.SYSTEM,{method:"getSystemInfo",parameters:{keys:["sdkVersion"]},onComplete:function(b){var e=b.returnValue;if(e){var f=b.sdkVersion;c.onComplete(a.Result(f))}else c.onComplete(a.Result(!1,new Error(d.webos_ls_failed)))}}),c}var d={webos_object:"Couldn't find webOS object",webos_ls_failed:"Call over LSBus failed"},e={DISPLAY:"luna://com.webos.service.tv.display",SYSTEM:"luna://com.webos.service.tv.systemproperty"};return{ERROR:d,ServiceRequestType:e,serviceRequest:b,getSdkVersion:c}}),define("asteroid/target/lunabus3d",["ensis/logger/logger","ensis/async/async","asteroid/controls","./webosutil"],function(a,b,c,d){"use strict";function e(a){function d(){k.log("Content is now finished"),j.removeEventListener("abort",d),j.removeEventListener("ended",d),window.removeEventListener("beforeunload",d);var a=h(c.VideoMode3D.OFF);i({method:a.cmd,parameters:a.params})}function e(a){m.onComplete(b.Result(!1,a))}var j=a.videoElement,l=a.videoMode3D;if("undefined"==typeof j||"undefined"==typeof l)throw new Error(c.ERROR.invalid_params);var m=b.Deferred();return f().then(function(a){try{var b=a.get();return k.log("Disable autodetect: ",b),g(j,l)}catch(c){k.error("Error disabling 3D detect"),e(c)}}).then(function(a){try{var b=a.get();k.log("Set 3D mode: ",b),m.onComplete(a)}catch(c){k.error("Error setting 3D mode"),e(c)}}),j.addEventListener("abort",d),j.addEventListener("ended",d),window.addEventListener("beforeunload",d),m}function f(){var a=b.Deferred();return i({method:"disable3DStatusChangeOnSignal",parameters:{disableChange:!0},onComplete:function(d){k.log("disable3DStatusChange: ",d),d.returnValue?a.onComplete(b.Result(!0)):a.onComplete(b.Result(!1,new Error(c.ERROR.failed_3D_mode)))}}),a}function g(a,d){function e(){k.log("LG platform is now ready");try{i(l)}catch(a){f.onComplete(b.Result(!1,a))}}var f=b.Deferred(),g=1,j=h(d),l={method:j.cmd,parameters:j.params,onComplete:function(a){k.log("luna-bus response: ",a);var d=null;a.returnValue?(k.log("3D mode set: ",j.params),d=b.Result(!0)):(k.warn("Failed to set 3D mode"),0==g?(k.error("Returning error"),d=b.Result(!1,new Error(c.ERROR.failed_3D_mode))):(k.log("Trying again: ",g," attempt(s) remaining"),--g,e())),null!==d&&f.onComplete(d)}};return a.paused||a.readyState<=a.HAVE_CURRENT_DATA?a.addEventListener("playing",function m(){a.removeEventListener("playing",m),e()}):e(),f}function h(a){switch(a){case c.VideoMode3D.LEFT_RIGHT:return{cmd:"set3DOnByPattern",params:{pattern3D:"side_side_half",userPatternMode:!1}};case c.VideoMode3D.TOP_BOTTOM:return{cmd:"set3DOnByPattern",params:{pattern3D:"top_bottom",userPatternMode:!1}};default:return{cmd:"set3DOff",params:{}}}}function i(a){d.serviceRequest(d.ServiceRequestType.DISPLAY,a)}function j(){return{setVideoMode3D:e}}var k=a.create("Controls/LBus");return{create:j}}),define("ensis/async/util",["ensis/async/async","ensis/logger/logger"],function(a,b){"use strict";function c(b){var c=a.Deferred();return setTimeout(function(){c.onComplete()},b),c}function d(){function b(b){return function(g){h.log("whenAll -- then for ",b,"; ",JSON.stringify(g)),f[b]=g,++e,e===d&&c.onComplete(a.Result(f))}}var c=a.Deferred(),d=arguments.length,e=0,f=[];return 0===d?(c.onComplete(a.Result(null,new Error("Need futures"))),c):([].forEach.call(arguments,function(a,c){h.log("iterating ",c),a.then(b(c))}),c)}function e(){function b(b,d){return function(e){h.log("whenAny -- then for ",d),c.onComplete(a.Result({completed:b,result:e,index:d}))}}var c=a.Deferred(),d=arguments.length;return 0===d?(c.onComplete(a.Result(null,new Error("Need futures"))),c):([].forEach.call(arguments,function(a,c){h.log("iterating ",c),a.then(b(a,c))}),c)}function f(b){var f=a.Deferred(),g=c(b),j=[].splice.call(arguments,1);return e(d.apply(this,j),g).then(function(a){try{if(a=a.get(),h.log("all or timeout internal result is: ",JSON.stringify(a)),1===a.index)return void f.onComplete(i)}catch(b){}f.onComplete(a.result)}),f}function g(b){var d=a.Deferred(),f=c(b),g=[].splice.call(arguments,1);return e(e.apply(this,g),f).then(function(a){try{if(a=a.get(),h.log("index: ",a.index,"; promises len: ",g.length),1===a.index)return void d.onComplete(i)}catch(b){}d.onComplete(a.result)}),d}var h=b.create("async/util"),i=function(){var b=new Error("timeout");return b.isTimeout=!0,a.Result(null,b)}();return{wait:c,whenAny:e,whenAll:d,whenAllOrTimeout:f,whenAnyOrTimeout:g}}),define("asteroid/target/mediaoptions3d",["ensis/logger/logger","ensis/async/async","asteroid/controls","ensis/async/util"],function(a,b,c,d){"use strict";function e(a){var e=a.videoElement,f=a.videoMode3D;if("undefined"==typeof e||"undefined"==typeof f)throw new Error(c.ERROR.invalid_params);var i=b.Deferred(),j={option:{"3dMode":g(f)}};return j=JSON.stringify(j),h.log("mediaOption: ",j),e.mediaOption=j,d.wait(10).then(function(){i.onComplete(b.Result(!0))}),i}function f(){return{setVideoMode3D:e}}function g(a){switch(a){case c.VideoMode3D.LEFT_RIGHT:return"side_by_side_LR";case c.VideoMode3D.TOP_BOTTOM:return"top_bottom";default:return"2D"}}var h=a.create("Controls/MOpt");return{create:f}}),define("asteroid/target/controls",["asteroid/controls","ensis/lang/object","ensis/async/async","ensis/logger/logger","./webosutil","./lunabus3d","./mediaoptions3d"],function(a,b,c,d,e,f,g){function h(a){if("string"!=typeof a)throw new Error("Invalid type for version string");var b=a.split(".");if(3!=b.length)throw new Error("Invalid format for version string");var c={};if(c.major=Number.parseInt(b.shift()),c.minor=Number.parseInt(b.shift()),c.fix=b.shift(),"number"!=typeof c.major||"number"!=typeof c.minor||Number.isNaN(c.major)||Number.isNaN(c.minor))throw new Error("Invalid data in version info");return c}function i(a){var b,c=h(a);return b=c.major>3?g.create():3===c.major&&c.minor>=3?g.create():f.create()}function j(b){var d;return null==l?(d=c.Deferred(),l="pending",e.getSdkVersion(b).then(function(e){try{var f=e.get();l=i(f),l.setVideoMode3D(b).then(function(a){d.onComplete(a)})}catch(g){d.onComplete(c.Result(!1,new Error(a.ERROR.failed_3d_mode)))}})):"pending"===l?k.warn("Set 3D mode called while it was already pending.  Latter calls are ignored: ",b):d=l.setVideoMode3D(b),d}var k=d.create("Target/Controls"),l=null,m=b.extend(a,{setVideoMode3D:j});return m.ERROR=b.extend(a.ERROR,e.ERROR),m}),define("asteroid/buffercontrol",["ensis/logger/logger","ensis/lang/object","ensis/lang/function"],function(a,b,c){
"use strict";function d(a){r=a}function e(){return r}function f(a,b){b=b||Date.now(),b-a.time>=p&&i(a)}function g(a){switch(f(a),a.count){case 0:return q;case 1:return 6;case 2:return 9;default:return 12}}function h(a){var b=Date.now();f(a,b),a.time=b,++a.count}function i(a){return a=a||{},a.count=0,a.time=Number.NEGATIVE_INFINITY,a}function j(){return{create:k,getResumeLevel:e,setResumeLevel:d}}function k(a){function b(){return c}function c(){try{n.canPlay()}catch(a){m.error("onCanPlay is no longer valid")}}n||(n=l(a||!1));var e=i();return d(g(e)),{getManager:function(){return n},getCanPlayHandler:b,trackUnderruns:function(){h(e)},calculateResumeLevel:function(){return g(e)}}}function l(a){function d(){w.video=!1,w.audio=!1,x=!1}function f(a,b,c){y.duration=a,y.position=b,y.ranges=c,x&&h()&&(x=!1,p())}function g(a,b,c,d){var e,f=!1,g=!1;return d=d||0,e=Math.abs(a-b),(e<=d||a>=b)&&(f=!0),e=Math.abs(a-c),(e<=d||a<=c)&&(g=!0),f&&g}function h(){if(!y.ranges||!y.ranges.length||Number.isNaN(y.position))return!1;for(var a,b,c=!1,d=0;d!==y.ranges.length&&!a;++d)isNaN(y.ranges.end(d))||isNaN(y.ranges.start)||(b=y.ranges.end(d)-y.ranges.start(d)),b<2*o.video?m.trace("Range ",d," too small."):g(y.position,y.ranges.start(d),y.ranges.end(d),o.video)&&(a={start:y.ranges.start(d),end:y.ranges.end(d)});if(a){var f=a.end-y.position>=e(),h=y.position+e()>=y.duration;c=f||h}return c}function i(a){w[a]=!0,l()&&(h()?p():x=!0)}function j(a){w[a]=!1,x=!1,n()&&A()}function k(){return!w.audio&&!w.video}function l(){return w.audio&&w.video}function n(){return w.audio!==w.video}function p(){v&&z()}function q(){a&&(v=!0,l()&&z())}function r(){l()&&h()&&p()}function s(){a&&(v=!1)}function t(){var c=b.extend(w);return c.canPlay=a?v:"<canplay ignored>",JSON.stringify(c)}var u=function(){return!a},v=u(),w={},x=!1,y={duration:Number.POSITIVE_INFINITY,position:Number.NaN,ranges:[]},z=c.NOP,A=c.NOP;return{toJSON:t,stalledVideo:function(){j("video")},bufferedVideo:function(){i("video")},stalledAudio:function(){j("audio")},bufferedAudio:function(){i("audio")},bufferedRanges:f,isAllReady:l,isOneStalled:n,isAllStalled:k,checkBuffered:r,canPlay:q,clear:function(){v=u(),d()},seeking:s,whenBuffered:function(a){if("function"!=typeof a)throw m.error("whenBuffered requires a function as parameter"),new Error("Invalid parameter");z=a},whenUnderrun:function(a){if("function"!=typeof a)throw m.error("whenUnderrun requires a function as parameter"),new Error("Invalid parameter");A=a}}}var m=a.create("BufferControl"),n=null,o={audio:2/48e3,video:2/30},p=18e4,q=6,r=q;return j()}),define("asteroid/target/buffercontrol",["ensis/lang/object","asteroid/buffercontrol","ensis/logger/logger"],function(a,b,c){"use strict";function d(){function a(a,b){f=Date.now(),g=b,h=a}function b(){if(Number.isNaN(h))return null;if(!g||!g.length)return null;for(var a=!1,b=0;!a&&b!=g.length;){var c=g.start(b),e=g.end(b);c>=d&&(c-=d),e+=d,h>=c&&h<=e?a=!0:++b}return a?{start:g.start(b),end:g.end(b)}:null}function c(){var a=Date.now();return!Number.isNaN(h)&&!(a-f>e)}var d=2/30,e=3e3,f=0,g=null,h=Number.NaN;return{findCurrentRange:b,update:a,getPosition:function(){return h},isCurrent:c}}function e(){function a(){h.log("Waiting event received, and triggering buffer underrun");var a=c.findCurrentRange(),b=c.getPosition();c.isCurrent()||h.log("onWaiting: buffer info not been refreshed recently"),a&&(a.start>b&&h.warn("Buffered range may not be useful; start: ",a.start," 'v' currentTime: ",b),a.end>b+i&&h.log("Have good amount of buffer ahead, shouldn't be waiting")),e=!0,g.getManager().stalledVideo(),g.getManager().stalledAudio()}function b(a,b){if(c.update(a,b),e){var d=c.findCurrentRange();if(a=c.getPosition(),c.isCurrent()){if(d&&d.end>a+i){e=!1;var f=g.getManager();f.isAllReady()?h.trace("Recovered from waiting, but no need to notify bcmgr.  Streams already flagged as ready"):(h.log("Resuming playback based on progress event"),f.bufferedVideo(),f.bufferedAudio())}}else h.log("onWaiting: no fresh buffer info.")}}var c=d(),e=!1;return{onWaiting:a,onProgress:b}}function f(){return g=b.create(!0),g.createWaitingMonitor=e,g}var g,h=c.create("Target/BufferControl"),i=6;return a.extend(b,{create:f})}),define("ensis/dash/trackinfo",[],function(){"use strict";function a(a,b,c,d,e){return{type:a,bandwidth:b,mime:c,codecs:d,url:e}}function b(){function b(a,b,c,d,e){return{adaptationType:a,adaptationIndex:b,mime:c,codecs:d,info:e}}function c(){return{audio:[],video:[]}}return{makeTrack:b,createRepresentationInfo:a,create:c}}return b()}),define("ensis/dash/manifestutil",["ensis/media/types","ensis/logger/logger","ensis/dash/trackinfo"],function(a,b,c){"use strict";function d(a){for(var b=c.create(),d=a.getElementsByTagName("AdaptationSet"),h=0;h!=d.length;++h){var i=d[h],j={mimeType:i.getAttribute("mimeType"),codecs:i.getAttribute("codecs")},k=g.getType(j.mimeType),l=[],m=i.getElementsByTagName("Representation"),n=e(j,m,l);g.isMedia(k)&&g.isMedia(n)&&k!==n&&f.error("Mismatch between mimeType values in AdaptationSet and Representation: ",k,"/",n);var o=null,p=null;if(g.isMedia(n)?k=n:g.unknown!=n&&f.error("Representation contains a mediatype that is non-media: ",n),g.isMedia(k)){if(l.length>0){var q=!1;l.forEach(function(a){o?o!==a.mime&&(q=!0):o=a.mime,p||(p=a.codecs)}),q&&f.error("All representations in an adaptation set are expected to be same mime type: ",JSON.stringify(l))}p||(p=j.codecs?j.codecs:""),o||(o=j.mimeType?j.mimeType:"")}switch(k){case g.audio:var r=c.makeTrack(k,h,o,p,l);b.audio.push(r);break;case g.video:var s=c.makeTrack(k,h,o,p,l);b.video.push(s);break;default:f.warn("Don't do anything currently with AdaptationType: ",k)}}return b}function e(a,b,c){var d=g.unknown;if(0===b.length)f.warn("No representations in the AdaptationSet");else{for(var e=g.unknown,h=!1,i=0;i!=b.length;++i){var j=b[i],k=j.getAttribute("mimeType"),l=g.getType(k);g.unknown!==l&&(g.unknown!==e?e!==l&&(h=!0):e=l);var m=j.getElementsByTagName("BaseURL");1!==m.length&&f.log("Wasn't expecting more than one BaseURL per Representation: ",JSON.stringify(m));for(var n=m[0],o="",p=n.firstChild;p;)3===p.nodeType&&(o+=p.nodeValue),p=p.nextSibling;if(o&&o.length>0){k||(k=a.mimeType);var q=j.getAttribute("codecs");q||(q=a.codecs),o=o.trim(),c.push({type:l,bandwidth:j.getAttribute("bandwidth"),mime:k,codecs:q,url:o})}}h||(d=e)}return d}var f=b.create("ManifestUtil"),g=a.AdaptationType;return{parseManifest:d}}),define("ensis/dash/manifesttweaks",["ensis/logger/logger","ensis/media/codec","ensis/media/types","ensis/dash/manifestutil"],function(a,b,c,d){"use strict";function e(a){var c=!1,d=a.getAttribute("codecs");if("string"!=typeof d)m.log("Representation has no 'codecs' attribute");else{m.trace("Representation has a 'codecs' attribute of: ",d);var e=b.removeCodecs(d,n);d!==e&&(m.log("Updating codecs attribute: ",e),a.setAttribute("codecs",e),c=!0)}return c}function f(a){var c=!1,d=a.getAttribute("codecs");if("string"!=typeof d)m.log("AdaptationSet has no 'codecs' attribute");else{m.trace("AdaptationSet has a 'codecs' attribute of: ",d);var f=b.removeCodecs(d,n);d!==f&&(m.log("Updating codecs attribute: ",f),a.setAttribute("codecs",f),c=!0)}var g=a.getElementsByTagName("Representation");if(g&&g.length&&g.length>0)for(var h=0;h!=g.length;++h)c|=e(g[h]);return c}function g(a,b){var c=!1;try{var e=d.parseManifest(a),f=[];e.audio.length>0&&e.audio.forEach(function(a){var c=a.codecs.toLowerCase();-1!==b.indexOf(c)&&(f.push(a.adaptationIndex),m.log("Manifest contains ",a.codecs,": ",a.adaptationIndex))});var g=a.getElementsByTagName("AdaptationSet"),h=f.map(function(a){return m.warn("Removing adaptation ",a),g[a]});h.forEach(function(a){a.parentNode.removeChild(a),c=!0})}catch(i){throw m.error("Problem removing audio adaptation: ",i.message),i}return c}function h(a){var b=!1,c=a.getElementsByTagName("AdaptationSet");if(c&&c.length&&c.length>0)for(var d=0;d!=c.length;++d)b|=f(c[d]);return b}function i(a){var b=!1;try{for(var c=a.getElementsByTagName("SegmentBase"),d=0;d!=c.length;++d){var e=c[d],f=e.getElementsByTagName("Initialization");if(0===f.length){m.log('Vudu manifest has no Initialization, Fabricate an <Initialization range="xxx"> tag');var g,h,i=e.getAttribute("indexRange");if("string"==typeof i){var j=i.split("-");try{var k=parseInt(j[0]);isNaN(k)||k>1&&(h=k-1)}catch(l){m.error("Problem parsing index range")}}"undefined"==typeof h&&(h=1e4),"undefined"==typeof g&&(g=0),h<g&&(m.warn("Manifest initialization range got badly initialized: ",g,"-",h),g=0,h=1e4);var n=""+g+"-"+h,o=a.createElement("Initialization");o.setAttribute("range",n),e.appendChild(o),b=!0}else!function(){for(var a=f.length;0!==a;){--a;var c=f[a],d=c.getAttribute("range");if("string"==typeof d){var e=d.split("-");try{var g=parseInt(e[0]),h=parseInt(e[1]);isNaN(g)||0!==g&&(m.error("Intialization Range do not start from offset 0, correct it here"),g=0,d=""+g+"-"+h,c.setAttribute("range",d),b=!0)}catch(i){m.error("Problem parsing Initializtion range")}}}}()}}catch(l){m.error("Vudu specific Manifest process failed: ",l.message)}return b}function j(a,b){var c=a.some(function(a){return-1!==b.indexOf(a)});return c}function k(a,b){var c=!1;b=b.map(function(a){return a.toUpperCase()});for(var d=a.getElementsByTagName("AdaptationSet"),e=0;e!=d.length;++e){for(var f=[],g=d[e],h=g.getElementsByTagName("ContentProtection"),i=0;i!=h.length;++i){var k=h[i],l=k.getAttribute("schemeIdUri").toUpperCase();j(b,l)||f.push(k)}0!==f.length&&(c=!0),f.forEach(function(a){a.parentNode.removeChild(a)})}return c}function l(a,b){for(var d=!1,e=a.getElementsByTagName("AdaptationSet"),f=0;f!=e.length;++f){for(var g=!1,h=!1,i=e[f],j=i.getElementsByTagName("ContentProtection"),k=0;k!==j.length;++k){var l=j[k],m=l.getAttribute("schemeIdUri").toUpperCase();if(g=!0,-1!==m.indexOf(c.DrmSchemeUUID.playready)){h=!0;var n=[];if(0!==l.childNodes.length){var o=l.firstChild;do{-1!==o.nodeName.toLowerCase().indexOf(":pssh")&&b.skipPssh&&n.push(o),-1!==o.nodeName.toLowerCase().indexOf(":pro")&&b.skipPro&&n.push(o);var p=o;for(o=null;p.nextSibling;)if(p=p.nextSibling,1===p.nodeType){o=p;break}}while(null!==o);0!==n.length&&(d=!0),n.forEach(function(a){a.parentNode.removeChild(a)})}}}if(g&&b.ensurePR&&!h){var q=i.ownerDocument.createElement("ContentProtection");q.setAttribute("schemeIdUri","urn:uuid:"+c.DrmSchemeUUID.playready),b.versionInfo&&q.setAttribute("value",b.versionInfo),i.appendChild(q),d=!0}}return d}var m=a.create("ManifestTweak"),n=[];return n.push(b.Formats.video[b.Names.video.DOVI].codecs.split(",")[1]),n.push(b.Formats.video[b.Names.video.DOVI_2k_24].codecs.split(",")[1]),n.push(b.Formats.video[b.Names.video.DOVI_2k_30].codecs.split(",")[1]),n.push(b.Formats.video[b.Names.video.DOVI_4k_24].codecs.split(",")[1]),n.push(b.Formats.video[b.Names.video.DOVI_4k_30].codecs.split(",")[1]),{stripAudioAdaptations:g,stripDolbyVision:h,patchVuduManifest:i,restrictContentProtection:k,patchPlayreadyContentProtection:l}}),define("asteroid/target/modules/manifestmodifier",["ensis/logger/logger","ensis/media/codec","ensis/media/types","ensis/dash/manifesttweaks","asteroid/target/target"],function(a,b,c,d,e){"use strict";function f(a){var b=!1,f=!1;try{var g=e.get("Features"),j=g.getAudioSupport();-1===j.indexOf(c.MediaFormat.Audio.DD)&&(f=!0)}catch(k){h.error("Problem checking getAudioSupport(): ",k.message,"; target: ",e.target)}return f&&(b=d.stripAudioAdaptations(a,[i])),b}function g(a){var b=d.patchVuduManifest(a);return b|=d.stripDolbyVision(a),b|=f(a),b?a:null}var h=a.create("manifestmod/"+e.target),i=b.Formats.audio[b.Names.audio.DolbyDigital].codecs;return h.trace("Dolby Digital codec string is: ",i),{modify:g}}),define("asteroid/target/modules",["./modules/manifestmodifier"],function(a){return{ManifestModifier:a}}),define("ensis/vudu/playerbridge/bridge",["ensis/lang/function","ensis/logger/logger"],function(a,b){"use strict";function c(){return{flush:a.namedNOP("flush"),loadLicense:a.namedNOP("loadLicense"),pause:a.namedNOP("pause"),play:a.namedNOP("play"),registerStateChangeHandler:a.namedNOP("registerStateChangeHandler"),seek:a.namedNOP("seek"),setVolume:a.namedNOP("setVolume"),start:a.namedNOP("start"),stop:a.namedNOP("stop"),unregisterStateChangeHandler:a.namedNOP("unregisterStateChangeHandler")}}function d(a,b){function c(c){a.postMessage({type:j.STATE_CHANGE,context:b,status:c},"*")}function d(){a.postMessage({type:j.READY,context:b},"*")}function e(){a.postMessage({type:j.DESTROYED,context:b},"*")}function f(){a=null}return{ready:d,destroyed:e,stateChange:c,stop:f}}function e(b,c){function d(a){if(!a||!a.data)return void k.warn("received message with no data");if(j.COMMAND!==a.data.type)return void k.trace("Received message with invalid type");var b=a.data.cmd,d=a.data.args;f(c[b],d)}function e(){b.removeEventListener("message",d,!1),b={}}b.addEventListener("message",d,!1);var f=a.makeChecked({missing:function(a,b){k.error("No handler for ",a)},"catch":function(a){k.error("Host listener threw: ",a.message)}});return{stop:e}}function f(a,b){var c={};c.type=j.COMMAND,c.cmd=a,c.args={};for(var d in b)b.hasOwnProperty(d)&&(c.args[d]=b[d]);return c}function g(a){var b={};return b.type=j.CONNECT,b.context=""+a,b}function h(a,b){var c={};c.state=[a];for(var d in b)if(b.hasOwnProperty(d)){var e=b[d];Array.isArray(e)||(e=[""+e]),c[d]=e}return c}function i(){return{EVENT:j,getBridgeToHost:d,getBridgeFromHost:e,createHostCmdListener:c,formatHostCommand:f,formatHostConnectMessage:g,formatPlayerMessage:h}}var j={STATE_CHANGE:"com.vudu.player.bridge.statechange",READY:"com.vudu.player.bridge.ready",DESTROYED:"com.vudu.player.bridge.destroyed",CONNECT:"com.vudu.player.bridge.connect",COMMAND:"com.vudu.player.bridge.command"},k=b.create("Bridge");return i()}),define("ensis/vudu/playerbridge/params",[],function(){function a(a,b,c,d){return{fixed:!!c||!!d,suggestedMaxBitrate:a,suggestedMaxResolution:b,fixedBitrate:c,fixedResolution:d}}function b(b){return a(b)}function c(b){return a(null,b)}function d(b){return a(null,null,b)}function e(b){return a(null,null,null,b)}function f(a,b,c,d){return"undefined"==typeof d&&(d=[]),{uriBase:a,uriSuffix:b,type:c,subtitles:d}}function g(a,b,c){return{name:a,languageCode:b,version:c}}function h(){for(var a=h.Builder(),b=0;b!==arguments.length;++b){var c=arguments[b];"string"==typeof c&&(c=i(c)),a.add(c)}return a.build()}function i(a){switch(a){case"leftRight":case"topBottom":case"twoD":return h.Dimensionality(a);case"sdr":case"highP":case"main10":case"hdr10":case"dvheStn":case"dvheDtr":return h.VideoProfile(a);default:return}}function j(a,b){return{target:a,pause:b}}var k={480:"480",720:"720",1080:"1080",2160:"2160"};h.Dimensionality=function(a){return{dimensionality:a}},h.VideoProfile=function(a){return{videoprofile:a}},h.Builder=function(){var a=function(){var b={};return{add:function(c){for(var d in c)c.hasOwnProperty(d)&&(b[d]=c[d]);return a},build:function(){return b}}}();return a};var l={BEFORE:"before",EXACT:"exact",AFTER:"after"};return{EditionProfile:h,QualityInfo:a,QualityInfoResolution:k,QualityInfoFixedBitrate:d,QualityInfoFixedResolution:e,QualityInfoSuggestedMaxBitrate:b,QualityInfoSuggestedMaxResolution:c,SeekTarget:l,SeekOptions:j,SubtitleInfo:f,SubtitleInfoLanguageOption:g}}),define("ensis/vudu/playerbridge/msgbuilder",["ensis/logger/logger","./bridge","./params"],function(a,b,c){"use strict";function d(a,b){return a&&Array.isArray(a)&&a.length>=1?a[0]:b}function e(){return{HostMsgBuilder:g,HostMsgParser:h,PlayerMsgBuilder:i,PlayerMsgParser:j}}var f=a.create("Bridge/util"),g={flushStats:function(){return b.formatHostCommand("flushStats")},loadLicense:function(a,c){return b.formatHostCommand("loadLicense",{requestSequence:a,token:c})},loadPlayerImplementation:function(a){return b.formatHostCommand("loadPlayerImplementation",{playerInfo:a})},pause:function(){return b.formatHostCommand("pause")},play:function(){return b.formatHostCommand("play")},registerStateChangeHandler:function(a){return f.error("State change handler is Obsolete"),b.formatHostCommand("registerStateChangeHandler")},seek:function(a,c){var d={position:a};return"object"==typeof c&&(d.options=c),b.formatHostCommand("seek",d)},selectCaptionTrack:function(a){return b.formatHostCommand("selectCaptionTrack",{lang:a})},selectRepresentation:function(a,c){return b.formatHostCommand("selectRepresentation",{audio:c,video:a})},selectStreamingAlgorithm:function(a){return b.formatHostCommand("selectStreamingAlgorithm",{algorithm:a})},setCaptionStyle:function(a){return b.formatHostCommand("setCaptionStyle",{style:a})},setDebugLevel:function(a,c){return b.formatHostCommand("setDebugLevel",{logging:a,statistics:c})},setVolume:function(a,c){return b.formatHostCommand("setVolume",{volume:a,muted:c})},start:function(a,d,e,f,g,h,i){return"string"==typeof g&&(g=c.EditionProfile(g)),b.formatHostCommand("start",{uriSuffix:a,fullUrl:d,bookmarkTime:e,movieQuality:f,editionprofile:g,subtitleInfo:h,qualityInfo:i})},stop:function(){return b.formatHostCommand("stop")},unregisterStateChangeHandler:function(){return f.error("State change handler is Obsolete"),b.formatHostCommand("unregisterStateChangeHandler")}},h={flushStats:function(a){return[]},loadLicense:function(a){return[a.requestSequence,a.token]},loadPlayerImplementation:function(a){return[a.playerInfo]},pause:function(a){return[]},play:function(a){return[]},registerStateChangeHandler:function(){return f.error("State change handler is Obsolete"),[]},seek:function(a){return[a.position,a.options]},selectCaptionTrack:function(a){var b;return"undefined"!=typeof a.lang&&(b=a.lang),[b]},selectRepresentation:function(a){var b=a.audio,c=a.video;return"undefined"!=typeof b&&null!==b&&"number"==typeof b||(b=Number.NaN),"undefined"!=typeof c&&null!==c&&"number"==typeof c||(c=Number.NaN),[c,b]},selectStreamingAlgorithm:function(a){return[a.algorithm]},setCaptionStyle:function(a){return[a.style]},setDebugLevel:function(a){return[a.logging,a.statistics]},setVolume:function(a){return[a.volume,a.muted]},start:function(a){var b=a.qualityInfo;a.suggestedMaxBitrate&&("number"==typeof a.suggestedMaxBitrate?b=c.QualityInfoSuggestedMaxBitrate(a.suggestedMaxBitrate):"string"==typeof a.suggestedMaxBitrate&&(b=c.QualityInfoSuggestedMaxBitrate(Number.parseInt(a.suggestedMaxBitrate)))),"number"==typeof b?b=c.QualityInfoSuggestedMaxBitrate(b):"string"==typeof b&&(b=c.QualityInfoSuggestedMaxBitrate(Number.parseInt(b)));var d;return d="string"==typeof a.dimensionality?c.EditionProfile(a.dimensionality):a.editionprofile?"string"==typeof a.editionprofile?c.EditionProfile(a.editionprofile):a.editionprofile:c.EditionProfile(),[a.uriSuffix,a.fullUrl,a.bookmarkTime,a.movieQuality,d,a.subtitleInfo,b]},stop:function(a){return[]},unregisterStateChangeHandler:function(a){return f.error("State change handler is Obsolete"),[]}},i={autoplayDisabled:function(){return b.formatPlayerMessage("autoplayDisabled")},bufferLoaded:function(){return b.formatPlayerMessage("bufferloaded")},bufferUnderrun:function(){return b.formatPlayerMessage("bufferunderrun")},changedBitrateIndex:function(a){return b.formatPlayerMessage("changedBitrateIndex",{newBitrate:""+a})},changedDebugInfo:function(a){return b.formatPlayerMessage("changedDebugInfo",{newDebugInfo:a})},ended:function(a,c){return b.formatPlayerMessage("ended",{currentTime:a,duration:c})},playerError:function(a,c){return b.formatPlayerMessage("playererror",{errortype:a,errorreason:c})},playerStopped:function(a,c){return b.formatPlayerMessage("playerStopped",{reason:a,extra:c})},licenseRequest:function(a,c,d){return b.formatPlayerMessage("licenseRequest",{requestSequence:a,drmType:c,drmToken:d})},loadedBitrates:function(a,c){return b.formatPlayerMessage("loadedBitrates",{length:a,bitrates:c})},loadedPlayer:function(a,c){return b.formatPlayerMessage("loadedPlayer",{id:a,streamingAlgorithm:c})},loadSubtitles:function(a){return f.warn("DEPRECATED.  Subtitles must go via Second Screen APIs now"),b.formatPlayerMessage("loadSubtitles",{name:a})},paused:function(a){return b.formatPlayerMessage("paused",{currentTime:a})},playbackRateChanged:function(a){return b.formatPlayerMessage("playbackRateChanged",{playbackRate:a})},playing:function(){return b.formatPlayerMessage("playing")},seeked:function(){return b.formatPlayerMessage("seeked")},seeking:function(){return b.formatPlayerMessage("seeking")},sendNetLogs:function(a,c){return b.formatPlayerMessage("sendNetLogs",{level:a,message:c})},sendStats:function(a){return b.formatPlayerMessage("sendStats",{stats:a})},sendStatsV3:function(a){return b.formatPlayerMessage("sendStatsV3",{stats:a})},setSubtitleStyle:function(a){return f.warn("DEPRECATED.  Subtitles must go via Second Screen APIs now"),b.formatPlayerMessage("setSubtitleStyle",{style:a})},timeChanged:function(a,c){return b.formatPlayerMessage("timeChanged",{currentTime:a,duration:c})},unloadSubtitles:function(){return f.warn("DEPRECATED.  Subtitles must go via Second Screen APIs now"),b.formatPlayerMessage("unloadSubtitles",{})},volumeChanged:function(a,c){return"boolean"==typeof c?c=c?"true":"false":"number"==typeof c?c=0!==c?"true":"false":"string"!=typeof c&&(c="false"),b.formatPlayerMessage("volumeChanged",{volume:""+a,muted:c})}},j={autoplayDisabled:function(){return[]},bufferLoaded:function(){return[]},bufferUnderrun:function(){return[]},changedBitrateIndex:function(a){return[+d(a.newBitrate,"0")]},changedDebugInfo:function(a){return[d(a.newDebugInfo," *** missing debug info *** ")]},ended:function(a){var b=+d(a.currentTime,"0"),c=+d(a.duration,"0");return[b,c]},playerError:function(a){return[d(a.errortype),d(a.errorreason)]},playerStopped:function(a){return[d(a.reason,""),d(a.extra,"")]},licenseRequest:function(a){return[d(a.requestSequence),d(a.drmType),d(a.drmToken)]},loadedBitrates:function(a){return[+d(a.length,0),a.bitrates]},loadedPlayer:function(a){return[a.id,a.streamingAlgorithm]},loadSubtitles:function(){return[]},paused:function(a){return[+d(a.currentTime,0)]},playbackRateChanged:function(a){return[+d(a.playbackRate,0)]},playing:function(){return[]},seeked:function(){return[]},seeking:function(){return[]},sendNetLogs:function(a){return[d(a.level,"<unknown>"),d(a.message)]},sendStats:function(a){return[d(a.stats,{})]},sendStatsV3:function(a){return[d(a.stats,{})]},setSubtitleStyle:function(){return[]},timeChanged:function(a){return[+d(a.currentTime,0),+d(a.duration,0)]},unloadSubtitles:function(){return[]},volumeChanged:function(a){var b=d(a.muted,"false");return b="true"===b,[+d(a.volume,Number.NaN),b]}};return e()}),define("ensis/data/uri",[],function(){function a(a){var b=a,c=RegExp("([^/]+(?=[#?])|[^/]+$)"),d=c.exec(a);return d&&d.length&&(b=d[1]),b}function b(a){var b,c={},d=a.indexOf("?");if(b=-1===d?a:a.substr(d+1),b.length>0){var e=b.split("&");e.forEach(function(a){var b=a.split("=",2);if("undefined"!=typeof b[0])if("undefined"==typeof c[b[0]])c[b[0]]=b[1];else if(Array.isArray(c[b[0]]))c[b[0]].push(b[1]);else{var d=[c[b[0]],b[1]];c[b[0]]=d}})}return c}function c(){return{getResourceFromPath:a,getSearchParamsFromPath:b}}return c()}),define("ensis/drm/directorutil",["ensis/logger/logger"],function(a){"use strict";function b(a){return f(a)}function c(a){var b;if(a){var c=a.getElementsByTagName("license");if(0!==c.length){var d=c[0];b=d.firstChild.nodeValue}}return f(b)}function d(a){var b=g(a),c=window.btoa(b);return c}function e(a){try{var b=ArrayBuffer.isView(a)?a.buffer:a,c=new Uint16Array(b),d=String.fromCharCode.apply(null,c),e=new DOMParser,f=e.parseFromString(d,"text/xml"),g=f.getElementsByTagName("Challenge");if(1!==g.length)throw h.error("Must only be one Challenge in XML: ",d),new Error("message format is bad");var i=g[0].childNodes[0].nodeValue;return i}catch(j){throw h.error("Problem extracting AcquireLicense element from license request data: ",j.message),j}}function f(a){var b=null;if(a){h.trace("License data [len: ",a.length,"]: ",a.substr(0,16)," ... ");for(var c=window.atob(a),d=c.length,e=new Uint8Array(new ArrayBuffer(d)),f=0;f<d;f++)e[f]=c.charCodeAt(f);b=e.buffer}else h.error("VUDU DRM: No license data come back from Vudu UI");return null===b&&(b=new Uint8Array(0)),b}function g(a){var b;if(a instanceof ArrayBuffer)b=new Uint8Array(a);else{if("function"!=typeof ArrayBuffer.isView||!ArrayBuffer.isView(a))throw new Error("Can't convert array to string: "+a);b=a}return String.fromCharCode.apply(String,b)}var h=a.create("DirDrmUtils");return{unpackDirectorResponseFromNote:b,unpackDirectorResponseFromDOM:c,packEmeMessage:d,packEmeMessageMsft:e}}),define("ensis/vudu/player/DashPlayerInterface",["ensis/lang/function","ensis/media/types","ensis/logger/logclient","ensis/lang/error"],function(a,b,c,d){"use strict";function e(a,b,c){return{level:a,allowConsole:b,useTimestamps:c}}function f(a,b,c,d,e,f){return{mediaElement:a,mpdUrl:b,uriSuffix:c,eventListener:d,bookmarkTime:e,algorithm:f}}function g(a,b,c){return{type:a,reason:b,extra:c}}function h(a,b,c,d,e,f,g){return{type:a,durationMs:c,index:b,representation:d,byteCount:e,downloadStartTimeMs:f,downloadEndTimeMs:g}}function i(a){return{streamingAlgorithm:a}}function j(a,b,c){return{type:a,representationIndex:b,sidx:c}}function k(a,b,c){return{id:a,name:b,build:c,streamingAlgorithm:void 0}}function l(){return{createPlayer:null,getVersionInfo:null,getInterfaceVersion:null}}function m(){return{play:null,pause:null,seek:null,getCurrentTime:null,getDuration:null,getPlayerSettings:null,getVolume:null,getMute:null,setVolume:null,setMute:null,getBitratesFor:null,getCurrentAdaptationFor:null,getCurrentRepresentationFor:null,setMaxBitrateFor:null,setMaxVideoResolution:null,setCurrentRepresentationFor:null,setInitialBitrateFor:null,initialize:null,setLogging:null,reset:null}}function n(){var a={onAdaptationSelected:null,onBufferLoaded:null,onBufferLevel:null,onBufferUnderrun:null,onError:null,onFragmentLoaded:null,onLicenseRequest:null,onManifestLoaded:null,onManifestParsed:null,onRepresentationSelected:null,onSidxParsed:null,onCanPlay:null,onEnded:null,onKeySystemsChanged:null,onMetadataLoaded:null,onPause:null,onPlay:null,onPlaybackRateChanged:null,onPositionUpdate:null,onProgress:null,onSeeked:null,onSeeking:null,onVolumeChanged:null,onWaiting:null,onLogMessage:null,onMetricsData:null,onPlayerStopped:null};return a}function o(){return{createPlayer:a.namedNOP("AbstractPlayerFactoryImpl::createPlayer"),getVersionInfo:a.namedNOP("AbstractPlayerFactoryImpl::getVersionInfo"),getInterfaceVersion:a.namedNOP("AbstractPlayerFactoryImpl::getInterfaceVersion")}}function p(){return{play:a.namedNOP("AbstractDashPlayer::play"),pause:a.namedNOP("AbstractDashPlayer::pause"),seek:a.namedNOP("AbstractDashPlayer::seek"),getCurrentTime:a.namedNOP("AbstractDashPlayer::getCurrentTime"),getDuration:a.namedNOP("AbstractDashPlayer::getDuration"),getVolume:a.namedNOP("AbstractDashPlayer::getVolume"),getMute:a.namedNOP("AbstractDashPlayer::getMute"),setVolume:a.namedNOP("AbstractDashPlayer::setVolume"),setMute:a.namedNOP("AbstractDashPlayer::setMute"),getBitratesFor:a.namedNOP("AbstractDashPlayer::getBitratesFor"),getCurrentAdaptationFor:a.namedNOP("AbstractDashPlayer::getCurrentAdaptationFor"),getCurrentRepresentationFor:a.namedNOP("AbstractDashPlayer::getCurrentRepresentationFor"),setMaxBitrateFor:a.namedNOP("AbstractDashPlayer::setMaxBitrateFor"),setMaxVideoResolution:a.namedNOP("AbstractDashPlayer::setMaxVideoResolution"),setCurrentRepresentationFor:a.namedNOP("AbstractDashPlayer::setCurrentRepresentationFor"),setInitialBitrateFor:a.namedNOP("AbstractDashPlayer::setInitialBitrateFor"),getPlayerSettings:a.namedNOP("AbstractDashPlayer::getPlayerSettings"),initialize:a.namedNOP("AbstractDashPlayer::initialize"),setLogging:a.namedNOP("AbstractDashPlayer::setLogging"),reset:a.namedNOP("AbstractDashPlayer::reset")}}function q(){return{onAdaptationSelected:a.namedNOP("AbstractDashListener::onAdaptationSelected"),onBufferLoaded:a.namedNOP("AbstractDashListener::onBufferLoaded"),onBufferLevel:a.namedNOP("AbstractDashListener::onBufferLevel"),onBufferUnderrun:a.namedNOP("AbstractDashListener::onBufferUnderrun"),onError:a.namedNOP("AbstractDashListener::onError"),onFragmentLoaded:a.namedNOP("AbstractDashListener::onFragmentLoaded"),onLicenseRequest:a.namedNOP("AbstractDashListener::onLicenseRequest"),onManifestLoaded:a.namedNOP("AbstractDashListener::onManifestLoaded"),onManifestParsed:a.namedNOP("AbstractDashListener::onManifestParsed"),onRepresentationSelected:a.namedNOP("AbstractDashListener::onRepresentationSelected"),onSidxParsed:a.namedNOP("AbstractDashListener::onSidxParsed"),onCanPlay:a.namedNOP("AbstractDashListener::onCanPlay"),onEnded:a.namedNOP("AbstractDashListener::onEnded"),onKeySystemsChanged:a.namedNOP("AbstractDashListener::onKeySystemsChanged"),onMetadataLoaded:a.namedNOP("AbstractDashListener::onMetadataLoaded"),onPause:a.namedNOP("AbstractDashListener::onPause"),onPlay:a.namedNOP("AbstractDashListener::onPlay"),onPlaybackRateChanged:a.namedNOP("AbstractDashListener::onPlaybackRateChanged"),onPositionUpdate:a.namedNOP("AbstractDashListener::onPositionUpdate"),onProgress:a.namedNOP("AbstractDashListener::onProgress"),onSeeked:a.namedNOP("AbstractDashListener::onSeeked"),onSeeking:a.namedNOP("AbstractDashListener::onSeeking"),onVolumeChanged:a.namedNOP("AbstractDashListener::onVolumeChanged"),onWaiting:a.namedNOP("AbstractDashListener::onWaiting"),onLogMessage:a.namedNOP("AbstractDashListener::onLogMessage"),onMetricsData:a.namedNOP("AbstractDashListener::onMetricsData")}}var r=3;return{VERSION:r,DashPlayerFactory:l,DashPlayerInterface:m,DashPlayerListenerInterface:n,ErrorDetails:g,FragDownloadDetails:h,LoggingParams:e,InitParams:f,PlayerSettingDetails:i,SegmentIndexDetails:j,VersionDetails:k,createPlayerInterface:m,createPlayerFactory:l,createListenerInterface:n,createAbstractPlayer:p,createAbstractPlayerFactory:o,createAbstractListener:q}}),define("asteroid/config",["module","ensis/lang/error","asteroid/target/target"],function(a,b,c){"use strict";function d(){return h.aggStatsSendInterval?h.aggStatsSendInterval:600}function e(a,d){if("pallas"===c.target&&"UHD"===a)return 12e6;if(d.getVersion()>=3&&d.useLowBitrateStartup())return 0;var e=i[a];if("undefined"==typeof e)throw b.Error.create("Invalid value for quality ("+a+")");return e}function f(){return h.localLoggingLevel}function g(){return{getAggStatsSendInterval:d,getLocalLoggingLevel:f,selectInitialVideoBitrate:e,FragmentTolerance:j}}var h=a.config()||{},i={SD:1e6,HD:15e5,HDX:45e5,UHD:675e4},j={video:2/30,audio:1/8e3,"default":2/30,getForType:function(a){return"number"==typeof j[a]?j[a]:j["default"]}};return g()}),define("ensis/event/ThrottledReporter",["ensis/lang/function","ensis/lang/error"],function(a,b){"use strict";function c(){return{report:function(){}}}function d(){return c()}function e(a,c){function d(a){var b,c=Date.now();Number.isNaN(g.timeTracker)?b=c:(b=c-g.timeTracker,b="+"+b),g.list.push(a+"@"+b),g.timeTracker=c,null==g.timerFlush&&e()}function e(){if(0===g.list.length)g.timerFlush=null;else{var b=[];g.list.length<=g.MAX_REPORT?(b=g.list,g.list=[]):b=g.list.splice(0,g.MAX_REPORT);var c=b.join(",");g.timerFlush=setTimeout(e,g.INTERVAL),a.report(c)}}function f(){null!==g.timerFlush&&(clearTimeout(g.timerFlush),g.timerFlush=null),e(),null!==g.timerFlush&&(clearTimeout(g.timerFlush),g.timerFlush=null)}var g={INTERVAL:c||1e3,MAX_REPORT:20,timeTracker:Number.NaN,timerFlush:null,list:[]};if(!a||"function"!=typeof a.report)throw b.Error.create("Invalid parameter");return{addMessage:d,stop:f}}function f(){return{create:e,createAbstractHandler:d}}return f()}),define("asteroid/HTMLMediaElementMetricsHandler",["ensis/lang/error","ensis/event/ThrottledReporter"],function(a,b){"use strict";function c(){}function d(a){try{var b=l.format(a);j.addMessage(b)}catch(c){throw c}}function e(c,e){h=c,"function"!=typeof e&&a.Error.create("Invalid parameter for message out"),i.report=function(a){e("Media Event: "+a)},j=b.create(i,1e3),k.forEach(function(a){h.addEventListener(a,d)})}function f(){k.forEach(function(a){h.removeEventListener(a,d);
}),h=null,j.stop(),j=null}function g(){return{setup:e,stop:f}}var h=null,i=b.createAbstractHandler();i.report=c;var j,k=["abort","canplay","canplaythrough","ended","loadeddata","loadedmetadata","loadstart","pause","play","playing","seeked","seeking","volumechange","waiting"],l={format:function(a){var b,c=l.getForEvent(a.type);return b=c?[a.type,"(",c(a),")"].join(""):a.type},getForEvent:function(a){return"function"==typeof l[a]?l[a]:null},loadedmetadata:function(a){return a.target.duration},playing:function(a){return a.target.currentTime},pause:function(a){return a.target.currentTime},seeking:function(a){return a.target.currentTime},seeked:function(a){return a.target.currentTime},volumechange:function(a){var b=a.target.volume;b=b.toString().substr(0,4);var c=a.target.muted;return c&&(b+=":muted"),b}};return g()}),define("asteroid/DashPlayerEventMetricsHandler",["ensis/lang/function","ensis/lang/error","ensis/media/types","ensis/vudu/player/DashPlayerInterface","ensis/vudu/playerbridge/msgbuilder","ensis/event/ThrottledReporter"],function(a,b,c,d,e,f){"use strict";function g(a){switch(a){case c.AdaptationType.audio:return"a";case c.AdaptationType.video:return"v";default:return"-"}}function h(a,b,c){var d={method:a,reporter:b};return function(){return c.apply(d,arguments)}}function i(){var a=[];a.push(l.getToken(this.method));var b=l.getFormatter(this.method);b&&(a.push("("),a.push.apply(a,b.apply(null,arguments)),a.push(")")),this.reporter.addMessage(a.join(""))}function j(){var a=[],b=m.getToken(this.method);a.push(b);var c=m.getFormatter(this.method);c&&(a.push("("),a.push.apply(a,c.apply(null,arguments)),a.push(")")),this.reporter.addMessage(a.join(""))}function k(a){function c(){m.stop(),g=null,k=null,m=null}var g={},k={};"function"!=typeof a&&b.Error.create("Invalid parameter for message logger");var l=f.createAbstractHandler();l.report=function(b){a("Player: "+b)};var m=f.create(l,5e3),n=d.createListenerInterface();for(var o in n)n.hasOwnProperty(o)&&(g[o]=h(o,m,i));var p=e.HostMsgParser;for(o in p)e.HostMsgParser.hasOwnProperty(o)&&(k[o]=h(o,m,j));return{player:g,host:k,stop:c}}var l={getFormatter:function(a){if("function"==typeof l.methods[a])return l.methods[a]},getToken:function(a){return"string"==typeof l.tokens[a]?l.tokens[a]:a},methods:{onAdaptationSelected:function(a,b){var c=[];return c.push(g(a)),c.push("/",b),c},onBufferLoaded:function(a){var b=[];return b.push(g(a)),b},onBufferLevel:function(a,b){var c=[];return c.push(g(a)),c.push("/",b),c},onBufferUnderrun:function(a){var b=[];return b.push(g(a)),b},onError:function(a){var b=[];return b.push(a.type),b},onLicenseRequest:function(a){var b,c=[];switch(a){case"playready":b="pr";break;case"widevine":b="wv";break;default:b="--"}return c.push(b),c},onFragmentLoaded:function(a,b){var c=[],d=NaN;return"number"==typeof b.downloadEndTimeMs&&"number"==typeof b.downloadStartTimeMs&&(isNaN(b.downloadEndTimeMs)||isNaN(b.downloadStartTimeMs)||(d=b.downloadEndTimeMs-b.downloadStartTimeMs,d=Math.floor(d),d/=1e3)),c.push(g(a)),c.push("/","ri:",b.representation),c.push("/","si:",b.index),c.push("/","bc:",b.byteCount),isNaN(d)||c.push("/","dls:",d),c},onRepresentationSelected:function(a,b){var c=[];return c.push(g(a)),c.push("/","ri:",b),c},onSidxParsed:function(a,b){var c=[];return c.push(g(a)),c.push("/","ri:",b.representationIndex),c.push("/","rc:",b.sidx.getReferenceCount()),c}},tokens:{onAdaptationSelected:"adapt",onBufferLoaded:"buffLd",onBufferLevel:"buff",onBufferUnderrun:"buffUR",onError:"err",onFragmentLoaded:"frag",onLicenseRequest:"lreq",onRepresentationSelected:"rep",onSidxParsed:"sidx"}},m={getFormatter:function(a){if("function"==typeof m.methods[a])return m.methods[a]},getToken:function(a){return"string"==typeof m.tokens[a]?m.tokens[a]:a},methods:{loadLicense:function(a){return[a]},loadPlayerImplementation:function(a){var b=[];return"string"==typeof a&&(a=a.split(","),a.length>0&&b.push(a[0])),b},selectStreamingAlgorithm:function(a){var b=[];return b.push(a),b},setDebugLevel:function(a,b){var c=[];return a&&a.length>0&&(c.push("l:",a.substr(0,1)),b&&c.push("/d")),c}},tokens:{loadLicense:"llic",loadPlayerImplementation:"plImpl",selectStreamingAlgorithm:"algo",setDebugLevel:"dbg"}};return{create:k}}),define("asteroid/PlayerStatus",["ensis/logger/logger"],function(a){var b=a.create("PlayerStatus"),c={PLAY_STATUS_INIT:"init",PLAY_STATUS_PLAY:"play",PLAY_STATUS_PAUSE:"paused",PLAY_STATUS_SEEKING:"seeking",PLAY_STATUS_SEEKED:"seeked",PLAY_STATUS_ENDED:"ended",PLAY_STATUS_ERROR:"error",create:function(){function a(a,c){b.trace("checkStatusIsReached() current: ",e,"; desired: ",a),a===e&&(clearInterval(f),f=null,b.trace("checkStatusIsReached() completed"),c())}var d=100,e=c.PLAY_STATUS_INIT,f=null;return{waitForStatusReached:function(b,c){return b===e?void c():(null!==f&&clearInterval(f),void(f=setInterval(a,d,b,c)))},getStatus:function(){return e},setStatus:function(a){e=a},equalsAny:function(){var a=[].some.call(arguments,function(a){return e===a});return a}}}};return c}),define("asteroid/HostBridgeWrapper",["ensis/lang/object","ensis/logger/logger","ensis/async/async2","ensis/async/util","ensis/lang/error","ensis/vudu/playerbridge/bridge","ensis/vudu/playerbridge/msgbuilder"],function(a,b,c,d,e,f,g){"use strict";function h(a){if(w.trace("Host connected"),x!==y)throw e.Error.create("Bridge is already connected");y=m(a.detail.source,a.detail.data.context),A.onComplete(),A=null}function i(a){w.trace("Player registered"),t=l(a),z.onComplete(),z=null}function j(a){x!==y&&u&&u.stateChange(a)}function k(){y=x,t=null,u.destroyed(),u.stop(),v.stop(),d.wait(1).then(function(){v=null,u=null})}function l(a){function b(a,b){return function(c){var d=g.HostMsgParser[a](c);b.apply({},d)}}var c={};for(var d in a)a.hasOwnProperty(d)&&"function"==typeof a[d]&&(c[d]=b(d,a[d]));return c}function m(a,b){return{source:a,context:b}}function n(){var a=c.Deferred();return a.execute(function(){}),a}function o(){var a=c.Deferred();return a.execute(function(){}),a}function p(){u=f.getBridgeToHost(y.source,y.context);var b=a.extend(f.createHostCmdListener(),t);v=f.getBridgeFromHost(window,b),u.ready()}function q(){if(x===y)throw e.Error.create("Bridge is not yet connected");return y.source}function r(){if(x===y)throw e.Error.create("Bridge is not yet connected");return y.context}function s(){return{getConnectionContext:r,getHostWindow:q,handleHostConnectEvent:h,postPlayerStateChange:j,registerPlayerHostHandler:i,stop:k}}var t,u,v,w=b.create("HostBridgeWrapper"),x=new Object,y=x,z=n(),A=o();return d.whenAll(A,z).then(p),s()}),define("ensis/data/find",[],function(){function a(b,c,d,e,f){var g=d||0,h=e||c.length,i=f||{calls:0};if(++i.calls,1>=h-g)return g;var j=Math.floor(g+(h-g)/2);return b==c[j]?j:b>c[j]?a(b,c,j,h,i):a(b,c,g,j,i)}function b(b,c){return a(b,c)}function c(){return{search:b,insertSorted:d,CompareFunction:{NUMERIC_ASC:f,NUMERIC_DESC:g}}}var d=function(a,b,c){var d=e(a,b,c);return a.splice(d,0,b),d},e=function(a,b,c){if("undefined"==typeof c)c=f;else if("function"!=typeof c)throw new Error("Invalid value for compare_function");for(var d=0;d!=a.length&&!(c(a[d],b)>0);++d);return d},f=function(a,b){return a<b?-1:a>b?1:0},g=function(a,b){return b<a?-1:b>a?1:0};return c()}),define("asteroid/SeekUtil",["ensis/logger/logger","ensis/media/types","ensis/data/find","ensis/lang/error","asteroid/config"],function(a,b,c,d,e){"use strict";function f(){function a(a,c){if(a!==b.MediaType.AUDIO&&a!==b.MediaType.VIDEO&&h.warn("Add for type called for non media stream: ",a),g[a]&&g[a].seekTable)return void h.trace("Already have a seek table for this type: ",a);g[a]={seekTable:[0]};for(var d=0,e=c.getTimescale(),f=c.getReferenceCount(),i=0;i!=f;++i){var j=c.getReference(i).subsegment_duration;d+=j;var k=d/e;g[a].seekTable.push(k)}}function e(a,b,d){if(g[a]){var e=g[a].seekTable,f=Number.NaN,j=c.search(b,e),k=1+j;if(k===e.length)f=j;else{var l=e[j],m=e[k];if(d)for(;k!==e.length&&l<b;)l=m,j=k,++k,m=e.length===k?Number.POSITIVE_INFINITY:e[k];d?f=j:m>=b&&b>=l?f=m-b<i[a]?k:j:(h.warn("Weird seektime info: ",l," | ",b," | ",m),f=j)}if(!Number.isNaN(f)){var n=e[f];h.trace("Adjusting seektime from: ",b," to: ",n),b=n,b+=i[a]}}else h.error("No seek table yet for type: ",a);return b}function f(a,b){if(!g[a])throw h.error("No seek table yet for type: ",a),d.Error.create("Seek table not yet initialized");var e=g[a].seekTable,f=Number.NaN,i=c.search(b,e),j=1+i;if(j===e.length)f=i;else{var k=e[i],l=e[j],m=b-k,n=l-b;f=m<n?i:j}return{index:f,time:e[f]}}var g={};return{addTableForType:a,findAlignedSeekTime:e,findClosestStartTime:f}}function g(){return{create:f}}var h=a.create("SeekUtil"),i={};return i[b.MediaType.VIDEO]=e.FragmentTolerance.getForType("video"),i[b.MediaType.AUDIO]=e.FragmentTolerance.getForType("audio"),g()}),define("ensis/html/video/captions",[],function(){"use strict";function a(a,b){"undefined"==typeof a&&(a="CaptionError"),"undefined"==typeof b&&(b=a),this.message=a,this.code=b,this.ErrorCode=j}function b(b){switch(b){case g.VTT:return"text/vtt";case g.TTML:return"text/ttml";default:throw a.create(j.INVALID_FORMAT)}}function c(b){if("string"!=typeof b)throw a.create(j.INVALID_MIMETYPE);switch(b.toLowerCase()){case"text/webvtt":case"text/vtt":return g.VTT;case"text/ttml":return g.TTML;default:throw a.create(j.INVALID_MIMETYPE)}}function d(a,b){var c,d;b?(c=b.ownerDocument?b.ownerDocument:document,b instanceof HTMLMediaElement&&(d=b)):c=document;var e=c.createElement("track");return e.setAttribute("kind",a.kind),e.setAttribute("label",a.label),e.setAttribute("src",a.src),e.setAttribute("srcLang",a.srcLang),e.setAttribute("mode",a.mode),d&&d.appendChild(e),e["x-vudu"]={selected:!1,enableTrack:function(){e["x-vudu"].selected=!0,e.track.mode=h.SHOWING},disableTrack:function(){e["x-vudu"].selected=!1,e.track.mode=h.DISABLED}},d&&(d["x-vudu"]?d["x-vudu"].trackList.push(e):d["x-vudu"]={trackList:[e],enableTrack:function(a){if("undefined"==typeof a||isNaN(a))d["x-vudu"].disableTracks();else{if(d["x-vudu"].trackList[a]["x-vudu"].selected)return;d["x-vudu"].disableTracks(),d["x-vudu"].trackList[a]["x-vudu"].enableTrack()}},disableTracks:function(){d["x-vudu"].trackList.forEach(function(a){a["x-vudu"].disableTrack()})}}),e}function e(a,b,c,d,e){return{src:b,kind:c,label:d,type:a,mode:h.DISABLED,srcLang:e}}function f(){return{Type:g,TrackMode:h,TrackKind:i,CaptionError:a,createTrackInfo:e,createTrackElement:d,mimetypeForType:b,typeForMimeType:c}}var g={VTT:"vtt",TTML:"ttml"},h={DISABLED:"disabled",HIDDEN:"hidden",SHOWING:"showing"},i={CAPTIONS:"captions",SUBTITLES:"subtitles",METADATA:"metadata"},j={INVALID_MIMETYPE:"invalid-mimetype",INVALID_TRACK_FORMAT:"invalid-track-format"};return a.create=function(b,c){return new a(b,c)},a.ErrorCode=j,f()}),define("ensis/vudu/director/util",[],function(){function a(a,b,c,d,e){var f;switch(c){case"text/vtt":case"text/webVTT":f="vtt";break;case"text/ttml":f="ttml";break;default:throw new Error("Unsupported mimetype for captions: "+c)}return"string"!=typeof b?b="":"?"!==b[0]&&(b="?"+b),a+"/subtitle."+e+"."+d+"."+f+b}function b(){return{buildCaptionsUrl:a}}return b()}),define("asteroid/CaptionUtil",["ensis/logger/logger","ensis/html/video/captions","ensis/vudu/director/util","ensis/lang/error"],function(a,b,c,d){"use strict";function e(){return b.TrackKind.CAPTIONS}function f(a,b){var c={};return a.subtitles.forEach(function(a,b){c[a.name]=b}),{enableCaptions:function(a){return"number"!=typeof c[a]?void k.warn("Invalid caption language: ",a):void b["x-vudu"].enableTrack(c[a])},disableCaptions:function(){b["x-vudu"].disableTracks()}}}function g(a,d){var g=null;if(a.subtitles&&0!==a.subtitles.length)if(a.type)try{var h=b.typeForMimeType(a.type);h!==b.Type.VTT&&h!==b.Type.TTML||(a.subtitles.forEach(function(f){var g=e(),i=c.buildCaptionsUrl(a.uriBase,a.uriSuffix,a.type,f.languageCode,f.version),j=b.createTrackInfo(h,i,g,f.name,f.languageCode);b.createTrackElement(j,d)}),g=f(a,d))}catch(i){k.warn("Unable to set-up captions: ",i.message)}else k.log("Subtitle mimetype not defined, not rendering subtitles");else k.log("No subtitles listed, not rendering subtitles");return g}function h(a,b){return{isEnabled:function(){return a},getLanguage:function(){if(!a)throw d.Error.create("Invalid state - captions not enabled");return b}}}function i(a){var b,c=!1;return null===a||"undefined"==typeof a||("boolean"==typeof a&&!1!==a?k.warn("parseHostCaptionMode() needs 'falsey' or language code/label"):"string"==typeof a&&(""===a||"off"===a.toLowerCase()||(c=!0,b=a))),h(c,b)}function j(){return{create:g,parseHostCaptionMode:i}}var k=a.create("CaptionUtil");return j()}),define("ensis/media/buffercontrol",["ensis/logger/logger"],function(a){"use strict";function b(a,b,c){var d;c&&(d={detail:c});var e=new CustomEvent(a,d);b.dispatchEvent(e)}function c(a){switch(a){case 0:return h.CCAST.RESUME_LEVEL_0;case 1:return h.CCAST.RESUME_LEVEL_1;case 2:return h.CCAST.RESUME_LEVEL_2;default:return h.CCAST.RESUME_LEVEL_3}}function d(a,c,d,e){var f=0,j=0;return a.buffered&&a.buffered.length>0&&(j=Math.max(a.buffered.end(0)-a.currentTime,0)),j<=h.BUFFER_ZONES.PANIC?(g.log("PANIC: buffer level is below acceptible minimum"),f=0):d==c?f=c:d<c?(g.log("Quality Level increase request: ",d," -> ",c),j>h.BUFFER_ZONES.CONSERVATIVE?(c-d>1&&g.log("AGRESSIVE: Jumping some levels:",d," -> ",c),f=c):(c-d>1&&g.log("CONSERVATIVE: GOOG recommends ",c," but ignoring due to conservative algorithm"),f=d+1,f>c&&(f=c,g.log("CONSERVATIVE: Unexpected scenario; current: ",d,"; recommendedIdx: ",c)),g.log("CONSERVATIVE: Increasing bitrate gradually.  New Index: ",f))):(g.log("Quality Level decrease request: ",d," -> ",c),f=c),d!==f&&b(i.EVT_CHNG_QUALITY_LEVEL,e,{type:"video",index:f,bitrate:Number.NaN}),f}function e(a){function e(a,b){g.log("Quality: ",a,": ",b)}function f(){++u,b(i.EVT_CHNG_RESUME_LEVEL,t,{level:c(u)}),b(i.EVT_PLAYER_STALL,t,{stalled:!0,count:u}),h.MAX_STALL==u&&b(i.EVT_PLAYBACK_FAIL,t)}function k(a){g.log("Buffer level: ",a)}function l(){u=0,r.removeEventListener("playing",l);(function(){function a(){if(0===c.length)return null;var a=c.shift();return a}function b(){var c=a();null!=c&&setTimeout(function(){f(),setTimeout(function(){n()},5e3),b()},1e3*c)}var c=[10,10,10,10,10,10,10];return{next:b}})()}function m(a){switch(a.type){case"seeking":g.log("seekMonitor: Marking player as 'inseek', so stalls are not counted."),v.setSeekStart(a.target.paused?v.State.SEEKING_PAUSED:v.State.SEEKING_PLAYING);break;case"seeked":v.State.SEEKING_PAUSED==v.getState()?(g.log("seekMonitor: Seek ended while paused, clearing 'inseek'."),v.setSeekEnded()):g.log("seekMonitor: Seek ended but maintain 'inseek' until playback resumes.");break;case"playing":v.State.NONE!==v.getState()&&(g.log("seekMonitor: Playback resumed while 'inseek', signals end of seek."),v.setSeekEnded())}}function n(){var a=s.getState();a&&a.underflow?g.warn("Playback resumed, but MPL is still reporting underflow condition"):(w=!1,b(i.EVT_PLAYER_STALL,t,{stalled:!1,count:u}))}function o(a){var b=!1,c="";if(v.inSeekWindow())b=!0,c="SEEKING";else if(x)b=!0,c="STARTING";else if("pause"==a.type||"stalled"==a.type){var d=s.getState();d&&!d.underflow&&(b=!0,c="Was pause or stall, but no underflow"),w&&(b=!0,c="Was already flagged as stalled")}b?g.log("Ignoring stall; reason: ",c):(g.warn("reporting a stall"),w=!0,f())}function p(a){"play"==a.type?x=!0:"playing"==a.type&&(x=!1)}function q(){r.removeEventListener("playing",l),r.removeEventListener("playing",n),r.removeEventListener("pause",o),r.removeEventListener("stalled",o),r.removeEventListener("waiting",o),r.removeEventListener("play",p),r.removeEventListener("playing",p),r.removeEventListener("playing",m),r.removeEventListener("seeking",m),r.removeEventListener("seeked",m)}var r=a.mediaElement,s=a.mplPlayer,t=document.createElement("div"),u=0,v=j({video:r,dispatchEvent:function(a,c){b(a,t,c)},getResumeLevel:function(){return c(u)}}),w=!1,x=!0;r.addEventListener("playing",l),r.addEventListener("playing",n),r.addEventListener("pause",o),r.addEventListener("waiting",o),r.addEventListener("stalled",o),r.addEventListener("play",p),r.addEventListener("playing",p),r.addEventListener("playing",m),r.addEventListener("seeking",m),r.addEventListener("seeked",m),t.reportStall=f,t.reportQuality=e,t.reportBufferLevel=k,t.stop=q,t.getPlaybackResumeLevel=function(){return c(u)},t.getPlaybackResumeFragments=function(){return h.CCAST.RESUME_FRAG_COUNT},t.getPlaybackStallLevel=function(){return h.MIN_BUFFER_PAUSE_LEVEL},t.getStallState=function(){return w};var y=-1;return t.selectVideoQualityIndex=function(a){return y=d(r,a,y,t)},t.getVideoQuality=function(){return-1!==y?y:Number.NaN},t.selectAudioQualityIndex=function(){return 0},t.EVENTS=i,t}function f(){var a={};return a.create=e,a.EVENTS=i,a.ZONES=h.BUFFER_ZONES,a}var g=a.create("BufferControl"),h={MAX_STALL:4,MIN_BUFFER_RESUME_LEVEL:10,MIN_BUFFER_PAUSE_LEVEL:3};h.CCAST={RESUME_LEVEL_0:10,RESUME_LEVEL_1:13,RESUME_LEVEL_2:16,RESUME_LEVEL_3:19,RESUME_FRAG_COUNT:1e3},h.MIN_BUFFER_RESUME_LEVEL=h.CCAST.RESUME_LEVEL_0,h.BUFFER_ZONES={PANIC:4,CONSERVATIVE:15};var i={EVT_CHNG_QUALITY_LEVEL:"changequalitylevel",EVT_CHNG_RESUME_LEVEL:"changeresumelevel",EVT_PLAYBACK_FAIL:"playbackfailed",EVT_PLAYER_STALL:"stall",EVT_PLAYER_BUFFER_SEEK:"bufferingforseek"},j=function(a){function b(){function a(){var a=!1;if(f.SEEKING_PLAYING===m||f.SEEKING_PAUSED===m)g.log("SeekMonitor: Still actively seeking"),a=!0;else if(!isNaN(n)){var b=Date.now();b<n&&(g.log("SeekMonitor: In postseek grace period"),a=!0),g.log("SeekMonitor::inSeekWindow: ",a,"; ",b," 'v' ",n)}return a}function b(){m=f.NONE,n=Date.now(),g.log("SeekMonitor::setSeekEnded: ",n),n+=h,g.log("SeekMonitor::setSeekEnded (bumped): ",n),d(i.EVT_PLAYER_BUFFER_SEEK,{seek:!0,grace:!0,endtime:n}),k()}function k(){var a=Date.now(),b=!1;o&&(clearTimeout(o),o=null);var f=0;c.buffered&&c.buffered.length>0&&(f=Math.max(c.buffered.end(0)-c.currentTime,0)),f>=e()?(b=!0,g.log("SeekMonitor::canEnd - enough buffer")):a>n&&(b=!0,g.log("SeekMonitor::canEnd - time-out")),b?(n=a,d(i.EVT_PLAYER_BUFFER_SEEK,{seek:!1})):o=setTimeout(k,j)}function l(a){m=a,o&&(clearTimeout(o),o=null),d(i.EVT_PLAYER_BUFFER_SEEK,{seek:!0})}var m,n,o=null;return{getState:function(){return m},inSeekWindow:a,setSeekStart:l,setSeekEnded:b,State:f}}var c=a.video,d=a.dispatchEvent,e=a.getResumeLevel,f={NONE:0,SEEKING_PLAYING:1,SEEKING_PAUSED:2},h=5e3,j=666;return b()};return f()}),define("ensis/diag/stream/translator",["ensis/media/codec","ensis/media/types"],function(a,b){function c(c){function d(a){for(var b=0;b!=e.length;++b)if(a.toUpperCase()===e[b].codecs.toUpperCase())return e[b].name;return"N/A"}var e=c===b.Track.Type.VIDEO?a.Formats.video:a.Formats.audio;return{translate:d}}function d(){return c(b.Track.Type.AUDIO)}function e(){return c(b.Track.Type.VIDEO)}function f(){return{translate:function(a){return a}}}function g(a){switch(a){case b.Track.Type.AUDIO:return d();case b.Track.Type.VIDEO:return e();default:return f()}}return{lookup:g}}),define("ensis/diag/stream/stream_frag_html",[],function(){return'<div id="stats" class="dbcheck stat-box">\t\t\t<div id="vfmt" class="stat-field stat-vfmt">-</div>\t\t\t<div id="afmt" class="stat-field stat-afmt">-</div>\t\t\t<div id="stall" class="stat-field stat-stall">-</div>\t\t\t<div id="resume" class="stat-field stat-resume">-</div>\t\t\t<div id="buffer" class="stat-field stat-buffer">-</div>\t\t\t<div id="resolution" class="stat-field stat-res">-</div>\t\t\t<div id="bitrate-video" class="stat-field stat-video">-</div>\t\t\t<div id="bitrate-audio" class="stat-field stat-audio">-</div>\t\t</div>\t\t\t<div id="quality-bar" data-ancinus-className="dbcheck quality-bar"></div>\t\t<div id="buffer-bar" data-ancinus-className="dbcheck buffer-bar"></div>\t\t<div id="stall-spinner" style="display: none;"></div>\t\t<div id="finished-banner" style="display: none;">fin!</div>'}),define("ensis/diag/stream/stream_css",[],function(){return'.stat-box {\t\tmargin: 10px 40px; padding: 12px;\t\tposition: fixed;\t\tz-index: 1000;\t\ttop: 0px; right: 12px;\t\twidth: 80%; height: 24px;\t\tfont-size: 16px;\t\tbackground: #088;\t\topacity: 0.5;\t\ttext-align: right;\t}\t.stat-field {\t\t\tdisplay: inline-block;\t\t\tmargin: 0px;\t\t\tpadding: 0px;\t\t\tcolor: #ff0;\t\t\ttext-shadow: 0px 1px 8px #000;\t\t}\t.stat-video:before { content: "VIDEO:" }\t.stat-audio:before { content: "AUDIO:" }\t.stat-res:before { content: "RESOLUTION:" }\t.stat-buffer:before { content:"BUFFER (secs):" }\t.stat-resume:before { content:"RESUME (secs):" }\t.stat-stall:before { content:"STALLS:" }\t.stat-afmt:before { content:"A-FMT:" }\t.stat-vfmt:before { content:"V-FMT:" }\t\t.stat-stall {\t\ttransition-property: color;\t\ttransition-duration: 1s;\t}\t.stat-stall-stalled {\t\tcolor:#f88;\t}\t.stat-stalled-notstalled {\t}\t\t\t.quality-bar {\t\tz-index: 1000;\t\tposition: fixed;\t\tleft: 0px;\t\tbottom: 0px;\t\twidth: 100px;\t\topacity: 0.5;\t}\t\t.quality-low {\t\theight: 100px;\t\tbackground: #f00;\t}\t\t.quality-med {\t\theight: 200px;\t\tbackground: #ff0;\t}\t\t.quality-high {\t\theight: 300px;\t\tbackground: #0f0;\t}\t\t.quality-higher {\t\theight: 400px;\t\tbackground: #f0f;\t\topacity: 0.3;\t}\t\t.buffer-bar {\t\tpadding: 0px;\t\tmargin: 0px;\t\tposition: absolute;\t\tleft: 10%;\t\tright: 10%;\t\twidth: 80%;\t\theight: 24px;\t\tbottom: 10%;\t\tbackground: rgba(255, 255, 255, 0.2);\t\tfont-size: 18px;\t\tvalign: center;\t\ttext-align: center;\t\ttext-shadow: 0px 1px 8px #000;\t\tcolor: white;\t\tz-index: 1000;\t}\t\t.buffer-bar-panic {\t\tbackground: rgba(255, 0, 0, 0.5);\t}\t.buffer-bar-conservative{\t\tbackground: rgba(255, 255, 0, 0.5);\t}\t.buffer-bar-agressive{\t\tbackground: rgba(0, 255, 0, 0.5);\t}\t'}),define("ensis/diag/stream",["require","ensis/async/async","ensis/logger/logger","ensis/media/types","ensis/media/buffercontrol","./stream/translator","./stream/stream_frag_html","./stream/stream_css"],function(a,b,c,d,e,f,g,h){function i(a){s=a.ownerDocument;var c=b.Deferred(),d=g,e=h;a.innerHTML=d;var f=s.createElement("style");f.innerHTML=e,s.head.appendChild(f);var i=b.Result(k());return c.onComplete(i),c}function j(a){throw new Error("Not tested yet!")}function k(){return{bitrates:function(a){},buffer:function(a,b,c){o(a,b,c)},ended:function(a){},error:function(a,b,c){},format:function(a,b){q(a,b)},quality:function(a,b,c){a===d.Track.Type.VIDEO&&l(b)},resolution:function(a,b){m(a,b)},resume:function(a){n(a)},seek:function(){},stall:function(a,b){p(a,b)},statistics:function(a,b,c){},subtitles:function(a,b,c,d){}}}function l(a){t.log("Video quality: ",a);var b=s.getElementById("bitrate-video");b&&(b.innerHTML=""+a);var c=s.getElementById("quality-bar"),d=c.getAttribute("data-ancinus-className");switch(a){case 0:d+=" quality-low";break;case 1:d+=" quality-med";break;case 2:d+=" quality-high";break;default:d+=" quality-higher"}c&&(c.className=d)}function m(a,b){var c=s.getElementById("resolution");c&&(c.innerHTML=""+a+"x"+b)}function n(a){s.getElementById("resume").innerHTML=a}function o(a,b,c){var d=s.getElementById("buffer-bar");if(d){var f=Math.floor(b-c);d.innerHTML=a+"<--["+c+"]-->"+b,s.getElementById("buffer").innerHTML=f;var g=d.getAttribute("data-ancinus-className");g+=f<=e.ZONES.PANIC?" buffer-bar-panic":f>e.ZONES.CONSERVATIVE?" buffer-bar-agressive":" buffer-bar-conservative",d.className=g}}function p(a,b){var c=s.getElementById("stall");if(c){var d="stat-field stat-stall ";"undefined"!=typeof b&&(c.innerHTML=""+b),d+=a?"stat-stall-stalled":"stat-stall-notstalled",c.className=d}}function q(a,b){var c;switch(a){case d.Track.Type.AUDIO:c="afmt";break;case d.Track.Type.VIDEO:c="vfmt"}if(c){var e=f.lookup(a),g=e.translate(b),h=s.getElementById(c);h&&(h.innerHTML=g)}}function r(a){if(!a){var b=s.createElement("style");s.head.appendChild(b),b.innerHTML=".dbcheck { display: none; }"}}var s,t=c.create("DiagStream");return{createStatusDiv:i,createStatusFrame:j,setStatusVisible:r}}),define("ensis/diag/mediaevents",["ensis/logger/logger"],function(a){"use strict";function b(a,b){var c="undefined"!=typeof a.id,d=c?"; id: "+a.id:"";return function(a){b("Got event ",a.type,d)}}function c(){g.log.apply(null,arguments)}function d(a,d){var e=d||c,f=b(a,e);h.forEach(function(b){a.addEventListener(b,f,!0)}),i.push(a),j.push(f)}function e(a){var b=i.indexOf(a);if(-1===b)g.warn("unregister called with an element that is not registered"),g.log("had source: ",a.src),g.log("ready: ",a.readyState,"; network: ",a.networkState);else{var c=i.length;i.splice(b,1);var d=j.splice(b,1)[0];g.log("unregistered: element list length: ",i.length,"; from: ",c),h.forEach(function(b){a.removeEventListener(b,d,!0)})}}function f(){for(;0!==i.length;)e(i[0])}var g=a.create("MediaEvents"),h=["abort","loadstart","progress","loadeddata","loadedmetadata","canplay","play","playing","pause","seeking","seeked","waiting","stalled","ended","loaded","progress","error"],i=[],j=[];return{register:d,unregister:e,stop:f}}),define("asteroid/diagnostics",["module","ensis/media/types","ensis/diag/stream","ensis/diag/mediaevents","ensis/logger/logger","ensis/lang/function"],function(a,b,c,d,e,f){function g(){var a;return m.enabled?(l.log("Creating active diagnostic object"),a=i()):(l.log("Creating disabled diagnostic object"),a=h()),a}function h(){function a(){return{stop:f.NOP,quality:f.NOP,stall:f.NOP,formats:f.NOP,resume:f.NOP}}return{enabled:!1,start:a}}function i(){return{enabled:!0,start:j}}function j(a){function e(a){s=a}function f(){d.stop(),r&&(clearInterval(r),r=null)}function g(a,b){function c(){var c=a.buffered,d=Number.NaN;if("undefined"==typeof c||"undefined"==typeof c.length||0==c.length)l.log("No buffered ranges"),d=Number.NaN;else if(1==c.length)l.log("One buffered range, reporting that"),d=0;else{l.log("Multiple buffered ranges: ",c.length,"; Choosing closest to play range ...");var e=h(a.currentTime,c);d=e.index}var f=0,g=0;isNaN(d)||(f=c.start(d),g=c.end(d)),l.log("Reporting buffer range: ",f," < ",a.currentTime," > ",g),b.buffer(f,g,a.currentTime)}function d(){var c=a.videoWidth,d=a.videoHeight;l.log("Report Video Resolution(w/h): ",c,"x",d),b.resolution(c,d)}function e(){c(),d()}return setInterval(e,1e3)}function h(a,b){for(var c={index:Number.NaN,start:Number.POSITIVE_INFINITY,matched:!1},d=0;d!=b.length&&!c.matched;++d){var e=b.start(d),f=b.end(d);a>=e&&a<=f?(c.matched=!0,c.index=d,c.start=e,l.log("Got a match: ",JSON.stringify(c))):a<e&&e<c.start&&(c.index=d,c.start=e,l.log("Updating closest to: ",JSON.stringify(c)))}return c}function i(a){u=a,q.quality(b.Track.Type.VIDEO,u)}function j(a,b){v.state=a,v.count="undefined"!=typeof b?b:v.count,q.stall(v.state,v.count)}function k(a){if(a.type===b.AdaptationType.audio){var c=p(a.adaptIdx,s.audio);w.audio=m(a.type,c,a.repIdx)}else w.video=m(a.type,a.adaptIdx,a.repIdx);w.video&&w.audio&&n()}function m(a,c,d){var e=a===b.AdaptationType.audio?"audio":"video";return s[e]&&s[e].length&&s[e][c]&&s[e][c].info&&s[e][c].info[d]&&s[e][c].info[d].codecs}function n(){q.format(b.Track.Type.VIDEO,w.video),q.format(b.Track.Type.AUDIO,w.audio)}function o(a){t=a,q.resume(t)}function p(a,b){var c,d=!1;for(c=b?b.length:0;!d&&0!==c;)--c,b[c].adaptationIndex===a&&(d=!0);return d||l.error("Adaptation index not found: ",a),c}"undefined"!=typeof a.videoElement&&d.register(a.videoElement);var q=null,r=null,s=null;"undefined"!=typeof a.statsDiv&&c.createStatusDiv(a.statsDiv).then(function(b){try{q=b.get(),r=g(a.videoElement,q)}catch(c){l.err("Couldn't create stats monitoring panel")}});var t,u=0,v={state:!1,count:0},w={video:"",audio:""};return{setManifest:e,stop:f,quality:i,stall:j,format:k,resume:o}}function k(){return{isEnabled:function(){return m.enabled},create:g}}var l=e.create("DIAG"),m=a.config();return m||(m={}),m.enabled||(m.enabled=!1),k()}),define("asteroid/HostDebugInfoBuilder",["ensis/lang/function","ensis/logger/logger","ensis/lang/error"],function(a,b,c){"use strict";function d(a,b,c){return{url:a,audio:b,video:c,debugInfoString:[a,"\nVideo: ",c," Audio: ",b].join("")}}function e(){function b(b){"function"!=typeof b?(g.trace("Report function removed"),b=a.NOP):g.trace("Setting report function"),n=b}function e(a){if(p=a,g.trace("Building video codec info string ..."),p&&p.video&&p.video.length>0){var b=[];-1!==p.video[0].codecs.indexOf("hev")?b.push("H265"):-1!==p.video[0].codecs.indexOf("avc")&&b.push("H264"),-1!==p.video[0].codecs.indexOf("dvhe")&&(b.push("DV"),-1===p.video[0].codecs.indexOf(".04.")&&-1===p.video[0].codecs.indexOf("dtr")||b.push("DTR"),-1!==p.video[0].codecs.indexOf(".05.")&&b.push("STN")),b.push("DASH"),p.video[0].info&&p.video[0].info.length&&(o=p.video[0].info.length>4,b.push(o?"V3":"V2")),q=b,0!==q.length&&(k=q.join(" "),g.log("Video codec info string: ",k))}}function f(a,b,c,e){if(null===p)return void g.warn("Update received before manifest was provided");switch(a){case"audio":h(b,c,e);break;case"video":i(b,c,e)}if(l&&k&&m)try{var f=d(m,l,k);n(f)}catch(j){g.error("Error posting debug info to ui: ",j.message)}}function h(a){var b=[],c=j(a,p.audio);if(0===r.length){if(p.audio&&p.audio[c]){var d=p.audio[c].codecs;-1!==d.indexOf("mp4a")?b.push("AAC"):-1!==d.indexOf("ec-3")?b.push("DDP"):-1!==d.indexOf("ac-3")?b.push("DD"):b.push("-")}l=b.join(" "),r=b}}function i(a,b,c){if("string"==typeof c)m=c;else if(p&&p.video&&p.video.length&&p.video[0].info&&p.video[0].info[b]){var d=0;m=p.video[d].info[b].url}else g.error("No valid URL for debug info")}function j(a,b){var d,e=!1;for(d=b?b.length:0;!e&&0!==d;)--d,b[d].adaptationIndex===a&&(e=!0);if(!e)throw g.error("Adaptation index not found: ",a),c.Error.create("Invalid parameter");return d}var k,l,m,n=a.NOP,o=!1,p=null,q=[],r=[];return{setReporter:b,updateForType:f,setManifest:e}}function f(){return{create:e}}var g=b.create("HostDebugInfo");return f()}),define("asteroid/OortPathResolver",["ensis/logger/logger","ensis/lang/function"],function(a,b){var c=a.create("OORT"),d="local:",e={resolveNpmBundle:function(a){var b=a.substr(d.length);return b="../node_modules/@vudu/asteroid-bundle-"+Asteroid.getTarget()+"/players/"+b},resolveViaAsteroidSrcPath:function(a){var b;c.trace("Scripts: ",window.document.scripts);var e=[].filter.call(window.document.scripts,function(a){return!(!a||!a.src||-1===a.src.indexOf("/asteroid"))});if(1!==e.length&&c.warn("Only expect one script-tag to point to an asteroid"),0==e.length)c.error("Can't locate oort players, as there's no asteroid script");else{var f=e.shift();f=f.src;var g,h;g=f.lastIndexOf("/asteroid"),h=f.substring(0,g),b=a.substr(d.length),b=h+"/players/"+b}return b}},f=b.namedNOP("oort path resolver");return{LOCAL_PROTOCOL:d,ResolveLocal:e,resolve:f}}),define("asteroid/target/oortpathresolver",["asteroid/OortPathResolver"],function(a){"use strict";return a.resolve=a.ResolveLocal.resolveNpmBundle,a}),define("asteroid/dashplayer/version",{url:"local:platjs-wrapper_dashjs_230@1.5.7-beta.317583.30/player_dashjs_2.3.0.all.js","package":"@vudu/platjs-wrapper_dashjs_230",version:"1.5.7-beta.317583.30",isDefault:!0}),define("asteroid/DashPlayerLoader",["ensis/lang/error","ensis/logger/logger","ensis/async/async2","ensis/vudu/player/DashPlayerInterface","asteroid/target/oortpathresolver","asteroid/dashplayer/version"],function(a,b,c,d,e,f){"use strict";function g(b){function d(){b?g().then(function(a){l.onComplete(a)})["catch"](function(){i.error("Shouldn't be possible to get here"),h()}):h()}function h(){i.error("FATAL ERROR: Default player failed to load."),l.onComplete(a.Error.create("Failed to load any player"))}var k,l=c.Deferred();if(b)0===b.indexOf(e.LOCAL_PROTOCOL)?(k=e.resolve(b),k?i.trace("URI '",b,"' resolved to: ",k):i.error("Oort path resolver didn't return a URL for: '",b,"'.  Using default player")):k=b;else{i.log("Expecting default player: ",f);var m=f.url;k=e.resolve(m),k?i.trace("Default player URI '",m,"' resolved to: ",k):i.error("Oort path resolver didn't return a URL for default URL: '",m)}return l.execute(function(){var a=require.config({
context:"loader"});a([k],function(){a(["player/PlayerFactory"],function(a){var b=1;"function"==typeof a.getInterfaceVersion&&(b=a.getInterfaceVersion()),-1!==j.indexOf(b)?l.onComplete(a):(i.error("Included player library has wrong DashPlayerInterface version: ",b,"; require: ",j),d())},function(){b?(i.error("Specified player (",b,") was not found - reverting to default player"),d()):h()})},function(){i.error("Specified player factory not valid: ",k),d()})}),l}function h(){return{getPlayerFactory:g}}var i=b.create("DashPlayerLoader"),j=[1,2,3];return h()}),define("ensis/abr/fragsize",["require","exports","ensis/logger/logger","ensis/lang/error"],function(a,b,c,d){"use strict";function e(a){for(var b={averageDuration:0,averageBitrate:0,max:Number.NEGATIVE_INFINITY,min:Number.POSITIVE_INFINITY,count:a.getReferenceCount()},c=0;b.count!==c;++c){var d=a.getReference(c);b.max=Math.max(b.max,d.subsegment_duration),b.min=Math.min(b.min,d.subsegment_duration),b.averageDuration+=d.subsegment_duration,b.averageBitrate+=d.ref_info.size}var e=a.getTimescale();return b.averageDuration/=b.count,b.averageDuration/=e,0===b.averageDuration?b.averageBitrate=0:(b.averageBitrate*=8,b.averageBitrate/=b.count,b.averageBitrate/=b.averageDuration),b.max/=e,b.min/=e,b}function f(a,b,c){void 0===b&&(b=NaN),void 0===c&&(c=1);var e,f,g=Number.NaN;isNaN(b)?(e=0,f=a.getReferenceCount()):(e=b,e>=a.getReferenceCount()&&(e=a.getReferenceCount()-1),f=e+c,f>a.getReferenceCount()&&(f=a.getReferenceCount()));for(var i=0,j=0,k=e;k!==f;++k){var l=a.getReference(k);if("moof"!==l.ref_info.type)throw d.Error.create("Unsupported SIDX type.  Only implemented for MOOF type");j+=l.subsegment_duration,i+=l.ref_info.size}return h.trace("Calculated bytes: ",i),h.trace("Calculated duration: ",j),0===j?h.warn("Can't calculate average bitrate as fragments seem to have zero duration"):(g=8*i,j/=a.getTimescale(),g/=j,g=Math.ceil(g)),h.trace("Average fragment bitrate for fragment range: ",e,"-",f,": ",g),g}function g(a,b,c){void 0===b&&(b=NaN),void 0===c&&(c=1);var e,f,g=0;isNaN(b)?(e=0,f=a.getReferenceCount()):(e=b,e>=a.getReferenceCount()&&(e=a.getReferenceCount()-1),f=e+c,f>a.getReferenceCount()&&(f=a.getReferenceCount()));for(var i=e;i!==f;++i){var j=a.getReference(i);if("moof"!==j.ref_info.type)throw d.Error.create("Unsupported SIDX type.  Only implemented for MOOF type");var k=j.subsegment_duration,l=j.ref_info.size;if(0===k)h.warn("Can't calculate average bitrate as fragments seem to have zero duration");else{var m=8*l;k/=a.getTimescale(),m/=k,g=Math.max(m,g),g=Math.ceil(g)}}return h.trace("Max fragment bitrate for fragment range: ",e,"-",f,": ",g),g}b.__esModule=!0;var h=c.create("FragMetrics");b.calculateRepresentationMetrics=e,b.calculateFragmentsAverageBitrate=f,b.calculateFragmentsMaxBitrate=g}),define("ensis/abr/vbrfragbitrate",["require","exports","ensis/logger/logger","ensis/media/types","ensis/lang/error","ensis/abr/fragsize"],function(a,b,c,d,e,f){"use strict";b.__esModule=!0;var g,h=c.create("VbrRateCache"),i=function(){function a(a){this.representationIndex=a}return a.prototype.setCachedBitrates=function(a,b){var c=this;if(a>=this.segmentStartIndex&&a<=j.CACHE_SIZE+this.segmentStartIndex){h.trace("Appending bitrates to existing cache; rep: ",this.representationIndex,"; with starting segment: ",this.segmentStartIndex,"; adding: ",b.length);var d=a-this.segmentStartIndex;b.forEach(function(a){c.bitrates[d]=a,++d})}else if(a<this.segmentStartIndex&&this.segmentStartIndex-a<=b.length){h.trace("Prepending bitates to existing cache; rep: ",this.representationIndex,"; with starting segment: ",a,"; adding: ",b.length);for(var e=0,f=this.segmentStartIndex-a;e!==f;++e)this.bitrates.unshift(b[e]);this.segmentStartIndex=a}else h.trace("Replacing cache entries as range is not in sequence; rep: ",this.representationIndex,"; starting with segment index: ",a,"; length: ",b.length),this.segmentStartIndex=a,this.bitrates=b;if(h.trace("Updated cache start: ",this.segmentStartIndex,"; length: ",this.bitrates.length),this.bitrates.length>j.CACHE_SIZE){h.trace("Trimming bitrate cache...");var g=this.segmentStartIndex+this.bitrates.length-j.CACHE_SIZE;this.segmentStartIndex=g,this.bitrates=this.bitrates.splice(-j.CACHE_SIZE,j.CACHE_SIZE)}h.log("New cache details; rep: ",this.representationIndex,"; start: ",this.segmentStartIndex,"; size: ",this.bitrates.length)},a.prototype.getCacheEntryForFragment=function(a){if(a>=this.segmentStartIndex&&a-this.segmentStartIndex<j.CACHE_SIZE){var b=a-this.segmentStartIndex;return this.bitrates[b]}return Number.NaN},a}();!function(a){a[a.average=0]="average",a[a.maximum=1]="maximum"}(g||(g={}));var j=function(){function a(b,c){this.activeRepresentationIndex=Number.NaN,this.type=b,this.representationCount=c,d.AdaptationType.audio!==b&&(this.sidx=[],this.cachedRepresentationInfo=[],this.averageBitrates=[],this.sampleWindow=a.defaultSampleWindow,this.calculationMethod=a.defaultCalculationMethod)}return a.setConfig=function(b){b.sampleWindow&&(a.defaultSampleWindow=b.sampleWindow),"number"==typeof b.calculationMethod&&(a.defaultCalculationMethod=b.calculationMethod)},a.prototype.getCacheEntry=function(a){var b,c=this.cachedRepresentationInfo.filter(function(b){return b.representationIndex===a});return 1===c.length?b=c[0]:0!==c.length&&(h.error("Cache can't return more than one hit"),h.log("Trimming representation cache to remove duplicates: ",this.cachedRepresentationInfo.length),this.cachedRepresentationInfo=this.cachedRepresentationInfo.filter(function(b){return b.representationIndex!==a}),h.log("Trimmed representation cache: ",this.cachedRepresentationInfo.length)),b},a.prototype.setNominalBitrates=function(a){this.averageBitrates=a},a.prototype.setNominalBitratesFromManifestTracks=function(a,b,c){void 0===b&&(b=0),void 0===c&&(c=0);var e,f;d.AdaptationType.video===this.type?f=a.video[b].info:d.AdaptationType.audio===this.type&&(f=a.audio[c].info),e=f.map(function(a){return parseInt(a.bandwidth)}).sort(function(a,b){return a>=b?1:-1}),this.setNominalBitrates(e)},a.prototype.setSidxForRepresentation=function(a,b){if(d.AdaptationType.audio===this.type){if(0===this.averageBitrates.length){var c=f.calculateRepresentationMetrics(b);this.averageBitrates[0]=c.averageBitrate}}else{if(0===this.averageBitrates.length){var c=f.calculateRepresentationMetrics(b);this.averageBitrates[a]=c.averageBitrate}this.sidx[a]=b}},a.prototype.updateWindowBitrates=function(b,c){if(this.type!==d.AdaptationType.audio){var e=this.getCacheEntry(b),j=Number.NaN,k=[];if(e?c>=e.segmentStartIndex&&c<e.segmentStartIndex+a.CACHE_SIZE||(j=c):(j=c,e=new i(b),this.cachedRepresentationInfo.push(e)),!isNaN(j)){var l=this.sidx[b];if(l){var m=j+a.CACHE_SIZE,n=j,o=void 0;switch(this.calculationMethod){case g.average:o=f.calculateFragmentsAverageBitrate;break;case g.maximum:default:o=f.calculateFragmentsMaxBitrate}for(;n!==m;){var p=o(l,n,this.sampleWindow);k.push(p),++n}e.setCachedBitrates(j,k)}else h.warn("Currently no sidx box info for representation: ",b)}}},a.prototype.getBitrates=function(a){var b;if(d.AdaptationType.audio===this.type){var c=[];c.push(this.averageBitrates[0]),b=c}else b=this.averageBitrates.map(function(a){return a}),this.cachedRepresentationInfo.forEach(function(c){var d=c.getCacheEntryForFragment(a);isNaN(d)||(h.trace("Using localized bitrate for representaion: ",c.representationIndex,"; bitrate: ",d),b[c.representationIndex]=d)});return b},a.prototype.setCurrentRepresentation=function(a){if(h.log("Active representation: ",a),a>=this.representationCount)throw h.error("Representation selected exceeds the number for this adapaptation: ",a,"/",this.representationCount),e.Error.create("Invalid parameter");this.sidx[a]||h.warn("Requesting a representation that has not yet delivered a sidx"),this.activeRepresentationIndex=a},a.prototype.updateCurrentPlaybackStatus=function(a,b){void 0===b&&(b=Number.NaN),isNaN(b)&&(b=this.activeRepresentationIndex),isNaN(b)?h.warn("current representation is not known.  Unable to set bitrate cache"):(this.updateWindowBitrates(b,a),b>0&&this.updateWindowBitrates(b-1,a),b+1<this.representationCount&&this.updateWindowBitrates(b+1,a))},a.create=function(b,c){return new a(b,c)},a.CACHE_SIZE=10,a.DEFAULT_SAMPLE_WINDOW=3,a.defaultSampleWindow=a.DEFAULT_SAMPLE_WINDOW,a.defaultCalculationMethod=g.maximum,a}();b.VbrRateMonitor=j}),define("ensis/event/dispatcher",["ensis/logger/logger","ensis/lang/function"],function(a,b){function c(){function a(a,c,d){var i=null,j=g[a];if("undefined"!=typeof j){var k=b.makeChecked({"catch":function(a){i=a}});if(++h,j.forEach(function(b){var e={type:a};"undefined"!=typeof d?e.target=d:e.target=f,"undefined"!=typeof c&&(e.detail=c),k(b,e)}),--h,0==h&&e(a),null!==i)throw i}}function c(a,b){if("function"==typeof b){var c=g[a];"undefined"==typeof c&&(c=g[a]=[]),c.push(b)}}function d(a,b){var c=g[a];if("undefined"!=typeof c){var d=c.indexOf(b);0!==h?c[d]=null:c.splice(d,1)}}function e(a){var b=g[a];if("undefined"!=typeof b)for(var c=b.length;0!==c;)--c,null==b[c]&&b.splice(c,1)}var f={},g={},h=0;return f.addListener=c,f.removeListener=d,f.dispatch=a,f}function d(){return{create:c}}return d()}),define("asteroid/VbrUtil",["ensis/logger/logger","ensis/media/types","ensis/abr/vbrfragbitrate","ensis/event/dispatcher","ensis/lang/object"],function(a,b,c,d,e){"use strict";function f(){function a(a){if(l=a,l&&l.video&&l.video.length){1!==l.video.length&&n.warn("Only expecting one Video Adaptation");var d=l.video[0];i=c.VbrRateMonitor.create(b.AdaptationType.video,d.info.length);var e=l.audio[0];j=c.VbrRateMonitor.create(b.AdaptationType.audio,e.info.length),i.setNominalBitratesFromManifestTracks(l),o.video=i.getBitrates(0),k(b.AdaptationType.video,m),j.setNominalBitratesFromManifestTracks(l),o.audio=j.getBitrates(0),k(b.AdaptationType.audio,m)}else n.warn("Parsed manifest doesn't reveal any video tracks!")}function d(a,c,d){a===b.AdaptationType.video&&i.setSidxForRepresentation(c,d)}function f(a,c){return a===b.AdaptationType.audio?j.getBitrates(c):a===b.AdaptationType.video?i.getBitrates(c):void 0}function g(a,c){a===b.AdaptationType.video&&i.setCurrentRepresentation(c)}function h(a,c,d){a===b.AdaptationType.video?(i.updateCurrentPlaybackStatus(c,d),o.video=i.getBitrates(c),k(a,m)):null===o.audio&&(o.audio.audioMonitor.getBitrates(c),k(a,m))}var i,j,l,m={};return m=e.extend(m,{getBitrates:f,setCurrentRepresentation:g,setManifest:a,setRepresentationSidx:d,updateCurrentPlaybackStatus:h})}function g(a){if(null===o[a])throw n.error("Called too early for ",a),new Error("called too early");var b=o[a];return n.trace("Instantaneous Bitrates: ",a,"; bitrates: ",b),b}function h(){p.addListener.apply(p,arguments)}function i(){p.removeListener.apply(p,arguments)}function j(a){c.VbrRateMonitor.setConfig(a)}function k(a,c){var d=a===b.AdaptationType.video?"video":"audio";p.dispatch(q.BitratesUpdated,{adaptation:a,adaptationAsString:d},c)}function l(){p=null}function m(){return{Events:q,createMonitor:f,addListener:h,removeListener:i,setConfig:j,getInstantaneousAudioBitrates:function(){return g("audio")},getInstantaneousVideoBitrates:function(){return g("video")},stop:l}}var n=a.create("VbrUtil"),o={audio:null,video:null},p=d.create(),q={BitratesUpdated:"bitratesupdated"};return m()}),define("asteroid/StreamingAlgo",["ensis/logger/logger","ensis/lang/error","ensis/data/format"],function(a,b,c){function d(a,b){return{getVersion:function(){return a},getRawData:function(){return b},toString:function(){return["Asteroid Streaming Algorithm Mode V",a,"; raw data: ","number"==typeof b?c.toHex(b):b].join("")},toNumber:function(){return 0}}}function e(a){i.trace("Creating asteroid streaming info with params: ",a);var c=null;if("undefined"==typeof a||"undefined"==typeof a.asteroid)i.log("No streaming algo specified for Asteroid");else{var e,l,m=a.asteroid;try{if(l=Number.parseInt(m,16),Number.isNaN(l))throw i.warn("Parameter not a number: ",m),b.Error.create("invalid streaming algorithm info for asteroid");switch(e=l&k,e>>>=j,l&=~k,e){case 1:c=h(l);break;case 2:c=g(l);break;case 3:c=f(l);break;default:throw i.warn("Invalid version Number: ",e),b.Error.create("Invalid parameter")}}catch(n){i.error("Streaming algorithm initialization failed: ",n.message),c=null}}return null===c&&(i.trace("initializing default (0) streaming algorithm version"),c=d(0)),c}function f(a){var b=6,c=g(a),d=c.toNumber,e=c.toString,f=!!(a&&1<<b);return c.getVersion=function(){return 3},c.toString=function(){var a=e.call(c),b="Asteroid Streaming Algorithm Mode V2",d="Asteroid Streaming Algorithm Mode V3",g=[a.replace(b,d),"; useLowBitrateStart: ",f?"enabled":"disabled"].join("");return g},c.toNumber=function(){var a=d.call(c);return a&=~k,a|=3<<j,f&&(a|=1<<b),i.trace("toNumber (lowbr): ",a),a},c.useLowBitrateStartup=function(){return f},i.trace(c.toString()),c}function g(a){var b,c,e=0,f=1,g=2,h=3,k=4,l=5,m=d(2,a),n=!!(a&1<<e),o=!1,p=!!(a&1<<l);if(p){var q=2147483648>>31-f^2147483648>>31-(1+g);b=a&q,b>>=f,++b,q=2147483648>>31-h^2147483648>>31-(1+k),c=a&q,c>>=h}m.toString=function(){return["Asteroid Streaming Algorithm Mode V2","; VBR mode: ",p?"enabled":"disabled","; VBR window: ",p?b:"n/a","; VBR calc method: ",p?r.toString(c):"n/a"].join("")},m.isTestMode=function(){return n},m.isDolbyStripDisabled=function(){return o},m.isVbrEnabled=function(){return p},m.getVbrBitrateSampleWindow=function(){return b},m.getVbrBitrateCalculationMethod=function(){return c},m.toNumber=function(){var a=0,d=2<<j;return a|=d,i.trace("toNumber (version): ",a),p&&(d=1<<l,a|=d,d=b,--d,d<<=f,a|=d,d=c,d<<=h,a|=d),i.trace("toNumber (vbr): ",a),d=n?1:0,d<<=e,a|=d,i.trace("toNumber (test): ",a),a};var r={average:0,maximum:1,toString:function(a){if("number"!=typeof a)return"";for(var b in r)if(r.hasOwnProperty(b)&&r[b]===a)return b}};return m.VbrModeCalculationMethod=r,i.trace(m.toString()),m}function h(a){var b,c=0,e=1,f=2,g=3,h=4,k=d(1,a),l=!!(a&1<<c),m=!!(a&1<<h),n=!!(a&1<<g);if(n){var o=2147483648>>31-e^2147483648>>31-(1+f);b=a&o,b>>=e,++b}return k.toString=function(){return["Asteroid Streaming Algorithm Mode V1 - DoVi Strip: ",m?"disabled":"not disabled","; VBR mode: ",n?"enabled":"disabled","; VBR window: ",n?b:"n/a"].join("")},k.isTestMode=function(){return l},k.isDolbyStripDisabled=function(){return i.warn("DoViStrip code should all be removed now, why is this being called?"),m},k.isVbrEnabled=function(){return n},k.getVbrBitrateSampleWindow=function(){return b},k.toNumber=function(){var a=0,d=1<<j;return a|=d,i.trace("toNumber (version): ",a),n&&(d=1<<g,a|=d,d=b,--d,d<<=e,a|=d),i.trace("toNumber (vbr): ",a),d=m?1:0,d<<=h,a|=d,i.trace("toNumber (dovi): ",a),d=l?1:0,d<<=c,a|=d,i.trace("toNumber (test): ",a),a},i.trace(k.toString()),k}var i=a.create("algoutil"),j=28,k=15<<j;return{create:e}}),define("asteroid/Deprecated",["ensis/logger/logger"],function(a){function b(b){function c(a,c){return function(){try{throw new Error(b+" is deprecated")}catch(d){var f={message:d.message,callers:[]};try{d.stack&&d.stack.split&&(d.stack.split("\n").forEach(function(a){a.trim&&(a=a.trim()),f.callers.push(a)}),f.message=f.callers.join(" > "))}catch(d){}e.warn(f.message)}return"undefined"!=typeof a[c]?(e.warn(c," is deprecated"),a[c]):void e.error(c," is not a valid parameter")}}function d(a,c){return function(){throw e.error("Can't modify ",c),new Error("Invalid access: "+b+"::"+c)}}var e=a.create(b);return{makeWarningAccessor:c,makeInvalidAccessor:d}}return{create:b}}),define("asteroid/ResourceMetricsHandler",["ensis/lang/function","ensis/event/ThrottledReporter"],function(a,b){"use strict";function c(){function c(c,d){var e,f,g,h={};return c?(g=!1,f=b.createAbstractHandler(),f.report=function(b){a.checked(d,b),g=!1},e=b.create(f,3e3),h.report=function(){if(!g){g=!0;var a=c.dump();e.addMessage(a)}},h.stop=function(){c.stop(),e.stop(),e=null,f=null}):(h.report=a.NOP,h.stop=a.NOP),h}return{create:c}}return c()}),define("ensis/dash/sidxutil",["require","exports"],function(a,b){"use strict";b.__esModule=!0;var c=function(){function a(a){this.refCount=a.getReferenceCount(),this.segTimes=[],this.segOffsets=[];var b=0,c=0,d=a.getTimescale();this.segTimes.push(b/d),this.segOffsets.push(c);for(var e=0;e!==this.refCount;++e){var f=a.getReference(e);b+=f.subsegment_duration,c+=f.ref_info.size,this.segTimes.push(b/d),this.segOffsets.push(c)}}return a.prototype.findReferenceForTime=function(a){var b=this,c=function(a,d,e,f){if(void 0===d&&(d=!0),d&&(e=0,f=b.refCount-1),f-e<=2)return a>=b.segTimes[f]?f:e;var g=Math.floor((f-e)/2);return g+=e,a>=b.segTimes[g]&&a<b.segTimes[g+1]?g:a<b.segTimes[g]?c(a,!1,e,g):c(a,!1,g,f)};return c(a)},a.prototype.getTimeRangeForReference=function(a){var b=0,c=Number.POSITIVE_INFINITY;return a<0||a>this.refCount?(b=NaN,c=NaN):(b=this.segTimes[a],c=this.segTimes[a+1]),{start:b,end:c}},a.create=function(b){return new a(b)},a}();b.TimeUtil=c}),define("ensis/vudu/util/AggStatUtil",["ensis/logger/logger","ensis/lang/function","ensis/lang/error","ensis/async/util","ensis/lang/arguments","ensis/async/async2"],function(a,b,c,d,e,f){"use strict";function g(){return 0|Date.now()/1e3}function h(a,b){function d(){u=Number.NaN,v=Number.NaN,w=Date.now(),x=x||[],y=[],z=[],A=[],B=[],C=[],D=E=g(),F=[],x.forEach(function(){A.push(0),B.push(0),C.push(0)})}function f(){var a=g();return E=a,y.push(a),o()}function h(){return z.push(g()),p()}function i(a,b,d,e,f,g){if(0===x.length)throw c.Error.create("Bitrates must be set before reporting a fragment");var h=d/4;(Number.isNaN(u)||b<u)&&(u=b),(Number.isNaN(v)||b>v)&&(v=b);var i=g-f,j=e;A[a]+=Math.round(j),C[a]+=Math.floor(h),B[a]+=Math.round(i),E=Math.round(g/1e3)}function j(a,b,c,d,f,g){i(a,b,c,d,f,g),F.push(e.toArray(arguments))}function k(){return!Number.isNaN(v)&&!Number.isNaN(u)&&v-u>=l}function m(){return!Number.isNaN(u)&&!Number.isNaN(v)}function n(a){Array.isArray(a)||c.Error.create("Invalid Parameter: Bitrates should be a list of bitrates"),x=a,d()}function o(){return y.length}function p(){return z.length}function q(){return{sessionId:w,startTimeSec:D,endTimeSec:E,startingChunkNum:Number.isNaN(u)?0:u,endingChunkNum:Number.isNaN(v)?0:v,numUnderruns:y.length,lowBufLevelCount:z.length,bitrates:x,milliSecsPerRate:A,downloadMilliSecsPerRate:B,wordsPerRate:C}}function r(){return JSON.stringify(q())}function s(){return H}function t(){return G}var u,v,w,x,y,z,A,B,C,D,E,F,G=a,H=!!b;return d(),{setBitrates:n,resetStats:d,reportUnderrun:f,reportLowBuffer:h,logFragmentDetailed:j,logFragmentNormal:i,getUnderrunCount:o,getLowBufferCount:p,haveChunksToReport:m,haveMinChunkCount:k,toJSON:q,toJsonString:r,alwaysSendReport:s,getReportIntervalInSecs:t}}function i(a,e){function i(){var a=r.reportUnderrun();return l(!0),k.warn("Underrun reported #",a),a}function j(a,b,c,d,e,f){k.trace("Chunk download reported: ",b," at quality: ",a);var g=!1;t=a,Number.isNaN(s)&&(g=!0),r.logFragment(t,b,c,d,e,f),l(g)}function l(a){var b=f.Deferred();if(!r.alwaysSendReport()){if(!r.haveChunksToReport())return;if(!a){if(!r.haveMinChunkCount())return;if(g()-s<r.getReportIntervalInSecs())return}}var c=r.toJSON();return k.trace("Queueing stats: ",c),b.execute(function(){d.wait(5).then(function(){try{k.log("Sending stats: ",c),u(c)}catch(a){k.error("stats reporting threw: ",a.message)}b.onComplete()})}),s=g(),b}function n(a){if("undefined"==typeof a||null===a)k.trace("Reporting function removed.  Stats will not be reported"),a=b.NOP;else{if("function"!=typeof a)throw k.error("Reporting parameter must be a function or null"),c.Error.create("Invalid Parameter");k.trace("Stats Reporting function ",u===b.NOP?"set":"updated")}u=a}function o(a){r.setBitrates(a)}function p(){k.trace("Shutting down"),r.resetStats(),u=b.NOP}function q(){k.log("Stats reset"),r.haveChunksToReport()&&l(!0),r.resetStats(),s=Number.NaN}var r=h(a,e),s=Number.NaN,t=Number.NaN,u=b.NOP();return r.logFragment=m?r.logFragmentDetailed:r.logFragmentNormal,{getAggStats:function(){return r},setReporter:n,reportUnderrun:i,reportDownload:j,sendStats:l,setBitrates:o,reset:q,done:p}}function j(){return{create:i}}var k=a.create("AggStatUtil"),l=2,m=!1;return j()}),define("ensis/data/sparsearray",["require","exports"],function(a,b){"use strict";b.__esModule=!0;var c;!function(a){function b(){return new c}var c=function(){function a(){this.keys={},this.nextKey=0,this.values=[],this.entryCount=0}return a.prototype.set=function(a,b){var c;"undefined"!=typeof this.keys[a]?c=this.keys[a]:(c=this.nextKey++,this.keys[a]=c,++this.entryCount),this.values[c]=b},a.prototype.get=function(a){if("undefined"==typeof this.keys[a])throw new Error("Invalid Index");return this.values[this.keys[a]]},a.prototype.remove=function(a){"undefined"!=typeof this.keys[a]&&(delete this.values[this.keys[a]],delete this.keys[a],--this.entryCount)},a.prototype.entries=function(){return this.entryCount},a}();a.SparseArray=c,a.create=b}(c=b.SparseArray||(b.SparseArray={}))}),define("ensis/vudu/util/aggstatv3util",["require","exports","ensis/media/types","ensis/async/async2","ensis/logger/logger","ensis/lang/function","ensis/lang/error","ensis/data/sparsearray"],function(a,b,c,d,e,f,g,h){"use strict";function i(a){return!isNaN(a.startingChunkNum)&&(!isNaN(a.endingChunkNum)&&(!(!a.bitrates||!a.bitrates.length)&&!(!a.movieUrl||!a.movieUrl.length)))}function j(a){return JSON.parse(JSON.stringify(a))}b.__esModule=!0;var k=e.create("AggStatV3"),l=function(){function a(a,b,c,d,e,f){void 0===a&&(a=NaN),this.representation=a,isNaN(a)||(this.firstSegmentIndex=this.lastSegmentIndex=b,this.byteCount=c,this.downloadTime=f,this.time={start:Math.floor(d),end:Math.floor(e)})}return a.prototype.updateRangeEnd=function(a,b,c,d){if(isNaN(this.representation))throw new Error("Can't update timerange for an undefined representation");if(a>1+this.lastSegmentIndex)throw new Error("Requires sequential segments");this.lastSegmentIndex=a,this.byteCount+=b,this.downloadTime+=d,this.time.end=Math.floor(c),k.trace("Updating download stats on stack: ",{representation:this.representation,firstSegmentIndex:this.firstSegmentIndex,lastSegmentIndex:this.lastSegmentIndex,byteCount:this.byteCount,time:this.time,downloadTime:this.downloadTime})},a}(),m=function(){function a(b,d,e){void 0===b&&(b=""),void 0===d&&(d=a.DefaultReportingIntervalSecs),void 0===e&&(e=a.DefaultLowBufferLevelSecs);var g=this;this.reportingIntervalMillis=1e3*d,this.lowBufferLevelSecs=e,this.sessionCreationTimeMs=Date.now(),this.playbackStartTimeMs=NaN,this.lastReportTime=NaN,this.audioBitrates=[],this.audioBitrateTags=[],this.videoBitrates=[],this.videoBitrateTags=[],this.currentDownloadFragRepSpan=h.SparseArray.create(),this.downloadedRangesStack=h.SparseArray.create(),this.playbackTimePerRate=h.SparseArray.create(),this.downloadedBytesPerRate=h.SparseArray.create(),this.downloadMillisPerRate=h.SparseArray.create(),this.currentPlaybackFragment=h.SparseArray.create(),this.downloadStackDirty=h.SparseArray.create(),this.lowBufferCount=h.SparseArray.create(),this.playedSegments=h.SparseArray.create(),[c.AdaptationType.audio,c.AdaptationType.video].forEach(function(a){g.currentDownloadFragRepSpan.set(a,NaN),g.playbackTimePerRate.set(a,[]),g.downloadedBytesPerRate.set(a,[]),g.downloadMillisPerRate.set(a,[]),g.downloadedRangesStack.set(a,[]),g.currentPlaybackFragment.set(a,NaN),g.downloadStackDirty.set(a,!1),g.lowBufferCount.set(a,{tally:0}),g.playedSegments.set(a,{first:NaN,last:NaN})}),this.reporterCallback=f.NOP,this.underruns={accumulatedBufferingTimeMs:0,numUnderruns:0,underrunStartMs:NaN,underrunEndMs:NaN},this.networkRetryCount=0,this.lastPlaybackProgressTimeMs=NaN,this.durationSecs=this.bookmarkSecs=NaN,this.playerData={},this.playerSession=b}return a.prototype.setAudioBitrates=function(a,b){b||(b=[]);for(var d=[],e=0;e!==a.length;++e)if(d.push(0),this.audioBitrates.push(a[e]),"string"==typeof b[e])this.audioBitrateTags.push(b[e]);else{var f=a[e];f/=1024,f|=0,this.audioBitrateTags.push(""+f)}this.playbackTimePerRate.set(c.AdaptationType.audio,j(d)),this.downloadedBytesPerRate.set(c.AdaptationType.audio,j(d)),this.downloadMillisPerRate.set(c.AdaptationType.audio,j(d)),k.log(this.audioBitrates.length," audio bitrates")},a.prototype.setVideoBitrates=function(a,b){b||(b=[]);for(var d=[],e=0;e!==a.length;++e)if(d.push(0),this.videoBitrates.push(a[e]),"string"==typeof b[e])this.videoBitrateTags.push(b[e]);else{var f=a[e];f/=1024,f|=0,this.videoBitrateTags.push(""+f)}this.playbackTimePerRate.set(c.AdaptationType.video,j(d)),this.downloadedBytesPerRate.set(c.AdaptationType.video,j(d)),this.downloadMillisPerRate.set(c.AdaptationType.video,j(d)),k.log(this.videoBitrates.length," video bitrates")},a.prototype.setStreamMetadata=function(a){a.audioSegmentCount&&(this.segmentCount.audio=a.audioSegmentCount),a.videoSegmentCount&&(this.segmentCount.video=a.videoSegmentCount),a.url&&(this.movieUrl=a.url),a.duration&&(this.durationSecs=a.duration),a.bookmark&&(this.bookmarkSecs=a.bookmark)},a.prototype.addPlayerData=function(a,b){if("undefined"==typeof this.playerData[a])this.playerData[a]=b;else if(Array.isArray(this.playerData[a]))this.playerData[a].push(b);else{var c=this.playerData[a];this.playerData[a]=[],this.playerData[a].push(c,b)}k.trace("Updated player data: ",this.playerData)},a.prototype.logPlaying=function(){isNaN(this.playbackStartTimeMs)&&(this.playbackStartTimeMs=Date.now())},a.prototype.logNetworkRetry=function(){++this.networkRetryCount},a.prototype.logBufferingStart=function(){this.underruns.underrunStartMs||(this.underruns.underrunStartMs=Date.now(),++this.underruns.numUnderruns,k.log("Internal underrun tally: ",this.underruns.numUnderruns),this.flushStats())},a.prototype.logBufferingEnd=function(){if(this.underruns.underrunStartMs){this.underruns.underrunEndMs=Date.now();var a=this.underruns.underrunEndMs-this.underruns.underrunStartMs;a>0&&(this.underruns.accumulatedBufferingTimeMs+=a)}else k.error("Underrun reporting object not initialized");delete this.underruns.underrunStartMs,delete this.underruns.underrunEndMs},a.prototype.logBufferLevel=function(b,c){isNaN(this.playbackStartTimeMs)||(c<=this.lowBufferLevelSecs?this.lowBufferCount.get(b).pending||(this.lowBufferCount.get(b).pending=!0,++this.lowBufferCount.get(b).tally,k.log("Low buffer levels encoutered for ",b,"; level: ",c,"; tally: ",this.lowBufferCount.get(b).tally)):this.lowBufferCount.get(b).pending&&c>this.lowBufferLevelSecs+a.DefaultLowBufferClearHysteresis&&(this.lowBufferCount.get(b).pending=!1,k.trace("Recovered from low buffer level for ",b,"; level now : ",c)))},a.prototype.addFragmentDetails=function(a,b){var c=a.type,d=Math.floor(a.downloadEndTimeMs-a.downloadStartTimeMs);this.trackDownloadedSegment(c,a.index);try{var e=this.downloadedBytesPerRate.get(c);e[a.representation]+=a.byteCount,k.trace("Bytes downloaded: ",e);var f=this.downloadMillisPerRate.get(c);f[a.representation]+=d}catch(g){k.error("Problem updating bytes tally: ",g.message)}var h,i;try{h=this.currentDownloadFragRepSpan.get(c),i=this.downloadedRangesStack.get(c)[h]}catch(g){h=NaN}var j=Math.floor(1e3*b.start),m=Math.floor(1e3*b.end);if(isNaN(h)||a.representation!==i.representation)i=new l(a.representation,a.index,a.byteCount,j,m,d),h=this.pushDownloadReport(c,i);else try{i.updateRangeEnd(a.index,a.byteCount,m,d)}catch(g){k.warn("Should only happen once, when starting from bookmark: ",g.message),this.markFragmentPlayed(c,h),i=new l(a.representation,a.index,a.byteCount,j,m,d),h=this.pushDownloadReport(c,i)}this.currentDownloadFragRepSpan.set(c,h),this.sendReport()},a.prototype.addPlaybackTime=function(a){var b=this;if(0!==a&&!isNaN(a)){var d=Math.floor(1e3*a);isNaN(this.lastPlaybackProgressTimeMs)&&(this.lastPlaybackProgressTimeMs=d),[c.AdaptationType.audio,c.AdaptationType.video].forEach(function(c){var e,f=b.downloadedRangesStack.get(c),g=NaN;try{var h=b.currentPlaybackFragment.get(c);isNaN(h)||(e=f[h]),g=h}catch(i){k.trace("No current fragment set for ",c)}if(e||(g=b.findNewPlaybackFragment(c,d),isNaN(g)||(e=f[g])),e){var j=b.lastPlaybackProgressTimeMs;if(d>100+e.time.end){var l=e.time.end;b.appendPlaybackTime(c,e.representation,l,j),j=l,b.markFragmentPlayed(c,g),g=b.findNewPlaybackFragment(c,d)}isNaN(g)?k.error("Transitioned past last fragment for ",c,", at time: ",a):(e=f[g],b.appendPlaybackTime(c,e.representation,d,j))}else k.warn("No current fragment could be found for ",c," at ",a);b.currentPlaybackFragment.set(c,g)}),this.lastPlaybackProgressTimeMs=d,this.sendReport()}},a.prototype.flushStats=function(){this.sendReport(!0)},a.prototype.ended=function(){},a.prototype.seekSession=function(a,b){var d=this;this.flushStats(),this.playerSession=a;var e=Math.floor(1e3*b);this.lastPlaybackProgressTimeMs=e,this.lastReportTime=NaN,this.networkRetryCount=0,this.underruns={accumulatedBufferingTimeMs:0,numUnderruns:0,underrunStartMs:NaN,underrunEndMs:NaN},[c.AdaptationType.audio,c.AdaptationType.video].forEach(function(a){d.currentDownloadFragRepSpan.set(a,NaN);var b;b=d.playbackTimePerRate.get(a);for(var c=0;c!==b.length;++c)b[c]=0;d.playbackTimePerRate.set(a,b),b=d.downloadedBytesPerRate.get(a);for(var c=0;c!==b.length;++c)b[c]=0;d.downloadedBytesPerRate.set(a,b),b=d.downloadMillisPerRate.get(a);for(var c=0;c!==b.length;++c)b[c]=0;d.downloadMillisPerRate.set(a,b),d.currentPlaybackFragment.set(a,NaN),d.lowBufferCount.set(a,{tally:0}),d.playedSegments.set(a,{first:NaN,last:NaN})})},a.prototype.stop=function(){var a=this,b=d.Deferred();return b.execute(function(){var c=a.toJSON();f.checked(a.reporterCallback,c),a.reporterCallback=f.NOP,b.onComplete()}),b},a.prototype.setReporter=function(a){if("undefined"==typeof a||null===a)k.trace("Reporting function removed.  Stats will not be reported"),a=f.NOP;else{if("function"!=typeof a)throw k.error("Reporting parameter must be a function or null"),g.Error.create("Invalid Parameter");k.trace("Stats Reporting function ",f.NOP===this.reporterCallback?"set":"updated")}this.reporterCallback=a},a.prototype.toString=function(){return JSON.stringify(this.toJSON)},a.prototype.toJSON=function(){var a,b,d,e,f,g,h,i,j,l,m;if(this.movieUrl&&0!==this.movieUrl.length){l=this.movieUrl;var n=l.indexOf("?"),o=l.indexOf("/manifest.mpd");-1!==o?l=l.substring(0,o):-1!==n&&(l=l.substring(0,n))}else k.warn("Movie URL not set");var p=[];for(var q in this.playerData)if(this.playerData.hasOwnProperty(q)){var r=this.playerData[q];Array.isArray(r)&&(r="[ "+r.join(", ")+" ]");var s=[q,r].join(": ");p.push(s)}m=p.join("; ");try{e=[];var t=this.downloadedBytesPerRate.get(c.AdaptationType.audio);t.forEach(function(a,b){e[b]=Math.floor(a/4)}),d=[],t=this.downloadedBytesPerRate.get(c.AdaptationType.video),t.forEach(function(a,b){d[b]=Math.floor(a/4)}),b=this.playbackTimePerRate.get(c.AdaptationType.audio),a=this.playbackTimePerRate.get(c.AdaptationType.video),g=this.downloadMillisPerRate.get(c.AdaptationType.audio),f=this.downloadMillisPerRate.get(c.AdaptationType.video),h=this.lowBufferCount.get(c.AdaptationType.audio).tally+this.lowBufferCount.get(c.AdaptationType.video).tally,i=this.playedSegments.get(c.AdaptationType.video).first,j=this.playedSegments.get(c.AdaptationType.video).last}catch(u){}return{audioBitrate:this.audioBitrateTags[0],audioDownloadMilliSecsPerRate:g,audioMilliSecsPerRate:b,audioWordsPerRate:e,bitrates:this.videoBitrateTags,bufferingTimeMs:this.underruns.accumulatedBufferingTimeMs,downloadMilliSecsPerRate:f,endingChunkNum:j,initialPlaybackStartTimeMs:this.playbackStartTimeMs-this.sessionCreationTimeMs,levels:this.videoBitrates.length,milliSecsPerRate:a,movieUrl:l,numLowBufferLevel:h,numRetries:this.networkRetryCount,numUnderruns:this.underruns.numUnderruns,playerData:m,playerSession:this.playerSession,startingChunkNum:i,wordsPerRate:d}},a.create=function(b,c,d){return new a(b,c,d)},a.prototype.pushDownloadReport=function(a,b){k.trace("Adding download fragment to stack: ",b," for type: ",a);var c=this.downloadedRangesStack.get(a);try{var d=NaN,e=NaN,f=0,g=!1;if(this.downloadStackDirty.get(a)){for(k.trace("Downloaded fragment stack marked dirty for type: ",a,"; length: ",c.length);c.length>f;)if(isNaN(d)?null===c[f]&&(d=f):null!==c[f]&&(e=f),
isNaN(d)||isNaN(e))++f;else{var h=e-d;k.trace("Removing marked items in list starting: ",d,"; number: ",h),c.splice(d,e-d),f=d,d=e=NaN,g=!0}if(!isNaN(d)){var h=c.length-d;k.trace("Removing marked items at end of list: ",d,"; number: ",h),c.splice(d,h),g=!0}this.downloadStackDirty.set(a,!1),g?(k.trace("Downloaded fragment stack cleaned up for type: ",a,"; new length: ",c.length),this.currentPlaybackFragment.set(a,NaN)):k.warn("Hmm, list was marked as dirty but we didn't remove anything: ",a,"/",c.length)}}catch(i){}return c.push(b)-1},a.prototype.appendPlaybackTime=function(a,b,c,d){try{var e=this.playbackTimePerRate.get(a),f=c-d;f<0||(e[b]+=f),k.trace("Playback timeset updated: ",e)}catch(g){k.error("Couldn't update playback times: ",g.message)}},a.prototype.findNewPlaybackFragment=function(a,b){var c=NaN;try{for(var d=this.downloadedRangesStack.get(a),e=0;isNaN(c)&&d.length!==e;++e){var f=d[e];null!==f&&f.time.start<=b&&f.time.end>=b&&(c=e)}}catch(g){k.warn("Failed to find a downloaded range for time: ",b,"; adaptation: ",a,"; error: ",g.message)}return k.trace("Selected playback fragment: ",c),c},a.prototype.markFragmentPlayed=function(a,b){var c=this.downloadedRangesStack.get(a),d=c[b];c[b]=null,k.trace("Marking fragment as played, type: ",a,"; index: ",b,"; details: ",d),this.downloadStackDirty.set(a,!0)},a.prototype.trackDownloadedSegment=function(a,b){var c=this.playedSegments.get(a);isNaN(c.first)?c.first=c.last=b:(b<c.first&&k.warn("Playback should always advance - first segment: ",c.first,"; this segment: ",b),b<c.last?k.warn("Playback should always advance - last segment: ",c.last,"; this segment: ",b):c.last=b)},a.prototype.sendReport=function(a){void 0===a&&(a=!1);var b,c=Date.now();if(isNaN(this.lastReportTime)?b=!0:a?b=!0:c>=this.lastReportTime+this.reportingIntervalMillis&&(b=!0),b){var d=this.toJSON();i(d)&&(f.checked(this.reporterCallback,d),this.lastReportTime=c)}},a.DefaultReportingIntervalSecs=300,a.DefaultLowBufferLevelSecs=4,a.DefaultLowBufferClearHysteresis=4,a}();b.AggStatReporter=m}),define("asteroid/AggStatWrapper",["ensis/logger/logger","ensis/lang/function","ensis/lang/object","ensis/lang/error","ensis/media/types","ensis/dash/sidxutil","ensis/vudu/util/AggStatUtil","ensis/vudu/util/aggstatv3util"],function(a,b,c,d,e,f,g,h){function i(){return o.trace("Proxying call to agg stat v2"),g.create.apply(g,arguments)}function j(){return r+":"+s++}function k(){function a(a){e="function"!=typeof a?d:a}function c(){return f}var d=b.namedNOP("AggStatWrapper::reporter"),e=d,f=function(){e.apply(null,arguments)};return{getProxy:c,setClient:a}}function l(a,b){function g(a,b){const c=typeof b;if("string"!==c&&"number"!==c)throw o.error("playerData can only be string values: ",a,"/",c),d.Error.create("Invalid parameter");if("string"!=typeof q[a])throw o.error("Invalid PlayerData key: ",a),d.Error.create("Invalid Parameter");w.addPlayerData(a,b)}function i(a){o.trace("Using manifest info: ",a),a.audio.forEach(function(a,b){y.audio[b]=[];for(var c=0;a.info.length!==c;++c){var d=a.info[c].url,e=m(d);y.audio[b].push({tag:e,bitrate:parseFloat(a.info[c].bandwidth)})}}),a.video.forEach(function(a,b){y.video[b]=[];for(var c=0;a.info.length!==c;++c){var d=a.info[c].url,e=m(d);y.video[b].push({tag:e,bitrate:parseFloat(a.info[c].bandwidth)})}}),y.video.sort(function(a,b){return a-b}),y.audio.sort(function(a,b){return a-b}),o.trace("Available track bitrates: ",y)}function l(a){v.setClient(a)}function n(a,b,c){var d;switch(a){case e.AdaptationType.video:d=x.video,w.setStreamMetadata({videoSidxEntries:c.getReferenceCount()});break;case e.AdaptationType.audio:d=x.audio,w.setStreamMetadata({audioSidxEntries:c.getReferenceCount()});break;default:return void o.warn("Invalid adaptation type")}d[b]=f.TimeUtil.create(c)}function p(a,b){var c,d;switch(a){case e.AdaptationType.video:c=x.video[b.representation];break;case e.AdaptationType.audio:c=x.audio[b.representation];break;default:return void o.warn("Invalid adaptation type")}d=c.getTimeRangeForReference(b.index),w.addFragmentDetails(b,d)}function s(){var a=j();w.seekSession(a)}function u(a,b,c){o.trace("Bitrates enabled by underlying player for: ",a," are: ",c);var d;switch(a){case e.AdaptationType.video:z.video=b,d=y.video[b];break;case e.AdaptationType.audio:z.audio=b,d=y.audio[b];break;default:return void o.warn("invalid adatpation type: ",a)}if(e.AdaptationType.audio===a)w.setAudioBitrates([d[0].bitrate],[d[0].tag]);else{var f=[],g=[];c.length!==d.length&&o.warn("Not all available bitrates are selected: ",d," / ",c);for(var h=0;h!==d.length;++h)-1!==c.indexOf(d[h].bitrate)&&(f.push(d[h].bitrate),g.push(d[h].tag));w.setVideoBitrates(f,g)}}if("string"!=typeof a||""===a)throw d.Error.create("Invalid parameter");r=a;var v=k(),w=h.AggStatReporter.create(j(),b);w.setReporter(v.getProxy());var x={video:[],audio:[]},y={audio:[[]],video:[[]]},z={audio:0,video:0},A={};for(var B in t)A[B]=function(a){return function(){w[a].apply(w,arguments)}}(B);return A=c.extend(A,{addPlayerData:g,enabledBitrates:u,onFragment:p,seekSession:s,setManifest:i,setReporter:l,setSidxDetails:n})}function m(a){var b,c,d;o.trace("Extracting TAG from ",a);for(var e=a.indexOf(".mp4");0!==e;)if(--e,n(a[e])){c=e+1,o.trace("Ending at: ",c);break}for(;0!==e;)if(--e,!n(a[e])){b=e+1,o.trace("Starting at: ",b);break}return"number"==typeof b&&"number"==typeof c?(d=a.substring(b,c),o.trace("Made tag: ",d)):o.warn("No TAG for representation with URL: ",a),d}function n(a){return!isNaN(a)}var o=a.create("AggStatWrapper"),p=["asteroidBuildInfo","asteroidStreamingAlgorithm","playerFactoryBuildInfo","playerFactoryName","playerStreamingAlgorithm","suggestedMaxBitrate"],q={};p.forEach(function(a){q[a]=a});var r,s=1,t={addPlaybackTime:null,logBufferingEnd:null,logBufferingStart:null,logBufferLevel:null,logNetworkRetry:null,logPlaying:null,setStreamMetadata:null,stop:null};return{PlayerDataProperties:q,createV2:i,createV3:l}}),define("asteroid/buildinfo",{build:"317595.58_asteroid2-sta",target:"vesta",config:"release",date:"2020-04-28T04:35:04.461Z"}),define("asteroid/vuduplayer",["module","ensis/logger/logger","ensis/logger/logclient","ensis/vudu/playerbridge/msgbuilder","ensis/vudu/playerbridge/params","ensis/lang/error","ensis/async/util","ensis/data/uri","ensis/drm/directorutil","ensis/media/types","ensis/vudu/player/DashPlayerInterface","ensis/async/async2","ensis/dash/manifestutil","asteroid/config","asteroid/features","asteroid/HTMLMediaElementMetricsHandler","asteroid/DashPlayerEventMetricsHandler","asteroid/PlayerStatus","asteroid/HostBridgeWrapper","asteroid/SeekUtil","asteroid/CaptionUtil","asteroid/diagnostics","asteroid/HostDebugInfoBuilder","asteroid/DashPlayerLoader","asteroid/VbrUtil","asteroid/StreamingAlgo","asteroid/Deprecated","asteroid/ResourceMetricsHandler","asteroid/AggStatWrapper","asteroid/buildinfo","asteroid/config"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E){"use strict";function F(a){var b;try{if(a){var c=a.downloadEndTimeMs,d=a.downloadStartTimeMs,e=a.byteCount;if(d&&c&&e){var f=c-d,g=8*e;isNaN(f)||isNaN(g)||(b=g/f/1e3,b=b.toFixed(3))}}}catch(h){G.trace("error calcuating bitrate: ",h.message)}return b||(b="<unknown>"),b}var G=b.create("Vudu Oort"),H=a.config(),I=c.Level.warn;return function(a){H.overrideLogLevel&&(b.setDefaultLogLevel(H.overrideLogLevel),I=H.overrideLogLevel),G.log("config: ",H),G.log("Vudu Asteroid with dynamic player selection");var J,K={id:"default",uri:"",customParams:null,playerHash:null},L=K,M={};a.Player=function(){function a(a,b,c){var e=xa.addRequest(c);s.postPlayerStateChange(d.PlayerMsgBuilder.licenseRequest(e,a,b))}function K(a,b){G.trace("Audio volume changed - volume: ",a,"; muted: ",b),s.postPlayerStateChange(d.PlayerMsgBuilder.volumeChanged(a,b))}function N(a,b){s.postPlayerStateChange(d.PlayerMsgBuilder.ended(a,b))}function O(){T("capability","setting3D")}function P(){T("capability","settingHDR")}function Q(){T("capability","hdcp")}function R(){T("capability","security")}function S(){T("drm","license-expired")}function T(a,b){function c(){var c=ca.getDuration(),e=ca.getCurrentTime(),f=c-e;!isNaN(f)&&Math.abs(f)<Ga.END_GUARD_LIMIT?(G.warn("Saw error at approximate end of content (~",f,"secs).  Reporting as EoF: ",e,"/",c),N(e,c)):s.postPlayerStateChange(d.PlayerMsgBuilder.playerError(a,b))}switch(ma.setStatus(r.PLAY_STATUS_ERROR),Asteroid.LabLog("Fatal: ",a+"/"+b),Asteroid.getTarget()){case"pallas":setTimeout(c,100);break;default:c()}}function U(a){na=a,za.setBitrates(na),s.postPlayerStateChange(d.PlayerMsgBuilder.loadedBitrates(na.length,na))}function V(a,b){a=ra[a]||"error",s.postPlayerStateChange(d.PlayerMsgBuilder.sendNetLogs(a,b))}function W(a,b){j.AdaptationType.video===a&&s.postPlayerStateChange(d.PlayerMsgBuilder.changedBitrateIndex(b))}function X(a,b,c,d){sa&&(a=j.AdaptationType.video===a?"video":"audio",Aa.updateForType(a,b,c,d))}function Y(a,b){ia.addPlayerData(C.PlayerDataProperties.playerStreamingAlgorithm,b),wa&&(b+="&asteroid="+wa.toNumber()),s.postPlayerStateChange(d.PlayerMsgBuilder.loadedPlayer(a,b))}function Z(a,b,c,d,e,f,g){var h,i=J.getVersionInfo(),l=i?i.id:"";M&&M[l]&&(h=M[l],G.log("Attempting to switch from default player algorithm, requesting: ",h));var m=k.InitParams(ba,b,a,Ma,c,h);L.customParams=L.customParams||{},L.customParams.videoQuality=d,ca.initialize(m,L.customParams);var o;"function"!=typeof ca.getPlayerSettings?G.error("Need to implement getPlayerSettings() API on ",l):o=ca.getPlayerSettings().streamingAlgorithm,"undefined"==typeof o&&(o="0"),G.log("DashPlayer '",l,"' is using algorithm: ",o);var p=H&&H.dashjs&&H.dashjs.log?H.dashjs.log:{},q=k.LoggingParams(I,!!p.console,!!p.timestamp);ca.setLogging(q),Number.isNaN(g)||ca.setMaxBitrateFor(j.AdaptationType.video,g);try{var r=n.selectInitialVideoBitrate(d,wa);G.log("Set movie initial bitrate: ",d,"; Bitrate: ",r),r/=1e3,r|=0,ca.setInitialBitrateFor(j.AdaptationType.video,r)}catch(s){G.error("Unable to select initial bitrate: ",s.message)}Y(l,o)}function $(a,b){var c=l.Deferred(),d=Asteroid.Controls.VideoModeHDR.fromDirectorString(b);return Asteroid.Controls.VideoModeHDR.OFF!==d?c.execute(function(){Asteroid.Controls.setVideoModeHDR(d).then(function(a){try{var b=a.get();c.onComplete(b)}catch(d){G.error("Failed switching HDR mode: ",d.message),c.onComplete(!1)}})}):c.execute(function(){c.onComplete(!0)}),c}function _(a,b){return oa.findAlignedSeekTime("video",a,b)}function aa(a){var b=Number.NaN,c=1,d=E.FragmentTolerance.getForType("video");try{var e=oa.findClosestStartTime("video",a);a>=e.time?a-e.time<=d&&(b=e.time+d):a+c>=e.time&&(b=e.time,b+=d)}catch(f){G.warn("Shouldn't be trying to seek before SIDX is parsed")}return Number.isNaN(b)?a:b}var ba=document.querySelector("#videoPlayer");if(!ba||"VIDEO"!==ba.nodeName)return G.error("HTML document does not have video element with ID as 'videoPlayer'"),null;var ca,da,ea=Asteroid.getTarget();if(v.isEnabled()){var fa=v.create(),ga={};ga.videoElement=document.querySelector("#videoPlayer"),ga.statsDiv=document.createElement("div"),ga.statsDiv.style.position="fixed",ga.statsDiv.style.top="10%",ga.statsDiv.style.bottom="10%",ga.statsDiv.style.left="0px",ga.statsDiv.style.width="100%",ga.statsDiv.style.height="80%",ga.statsDiv.style.zIndex="10000000",document.body.appendChild(ga.statsDiv),da=fa.start(ga)}var ha,ia,ja=null,ka=!1,la=!1,ma=r.create(),na=[],oa=t.create(),pa=null,qa=null,ra={error:"error",warn:"warn",log:"log",trace:"debug"},sa=!1,ta=null,ua=p.setup(ba,Asteroid.LabLog),va=q.create(Asteroid.LabLog),wa=z.create(M),xa=function(){var a=0,b={};return{addRequest:function(c){++a;var d="LR_"+a;return b[d]=c,d},completeRequest:function(c,d){if(!b[c])throw f.Error.create("invalid license request sequence: "+c);try{b[c](d,!0)}catch(e){G.error("License callback threw: ",e.message)}b[c]=null,delete b[c],--a},havePending:function(){return 0!==a},getPendingCount:function(){return a},reset:function(){a=0,b={}}}}();Asteroid.vuduParams=null;var ya=n.getAggStatsSendInterval(),za=C.createV2(ya);za.setReporter(function(a){G.trace("Stats reporter posting stats to host: ",a),s.postPlayerStateChange(d.PlayerMsgBuilder.sendStats(JSON.stringify(a)))});var Aa=w.create();Aa.setReporter(function(a){s.postPlayerStateChange(d.PlayerMsgBuilder.changedDebugInfo(a.debugInfoString))});var Ba;H.resources&&(Ba=Asteroid.Modules.get("Resources"),Ba&&(G.trace("Target has a resource monitor implementation"),Ba.start()));var Ca,Da=B.create(Ba,function(a){Asteroid.LabLog("resource usage: ",a)}),Ea=Asteroid.BufferControl.create(),Fa=Ea.getManager(),Ga={timerEndGuard:null,END_GUARD_LIMIT:10,onUnderrun:function(){if(ma.getStatus()!==r.PLAY_STATUS_PLAY)return void G.log("Stalled, but not playing - ignoring");if(null===Ga.timerEndGuard){var a=ca.getCurrentTime(),b=Math.abs(ca.getDuration()-a);if(b<=Ga.END_GUARD_LIMIT)return function(a,b){Ga.timerEndGuard=setInterval(function(){G.log("Checking end of stream stall...");var c=!1,d=ca.getCurrentTime();d!==a&&(G.log("Underrun end guard - cancel timer - timechanged: ",a," -> ",d),c=!0),0===--b&&(G.log("Underrun end guard - signal EOF - timeout"),c=!0,setTimeout(function(){N(a,a)},0)),c&&(clearInterval(Ga.timerEndGuard),Ga.timerEndGuard=null)},1e3)}(a,Ga.END_GUARD_LIMIT),void G.warn("Underrun, but not reporting: Too close to EOF")}ca.pause(),s.postPlayerStateChange(d.PlayerMsgBuilder.bufferUnderrun());var c=za.reportUnderrun();G.log("Underrun causing call of pause() on video element.  numUnderruns = ",c),Ea.trackUnderruns();var e=Ea.calculateResumeLevel();Asteroid.BufferControl.setResumeLevel(e),G.log("Setting playback resume level to ",e),da&&(da.resume(e),da.stall(!0,c)),ia.logBufferingStart()},onBuffered:function(){ma.equalsAny(r.PLAY_STATUS_SEEKED,r.PLAY_STATUS_PAUSE,r.PLAY_STATUS_INIT)?(xa.havePending()?G.log("Buffered, player state is: ",ma.getStatus(),"license requests outstanding: ",xa.getPendingCount(),"; Not calling play()"):(G.log("Buffered, player state: ",ma.getStatus()),ka?G.log("Not resuming playback - paused by user"):!ba.paused&&ma.equalsAny(r.PLAY_STATUS_SEEKED)?(G.trace("Playback will resume after seek as we're not paused"),ma.setStatus(r.PLAY_STATUS_PLAY),s.postPlayerStateChange(d.PlayerMsgBuilder.playing())):(G.trace("Requesting play on DashPlayer"),ca.play())),ia.logBufferingEnd(),s.postPlayerStateChange(d.PlayerMsgBuilder.bufferLoaded())):G.log("buffered, but player state is not SEEKED or PAUSED (",ma.getStatus(),");  No call to play()")}};Fa.whenBuffered(Ga.onBuffered),Fa.whenUnderrun(Ga.onUnderrun),"vesta"===ea&&"function"==typeof Ea.createWaitingMonitor&&(Ca=Ea.createWaitingMonitor());var Ha,Ia=null;"ceres"!==ea&&"intera"!==ea||(Ha=function(){function a(){q=!0}function b(){var c=!0;if("stopping"===o)G.log("Stopping seek stuck watcher due to shutdown"),c=!1;else if(q)c=!1;else{for(m.push(ba.currentTime);m.length>j;)m.shift();var d=0;if(m.length>i)for(var g=0;g!==m.length-1;++g)m[g+1]>m[g]&&++d;d>=i&&(G.trace("Looks like playback resumed after seek"),c=!1)}return c?(k>0?(G.trace("Expecting seek to resume ",ba.currentTime),k-=f):(G.warn("Seek has not resumed"),ka?G.trace("Seems to be paused due to user interaction"):(p+=h,G.trace("Giving seek a little tap to help it along, from => to: ",ba.currentTime," => ",p),ca.seek(p)),k=e,m=[]),void setTimeout(b,f)):(o="stopped",ba.removeEventListener("playing",a,!1),void n.onComplete())}function c(){return o="stopping",n}function d(a){return n.then(a)}var e=2100,f=300,g=1200,h=.1,i=Math.floor(g/f),j=2*i,k=e,m=[],n=l.Deferred(),o="running",p=0,q=!1;return ba.addEventListener("playing",a,!1),{start:function(a){return p=a,n.execute(function(){setTimeout(b,f)}),{stop:c,onDone:d}}}});var Ja,Ka=function(a,b){var c,d,e=a.indexOf("/manifest.mpd");if(-1===e)throw f.Error.create("Invalid Parameter");return c=a.substring(0,e),"string"!=typeof b?b="":"?"!==b[0]&&(b="?"+b),{getManifestUrl:function(){return a},getSidxsUrl:function(){var a=c+"/sidxs.json"+b;return a},getSidxsData:function(){return d},setSidxsData:function(a){d=a}}},La=b.create("DashPlayer"),Ma={onBufferUnderrun:function(a){if(!la){switch(va.player.onBufferUnderrun(a),a){case j.AdaptationType.video:Fa.stalledVideo();break;case j.AdaptationType.audio:Fa.stalledAudio();break;default:G.log("Adaptation not factored into stall state: ",a)}G.log("[",a,"] vuduplayer onBufferUnderrun() stall state: ",Fa.toJSON()," _videoStatus: ",ma.getStatus())}},onBufferLoaded:function(a){if(!la){switch(va.player.onBufferLoaded(a),a){case j.AdaptationType.video:Fa.bufferedVideo();break;case j.AdaptationType.audio:Fa.bufferedAudio();break;default:G.log("Adaptation not factored into stall state: ",a)}G.trace("[",a,"] vuduplayer onBufferLoaded() stall state: ",Fa.toJSON()," _videoStatus; ",ma.getStatus())}},onCanPlay:function(){if(Ea){var a=Ea.getCanPlayHandler();a()}},onError:function(a){if(!la){va.player.onError(a);var b=!1;switch(a.type){case"manifest":case"mediasource":case"mediaelement":case"capability":b=!0;break;default:G.log("this kind of error is ignored: ",a.type)}"download"===a.type&&("fragmentrepeated"===a.reason?Fa.isAllReady()||(b=!0):ia.logNetworkRetry()),"mediaelement"===a.type&&"notallowed"===a.reason&&(b=!1,s.postPlayerStateChange(d.PlayerMsgBuilder.autoplayDisabled())),b?G.error("DashPlayer reported error: ",a.type,"; reason: ",a.reason,"; error props: ",a.extra):G.warn("Non-fatal issue reported by DashPlayer: ",a.type,"; reason: ",a.reason,"; error props: ",a.extra),b&&T(a.type,a.reason)}},onMetricChanged:function(){},onMetricsData:function(){},onKeyStatusesChanged:function(a,b){G.log("Key Statuses Changed: ",a);var c=!1,d={EXPIRED:1,RESTRICTED:2,OTHER:128,value:0};b&&"function"==typeof b.forEach&&b.forEach(function(a){"string"!=typeof a?G.warn("Don't know what to do with this: ",typeof a):"status-pending"===a?G.trace("Ignore EME pending state notification"):"output-restricted"===a?d.value|=d.RESTRICTED:"expired"===a?d.value|=d.EXPIRED:"usable"===a?c=!0:d.value|=d.OTHER}),0!==d.value&&(c?G.warn("onKeyStatusesChanged: Found status with output-restricted, but also found usable key"):(G.error("onKeyStatusesChanged: Found key with restrictions and no usable key"),0!==(d.value&d.EXPIRED)?S():R()))},onManifestParsed:function(a){va.player.onManifestParsed(a),G.trace("Manifest parsed and ready for use ... nothing to do here, can we remove?")},onAdaptationSelected:function(a,b){va.player.onAdaptationSelected(a,b),"undefined"==typeof b&&G.error("Adapation not passed in onAdaptationSelected, type: ",a);var c=ca.getBitratesFor(a);if(ia.enabledBitrates(a,b||0,c),j.AdaptationType.video===a)if(0===c.length)G.error("onAdaptationSelected() bitrate list must be populated by now - for video");else{var d=c.sort(function(a,b){return a-b});U(d)}},onRepresentationSelected:function(a,b,c){va.player.onRepresentationSelected(a,b,c);var d=0;j.AdaptationType.audio===a&&(d=ca.getCurrentAdaptationFor(j.AdaptationType.audio)),W(a,b),Ja&&Ja.setCurrentRepresentation(a,b),da&&da.format({type:a,adaptIdx:d,repIdx:b}),X(a,d,b,c)},onFragmentLoaded:function(a,b){va.player.onFragmentLoaded(a,b),ia.onFragment(a,b),j.AdaptationType.video===a&&(Da.report(),b?(G.trace("VIDEO CHUNK -- ","index: ",b.index,"; quality: ",b.representation,"; bytes: ",b.byteCount,"; downloadMs: ",b.downloadStartTimeMs,"-",b.downloadEndTimeMs,"; bitrate (Mb/s): ",F(b),"; duration: ",b.durationMs),za.reportDownload(b.representation,b.index,b.byteCount,b.durationMs,b.downloadStartTimeMs,b.downloadEndTimeMs),"aurora"===ea&&(b.underrunCount=za.getAggStats().getUnderrunCount(),b.bitrates=na,s.getHostWindow().VUDU_Player.playerMgr.reportAsteroidStreamingStat(b)),Ja&&Ja.updateCurrentPlaybackStatus(a,b.index,b.representation),da&&da.quality(b.representation)):(G.trace("EOF on video, send Stats"),za.sendStats(!0)))},onLicenseRequest:function(b,c,d){va.player.onLicenseRequest(b,c);try{var e,f=Asteroid.Modules.get("ProtectionExtensionParser");if("undefined"!=typeof f){var h=f.parseAcquireLicenseMessage;"function"==typeof h&&(e=h(c))}e||(e=i.packEmeMessage(c)),a(b,e,function(a,b){var c;try{c=b?i.unpackDirectorResponseFromNote(a):i.unpackDirectorResponseFromDOM(a)}catch(e){G.error("Problem handling director license response: "+e.message)}d(c)})}catch(j){G.error("Problem handling license request from DASH player: ",j.message),g.wait(1).then(function(){d()})}},onPositionUpdate:function(){la||(G.trace("vuduplayer onPositionUpdate() currentTime = "+ca.getCurrentTime()+" duration = "+ca.getDuration()),ia.addPlaybackTime(ca.getCurrentTime()),s.postPlayerStateChange(d.PlayerMsgBuilder.timeChanged(ca.getCurrentTime(),ca.getDuration())))},onPlay:function(){ma.equalsAny(r.PLAY_STATUS_PLAY)||(ma.setStatus(r.PLAY_STATUS_PLAY),ia.logPlaying(),s.postPlayerStateChange(d.PlayerMsgBuilder.playing()))},onPause:function(){ma.equalsAny(r.PLAY_STATUS_PAUSE)||(ma.setStatus(r.PLAY_STATUS_PAUSE),la||s.postPlayerStateChange(d.PlayerMsgBuilder.paused(ca.getCurrentTime()?ca.getCurrentTime():0)))},onSeeking:function(){ma.equalsAny(r.PLAY_STATUS_SEEKING)||(G.trace("onSeeking()"),ma.setStatus(r.PLAY_STATUS_SEEKING),Fa.seeking(),s.postPlayerStateChange(d.PlayerMsgBuilder.seeking()))},onSeeked:function(){ma.equalsAny(r.PLAY_STATUS_SEEKED)||(G.log("onSeeked()"),ma.setStatus(r.PLAY_STATUS_SEEKED),s.postPlayerStateChange(d.PlayerMsgBuilder.seeked()),Fa.checkBuffered())},onEnded:function(){if(va.player.onEnded(),!ma.equalsAny(r.PLAY_STATUS_ENDED)){ma.setStatus(r.PLAY_STATUS_ENDED),la=!0;var a=ca.getCurrentTime()?ca.getCurrentTime():0,b=ca.getDuration()?ca.getDuration():0;N(a,b)}},onPlaybackRateChanged:function(a){la||(s.postPlayerStateChange(d.PlayerMsgBuilder.playbackRateChanged(a?a:0)),da&&0!==a&&da.stall(!1))},onMetadataLoaded:function(){var a=0,b=ca.getDuration();if(ja&&ja>10){G.log("Bookmark provided: ",ja);var c=!1;if(b?ja>=b-60&&(c=!0,ja=Math.max(0,b-60)):(c=!0,ja=0),c&&G.warn("Bookmark time modified to: ",ja),a=_(ja),ca.seek(a),"function"==typeof Ha){null!==Ia&&Ia.stop();var d=Ha(),e=d.start(a);e.onDone(function(){Ia===e&&(Ia=null)}),Ia=e}}G.trace("vuduplayer _onLoadedMetadata duration = ",b),G.trace("Sending initial volume info to UI from metadataloaded callback"),K(ca.getVolume(),ca.getMute()),ia.setStreamMetadata({duration:b})},onManifestLoaded:function(a){va.player.onManifestLoaded(a),"string"==typeof a&&G.error("Loaded manifest must be passed as a XML DOM tree."),qa=m.parseManifest(a),Aa.setManifest(qa),Ja&&Ja.setManifest(qa),da&&da.setManifest(qa),Asteroid.InitDataCache.buildRepresentations(a),ia.setManifest(qa),ha&&(Asteroid.InitDataCache.cacheInitData(ha.getSidxsUrl(),ha.getSidxsData()),ha=null)},onSidxParsed:function(a,b){if(va.player.onSidxParsed(a,b),j.AdaptationType.isMedia(a)){var c=a===j.AdaptationType.video?"video":"audio";if(!b)return void G.error("onSidxParsed hit problem for ",a);var d=b.sidx;oa.addTableForType(c,d),ia.setSidxDetails(a,b.representationIndex,d),Ja&&Ja.setRepresentationSidx(a,b.representationIndex,b.sidx)}},onVolumeChanged:function(a,b){K(a,b)},onLogMessage:function(a,b){b=b||c.Level.trace,La[b](a)},onWaiting:function(){Ca&&Ca.onWaiting()},onProgress:function(){Ca&&Ca.onProgress(ca.getCurrentTime(),ba.buffered)},onBufferLevel:function(a,b){var c=b.toFixed(2);va.player.onBufferLevel(a,c),Fa.bufferedRanges(ba.duration,ba.currentTime,ba.buffered),ia.logBufferLevel(a,b)},onPlayerStopped:function(a,b){if(!la){la=!0;var c={};for(var e in b)if(b.hasOwnProperty(e)){var f=null;switch(G.trace("Property '",e,"' found"),typeof b[e]){case"number":f="",f+=b[e],f=JSON.stringify({type:"number",value:f});break;case"string":f=b[e],f=JSON.stringify({type:"string",value:f});break;case"object":try{f=b[e],f=JSON.stringify({type:"object",value:JSON.stringify(f)})}catch(g){G.warn("Couldn't transfer ",e,"'s value to host: ",g.message)}break;case"function":G.warn("Can't include functions in value for host");break;default:G.warn("Can't process property ",e)}null!==f&&(c[e]=f)}else G.warn("Can't transfer inherited property '",e,"' to host");s.postPlayerStateChange(d.PlayerMsgBuilder.playerStopped(a,JSON.stringify(c)))}}},Na={flushStats:function(){za.sendStats(!0)},loadLicense:function(a,b){va.host.loadLicense(a,b);try{G.trace("Running license request callback with token ",b.substr(0,16),"...#",b.length),xa.completeRequest(a,b)}catch(c){return void G.error("Problem with license request callback: ",a,"; error: ",c.message)}ma.equalsAny(r.PLAY_STATUS_SEEKED,r.PLAY_STATUS_PAUSE,r.PLAY_STATUS_INIT)&&!xa.havePending()&&Fa&&Fa.isAllReady()&&(G.log("Got license and buffered, player state is (",ma.getStatus(),");  call play()"),ca.play())},loadPlayerImplementation:function(a){if("string"!=typeof a)return void G.error("loadPlayerImplementation: playerInfo must contain a string: (",typeof a,")",a);va.host.loadPlayerImplementation(a);var b=a.split(","),c=b[0],d=b[1],e=b[2],f=b[3];"undefined"==typeof c||"undefined"==typeof d?G.error("Ignoring player details.  Player must have an ID and URI"):(G.log("Updated player info provided: ",c,"; URI: ",d),L={id:c,uri:d,customParams:e,playerHash:f})},pause:function(){ma.equalsAny(r.PLAY_STATUS_PAUSE)||(G.log("Call pause() _videoStatus = ",ma.getStatus()),ka=!0,ca.pause())},play:function(){ka=!1,ma.equalsAny(r.PLAY_STATUS_PLAY,r.PLAY_STATUS_SEEKING,r.PLAY_STATUS_SEEKED)||Fa&&Fa.isAllReady()&&(G.log("Everything is ready, start to play()!! _videoStatus: ",ma.getStatus()),ca.play())},seek:function(a,b){function c(a){if(ka=!1,ca){G.log("doSeek callback seeking to time: ",a,"; player status: ",ma.getStatus());var b=ca.getDuration();if(b&&b>2&&a>b-2)G.warn("Requested seek time was too close to EoF - calling onVideoEnded()"),N(a,b);else if(za.sendStats(!0),ia.seekSession(),ca.seek(a),"function"==typeof Ha){null!==Ia&&Ia.stop();var c=Ha(),d=c.start(a);d.onDone(function(){Ia===d&&(Ia=null)}),Ia=d}}}if(!ma.equalsAny(r.PLAY_STATUS_SEEKING)){G.trace("seek() _videoStatus: ",ma.getStatus()),a<0&&(a=0),b=b||e.SeekOptions(e.SeekTarget.BEFORE,!0);var d=b.target;"undefined"==typeof d&&(d=e.SeekTarget.BEFORE);var f=e.SeekTarget.AFTER===d,g=b.pause;switch("boolean"!=typeof g&&(g=!0),d){case e.SeekTarget.EXACT:a=aa(a);break;case e.SeekTarget.BEFORE:case e.SeekTarget.AFTER:default:a=_(a,f)}g?ma.equalsAny(r.PLAY_STATUS_PLAY,r.PLAY_STATUS_SEEKED)?(G.trace("seek() calling pause() before seeking"),ca.pause(),ma.waitForStatusReached(r.PLAY_STATUS_PAUSE,function(){G.trace("seek() -- player status is paused now, do seek to: ",a),c(a)})):ma.equalsAny(r.PLAY_STATUS_PAUSE)&&(G.trace("seek() -- player is already paused, do seek to: ",a),c(a)):(G.trace("Performing a seek without pre-pause: ",a),c(a))}},selectCaptionTrack:function(a){return null===ta?void G.warn("Caption setting changed, but no captions defined"):(a=u.parseHostCaptionMode(a),void(a.isEnabled()?(G.log("Captions enabled: ",a.getLanguage()),ta.enableCaptions(a.getLanguage())):(G.log("Captions disabled"),ta.disableCaptions())))},selectRepresentation:function(a,b){G.log("selectRepresentation"),Number.NaN!==a&&null!==a&&(G.log("set videoIndex"),ca.setCurrentRepresentationFor(j.AdaptationType.video,a)),Number.NaN!==b&&null!==b&&(G.log("set audioIndex"),ca.setCurrentRepresentationFor(j.AdaptationType.audio,b))},selectStreamingAlgorithm:function(a){"string"!=typeof a&&G.warn("Ignoring call to selectStreamingAlgorithm for: ",a),va.host.selectStreamingAlgorithm(a);try{M=h.getSearchParamsFromPath(a),wa=z.create(M)}catch(b){G.error("Problem parsing streaming algorithm info from host: ",b.message)}},start:function(b,c,e,f,g,h,i){function j(){z.playerLoadTaskDone&&z.initdataLoadTaskDone&&z.hdrModeSetTaskDone&&Z(b,c,e,pa,l,h,k)}var k=i&&i.suggestedMaxBitrate;"undefined"==typeof g&&(g={});var l=g.dimensionality,m=Asteroid.Controls.VideoMode3D.fromDirectorString(l);if(Asteroid.Controls.VideoMode3D.OFF===m){G.log("Setting 3D to 'OFF', to clear any sticky former settings");try{Asteroid.Controls.setVideoMode3D({videoElement:ba,videoMode3D:Asteroid.Controls.VideoMode3D.OFF})}catch(n){G.error("Turning off 3D caused error: ",n.message)}}else!1===Asteroid.Features.get3DSupport()?(G.log("3D not supported"),O()):Asteroid.Controls.setVideoMode3D({videoElement:ba,videoMode3D:m}).then(function(a){try{!0!==a.get()&&O()}catch(b){G.error("Turning on 3D caused error: ",b.message),O()}});"string"!=typeof f?(G.error("Must specify a movie quality in call to start"),pa="SD"):pa=f.toUpperCase(),"undefined"!=typeof h&&(ta=u.create(h,ba)),"number"!=typeof k||k<0?k=Number.NaN:G.log("Suggested max bitrate: ",k),ia=C.createV3(s.getConnectionContext(),ya),ia.addPlayerData(C.PlayerDataProperties.asteroidBuildInfo,D.build),ia.addPlayerData(C.PlayerDataProperties.asteroidStreamingAlgorithm,wa.getVersion()),ia.addPlayerData(C.PlayerDataProperties.suggestedMaxBitrate,k),ia.setReporter(function(a){G.trace("StatsV3 reporter posting stats to host: ",a),s.postPlayerStateChange(d.PlayerMsgBuilder.sendStatsV3(JSON.stringify(a)))}),Asteroid.Features.registerHdmiChangeListener&&"UHD"===pa&&Asteroid.Features.registerHdmiChangeListener(function(a){if(G.log("HDMI Status Changed: ",a),o.HdmiState.ACTIVATED===a){var b=Asteroid.Features.getHdmiSupport();b.hdcp.flags&&-1!==b.hdcp.flags.indexOf("allow4K")||(G.warn("Aborting playback due to reported change in HDCP status: ",b.hdcp),Q())}}),za.reset(),ia.setStreamMetadata({url:c,bookmark:e||0}),ma=r.create(),xa.reset(),ja=e,G.log("vuduplayer start dash player at time = ",e," with movieQuality = ",f," _videoStatus = ",ma.getStatus()),Asteroid.vuduParams=function(){var c=A.create("Asteroid::VuduParams"),d={suffix:b,callbacks:{requestPlayReadyLicense:function(b,c){G.warn("Deprecated: requestPlayReadyLicense - use DashPlayerInterface"),a("playready",b,c)},requestWidevineLicense:function(b,c){G.warn("Deprecated: requestWidevineLicense - use DashPlayerInterface"),a("widevine",b,c)}}},e={};return e.__defineGetter__("suffix",c.makeWarningAccessor(d,"suffix")),e.__defineGetter__("callbacks",c.makeWarningAccessor(d,"callbacks")),e.__defineSetter__("suffix",c.makeInvalidAccessor(d,"suffix")),e.__defineSetter__("callbacks",c.makeInvalidAccessor(d,"callbacks")),e}();var p=Asteroid.Modules.get("BudgetAdapter");if(p){p.configure({quality:pa,maxFragmentDuration:Number.NaN,maxFragmentSize:Number.NaN});var q=(p.getMaxBufferSize(),p.getMaxBitrate());Number.isNaN(q)||(q/=1e3,q=Math.floor(q),k=Number.isNaN(k)?Math.floor(q):Math.min(k,q))}if(wa.getVersion()>0){try{if(wa.isVbrEnabled()){var t,v=wa.getVbrBitrateSampleWindow();"function"==typeof wa.getVbrBitrateCalculationMethod&&(t=wa.getVbrBitrateCalculationMethod()),y.setConfig({sampleWindow:v,calculationMethod:t}),Ja=y.createMonitor()}}catch(w){G.error("Failed initializing VBR settings: ",w.message),Ja=null}try{wa.isTestMode()&&(H.overrideLogLevel||Na.setDebugLevel("debug",!1))}catch(w){G.error("Failed updating testmode setting: ",w.message)}}var z={playerLoadTaskDone:!1,initdataLoadTaskDone:!1,hdrModeSetTaskDone:!1};ha=Ka(c,b),Asteroid.InitDataCache.fetchInitData(ha.getSidxsUrl()).then(function(a){ha.setSidxsData(a.initdata),z.initdataLoadTaskDone=!0,j()})["catch"](function(a){G.warn("InitDataCache load failed: ",a.message,"; manifest: ",ha.getSidxsUrl()),ha=null,z.initdataLoadTaskDone=!0,j()}),x.getPlayerFactory(L.uri,L.customParams,L.playerHash).then(function(a){J=a;var b=J.getVersionInfo();G.trace("Got player factory: ",b.name,"; build: ",b.build),ia.addPlayerData(C.PlayerDataProperties.playerFactoryName,b.name),ia.addPlayerData(C.PlayerDataProperties.playerFactoryBuildInfo,b.build),ca=J.createPlayer(L.customParams),z.playerLoadTaskDone=!0,j()})["catch"](function(a){G.error("Player loader failed: ",a.message),T("capability","player")}),$(pa,g.videoprofile).then(function(a){a?(z.hdrModeSetTaskDone=!0,j()):P()}),G.log("Supported qualities: ",Asteroid.Features.getVideoSupport(),"/",Asteroid.Features.getAudioSupport()),G.log("Using quality: ",pa,"/",g)},stop:function(){G.log("stopping player");var a=[];if(ba){if(ma=r.create(),za){var b=za.sendStats(!0);b&&a.push(b)}if(ia){var c=ia.stop();c&&a.push(c)}Aa&&(Aa=null),Fa&&(Fa.clear(),Fa=null),Ea&&(Ea=null),ta=null,Asteroid.vuduParams=null,xa.reset(),
pa=null,qa=null;try{var d=ca.reset();d&&"function"==typeof d.then&&a.push(d)}catch(e){G.warn("DASH-JS reset threw during stop - ignoring: ",e.message)}if(Asteroid.Features.unregisterHdmiChangeListener&&Asteroid.Features.unregisterHdmiChangeListener(),"function"==typeof Asteroid.Features.stop&&Asteroid.Features.stop(),"function"==typeof Asteroid.Controls.setVideoModeHDR){var f=Asteroid.Controls.setVideoModeHDR(Asteroid.Controls.VideoModeHDR.OFF);a.push(f)}Da.stop(),ua&&(ua.stop(),ua=null),va&&(va.stop(),va=null),da&&(da.stop(),da=null),y.stop()}a.push(g.wait(100)),Ia&&a.push(Ia.stop()),g.whenAll.apply(null,a).then(function(){za.done(),za=null,s.stop()})},setDebugLevel:function(a,c){switch(va.host.setDebugLevel(a,c),a){case"debug":case"info":I="trace";break;case"log":case"notice":I="log";break;case"error":case"warn":case"warning":default:I="warn"}H.overrideLogLevel?(G.warn("setDebugLevel ignored - using override from config: ",H.overrideLogLevel),I=H.overrideLogLevel):b.setDefaultLogLevel(I),sa=!!c},setVolume:function(a,b){try{Number.isNaN(a)||ca.setVolume(a),"boolean"==typeof b&&ca.setMute(b)}catch(c){G.error("Error in setVolume: ",c.message)}}};return s.registerPlayerHostHandler(Na),{reportNetLogs:function(a,b){V(a,b)}}}(),window.addEventListener("com.vudu.asteroid.deferredhostmessage",function N(a){window.removeEventListener("com.vudu.asteroid.deferredhostmessage",N),s.handleHostConnectEvent(a)})}}),define("ensis/isoreader/boxreader/trak",["ensis/logger/logger","ensis/lang/object","ensis/data/format","ensis/isoreader/boxreader/base","ensis/lang/error"],function(a,b,c,d,e){"use strict";function f(){d.BoxParsers.registerParser("trak",j),d.BoxParsers.registerParser("tkhd",k),d.BoxParsers.registerParser("mdia",l),d.BoxParsers.registerParser("mdhd",m),d.BoxParsers.registerParser("minf",n),d.BoxParsers.registerParser("stbl",o),d.BoxParsers.registerParser("stsc",p),d.BoxParsers.registerParser("stsz",q)}function g(){return{TrackBox:j,TrackHeaderBox:k,MediaBox:l,MediaHeaderBox:m,MediaInfoBox:n,SampleTableBox:o,SampleToChunkBox:p,SampleSizeFramingBox:q,registerParsers:f}}var h=a.create("iso/trak"),i=b.extend,j=function(){function a(a){function b(){var a=8,b=h.getChildBoxesSize();return a+b}var c=a.offset,e=d.Box.fromStream(a),f=e.getSize(),g=f-(a.offset-c),h=d.HierarchyBoxes.create(a,g,"trak"),j=i(e,h);return a.offset=c+f,j=i(j,{asStream:function(a){return d.HierarchyBoxes.asStream(j,a)},getSize:b})}return{fromStream:a}}(),k=function(){function a(a,c,e,f,g,h,j,k,l,m,n,o,p){(null===e||Number.isNaN(e))&&(e=8,e+=1===a?32:20,e+=8,e+=2,e+=2,e+=2,e+=2,e+=36,e+=8);var q=d.FullBox.create("tkhd",a,c,e),r=i(q);return r.getCreationTime=function(){return b(f)},r.getModificationTime=function(){return b(g)},r.getTrackId=function(){return h},r.getDuration=function(){return b(j)},r.getLayer=function(){return k},r.getAltGroup=function(){return l},r.getVolume=function(){return m},r.getMatrix=function(){return n},r.getWidth=function(){return o},r.getHeight=function(){return p},r.asStream=function(b){if(!d.isStream(b)){var c=new ArrayBuffer(e);b={offset:0,bytearray:new DataView(c)}}q.asStream(b);var i=b.offset,r=b.bytearray;1===a?(r.setUint32(i,f[0]),i+=4,r.setUint32(i,f[1]),i+=4,r.setUint32(i,g[0]),i+=4,r.setUint32(i,g[1]),i+=4,r.setUint32(i,h),i+=4,r.setUint32(i,0),i+=4,r.setUint32(i,j[0]),i+=4,r.setUint32(i,j[1]),i+=4):(r.setUint32(i,f),i+=4,r.setUint32(i,g),i+=4,r.setUint32(i,h),i+=4,r.setUint32(i,0),i+=4,r.setUint32(i,j),i+=4),r.setUint32(i,0),i+=4,r.setUint32(i,0),i+=4,r.setUint16(i,k),i+=2,r.setUint16(i,l),i+=2,r.setUint16(i,m),i+=2,r.setUint16(i,0),i+=2;for(var s=0;9!=s;++s)r.setUint32(i,n[s]),i+=4;return r.setUint32(i,o),i+=4,r.setUint32(i,p),i+=4,b.offset=i,b},r}function b(a){return a.isArray?""+a[0]+"."+a[1]:a}function e(b){var e=b.offset,f=d.FullBox.fromStream(b),g=f.getVersion(),i=f.getFlags();h.trace("TKHD flags: ",c.toHex(i));var j,k,l,m,n,o,p,q,r,s=b.offset,t=b.bytearray,u=[];1===g?(j=[],j.push(t.getUint32(s)),s+=4,j.push(t.getUint32(s)),s+=4,k=[],k.push(t.getUint32(s)),s+=4,k.push(t.getUint32(s)),s+=4,l=t.getUint32(s),s+=4,s+=4,m=[],m.push(t.getUint32(s)),s+=4,m.push(t.getUint32(s)),s+=4):(j=t.getUint32(s),s+=4,k=t.getUint32(s),s+=4,l=t.getUint32(s),s+=4,s+=4,m=t.getUint32(s),s+=4),s+=8,n=t.getUint16(s),s+=2,o=t.getUint16(s),s+=2,p=t.getUint16(s),s+=2,s+=2;for(var v=0;9!=v;++v)u[v]=t.getUint32(s),s+=4;u.forEach(function(a,b){h.trace("matrix ",b,": ",c.toHex(a))}),q=t.getUint32(s),s+=4,r=t.getUint32(s),s+=4,b.offset=e+f.getSize();var w=a(g,i,f.getSize(),j,k,l,m,n,o,p,u,q,r);return w}return{create:a,fromStream:e}}(),l=function(){function a(a){function b(){var a=8;return a+=h.getChildBoxesSize()}var c=a.offset,e=d.Box.fromStream(a),f=e.getSize(),g=f-(a.offset-c),h=d.HierarchyBoxes.create(a,g,"mdia"),j=i(e,h);return a.offset=c+f,j=i(j,{asStream:function(a){return d.HierarchyBoxes.asStream(j,a)},getSize:b})}return{fromStream:a}}(),m=function(){function a(a,b,f,g,h,j){function k(){return 1===a?d.ValueField.create64(b):d.ValueField.create32(b)}function l(){return 1===a?d.ValueField.create64(f):d.ValueField.create32(f)}function m(){return 1===a?d.ValueField.create64(h):d.ValueField.create32(h)}function n(){return j}function o(){var a=[].map.call(j,function(a){return a=a.charCodeAt(0),a-=96,a&=31});return a}function p(c){if(!d.isStream(c)){var e=new ArrayBuffer(t.getSize());c={offset:0,bytearray:new DataView(e)}}var i=c.offset;s.asStream(c);var j=c.offset,k=c.bytearray;1===a?(k.setUint32(j,b[0]),j+=4,k.setUint32(j,b[1]),j+=4,k.setUint32(j,f[0]),j+=4,k.setUint32(j,f[1]),j+=4,k.setUint32(j,g),j+=4,k.setUint32(j,h[0]),j+=4,k.setUint32(j,h[1]),j+=4):(k.setUint32(j,b),j+=4,k.setUint32(j,f),j+=4,k.setUint32(j,g),j+=4,k.setUint32(j,h),j+=4);var l=o(),m=l[0]<<10|l[1]<<5|l[2];return k.setUint16(j,m),j+=2,k.setUint16(j,0),j+=2,c.offset=j,r=j-i,k.setUint32(i,r),c}var q=0,r=12+(1==a?28:16)+2+2,s=d.FullBox.create(c,a,q,r),t=i(s,{getCreationTime:k,getModificationTime:l,getTimescale:function(){return g},getDuration:m,getLanguage:n,getLanguagePacked:o,asStream:p});if(Array.isArray(j)){var u=j.map(function(a){return a&=31,a+=96,String.fromCharCode(a)});j=u.join("")}return"string"==typeof j&&3===j.length||e.Error.create("Invalid format for lang field: ",j),t}function b(b){var c,e,f,g,h=b.offset,i=d.FullBox.fromStream(b),j=i.getVersion(),k=i.getSize(),l=b.bytearray,m=b.offset;k-(b.offset-h);1===j?(c=[],c.push(l.getUint32(m)),m+=4,c.push(l.getUint32(m)),m+=4,e=[],e.push(l.getUint32(m)),m+=4,e.push(l.getUint32(m)),m+=4,f=l.getUint32(m),m+=4,g=[],g.push(l.getUint32(m)),m+=4,g.push(l.getUint32(m)),m+=4):(c=l.getUint32(m),m+=4,e=l.getUint32(m),m+=4,f=l.getUint32(m),m+=4,g=l.getUint32(m),m+=4);var n=l.getUint16(m);m+=2;var o=[];o.unshift(31&n),n>>=5,o.unshift(31&n),n>>=5,o.unshift(31&n),m+=2;var p=a(j,c,e,f,g,o);return b.offset=m,p}var c="mdhd";return{create:a,fromStream:b}}(),n=function(){function a(a){function b(){var a=8;return a+=h.getChildBoxesSize()}var c=a.offset,e=d.Box.fromStream(a),f=e.getSize(),g=f-(a.offset-c),h=d.HierarchyBoxes.create(a,g,"minf"),j=i(e,h);return a.offset=c+f,j=i(j,{asStream:function(a){return d.HierarchyBoxes.asStream(j,a)},getSize:b})}return{fromStream:a}}(),o=function(){function a(a){function b(){var a=8;return a+=h.getChildBoxesSize()}var c=a.offset,e=d.Box.fromStream(a),f=e.getSize(),g=f-(a.offset-c),h=d.HierarchyBoxes.create(a,g,"stbl"),j=i(e,h);return a.offset=c+f,j=i(j,{asStream:function(a){return d.HierarchyBoxes.asStream(j,a)},getSize:b})}return{fromStream:a}}(),p=function(){function a(a){var b=0,c=0,f=[],g=12;g+=4,g+=12*a;for(var h=d.FullBox.create("stsc",b,c,g),j=i(h),k=0;k!=a;++k)f.push(e.create(0,0,0));return j.getEntryCount=function(){return f.length},j.getEntry=function(a){return f[a]},j.setEntry=function(a,b){if(a|=0,a<0||a>=f.length)throw new Error("index out of range");f[a]=b},j.asStream=function(a){if(!d.isStream(a)){var b=new ArrayBuffer(j.getSize());a={offset:0,bytearray:new DataView(b)}}var c=a.offset;h.asStream(a);var e=a.offset,i=a.bytearray;return i.setUint32(e,f.length),e+=4,f.forEach(function(a){i.setUint32(e,a.firstChunk),e+=4,i.setUint32(e,a.samplesPerChunk),e+=4,i.setUint32(e,a.sampleDescriptionIndex),e+=4}),a.offset=e,g=e-c,i.setUint32(c,g),a},j.getSize=function(){var a=16+12*f.length;return a},j}function b(b){var c=b.offset,f=(d.FullBox.fromStream(b),b.offset),g=b.bytearray,h=g.getUint32(f);f+=4;for(var i=a(h),j=0;j!=h;++j){var k=e.create();k.firstChunk=g.getUint32(f),f+=4,k.samplesPerChunk=g.getUint32(f),f+=4,k.sampleDescriptionIndex=g.getUint32(f),f+=4,i.setEntry(j,k)}return b.offset=c+=i.getSize(),i}function c(){return{create:a,fromStream:b,Entry:e}}var e=function(){function a(a,b,c){return{firstChunk:a,samplesPerChunk:b,sampleDescriptionIndex:c}}return{create:a}}();return c()}(),q=function(){function a(a,b){var c=0,e=0,f=[],g=20+4*b;if(0!==b&&0!==a&&h.error("Not valid to have both sampleSize AND sampleCount in 'stsz' box"),0===a)for(var j=0;j!=b;++j)f.push(0);var k=d.FullBox.create("stsz",c,e,g),l=i(k);return l.getSize=function(){var a=20+4*f.length;return a},l.setEntry=function(c,d){if(0!==a)throw h.error("Sample size is specified, can't have both entries and constant size defined"),new Error("Can't specify sample entries with sampleSize");if(c|=0,c<0||c>=b)throw h.error("Index out of range"),new Error("Index out of range");f[c]=d},l.getSampleSize=function(){return a},l.getEntryCount=function(){return f.length},l.getEntry=function(a){return f[a]},l.asStream=function(b){if(!d.isStream(b)){var c=new ArrayBuffer(l.getSize());b={offset:0,bytearray:new DataView(c)}}var e=b.offset;k.asStream(b);var g=b.offset,h=b.bytearray;h.setUint32(g,a),g+=4,h.setUint32(g,f.length),g+=4,f.forEach(function(a){h.setUint32(g,a),g+=4});var i=g-e;return h.setUint32(e,i),b.offset=g,b},l}function b(b){var c=b.offset,e=(d.FullBox.fromStream(b),b.offset),f=b.bytearray,g=f.getUint32(e);e+=4;var h=f.getUint32(e);e+=4;var i=a(g,h);if(0!==g);else for(var j=1;j<=h;++j){var k=f.getUint32(e);e+=4,i.setEntry(j,k)}return b.offset=c+i.getSize(),i}function c(){return{create:a,fromStream:b}}return c()}();return g()}),define("ensis/isoreader/boxreader/moov",["ensis/lang/object","ensis/isoreader/boxreader/base"],function(a,b){"use strict";function c(){b.BoxParsers.registerParser("moov",i),b.BoxParsers.registerParser("mvhd",j)}function d(){return{MoovBox:i,MoovHeaderBox:j,registerParsers:c}}var e=b.HierarchyBoxes,f=b.Box,g=b.FullBox,h=a.extend,i=function(){function a(a,c){if(!b.isStream(c)){c={offset:0,bytearray:null};var d=new ArrayBuffer(a.getSize());c.bytearray=new DataView(d)}var e=c.offset;c.bytearray.setUint32(c.offset,a.getSize()),c.offset+=4;for(var f="moov",g=0;4!=g;++g)c.bytearray.setUint8(c.offset++,f.charCodeAt(g));a.getChildBoxes().forEach(function(a){a.asStream(c)});var h=c.offset-e;return c.bytearray.setUint32(e,h),c}function c(b){var c=b.offset,d=f.fromStream(b),g=d.getSize(),i=g-(b.offset-c),j=e.create(b,i,"moov"),k=h(d,j);return k.getSize=function(){return 8+j.getChildBoxesSize()},b.offset=c+g,k=h(k,{asStream:function(b){return a(k,b)}})}function d(){return{fromStream:c}}return d()}(),j=function(){function a(a,c,e,f,i,j,k,l,m){function n(){return 1===a?b.ValueField.create64(c):b.ValueField.create32(c)}function o(){return 1===a?b.ValueField.create64(e):b.ValueField.create32(e)}function p(){return f}function q(){return 1===a?b.ValueField.create64(i):b.ValueField.create32(i)}function r(){return j}function s(){return k}function t(){return l}function u(){return m}function v(d){if(!b.isStream(d)){var g=new ArrayBuffer(y.getSize());d={offset:0,bytearray:new DataView(g)}}var h=d.offset;x.asStream(d);var n=d.offset,o=d.bytearray;1===a?(o.setUint32(n,c[0]),n+=4,o.setUint32(n,c[1]),n+=4,o.setUint32(n,e[0]),n+=4,o.setUint32(n,e[1]),n+=4,o.setUint32(n,f),n+=4,o.setUint32(n,i[0]),n+=4,o.setUint32(n,i[1]),n+=4):(o.setUint32(n,c),n+=4,o.setUint32(n,e),n+=4,o.setUint32(n,f),n+=4,o.setUint32(n,i),n+=4),o.setInt32(n,j),n+=4,o.setInt16(n,k),n+=2,o.setInt16(n,0),n+=2,o.setUint32(n,0),n+=4,o.setUint32(n,0),n+=4;for(var p=0;l.length!==p;++p)o.setInt32(n,l[p]),n+=4;for(var q=0;6!==q;++q)o.setInt32(n,0),n+=4;o.setUint32(n,m),n+=4,d.offset=n;var r=n-h;return o.setUint32(h,r),d}var w=12;1===a?w=w+8+8+4+8:w+=16,w+=80;var x=g.create(d,a,0,w);if(null===j&&(j=65536),null===k&&(k=256),null===l&&(l=[65536,0,0,0,65536,0,0,0,1073741824]),1===a){if(!Array.isArray(c))throw new Error("creation_time64 must be string");if(!Array.isArray(e))throw new Error("modification_time64 must be string");if(!Array.isArray(i))throw new Error("duration64 must be string")}var y=h(x,{getCreationTime:n,getModificationTime:o,getTimescale:p,getDuration:q,getRate:r,getVolume:s,getMatrix:t,getNextTrackId:u,asStream:v});return y}function c(b){var c,d,e,f,h,i,j,k,l,m,n,o=(b.offset,g.fromStream(b)),p=b.offset,q=b.bytearray,r=o.getVersion();for(1===r?(c=[],c.push(q.getUint32(p)),p+=4,c.push(q.getUint32(p)),p+=4,d=[],d.push(q.getUint32(p)),p+=4,d.push(q.getUint32(p)),p+=4,e=q.getUint32(p),p+=4,f=[],f.push(q.getUint32(p)),p+=4,f.push(q.getUint32(p)),p+=4):(c=q.getUint32(p),p+=4,d=q.getUint32(p),p+=4,e=q.getUint32(p),p+=4,f=q.getUint32(p),p+=4),h=q.getInt32(p),p+=4,i=q.getInt16(p),p+=2,l=q.getInt16(p),p+=2,m=[],m.push(q.getUint32(p)),p+=4,m.push(q.getUint32(p)),p+=4,j=[];9!==j.length;)j.push(q.getInt32(p)),p+=4;for(n=[];6!==n.length;)n.push(q.getInt32(p)),p+=4;k=q.getUint32(p),p+=4,b.offset=p;var s=a(r,c,d,e,f,h,i,j,k);return s}var d="mvhd";return{create:a,fromStream:c}}();return d()}),define("asteroid/DoviStrip",["module","ensis/logger/logger","ensis/isoreader/boxreader/base","ensis/isoreader/boxreader/trak","ensis/isoreader/boxreader/moov"],function(a,b,c,d,e){"use strict";function f(a){var b=c.createStream(a,0),d=[];try{for(;b.offset<b.bytearray.byteLength;){var e=b.offset,f=c.Box.fromStream(b),g=c.BoxParsers.getParser(f.getType());b.offset=e,f=g.fromStream(b),d.push({type:f.getType(),size:f.getSize(),box:f})}}catch(h){j.error("Caught: ",h)}return j.trace(d),d}function g(a){var b,d,e,g=a,h=f(a),i=h.reduce(function(a,b){return null!==a?a:"moov"===b.type?b.box:null},null),k=i.getChildBoxesByType("trak");return 2===k.count()&&(j.trace("TRAK boxes are at: ",k.position(0)," & ",k.position(1)),i.removeChildBox(k.position(1)),b=new ArrayBuffer(a.byteLength),d=new DataView(b),e=c.createStream(d,0),h.forEach(function(a){a.box.asStream(e)}),g=b.slice(0,e.offset),g=new DataView(g)),g}function h(a){var b=a,c=f(a),d={moof:Number.NaN,mdat:Number.NaN},e={moof:Number.NaN,mdat:Number.NaN};if(c.forEach(function(a,b){"moof"===a.type&&(Number.isNaN(d.moof)?d.moof=b:Number.isNaN(e.moof)?e.moof=b:j.error("Too many MOOF boxes!!")),"mdat"===a.type&&(Number.isNaN(d.mdat)?d.mdat=b:Number.isNaN(e.mdat)?e.mdat=b:j.error("Too many MDAT boxes!!"))}),!Number.isNaN(e.moof)){c.forEach(function(a){a.offset=this.tally,this.tally+=a.size},{tally:0}),j.trace(c);var g=c[e.moof].size+c[e.mdat].size,h=new Uint8Array(a.byteLength-g),i=a.buffer;c.forEach(function(a,b){if(-1===this.skip.indexOf(b)){var c=new Uint8Array(i.slice(a.offset,a.offset+a.size));h.set(c,this.pos),this.pos+=c.byteLength}},{pos:0,skip:[e.moof,e.mdat]}),b=new DataView(h.buffer)}return b}function i(){return!1}var j=b.create("DoviStrip");return d.registerParsers(),e.registerParsers(),{isStripEnabled:i,findBoxes:f,doFragStrip:h,doTrackOff:g}}),define("asteroid/util",["ensis/data/uri","ensis/async/async2"],function(a,b){function c(a){"?"===a[0]&&(a=a.substr(1));var b=a.split("&"),c={};return b.forEach(function(a){var b=a.split("=",2);if("undefined"==typeof c[b[0]])c[b[0]]=b[1];else if(Array.isArray(c[b[0]]))c[b[0]].push(b[1]);else{var d=[c[b[0]],b[1]];c[b[0]]=d}}),c}function d(){function a(){function a(){null!==e&&(e=null),window.parent&&window.parent.window&&window.parent.window.Asteroid&&window.parent.window.Asteroid.ready?c.onComplete(window.parent.window):(0===d?c.onComplete(b.ResultError("No AUX reference found")):e=setTimeout(a,100),--d)}var c=b.Deferred(),d=10,e=null,f=c.cancel;return c.cancel=function(){null!==e&&(clearTimeout(e),e=null,f.call(c))},c.execute(a),c}var c=b.Deferred(),d=c.cancel;c.cancel=function(){try{null!==e&&e.cancel()}catch(a){}d.call(c)};var e=null;return c.execute(function(){e=a(),e.then(function(a){c.onComplete(a)})["catch"](function(){c.onComplete(null)})}),c}return{uri:a,parseLaunchParams:c,findAuxWindow:d}}),function(){"use strict";function a(b){window.removeEventListener("message",a),c={source:b.source,data:b.data},Asteroid.ready&&(window.dispatchEvent(new CustomEvent("com.vudu.asteroid.deferredhostmessage",{detail:c})),c=null)}function b(){window.removeEventListener(Asteroid.ReadyEvent,b),c&&(window.dispatchEvent(new CustomEvent("com.vudu.asteroid.deferredhostmessage",{detail:c})),c=null)}var c;window.addEventListener("message",a),window.addEventListener(Asteroid.ReadyEvent,b)}(),require(["ensis/logger/logger","ensis/logger/logclient","ensis/lang/object","ensis/lang/arguments","ensis/dash/initdatacache","asteroid/target/target","asteroid/target/fills","asteroid/target/features","asteroid/target/controls","asteroid/target/buffercontrol","asteroid/target/modules","asteroid/vuduplayer","asteroid/DoviStrip","asteroid/util","asteroid/VbrUtil","asteroid/config","asteroid/buildinfo"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";function r(a){return D[a]}function s(){Asteroid.isPlayerWindow=!0,Asteroid.ready=!1,Asteroid.Features.init(function(){y.log("Asteroid ready and configured for ",f.target),t()}),l(u),u.Player&&"function"==typeof u.Player.reportNetLogs&&a.setDefaultClient(A)}function t(){Asteroid.ready=!0;var a=new CustomEvent(Asteroid.ReadyEvent);window.dispatchEvent(a)}var u={},v={};if("string"==typeof document.location.search&&(v=n.parseLaunchParams(document.location.search)),"undefined"!=typeof v.defaultLogLevel){var w=v.defaultLogLevel;if("string"==typeof w){var x=-1!==["trace","log","warn","error"].indexOf(w);x&&a.setDefaultLogLevel(w)}}var y=a.create("Asteroid");y.log("Asteroid Build: ",q),window.onerror=function(a,b,c,d){var e=!1;try{y.error("Global error handler caught from: ",b,"@",c,":",d," -- ",a),e="pallas"===Asteroid.getTarget()}catch(f){}return e},y.trace("Started with launch params of: ",v);var z,A=b.createAbstractClient();A.report=function(a,b){z&&r(a)&&z.report(a,b),u.Player.reportNetLogs(a,b)};var B=[b.Level.error,b.Level.warn,b.Level.log,b.Level.trace],C=p.getLocalLoggingLevel(),D={};if("undefined"!=typeof C){var E=B.indexOf(C);-1!==E&&(B.forEach(function(a,b){D[a]=E>=b}),z=b.getConsoleClient(),y.trace("Map of enabled log levels: ",B))}var F=function(a){function b(b){return"undefined"==typeof a[b]&&y.warn("No module loaded for: ",b,"; in target: ",f.target),a[b]}return{get:b}}({Controls:i,Features:h});f.get=F.get,Asteroid.Features=h,Asteroid.Controls=i,Asteroid.BufferControl=j,Asteroid.InitDataCache=e,Asteroid.DoviStrip=m,Asteroid.Util=n,Asteroid.getTarget=function(){return f.target},Asteroid.Fills={get:function(a){return g[a]}},Asteroid.Modules={get:function(a){return k[a]}},Asteroid.getLaunchParameter=function(a){return v[a]},function(){var b=a.create("FIDO");Asteroid.LabLog=function(){b.log.apply(b,d.toArray(arguments))}}(),Asteroid.Vbr={getSidxAudioBitrates:o.getInstantaneousAudioBitrates,getSidxVideoBitrates:o.getInstantaneousVideoBitrates,addListener:o.addListener,removeListener:o.removeListener,Events:o.Events},s()}),define("src/asteroid/EnsisAsteroidLoader.js",function(){});
//# sourceMappingURL=asteroid.all.js.map