var $jscomp=$jscomp||{};$jscomp.scope={},$jscomp.ASSUME_ES5=!1,$jscomp.ASSUME_NO_NATIVE_MAP=!1,$jscomp.ASSUME_NO_NATIVE_SET=!1,$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)},$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a},$jscomp.global=$jscomp.getGlobal(this),$jscomp.SYMBOL_PREFIX="jscomp_symbol_",$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){},$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)},$jscomp.Symbol=function(){var a=0;return function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+a++}}(),$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator")),"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}}),$jscomp.initSymbolIterator=function(){}},$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})},$jscomp.iteratorPrototype=function(a){return $jscomp.initSymbolIterator(),a={next:a},a[$jscomp.global.Symbol.iterator]=function(){return this},a},$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)},$jscomp.polyfill=function(a,b,c,d){if(b){for(c=$jscomp.global,a=a.split("."),d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={}),c=c[e]}a=a[a.length-1],d=c[a],b=b(d),b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}},$jscomp.FORCE_POLYFILL_PROMISE=!1,$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function c(a){return a instanceof e?a:new e(function(b,c){b(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){return null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_()),this.batch_.push(a),this},b.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var d=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){d(a,0)},b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];a[b]=null;try{c()}catch(d){this.asyncThrow_(d)}}}this.batch_=null},b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a})};var e=function(a){this.state_=0,this.result_=void 0,this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(c){b.reject(c)}};e.prototype.createResolveAndReject_=function(){function a(a){return function(d){c||(c=!0,a.call(b,d))}}var b=this,c=!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}},e.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof e)this.settleSameAsPromise_(a);else{a:switch(typeof a){case"object":var b=null!=a;break a;case"function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}},e.prototype.resolveToNonPromiseObj_=function(a){var b=void 0;try{b=a.then}catch(c){return void this.reject_(c)}"function"==typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)},e.prototype.reject_=function(a){this.settle_(2,a)},e.prototype.fulfill_=function(a){this.settle_(1,a)},e.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.state_);this.state_=a,this.result_=b,this.executeOnSettledCallbacks_()},e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=0;a<this.onSettledCallbacks_.length;++a)f.asyncExecute(this.onSettledCallbacks_[a]);this.onSettledCallbacks_=null}};var f=new b;return e.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)},e.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(d){c.reject(d)}},e.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{d(a(b))}catch(c){f(c)}}:b}var d,f,g=new e(function(a,b){d=a,f=b});return this.callWhenSettled_(c(a,d),c(b,f)),g},e.prototype["catch"]=function(a){return this.then(void 0,a)},e.prototype.callWhenSettled_=function(a,b){function c(){switch(d.state_){case 1:a(d.result_);break;case 2:b(d.result_);break;default:throw Error("Unexpected state: "+d.state_)}}var d=this;null==this.onSettledCallbacks_?f.asyncExecute(c):this.onSettledCallbacks_.push(c)},e.resolve=c,e.reject=function(a){return new e(function(b,c){c(a)})},e.race=function(a){return new e(function(b,d){for(var e=$jscomp.makeIterator(a),f=e.next();!f.done;f=e.next())c(f.value).callWhenSettled_(b,d)})},e.all=function(a){var b=$jscomp.makeIterator(a),d=b.next();return d.done?c([]):new e(function(a,e){function f(b){return function(c){g[b]=c,h--,0==h&&a(g)}}var g=[],h=0;do g.push(void 0),h++,c(d.value).callWhenSettled_(f(g.length-1),e),d=b.next();while(!d.done)})},e},"es6","es3"),$jscomp.polyfill("Promise.prototype.finally",function(a){return a?a:function(a){return this.then(function(b){return Promise.resolve(a()).then(function(){return b})},function(b){return Promise.resolve(a()).then(function(){throw b})})}},"es8","es3"),$jscomp.asyncExecutePromiseGenerator=function(a){function b(b){return a.next(b)}function c(b){return a["throw"](b)}return new Promise(function(d,e){function f(a){a.done?d(a.value):Promise.resolve(a.value).then(b,c).then(f,e)}f(a.next())})},$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())},$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(a){var b=function(){};return b.prototype=a,new b},$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1},$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){if(a.__proto__=b,a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null,$jscomp.inherits=function(a,b){if(a.prototype=$jscomp.objectCreate(b.prototype),a.prototype.constructor=a,$jscomp.setPrototypeOf){var c=$jscomp.setPrototypeOf;c(a,b)}else for(c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.superClass_=b.prototype},$jscomp.generator={},$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object")},$jscomp.generator.Context=function(){this.isRunning_=!1,this.yieldAllIterator_=null,this.yieldResult=void 0,this.nextAddress=1,this.finallyAddress_=this.catchAddress_=0,this.finallyContexts_=this.abruptCompletion_=null},$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0},$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1},$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_},$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a},$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0},this.jumpToErrorHandler_()},$jscomp.generator.Context.prototype["return"]=function(a){this.abruptCompletion_={"return":a},this.nextAddress=this.finallyAddress_},$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a},this.nextAddress=this.finallyAddress_},$jscomp.generator.Context.prototype["yield"]=function(a,b){return this.nextAddress=b,{value:a}},$jscomp.generator.Context.prototype.yieldAll=function(a,b){var c=$jscomp.makeIterator(a),d=c.next();return $jscomp.generator.ensureIteratorResultIsObject_(d),d.done?(this.yieldResult=d.value,void(this.nextAddress=b)):(this.yieldAllIterator_=c,this["yield"](d.value,b))},$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a},$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0},$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a,void 0!=b&&(this.finallyAddress_=b)},$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0,this.finallyAddress_=a||0},$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a,this.catchAddress_=b||0},$jscomp.generator.Context.prototype.enterCatchBlock=function(a){return this.catchAddress_=a||0,a=this.abruptCompletion_.exception,this.abruptCompletion_=null,a},$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_],this.catchAddress_=a||0,this.finallyAddress_=b||0},$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){var c=this.finallyContexts_.splice(b||0)[0];if(c=this.abruptCompletion_=this.abruptCompletion_||c){if(c.isException)return this.jumpToErrorHandler_();void 0!=c.jumpTo&&this.finallyAddress_<c.jumpTo?(this.nextAddress=c.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a},$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)},$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a,this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()},$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null},$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context,this.program_=a},$jscomp.generator.Engine_.prototype.next_=function(a){return this.context_.start_(),this.context_.yieldAllIterator_?this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_):(this.context_.next_(a),this.nextStep_())},$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;return b?this.yieldAllStep_("return"in b?b["return"]:function(a){return{value:a,done:!0}},a,this.context_["return"]):(this.context_["return"](a),this.nextStep_())},$jscomp.generator.Engine_.prototype.throw_=function(a){return this.context_.start_(),this.context_.yieldAllIterator_?this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_):(this.context_.throw_(a),this.nextStep_())},$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,c){try{var d=a.call(this.context_.yieldAllIterator_,b);if($jscomp.generator.ensureIteratorResultIsObject_(d),!d.done)return this.context_.stop_(),d;var e=d.value}catch(f){return this.context_.yieldAllIterator_=null,this.context_.throw_(f),this.nextStep_()}return this.context_.yieldAllIterator_=null,c.call(this.context_,e),this.nextStep_()},$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}if(this.context_.stop_(),this.context_.abruptCompletion_){if(a=this.context_.abruptCompletion_,this.context_.abruptCompletion_=null,a.isException)throw a.exception;return{value:a["return"],done:!0}}return{value:void 0,done:!0}},$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)},this["throw"]=function(b){return a.throw_(b)},this["return"]=function(b){return a.return_(b)},$jscomp.initSymbolIterator(),this[Symbol.iterator]=function(){return this}},$jscomp.generator.createGenerator=function(a,b){return $jscomp.generator.Generator_.prototype=a.prototype,new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b))},$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c},$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))},$jscomp.checkEs6ConformanceViaProxy=function(){try{var a={},b=Object.create(new $jscomp.global.Proxy(a,{get:function(c,d,e){return c==a&&"q"==d&&e==b}}));return!0===b.q}catch(c){return!1}},$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1,$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy(),$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},$jscomp.polyfill("WeakMap",function(a){function b(){if(!a||!Object.seal)return!1;try{var b=Object.seal({}),c=Object.seal({}),d=new a([[b,2],[c,3]]);return 2==d.get(b)&&3==d.get(c)&&(d["delete"](b),d.set(c,4),!d.has(b)&&4==d.get(c))}catch(e){return!1}}function c(a){$jscomp.owns(a,e)||$jscomp.defineProperty(a,e,{value:{}})}function d(a){var b=Object[a];b&&(Object[a]=function(a){return c(a),b(a)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var e="$jscomp_hidden_"+Math.random();d("freeze"),d("preventExtensions"),d("seal");var f=0,g=function(a){if(this.id_=(f+=Math.random()+1).toString(),a){$jscomp.initSymbol(),$jscomp.initSymbolIterator(),a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};return g.prototype.set=function(a,b){if(c(a),!$jscomp.owns(a,e))throw Error("WeakMap key fail: "+a);return a[e][this.id_]=b,this},g.prototype.get=function(a){return $jscomp.owns(a,e)?a[e][this.id_]:void 0},g.prototype.has=function(a){return $jscomp.owns(a,e)&&$jscomp.owns(a[e],this.id_)},g.prototype["delete"]=function(a){return!(!$jscomp.owns(a,e)||!$jscomp.owns(a[e],this.id_))&&delete a[e][this.id_]},g},"es6","es3"),$jscomp.MapEntry=function(){},$jscomp.polyfill("Map",function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_MAP||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),c=new a($jscomp.makeIterator([[b,"s"]]));if("s"!=c.get(b)||1!=c.size||c.get({x:4})||c.set({x:4},"t")!=c||2!=c.size)return!1;var d=c.entries(),e=d.next();return!e.done&&e.value[0]==b&&"s"==e.value[1]&&(e=d.next(),!(e.done||4!=e.value[0].x||"t"!=e.value[1]||!d.next().done))}catch(f){return!1}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;$jscomp.initSymbol(),$jscomp.initSymbolIterator();var c=new WeakMap,d=function(a){if(this.data_={},this.head_=g(),this.size=0,a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};d.prototype.set=function(a,b){var c=e(this,a);return c.list||(c.list=this.data_[c.id]=[]),c.entry?c.entry.value=b:(c.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,value:b},c.list.push(c.entry),this.head_.previous.next=c.entry,this.head_.previous=c.entry,this.size++),this},d.prototype["delete"]=function(a){return a=e(this,a),!(!a.entry||!a.list)&&(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0)},d.prototype.clear=function(){this.data_={},this.head_=this.head_.previous=g(),this.size=0},d.prototype.has=function(a){return!!e(this,a).entry},d.prototype.get=function(a){return(a=e(this,a).entry)&&a.value},d.prototype.entries=function(){return f(this,function(a){return[a.key,a.value]})},d.prototype.keys=function(){return f(this,function(a){return a.key})},d.prototype.values=function(){return f(this,function(a){return a.value})},d.prototype.forEach=function(a,b){for(var c,d=this.entries();!(c=d.next()).done;)c=c.value,a.call(b,c[1],c[0],this)},d.prototype[Symbol.iterator]=d.prototype.entries;var e=function(a,b){var d=b&&typeof b;"object"==d||"function"==d?c.has(b)?d=c.get(b):(d=""+ ++h,c.set(b,d)):d="p_"+b;var e=a.data_[d];if(e&&$jscomp.owns(a.data_,d))for(var f=0;f<e.length;f++){var g=e[f];if(b!==b&&g.key!==g.key||b===g.key)return{id:d,list:e,index:f,entry:g}}return{id:d,list:e,index:-1,entry:void 0}},f=function(a,b){var c=a.head_;return $jscomp.iteratorPrototype(function(){if(c){for(;c.head!=a.head_;)c=c.previous;for(;c.next!=c.head;)return c=c.next,{done:!1,value:b(c)};c=null}return{done:!0,value:void 0}})},g=function(){var a={};return a.previous=a.next=a.head=a},h=0;return d},"es6","es3"),$jscomp.polyfill("Set",function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_SET||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),c=new a($jscomp.makeIterator([b]));if(!c.has(b)||1!=c.size||c.add(b)!=c||1!=c.size||c.add({x:4})!=c||2!=c.size)return!1;var d=c.entries(),e=d.next();return!e.done&&e.value[0]==b&&e.value[1]==b&&(e=d.next(),!e.done&&e.value[0]!=b&&4==e.value[0].x&&e.value[1]==e.value[0]&&d.next().done)}catch(f){return!1}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;$jscomp.initSymbol(),$jscomp.initSymbolIterator();var c=function(a){if(this.map_=new Map,a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)this.add(b.value)}this.size=this.map_.size};return c.prototype.add=function(a){return this.map_.set(a,a),this.size=this.map_.size,this},c.prototype["delete"]=function(a){return a=this.map_["delete"](a),this.size=this.map_.size,a},c.prototype.clear=function(){this.map_.clear(),this.size=0},c.prototype.has=function(a){return this.map_.has(a)},c.prototype.entries=function(){return this.map_.entries()},c.prototype.values=function(){return this.map_.values()},c.prototype.keys=c.prototype.values,c.prototype[Symbol.iterator]=c.prototype.values,c.prototype.forEach=function(a,b){var c=this;this.map_.forEach(function(d){return a.call(b,d,d,c)})},c},"es6","es3"),$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}},$jscomp.polyfill("Array.prototype.findIndex",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).i}},"es6","es3"),$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator(),a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}return d.next=function(){return{done:!0,value:void 0}},d.next()}};return d[Symbol.iterator]=function(){return d},d},$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3"),$jscomp.polyfill("Object.is",function(a){return a?a:function(a,b){return a===b?0!==a||1/a===1/b:a!==a&&b!==b}},"es6","es3"),$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,b){var c=this;c instanceof String&&(c=String(c));var d=c.length,e=b||0;for(0>e&&(e=Math.max(e+d,0));e<d;e++){var f=c[e];if(f===a||Object.is(f,a))return!0}return!1}},"es7","es3"),$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""},$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,b){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,b||0)}},"es6","es3"),$jscomp.polyfill("Array.from",function(a){return a?a:function(a,b,c){$jscomp.initSymbolIterator(),b=null!=b?b:function(a){return a};var d=[],e=a[Symbol.iterator];if("function"==typeof e)for(a=e.call(a);!(e=a.next()).done;)d.push(b.call(c,e.value));else{e=a.length;for(var f=0;f<e;f++)d.push(b.call(c,a[f]))}return d}},"es6","es3"),$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(a,b){var c=$jscomp.checkStringArgs(this,a,"startsWith");a+="";for(var d=c.length,e=a.length,f=Math.max(0,Math.min(0|b,c.length)),g=0;g<e&&f<d;)if(c[f++]!=a[g++])return!1;return g>=e}},"es6","es3"),$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6","es3");var COMPILED=!0,goog=goog||{};goog.global=this,goog.isDef=function(a){return void 0!==a},goog.exportPath_=function(a,b,c){a=a.split("."),c=c||goog.global,a[0]in c||!c.execScript||c.execScript("var "+a[0]);for(var d;a.length&&(d=a.shift());)!a.length&&goog.isDef(b)?c[d]=b:c=c[d]?c[d]:c[d]={}},goog.define=function(a,b){var c=b;COMPILED||(goog.global.CLOSURE_UNCOMPILED_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_UNCOMPILED_DEFINES,a)?c=goog.global.CLOSURE_UNCOMPILED_DEFINES[a]:goog.global.CLOSURE_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_DEFINES,a)&&(c=goog.global.CLOSURE_DEFINES[a])),goog.exportPath_(a,c)},goog.DEBUG=!0,goog.LOCALE="en",goog.TRUSTED_SITE=!0,goog.STRICT_MODE_COMPATIBLE=!0,goog.provide=function(a){if(!COMPILED){if(goog.isProvided_(a))throw Error('Namespace "'+a+'" already declared.');delete goog.implicitNamespaces_[a];for(var b=a;(b=b.substring(0,b.lastIndexOf(".")))&&!goog.getObjectByName(b);)goog.implicitNamespaces_[b]=!0}goog.exportPath_(a)},goog.forwardDeclare=function(a){},COMPILED||(goog.isProvided_=function(a){return!goog.implicitNamespaces_[a]&&goog.isDefAndNotNull(goog.getObjectByName(a))},goog.implicitNamespaces_={}),goog.getObjectByName=function(a,b){for(var c,d=a.split("."),e=b||goog.global;c=d.shift();){if(!goog.isDefAndNotNull(e[c]))return null;e=e[c]}return e},goog.globalize=function(a,b){b=b||goog.global;for(var c in a)b[c]=a[c]},goog.addDependency=function(a,b,c){if(goog.DEPENDENCIES_ENABLED){var d;a=a.replace(/\\/g,"/");for(var e=goog.dependencies_,f=0;d=b[f];f++)e.nameToPath[d]=a;for(d=0;b=c[d];d++)a in e.requires||(e.requires[a]={}),e.requires[a][b]=!0}},goog.ENABLE_DEBUG_LOADER=!1,goog.logToConsole_=function(a){goog.global.console&&goog.global.console.error(a)},goog.require=function(a){if(!COMPILED){if(goog.isProvided_(a))return null;if(goog.ENABLE_DEBUG_LOADER){var b=goog.getPathFromDeps_(a);if(b)return goog.included_[b]=!0,goog.writeScripts_(),null}throw a="goog.require could not find: "+a,goog.logToConsole_(a),Error(a)}},goog.basePath="",goog.global.CLOSURE_NO_DEPS=!0,goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER,goog.DEPENDENCIES_ENABLED&&(goog.included_={},goog.dependencies_={nameToPath:{},requires:{},visited:{},written:{}},goog.inHtmlDocument_=function(){var a=goog.global.document;return"undefined"!=typeof a&&"write"in a},goog.findBasePath_=function(){if(goog.global.CLOSURE_BASE_PATH)goog.basePath=goog.global.CLOSURE_BASE_PATH;else if(goog.inHtmlDocument_())for(var a=goog.global.document.getElementsByTagName("script"),b=a.length-1;0<=b;--b){var c=a[b].src,d=c.lastIndexOf("?");if(d=-1==d?c.length:d,"base.js"==c.substr(d-7,7)){goog.basePath=c.substr(0,d-7);break}}},goog.importScript_=function(a,b){(goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_)(a,b)&&(goog.dependencies_.written[a]=!0)},goog.writeScriptTag_=function(a,b){if(goog.inHtmlDocument_()){var c=goog.global.document;if("complete"==c.readyState){if(/\bdeps.js$/.test(a))return!1;throw Error('Cannot write "'+a+'" after document load')}return void 0===b?c.write('<script type="text/javascript" src="'+a+'"></script>'):c.write('<script type="text/javascript">'+b+"</script>"),!0}return!1},goog.writeScripts_=function(){function a(e){if(!(e in d.written)){if(!(e in d.visited)&&(d.visited[e]=!0,e in d.requires))for(var f in d.requires[e])if(!goog.isProvided_(f)){if(!(f in d.nameToPath))throw Error("Undefined nameToPath for "+f);a(d.nameToPath[f])}e in c||(c[e]=!0,b.push(e))}}var b=[],c={},d=goog.dependencies_;for(f in goog.included_)d.written[f]||a(f);for(var e=0;e<b.length;e++){var f=b[e];goog.dependencies_.written[f]=!0}for(e=0;e<b.length;e++)(f=b[e])&&goog.importScript_(goog.basePath+f)},goog.getPathFromDeps_=function(a){return a in goog.dependencies_.nameToPath?goog.dependencies_.nameToPath[a]:null},goog.findBasePath_(),goog.global.CLOSURE_NO_DEPS||goog.importScript_(goog.basePath+"deps.js")),goog.isDefAndNotNull=function(a){return null!=a},goog.isString=function(a){return"string"==typeof a},goog.exportSymbol=function(a,b,c){goog.exportPath_(a,b,c)},goog.exportProperty=function(a,b,c){a[b]=c},goog.inherits=function(a,b){function c(){}c.prototype=b.prototype,a.superClass_=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.base=function(a,c,d){var e=Array.prototype.slice.call(arguments,2);return b.prototype[c].apply(a,e)}},COMPILED||(goog.global.COMPILED=COMPILED),goog.asserts={},goog.asserts.ENABLE_ASSERTS=!0,goog.asserts.assert=function(){},goog.asserts.patchAssert_=function(){var a=console.assert;a?a.bind||(console.assert=function(){a.apply(console,arguments)}):console.assert=function(){}},goog.asserts.ENABLE_ASSERTS&&(goog.asserts.patchAssert_(),goog.asserts.assert=console.assert.bind(console));var shaka={abr:{}};shaka.abr.Ewma=function(a){goog.asserts.assert(0<a,"expected halfLife to be positive"),this.alpha_=Math.exp(Math.log(.5)/a),this.totalWeight_=this.estimate_=0},shaka.abr.Ewma.prototype.sample=function(a,b){var c=Math.pow(this.alpha_,a);c=b*(1-c)+c*this.estimate_,isNaN(c)||(this.estimate_=c,this.totalWeight_+=a)},shaka.abr.Ewma.prototype.getEstimate=function(){return this.estimate_/(1-Math.pow(this.alpha_,this.totalWeight_))},shaka.abr.EwmaBandwidthEstimator=function(){this.fast_=new shaka.abr.Ewma(2),this.slow_=new shaka.abr.Ewma(5),this.bytesSampled_=0,this.minTotalBytes_=128e3,this.minBytes_=16e3},shaka.abr.EwmaBandwidthEstimator.prototype.sample=function(a,b){if(!(b<this.minBytes_)){var c=8e3*b/a,d=a/1e3;this.bytesSampled_+=b,this.fast_.sample(d,c),this.slow_.sample(d,c)}},shaka.abr.EwmaBandwidthEstimator.prototype.getBandwidthEstimate=function(a){return this.bytesSampled_<this.minTotalBytes_?a:Math.min(this.fast_.getEstimate(),this.slow_.getEstimate())},shaka.abr.EwmaBandwidthEstimator.prototype.hasGoodEstimate=function(){return this.bytesSampled_>=this.minTotalBytes_},shaka.log={},shaka.log.Level={NONE:0,ERROR:1,WARNING:2,INFO:3,DEBUG:4,V1:5,V2:6},shaka.log.MAX_LOG_LEVEL=4,shaka.log.alwaysError=function(){},shaka.log.alwaysWarn=function(){},shaka.log.error=function(){},shaka.log.warning=function(){},shaka.log.info=function(){},shaka.log.debug=function(){},shaka.log.v1=function(){},shaka.log.v2=function(){},window.console&&window.console.log.bind&&(shaka.log.alwaysWarn=console.warn.bind(console),shaka.log.alwaysError=console.error.bind(console),goog.DEBUG?(shaka.log.setLevel=function(a){var b=function(){},c=shaka.log,d=shaka.log.Level;shaka.log.currentLevel=a,c.error=a>=d.ERROR?console.error.bind(console):b,c.warning=a>=d.WARNING?console.warn.bind(console):b,c.info=a>=d.INFO?console.info.bind(console):b,c.debug=a>=d.DEBUG?console.log.bind(console):b,c.v1=a>=d.V1?console.debug.bind(console):b,c.v2=a>=d.V2?console.debug.bind(console):b},shaka.log.setLevel(shaka.log.MAX_LOG_LEVEL)):(shaka.log.MAX_LOG_LEVEL>=shaka.log.Level.ERROR&&(shaka.log.error=console.error.bind(console)),shaka.log.MAX_LOG_LEVEL>=shaka.log.Level.WARNING&&(shaka.log.warning=console.warn.bind(console)),shaka.log.MAX_LOG_LEVEL>=shaka.log.Level.INFO&&(shaka.log.info=console.info.bind(console)),shaka.log.MAX_LOG_LEVEL>=shaka.log.Level.DEBUG&&(shaka.log.debug=console.log.bind(console)),shaka.log.MAX_LOG_LEVEL>=shaka.log.Level.V1&&(shaka.log.v1=console.debug.bind(console)),shaka.log.MAX_LOG_LEVEL>=shaka.log.Level.V2&&(shaka.log.v2=console.debug.bind(console)))),goog.uri={},goog.uri.utils={},goog.uri.utils.splitRe_=/^(?:([^:\/?#.]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/#?]*?)(?::([0-9]+))?(?=[\/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/,goog.uri.utils.ComponentIndex={SCHEME:1,USER_INFO:2,DOMAIN:3,PORT:4,PATH:5,QUERY_DATA:6,FRAGMENT:7},goog.uri.utils.split=function(a){return a.match(goog.uri.utils.splitRe_)},goog.Uri=function(a){var b;a instanceof goog.Uri?(this.setScheme(a.getScheme()),this.setUserInfo(a.getUserInfo()),this.setDomain(a.getDomain()),this.setPort(a.getPort()),this.setPath(a.getPath()),this.setQueryData(a.getQueryData().clone()),this.setFragment(a.getFragment())):a&&(b=goog.uri.utils.split(String(a)))?(this.setScheme(b[goog.uri.utils.ComponentIndex.SCHEME]||"",!0),this.setUserInfo(b[goog.uri.utils.ComponentIndex.USER_INFO]||"",!0),this.setDomain(b[goog.uri.utils.ComponentIndex.DOMAIN]||"",!0),this.setPort(b[goog.uri.utils.ComponentIndex.PORT]),this.setPath(b[goog.uri.utils.ComponentIndex.PATH]||"",!0),this.setQueryData(b[goog.uri.utils.ComponentIndex.QUERY_DATA]||"",!0),this.setFragment(b[goog.uri.utils.ComponentIndex.FRAGMENT]||"",!0)):this.queryData_=new goog.Uri.QueryData(null,null)},goog.Uri.prototype.scheme_="",goog.Uri.prototype.userInfo_="",goog.Uri.prototype.domain_="",goog.Uri.prototype.port_=null,goog.Uri.prototype.path_="",goog.Uri.prototype.fragment_="",goog.Uri.prototype.toString=function(){var a=[],b=this.getScheme();if(b&&a.push(goog.Uri.encodeSpecialChars_(b,goog.Uri.reDisallowedInSchemeOrUserInfo_,!0),":"),b=this.getDomain()){a.push("//");var c=this.getUserInfo();c&&a.push(goog.Uri.encodeSpecialChars_(c,goog.Uri.reDisallowedInSchemeOrUserInfo_,!0),"@"),a.push(goog.Uri.removeDoubleEncoding_(encodeURIComponent(b))),b=this.getPort(),null!=b&&a.push(":",String(b))}return(b=this.getPath())&&(this.hasDomain()&&"/"!=b.charAt(0)&&a.push("/"),a.push(goog.Uri.encodeSpecialChars_(b,"/"==b.charAt(0)?goog.Uri.reDisallowedInAbsolutePath_:goog.Uri.reDisallowedInRelativePath_,!0))),(b=this.getEncodedQuery())&&a.push("?",b),(b=this.getFragment())&&a.push("#",goog.Uri.encodeSpecialChars_(b,goog.Uri.reDisallowedInFragment_)),a.join("")},goog.Uri.prototype.resolve=function(a){var b=this.clone();"data"===b.scheme_&&(b=new goog.Uri);var c=a.hasScheme();c?b.setScheme(a.getScheme()):c=a.hasUserInfo(),c?b.setUserInfo(a.getUserInfo()):c=a.hasDomain(),c?b.setDomain(a.getDomain()):c=a.hasPort();var d=a.getPath();if(c)b.setPort(a.getPort());else if(c=a.hasPath()){if("/"!=d.charAt(0))if(this.hasDomain()&&!this.hasPath())d="/"+d;else{var e=b.getPath().lastIndexOf("/");-1!=e&&(d=b.getPath().substr(0,e+1)+d)}d=goog.Uri.removeDotSegments(d)}return c?b.setPath(d):c=a.hasQuery(),c?b.setQueryData(a.getQueryData().clone()):c=a.hasFragment(),c&&b.setFragment(a.getFragment()),b},goog.Uri.prototype.clone=function(){return new goog.Uri(this)},goog.Uri.prototype.getScheme=function(){return this.scheme_},goog.Uri.prototype.setScheme=function(a,b){return(this.scheme_=b?goog.Uri.decodeOrEmpty_(a,!0):a)&&(this.scheme_=this.scheme_.replace(/:$/,"")),this},goog.Uri.prototype.hasScheme=function(){return!!this.scheme_},goog.Uri.prototype.getUserInfo=function(){return this.userInfo_},goog.Uri.prototype.setUserInfo=function(a,b){return this.userInfo_=b?goog.Uri.decodeOrEmpty_(a):a,this},goog.Uri.prototype.hasUserInfo=function(){return!!this.userInfo_},goog.Uri.prototype.getDomain=function(){return this.domain_},goog.Uri.prototype.setDomain=function(a,b){return this.domain_=b?goog.Uri.decodeOrEmpty_(a,!0):a,this},goog.Uri.prototype.hasDomain=function(){return!!this.domain_},goog.Uri.prototype.getPort=function(){return this.port_},goog.Uri.prototype.setPort=function(a){if(a){if(a=Number(a),isNaN(a)||0>a)throw Error("Bad port number "+a);this.port_=a}else this.port_=null;return this},goog.Uri.prototype.hasPort=function(){return null!=this.port_},goog.Uri.prototype.getPath=function(){return this.path_},goog.Uri.prototype.setPath=function(a,b){return this.path_=b?goog.Uri.decodeOrEmpty_(a,!0):a,this},goog.Uri.prototype.hasPath=function(){return!!this.path_},goog.Uri.prototype.hasQuery=function(){return""!==this.queryData_.toString()},goog.Uri.prototype.setQueryData=function(a,b){return a instanceof goog.Uri.QueryData?this.queryData_=a:(b||(a=goog.Uri.encodeSpecialChars_(a,goog.Uri.reDisallowedInQuery_)),
this.queryData_=new goog.Uri.QueryData(a,null)),this},goog.Uri.prototype.getEncodedQuery=function(){return this.queryData_.toString()},goog.Uri.prototype.getDecodedQuery=function(){return this.queryData_.toDecodedString()},goog.Uri.prototype.getQueryData=function(){return this.queryData_},goog.Uri.prototype.getFragment=function(){return this.fragment_},goog.Uri.prototype.setFragment=function(a,b){return this.fragment_=b?goog.Uri.decodeOrEmpty_(a):a,this},goog.Uri.prototype.hasFragment=function(){return!!this.fragment_},goog.Uri.removeDotSegments=function(a){if(".."==a||"."==a)return"";if(-1==a.indexOf("./")&&-1==a.indexOf("/."))return a;var b=0==a.lastIndexOf("/",0);a=a.split("/");for(var c=[],d=0;d<a.length;){var e=a[d++];"."==e?b&&d==a.length&&c.push(""):".."==e?((1<c.length||1==c.length&&""!=c[0])&&c.pop(),b&&d==a.length&&c.push("")):(c.push(e),b=!0)}return c.join("/")},goog.Uri.decodeOrEmpty_=function(a,b){return a?b?decodeURI(a):decodeURIComponent(a):""},goog.Uri.encodeSpecialChars_=function(a,b,c){return goog.isString(a)?(a=encodeURI(a).replace(b,goog.Uri.encodeChar_),c&&(a=goog.Uri.removeDoubleEncoding_(a)),a):null},goog.Uri.encodeChar_=function(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(15&a).toString(16)},goog.Uri.removeDoubleEncoding_=function(a){return a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")},goog.Uri.reDisallowedInSchemeOrUserInfo_=/[#\/\?@]/g,goog.Uri.reDisallowedInRelativePath_=/[#\?:]/g,goog.Uri.reDisallowedInAbsolutePath_=/[#\?]/g,goog.Uri.reDisallowedInQuery_=/[#\?@]/g,goog.Uri.reDisallowedInFragment_=/#/g,goog.Uri.QueryData=function(a,b){this.encodedQuery_=a||null},goog.Uri.QueryData.prototype.ensureKeyMapInitialized_=function(){if(!this.keyMap_&&(this.keyMap_={},this.count_=0,this.encodedQuery_))for(var a=this.encodedQuery_.split("&"),b=0;b<a.length;b++){var c=a[b].indexOf("="),d=null;if(0<=c){var e=a[b].substring(0,c);d=a[b].substring(c+1)}else e=a[b];e=decodeURIComponent(e.replace(/\+/g," ")),d=d||"",this.add(e,decodeURIComponent(d.replace(/\+/g," ")))}},goog.Uri.QueryData.prototype.keyMap_=null,goog.Uri.QueryData.prototype.count_=null,goog.Uri.QueryData.prototype.getCount=function(){return this.ensureKeyMapInitialized_(),this.count_},goog.Uri.QueryData.prototype.add=function(a,b){this.ensureKeyMapInitialized_(),this.encodedQuery_=null;var c=this.keyMap_.hasOwnProperty(a)&&this.keyMap_[a];return c||(this.keyMap_[a]=c=[]),c.push(b),this.count_++,this},goog.Uri.QueryData.prototype.toString=function(){if(this.encodedQuery_)return this.encodedQuery_;if(!this.keyMap_)return"";var a,b=[];for(a in this.keyMap_)for(var c=encodeURIComponent(a),d=this.keyMap_[a],e=0;e<d.length;e++){var f=c;""!==d[e]&&(f+="="+encodeURIComponent(d[e])),b.push(f)}return this.encodedQuery_=b.join("&")},goog.Uri.QueryData.prototype.toDecodedString=function(){return goog.Uri.decodeOrEmpty_(this.toString())},goog.Uri.QueryData.prototype.clone=function(){var a=new goog.Uri.QueryData;if(a.encodedQuery_=this.encodedQuery_,this.keyMap_){var b,c={};for(b in this.keyMap_)c[b]=this.keyMap_[b].concat();a.keyMap_=c,a.count_=this.count_}return a},shaka.util={},shaka.util.DelayedTick=function(a){this.onTick_=a,this.cancelPending_=null},shaka.util.DelayedTick.prototype.tickAfter=function(a){var b=this;this.stop();var c=!0,d=null;return this.cancelPending_=function(){window.clearTimeout(d),c=!1},d=window.setTimeout(function(){c&&b.onTick_()},1e3*a),this},shaka.util.DelayedTick.prototype.stop=function(){this.cancelPending_&&(this.cancelPending_(),this.cancelPending_=null)},shaka.util.Timer=function(a){this.onTick_=a,this.ticker_=null},goog.exportSymbol("shaka.util.Timer",shaka.util.Timer),shaka.util.Timer.prototype.tickNow=function(){return this.stop(),this.onTick_(),this},goog.exportProperty(shaka.util.Timer.prototype,"tickNow",shaka.util.Timer.prototype.tickNow),shaka.util.Timer.prototype.tickAfter=function(a){var b=this;return this.stop(),this.ticker_=new shaka.util.DelayedTick(function(){b.onTick_()}).tickAfter(a),this},goog.exportProperty(shaka.util.Timer.prototype,"tickAfter",shaka.util.Timer.prototype.tickAfter),shaka.util.Timer.prototype.tickEvery=function(a){var b=this;return this.stop(),this.ticker_=new shaka.util.DelayedTick(function(){b.ticker_.tickAfter(a),b.onTick_()}).tickAfter(a),this},goog.exportProperty(shaka.util.Timer.prototype,"tickEvery",shaka.util.Timer.prototype.tickEvery),shaka.util.Timer.prototype.stop=function(){this.ticker_&&(this.ticker_.stop(),this.ticker_=null)},goog.exportProperty(shaka.util.Timer.prototype,"stop",shaka.util.Timer.prototype.stop),shaka.net={},shaka.net.Backoff=function(a,b){b=void 0!==b&&b;var c=shaka.net.Backoff.defaultRetryParameters();this.maxAttempts_=null==a.maxAttempts?c.maxAttempts:a.maxAttempts,goog.asserts.assert(1<=this.maxAttempts_,"maxAttempts should be >= 1"),this.baseDelay_=null==a.baseDelay?c.baseDelay:a.baseDelay,goog.asserts.assert(0<=this.baseDelay_,"baseDelay should be >= 0"),this.fuzzFactor_=null==a.fuzzFactor?c.fuzzFactor:a.fuzzFactor,goog.asserts.assert(0<=this.fuzzFactor_,"fuzzFactor should be >= 0"),this.backoffFactor_=null==a.backoffFactor?c.backoffFactor:a.backoffFactor,goog.asserts.assert(0<=this.backoffFactor_,"backoffFactor should be >= 0"),this.numAttempts_=0,this.nextUnfuzzedDelay_=this.baseDelay_,(this.autoReset_=b)&&(goog.asserts.assert(2<=this.maxAttempts_,"maxAttempts must be >= 2 for autoReset == true"),this.numAttempts_=1)},shaka.net.Backoff.prototype.attempt=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function b(){var c,d;return $jscomp.generator.createGenerator(b,function(b){switch(b.nextAddress){case 1:if(a.numAttempts_>=a.maxAttempts_){if(!a.autoReset_)return b["return"](Promise.reject());a.reset_()}return c=a.numAttempts_,a.numAttempts_++,0==c?(goog.asserts.assert(!a.autoReset_,"Failed to delay with auto-reset!"),b["return"]()):(d=shaka.net.Backoff.fuzz_(a.nextUnfuzzedDelay_,a.fuzzFactor_),b["yield"](new Promise(function(a){shaka.net.Backoff.defer(d,a)}),2));case 2:a.nextUnfuzzedDelay_*=a.backoffFactor_,b.jumpToEnd()}})})},shaka.net.Backoff.defaultRetryParameters=function(){return{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:0,stallTimeout:0}},shaka.net.Backoff.fuzz_=function(a,b){return a*(1+(2*Math.random()-1)*b)},shaka.net.Backoff.prototype.reset_=function(){goog.asserts.assert(this.autoReset_,"Should only be used for auto-reset!"),this.numAttempts_=1,this.nextUnfuzzedDelay_=this.baseDelay_},shaka.net.Backoff.defer=function(a,b){new shaka.util.Timer(b).tickAfter(a/1e3)},shaka.util.Error=function(a,b,c,d){for(var e=[],f=3;f<arguments.length;++f)e[f-3]=arguments[f];if(this.severity=a,this.category=b,this.code=c,this.data=e,this.handled=!1,goog.DEBUG){f=e="UNKNOWN";for(var g in shaka.util.Error.Category)shaka.util.Error.Category[g]==this.category&&(e=g);for(var h in shaka.util.Error.Code)shaka.util.Error.Code[h]==this.code&&(f=h);if(this.message="Shaka Error "+e+"."+f+" ("+this.data.toString()+")",shaka.util.Error.createStack)try{throw Error(this.message)}catch(i){this.stack=i.stack}}},goog.exportSymbol("shaka.util.Error",shaka.util.Error),shaka.util.Error.prototype.toString=function(){return"shaka.util.Error "+JSON.stringify(this,null,"  ")},goog.DEBUG&&(shaka.util.Error.createStack=!0),shaka.util.Error.Severity={RECOVERABLE:1,CRITICAL:2},goog.exportProperty(shaka.util.Error,"Severity",shaka.util.Error.Severity),shaka.util.Error.Category={NETWORK:1,TEXT:2,MEDIA:3,MANIFEST:4,STREAMING:5,DRM:6,PLAYER:7,CAST:8,STORAGE:9},goog.exportProperty(shaka.util.Error,"Category",shaka.util.Error.Category),shaka.util.Error.Code={UNSUPPORTED_SCHEME:1e3,BAD_HTTP_STATUS:1001,HTTP_ERROR:1002,TIMEOUT:1003,MALFORMED_DATA_URI:1004,UNKNOWN_DATA_URI_ENCODING:1005,REQUEST_FILTER_ERROR:1006,RESPONSE_FILTER_ERROR:1007,MALFORMED_TEST_URI:1008,UNEXPECTED_TEST_REQUEST:1009,INVALID_TEXT_HEADER:2e3,INVALID_TEXT_CUE:2001,UNABLE_TO_DETECT_ENCODING:2003,BAD_ENCODING:2004,INVALID_XML:2005,INVALID_MP4_TTML:2007,INVALID_MP4_VTT:2008,UNABLE_TO_EXTRACT_CUE_START_TIME:2009,BUFFER_READ_OUT_OF_BOUNDS:3e3,JS_INTEGER_OVERFLOW:3001,EBML_OVERFLOW:3002,EBML_BAD_FLOATING_POINT_SIZE:3003,MP4_SIDX_WRONG_BOX_TYPE:3004,MP4_SIDX_INVALID_TIMESCALE:3005,MP4_SIDX_TYPE_NOT_SUPPORTED:3006,WEBM_CUES_ELEMENT_MISSING:3007,WEBM_EBML_HEADER_ELEMENT_MISSING:3008,WEBM_SEGMENT_ELEMENT_MISSING:3009,WEBM_INFO_ELEMENT_MISSING:3010,WEBM_DURATION_ELEMENT_MISSING:3011,WEBM_CUE_TRACK_POSITIONS_ELEMENT_MISSING:3012,WEBM_CUE_TIME_ELEMENT_MISSING:3013,MEDIA_SOURCE_OPERATION_FAILED:3014,MEDIA_SOURCE_OPERATION_THREW:3015,VIDEO_ERROR:3016,QUOTA_EXCEEDED_ERROR:3017,TRANSMUXING_FAILED:3018,UNABLE_TO_GUESS_MANIFEST_TYPE:4e3,DASH_INVALID_XML:4001,DASH_NO_SEGMENT_INFO:4002,DASH_EMPTY_ADAPTATION_SET:4003,DASH_EMPTY_PERIOD:4004,DASH_WEBM_MISSING_INIT:4005,DASH_UNSUPPORTED_CONTAINER:4006,DASH_PSSH_BAD_ENCODING:4007,DASH_NO_COMMON_KEY_SYSTEM:4008,DASH_MULTIPLE_KEY_IDS_NOT_SUPPORTED:4009,DASH_CONFLICTING_KEY_IDS:4010,UNPLAYABLE_PERIOD:4011,RESTRICTIONS_CANNOT_BE_MET:4012,NO_PERIODS:4014,HLS_PLAYLIST_HEADER_MISSING:4015,INVALID_HLS_TAG:4016,HLS_INVALID_PLAYLIST_HIERARCHY:4017,DASH_DUPLICATE_REPRESENTATION_ID:4018,HLS_MULTIPLE_MEDIA_INIT_SECTIONS_FOUND:4020,HLS_COULD_NOT_GUESS_MIME_TYPE:4021,HLS_MASTER_PLAYLIST_NOT_PROVIDED:4022,HLS_REQUIRED_ATTRIBUTE_MISSING:4023,HLS_REQUIRED_TAG_MISSING:4024,HLS_COULD_NOT_GUESS_CODECS:4025,HLS_KEYFORMATS_NOT_SUPPORTED:4026,DASH_UNSUPPORTED_XLINK_ACTUATE:4027,DASH_XLINK_DEPTH_LIMIT:4028,HLS_COULD_NOT_PARSE_SEGMENT_START_TIME:4030,CONTENT_UNSUPPORTED_BY_BROWSER:4032,CANNOT_ADD_EXTERNAL_TEXT_TO_LIVE_STREAM:4033,HLS_AES_128_ENCRYPTION_NOT_SUPPORTED:4034,INVALID_STREAMS_CHOSEN:5005,NO_RECOGNIZED_KEY_SYSTEMS:6e3,REQUESTED_KEY_SYSTEM_CONFIG_UNAVAILABLE:6001,FAILED_TO_CREATE_CDM:6002,FAILED_TO_ATTACH_TO_VIDEO:6003,INVALID_SERVER_CERTIFICATE:6004,FAILED_TO_CREATE_SESSION:6005,FAILED_TO_GENERATE_LICENSE_REQUEST:6006,LICENSE_REQUEST_FAILED:6007,LICENSE_RESPONSE_REJECTED:6008,ENCRYPTED_CONTENT_WITHOUT_DRM_INFO:6010,NO_LICENSE_SERVER_GIVEN:6012,OFFLINE_SESSION_REMOVED:6013,EXPIRED:6014,SERVER_CERTIFICATE_REQUIRED:6015,INIT_DATA_TRANSFORM_ERROR:6016,LOAD_INTERRUPTED:7e3,OPERATION_ABORTED:7001,NO_VIDEO_ELEMENT:7002,CAST_API_UNAVAILABLE:8e3,NO_CAST_RECEIVERS:8001,ALREADY_CASTING:8002,UNEXPECTED_CAST_ERROR:8003,CAST_CANCELED_BY_USER:8004,CAST_CONNECTION_TIMED_OUT:8005,CAST_RECEIVER_APP_UNAVAILABLE:8006,CAST_RECEIVER_APP_ID_MISSING:8007,STORAGE_NOT_SUPPORTED:9e3,INDEXED_DB_ERROR:9001,DEPRECATED_OPERATION_ABORTED:9002,REQUESTED_ITEM_NOT_FOUND:9003,MALFORMED_OFFLINE_URI:9004,CANNOT_STORE_LIVE_OFFLINE:9005,STORE_ALREADY_IN_PROGRESS:9006,NO_INIT_DATA_FOR_OFFLINE:9007,LOCAL_PLAYER_INSTANCE_REQUIRED:9008,NEW_KEY_OPERATION_NOT_SUPPORTED:9011,KEY_NOT_FOUND:9012,MISSING_STORAGE_CELL:9013},goog.exportProperty(shaka.util.Error,"Code",shaka.util.Error.Code),shaka.util.PublicPromise=function(){var a,b,c=new Promise(function(c,d){a=c,b=d});return c.resolve=a,c.reject=b,c},shaka.util.PublicPromise.prototype.resolve=function(a){},shaka.util.PublicPromise.prototype.reject=function(a){},shaka.util.AbortableOperation=function(a,b){this.promise=a,this.onAbort_=b,this.aborted_=!1},goog.exportSymbol("shaka.util.AbortableOperation",shaka.util.AbortableOperation),shaka.util.AbortableOperation.failed=function(a){return new shaka.util.AbortableOperation(Promise.reject(a),function(){return Promise.resolve()})},goog.exportProperty(shaka.util.AbortableOperation,"failed",shaka.util.AbortableOperation.failed),shaka.util.AbortableOperation.aborted=function(){var a=Promise.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.OPERATION_ABORTED));return a["catch"](function(){}),new shaka.util.AbortableOperation(a,function(){return Promise.resolve()})},goog.exportProperty(shaka.util.AbortableOperation,"aborted",shaka.util.AbortableOperation.aborted),shaka.util.AbortableOperation.completed=function(a){return new shaka.util.AbortableOperation(Promise.resolve(a),function(){return Promise.resolve()})},goog.exportProperty(shaka.util.AbortableOperation,"completed",shaka.util.AbortableOperation.completed),shaka.util.AbortableOperation.notAbortable=function(a){return new shaka.util.AbortableOperation(a,function(){return a["catch"](function(){})})},goog.exportProperty(shaka.util.AbortableOperation,"notAbortable",shaka.util.AbortableOperation.notAbortable),shaka.util.AbortableOperation.prototype.abort=function(){return this.aborted_=!0,this.onAbort_()},goog.exportProperty(shaka.util.AbortableOperation.prototype,"abort",shaka.util.AbortableOperation.prototype.abort),shaka.util.AbortableOperation.all=function(a){return new shaka.util.AbortableOperation(Promise.all(a.map(function(a){return a.promise})),function(){return Promise.all(a.map(function(a){return a.abort()}))})},goog.exportProperty(shaka.util.AbortableOperation,"all",shaka.util.AbortableOperation.all),shaka.util.AbortableOperation.prototype["finally"]=function(a){return this.promise.then(function(b){return a(!0)},function(b){return a(!1)}),this},goog.exportProperty(shaka.util.AbortableOperation.prototype,"finally",shaka.util.AbortableOperation.prototype["finally"]),shaka.util.AbortableOperation.prototype.chain=function(a,b){var c=this,d=new shaka.util.PublicPromise,e=function(){return d.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.OPERATION_ABORTED)),c.abort()};return this.promise.then(function(b){c.aborted_?d.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.OPERATION_ABORTED)):a?e=shaka.util.AbortableOperation.wrapChainCallback_(a,b,d):d.resolve(b)},function(a){b?e=shaka.util.AbortableOperation.wrapChainCallback_(b,a,d):d.reject(a)}),new shaka.util.AbortableOperation(d,function(){return e()})},goog.exportProperty(shaka.util.AbortableOperation.prototype,"chain",shaka.util.AbortableOperation.prototype.chain),shaka.util.AbortableOperation.wrapChainCallback_=function(a,b,c){try{var d=a(b);return d&&d.promise&&d.abort?(c.resolve(d.promise),function(){return d.abort()}):(c.resolve(d),function(){return Promise.resolve(d).then(function(){})["catch"](function(){})})}catch(e){return c.reject(e),function(){return Promise.resolve()}}},shaka.util.FakeEvent=function(a,b){b=void 0===b?{}:b;for(var c in b)this[c]=b[c];this.defaultPrevented=this.cancelable=this.bubbles=!1,this.timeStamp=window.performance&&window.performance.now?window.performance.now():Date.now(),this.type=a,this.isTrusted=!1,this.target=this.currentTarget=null,this.stopped=!1},shaka.util.FakeEvent.prototype.preventDefault=function(){this.cancelable&&(this.defaultPrevented=!0)},shaka.util.FakeEvent.prototype.stopImmediatePropagation=function(){this.stopped=!0},shaka.util.FakeEvent.prototype.stopPropagation=function(){},shaka.util.MultiMap=function(){this.map_={}},shaka.util.MultiMap.prototype.push=function(a,b){this.map_.hasOwnProperty(a)?this.map_[a].push(b):this.map_[a]=[b]},shaka.util.MultiMap.prototype.get=function(a){return(a=this.map_[a])?a.slice():null},shaka.util.MultiMap.prototype.getAll=function(){var a,b=[];for(a in this.map_)b.push.apply(b,this.map_[a]);return b},shaka.util.MultiMap.prototype.remove=function(a,b){var c=this.map_[a];if(c)for(var d=0;d<c.length;++d)c[d]==b&&(c.splice(d,1),--d)},shaka.util.MultiMap.prototype.clear=function(){this.map_={}},shaka.util.MultiMap.prototype.forEach=function(a){for(var b in this.map_)a(b,this.map_[b])},shaka.util.FakeEventTarget=function(){this.listeners_=new shaka.util.MultiMap,this.dispatchTarget=this},shaka.util.FakeEventTarget.prototype.addEventListener=function(a,b,c){this.listeners_.push(a,b)},shaka.util.FakeEventTarget.prototype.removeEventListener=function(a,b,c){this.listeners_.remove(a,b)},shaka.util.FakeEventTarget.prototype.dispatchEvent=function(a){goog.asserts.assert(a instanceof shaka.util.FakeEvent,"FakeEventTarget can only dispatch FakeEvents!");for(var b=this.listeners_.get(a.type)||[],c=0;c<b.length;++c){a.target=this.dispatchTarget,a.currentTarget=this.dispatchTarget;var d=b[c];try{d.handleEvent?d.handleEvent(a):d.call(this,a)}catch(e){shaka.log.error("Uncaught exception in event handler",e,e?e.message:null,e?e.stack:null)}if(a.stopped)break}return a.defaultPrevented},shaka.util.IDestroyable=function(){},shaka.util.IDestroyable.prototype.destroy=function(){},shaka.util.ObjectUtils=function(){},shaka.util.ObjectUtils.cloneObject=function(a){var b=new Set,c=function(a){switch(typeof a){case"undefined":case"boolean":case"number":case"string":case"symbol":case"function":return a;default:if(!a||a.buffer&&a.buffer.constructor==ArrayBuffer)return a;if(b.has(a))return null;var d=a.constructor==Array;if(a.constructor!=Object&&!d)return null;b.add(a);var e,f=d?[]:{};for(e in a)f[e]=c(a[e]);return d&&(f.length=a.length),f}};return c(a)},shaka.util.ArrayUtils={},shaka.util.ArrayUtils.defaultEquals=function(a,b){return!("number"!=typeof a||"number"!=typeof b||!isNaN(a)||!isNaN(b))||a===b},shaka.util.ArrayUtils.remove=function(a,b){var c=a.indexOf(b);-1<c&&a.splice(c,1)},shaka.util.ArrayUtils.count=function(a,b){var c=0;return a.forEach(function(a){c+=b(a)?1:0}),c},shaka.util.ArrayUtils.hasSameElements=function(a,b,c){if(c||(c=shaka.util.ArrayUtils.defaultEquals),a.length!=b.length)return!1;b=b.slice();var d={};a=$jscomp.makeIterator(a);for(var e=a.next();!e.done;d={item:d.item},e=a.next()){if(d.item=e.value,e=b.findIndex(function(a){return function(b){return c(a.item,b)}}(d)),-1==e)return!1;b[e]=b[b.length-1],b.pop()}return 0==b.length},shaka.util.OperationManager=function(){this.operations_=[]},shaka.util.OperationManager.prototype.manage=function(a){var b=this;this.operations_.push(a["finally"](function(){shaka.util.ArrayUtils.remove(b.operations_,a)}))},shaka.util.OperationManager.prototype.destroy=function(){var a=[];return this.operations_.forEach(function(b){b.promise["catch"](function(){}),a.push(b.abort())}),this.operations_=[],Promise.all(a)},shaka.net.NetworkingEngine=function(a){shaka.util.FakeEventTarget.call(this),this.destroyed_=!1,this.operationManager_=new shaka.util.OperationManager,this.requestFilters_=new Set,this.responseFilters_=new Set,this.onProgressUpdated_=a||null},goog.inherits(shaka.net.NetworkingEngine,shaka.util.FakeEventTarget),goog.exportSymbol("shaka.net.NetworkingEngine",shaka.net.NetworkingEngine),shaka.net.NetworkingEngine.RequestType={MANIFEST:0,SEGMENT:1,LICENSE:2,APP:3,TIMING:4},goog.exportProperty(shaka.net.NetworkingEngine,"RequestType",shaka.net.NetworkingEngine.RequestType),shaka.net.NetworkingEngine.PluginPriority={FALLBACK:1,PREFERRED:2,APPLICATION:3},goog.exportProperty(shaka.net.NetworkingEngine,"PluginPriority",shaka.net.NetworkingEngine.PluginPriority),shaka.net.NetworkingEngine.schemes_={},shaka.net.NetworkingEngine.registerScheme=function(a,b,c){goog.asserts.assert(void 0==c||0<c,"explicit priority must be > 0"),c=c||shaka.net.NetworkingEngine.PluginPriority.APPLICATION;var d=shaka.net.NetworkingEngine.schemes_[a];(!d||c>=d.priority)&&(shaka.net.NetworkingEngine.schemes_[a]={priority:c,plugin:b})},goog.exportProperty(shaka.net.NetworkingEngine,"registerScheme",shaka.net.NetworkingEngine.registerScheme),shaka.net.NetworkingEngine.unregisterScheme=function(a){delete shaka.net.NetworkingEngine.schemes_[a]},goog.exportProperty(shaka.net.NetworkingEngine,"unregisterScheme",shaka.net.NetworkingEngine.unregisterScheme),shaka.net.NetworkingEngine.prototype.registerRequestFilter=function(a){this.requestFilters_.add(a)},goog.exportProperty(shaka.net.NetworkingEngine.prototype,"registerRequestFilter",shaka.net.NetworkingEngine.prototype.registerRequestFilter),shaka.net.NetworkingEngine.prototype.unregisterRequestFilter=function(a){this.requestFilters_["delete"](a)},goog.exportProperty(shaka.net.NetworkingEngine.prototype,"unregisterRequestFilter",shaka.net.NetworkingEngine.prototype.unregisterRequestFilter),shaka.net.NetworkingEngine.prototype.clearAllRequestFilters=function(){this.requestFilters_.clear()},goog.exportProperty(shaka.net.NetworkingEngine.prototype,"clearAllRequestFilters",shaka.net.NetworkingEngine.prototype.clearAllRequestFilters),shaka.net.NetworkingEngine.prototype.registerResponseFilter=function(a){this.responseFilters_.add(a)},goog.exportProperty(shaka.net.NetworkingEngine.prototype,"registerResponseFilter",shaka.net.NetworkingEngine.prototype.registerResponseFilter),shaka.net.NetworkingEngine.prototype.unregisterResponseFilter=function(a){this.responseFilters_["delete"](a)},goog.exportProperty(shaka.net.NetworkingEngine.prototype,"unregisterResponseFilter",shaka.net.NetworkingEngine.prototype.unregisterResponseFilter),shaka.net.NetworkingEngine.prototype.clearAllResponseFilters=function(){this.responseFilters_.clear()},goog.exportProperty(shaka.net.NetworkingEngine.prototype,"clearAllResponseFilters",shaka.net.NetworkingEngine.prototype.clearAllResponseFilters),shaka.net.NetworkingEngine.defaultRetryParameters=shaka.net.Backoff.defaultRetryParameters,shaka.net.NetworkingEngine.makeRequest=function(a,b){return{uris:a,method:"GET",body:null,headers:{},allowCrossSiteCredentials:!1,retryParameters:b,licenseRequestType:null,sessionId:null}},shaka.net.NetworkingEngine.prototype.destroy=function(){return this.destroyed_=!0,this.requestFilters_.clear(),this.responseFilters_.clear(),this.operationManager_.destroy()},goog.exportProperty(shaka.net.NetworkingEngine.prototype,"destroy",shaka.net.NetworkingEngine.prototype.destroy),shaka.net.NetworkingEngine.prototype.request=function(a,b){var c=this,d=shaka.util.ObjectUtils,e=new shaka.net.NetworkingEngine.NumBytesRemainingClass;if(this.destroyed_)return d=Promise.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.OPERATION_ABORTED)),d["catch"](function(){}),new shaka.net.NetworkingEngine.PendingRequest(d,function(){return Promise.resolve()},e);goog.asserts.assert(b.uris&&b.uris.length,"Request without URIs!"),b.method=b.method||"GET",b.headers=b.headers||{},b.retryParameters=b.retryParameters?d.cloneObject(b.retryParameters):shaka.net.NetworkingEngine.defaultRetryParameters(),b.uris=d.cloneObject(b.uris),d=this.filterRequest_(a,b);var f=d.chain(function(){return c.makeRequestWithRetry_(a,b,e)}),g=f.chain(function(b){return c.filterResponse_(a,b)}),h=Date.now(),i=0;d.promise.then(function(){i=Date.now()-h},function(){});var j=0;return f.promise.then(function(){j=Date.now()},function(){}),d=g.chain(function(b){var d=Date.now()-j,e=b.response;return e.timeMs+=i,e.timeMs+=d,b.gotProgress||!c.onProgressUpdated_||e.fromCache||a!=shaka.net.NetworkingEngine.RequestType.SEGMENT||c.onProgressUpdated_(e.timeMs,e.data.byteLength),e},function(a){throw a&&(goog.asserts.assert(a instanceof shaka.util.Error,"Wrong error type"),a.severity=shaka.util.Error.Severity.CRITICAL),a}),d=new shaka.net.NetworkingEngine.PendingRequest(d.promise,d.onAbort_,e),this.operationManager_.manage(d),d},goog.exportProperty(shaka.net.NetworkingEngine.prototype,"request",shaka.net.NetworkingEngine.prototype.request),shaka.net.NetworkingEngine.prototype.filterRequest_=function(a,b){for(var c=shaka.util.AbortableOperation.completed(void 0),d={},e=$jscomp.makeIterator(this.requestFilters_),f=e.next();!f.done;d={requestFilter:d.requestFilter},f=e.next())d.requestFilter=f.value,c=c.chain(function(c){return function(){return c.requestFilter(a,b)}}(d));return c.chain(void 0,function(a){if(a&&a.code==shaka.util.Error.Code.OPERATION_ABORTED)throw a;throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.REQUEST_FILTER_ERROR,a)})},shaka.net.NetworkingEngine.prototype.makeRequestWithRetry_=function(a,b,c){var d=new shaka.net.Backoff(b.retryParameters,(!1));return this.send_(a,b,d,0,null,c)},shaka.net.NetworkingEngine.prototype.send_=function(a,b,c,d,e,f){var g=this,h=new goog.Uri(b.uris[d]),i=h.getScheme(),j=!1;i||(i=shaka.net.NetworkingEngine.getLocationProtocol_(),goog.asserts.assert(":"==i[i.length-1],"location.protocol expected to end with a colon!"),i=i.slice(0,-1),h.setScheme(i),b.uris[d]=h.toString());var k=(i=shaka.net.NetworkingEngine.schemes_[i])?i.plugin:null;if(!k)return shaka.util.AbortableOperation.failed(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.UNSUPPORTED_SCHEME,h));var l;return shaka.util.AbortableOperation.notAbortable(c.attempt()).chain(function(){if(g.destroyed_)return shaka.util.AbortableOperation.aborted();l=Date.now();var c=shaka.net.NetworkingEngine.RequestType.SEGMENT;return k(b.uris[d],b,a,function(b,d,e){g.onProgressUpdated_&&a==c&&(g.onProgressUpdated_(b,d),j=!0,f.setBytes(e))})}).chain(function(a){return void 0==a.timeMs&&(a.timeMs=Date.now()-l),{response:a,gotProgress:j}},function(h){if(h&&h.code==shaka.util.Error.Code.OPERATION_ABORTED)throw h;if(g.destroyed_)return shaka.util.AbortableOperation.aborted();if(h&&h.severity==shaka.util.Error.Severity.RECOVERABLE){var i=new shaka.util.FakeEvent("retry",{error:h instanceof shaka.util.Error?h:null});return g.dispatchEvent(i),d=(d+1)%b.uris.length,g.send_(a,b,c,d,h,f)}throw h||e})},shaka.net.NetworkingEngine.prototype.filterResponse_=function(a,b){for(var c=shaka.util.AbortableOperation.completed(void 0),d=$jscomp.makeIterator(this.responseFilters_),e=d.next();!e.done;e=d.next())c=c.chain(e.value.bind(null,a,b.response));return c.chain(function(){return b},function(a){if(a&&a.code==shaka.util.Error.Code.OPERATION_ABORTED)throw a;var b=shaka.util.Error.Severity.CRITICAL;throw a instanceof shaka.util.Error&&(b=a.severity),new shaka.util.Error(b,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.RESPONSE_FILTER_ERROR,a)})},shaka.net.NetworkingEngine.getLocationProtocol_=function(){return location.protocol},shaka.net.NetworkingEngine.NumBytesRemainingClass=function(){this.bytesToLoad_=0},goog.exportProperty(shaka.net.NetworkingEngine,"NumBytesRemainingClass",shaka.net.NetworkingEngine.NumBytesRemainingClass),shaka.net.NetworkingEngine.NumBytesRemainingClass.prototype.setBytes=function(a){this.bytesToLoad_=a},shaka.net.NetworkingEngine.NumBytesRemainingClass.prototype.getBytes=function(){return this.bytesToLoad_},shaka.net.NetworkingEngine.PendingRequest=function(a,b,c){shaka.util.AbortableOperation.call(this,a,b),this.bytesRemaining_=c},$jscomp.inherits(shaka.net.NetworkingEngine.PendingRequest,shaka.util.AbortableOperation),goog.exportProperty(shaka.net.NetworkingEngine,"PendingRequest",shaka.net.NetworkingEngine.PendingRequest),shaka.net.NetworkingEngine.PendingRequest.wrapChainCallback_=shaka.util.AbortableOperation.wrapChainCallback_,shaka.net.NetworkingEngine.PendingRequest.all=shaka.util.AbortableOperation.all,goog.exportProperty(shaka.net.NetworkingEngine.PendingRequest,"all",shaka.net.NetworkingEngine.PendingRequest.all),shaka.net.NetworkingEngine.PendingRequest.notAbortable=shaka.util.AbortableOperation.notAbortable,goog.exportProperty(shaka.net.NetworkingEngine.PendingRequest,"notAbortable",shaka.net.NetworkingEngine.PendingRequest.notAbortable),shaka.net.NetworkingEngine.PendingRequest.completed=shaka.util.AbortableOperation.completed,goog.exportProperty(shaka.net.NetworkingEngine.PendingRequest,"completed",shaka.net.NetworkingEngine.PendingRequest.completed),shaka.net.NetworkingEngine.PendingRequest.aborted=shaka.util.AbortableOperation.aborted,goog.exportProperty(shaka.net.NetworkingEngine.PendingRequest,"aborted",shaka.net.NetworkingEngine.PendingRequest.aborted),shaka.net.NetworkingEngine.PendingRequest.failed=shaka.util.AbortableOperation.failed,goog.exportProperty(shaka.net.NetworkingEngine.PendingRequest,"failed",shaka.net.NetworkingEngine.PendingRequest.failed),shaka.net.NetworkingEngine.PendingRequest.prototype.getBytesRemaining=function(){return this.bytesRemaining_.getBytes()},shaka.util.IReleasable=function(){},goog.exportSymbol("shaka.util.IReleasable",shaka.util.IReleasable),shaka.util.IReleasable.prototype.release=function(){},shaka.util.EventManager=function(){this.bindingMap_=new shaka.util.MultiMap},goog.exportSymbol("shaka.util.EventManager",shaka.util.EventManager),shaka.util.EventManager.prototype.release=function(){this.removeAll(),this.bindingMap_=null},goog.exportProperty(shaka.util.EventManager.prototype,"release",shaka.util.EventManager.prototype.release),shaka.util.EventManager.prototype.listen=function(a,b,c,d){this.bindingMap_&&(a=new shaka.util.EventManager.Binding_(a,b,c,d),this.bindingMap_.push(b,a))},goog.exportProperty(shaka.util.EventManager.prototype,"listen",shaka.util.EventManager.prototype.listen),shaka.util.EventManager.prototype.listenOnce=function(a,b,c,d){var e=this,f=function(d){e.unlisten(a,b,f),c(d)};this.listen(a,b,f,d)},goog.exportProperty(shaka.util.EventManager.prototype,"listenOnce",shaka.util.EventManager.prototype.listenOnce),shaka.util.EventManager.prototype.unlisten=function(a,b,c){if(this.bindingMap_){var d=this.bindingMap_.get(b)||[];d=$jscomp.makeIterator(d);for(var e=d.next();!e.done;e=d.next())e=e.value,e.target!=a||c!=e.listener&&c||(e.unlisten(),this.bindingMap_.remove(b,e))}},goog.exportProperty(shaka.util.EventManager.prototype,"unlisten",shaka.util.EventManager.prototype.unlisten),shaka.util.EventManager.prototype.removeAll=function(){if(this.bindingMap_){var a=this.bindingMap_.getAll();a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())b.value.unlisten();this.bindingMap_.clear()}},goog.exportProperty(shaka.util.EventManager.prototype,"removeAll",shaka.util.EventManager.prototype.removeAll),shaka.util.EventManager.Binding_=function(a,b,c,d){this.target=a,this.type=b,this.listener=c,this.options=shaka.util.EventManager.Binding_.convertOptions_(a,d),this.target.addEventListener(b,c,this.options)},shaka.util.EventManager.Binding_.prototype.unlisten=function(){goog.asserts.assert(this.target,"Missing target"),this.target.removeEventListener(this.type,this.listener,this.options),this.listener=this.target=null,this.options=!1},goog.exportProperty(shaka.util.EventManager.Binding_.prototype,"unlisten",shaka.util.EventManager.Binding_.prototype.unlisten),shaka.util.EventManager.Binding_.convertOptions_=function(a,b){if(void 0==b)return!1;if("boolean"==typeof b)return b;var c=new Set(["passive","capture"]),d=Object.keys(b).filter(function(a){return!c.has(a)});return goog.asserts.assert(0==d.length,"Unsupported flag(s) to addEventListener: "+d.join(",")),shaka.util.EventManager.Binding_.doesSupportObject_(a)?b:b.capture||!1},shaka.util.EventManager.Binding_.doesSupportObject_=function(a){var b=shaka.util.EventManager.Binding_.supportsObject_;if(void 0==b){b=!1;try{var c={},d={get:function(){return b=!0,!1}};Object.defineProperty(c,"passive",d),Object.defineProperty(c,"capture",d),d=function(){},a.addEventListener("test",d,c),a.removeEventListener("test",d,c)}catch(e){b=!1}shaka.util.EventManager.Binding_.supportsObject_=b}return b||!1},shaka.util.EventManager.Binding_.supportsObject_=void 0,shaka.util.FairPlayUtils=function(){},shaka.util.FairPlayUtils.defaultGetContentId=function(a){if(a=new Uint8Array(a),new DataView(a.buffer,a.byteOffset,a.byteLength).getUint32(0,!0)+4!=a.byteLength)throw new RangeError("Malformed FairPlay init data");return a=shaka.util.StringUtils.fromUTF16(a.subarray(4),!0),new goog.Uri(a).getDomain()},goog.exportSymbol("shaka.util.FairPlayUtils.defaultGetContentId",shaka.util.FairPlayUtils.defaultGetContentId),shaka.util.FairPlayUtils.initDataTransform=function(a,b,c){if(!c||!c.byteLength)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.SERVER_CERTIFICATE_REQUIRED);b="string"==typeof b?new Uint8Array(shaka.util.StringUtils.toUTF16(b,!0)):new Uint8Array(b);var d=new Uint8Array(8+a.byteLength+b.byteLength+c.byteLength),e=0,f=function(a){d.set(a,e),e+=a.byteLength},g=function(a){new DataView(d.buffer).setUint32(e,a.byteLength,!0),e+=4,f(a)};return f(new Uint8Array(a)),g(b),g(new Uint8Array(c)),d},goog.exportSymbol("shaka.util.FairPlayUtils.initDataTransform",shaka.util.FairPlayUtils.initDataTransform),
shaka.util.Iterables=function(){},shaka.util.Iterables.map=function(a,b){for(var c=[],d=$jscomp.makeIterator(a),e=d.next();!e.done;e=d.next())c.push(b(e.value));return c},shaka.util.Iterables.every=function(a,b){for(var c=$jscomp.makeIterator(a),d=c.next();!d.done;d=c.next())if(!b(d.value))return!1;return!0},shaka.util.Iterables.some=function(a,b){for(var c=$jscomp.makeIterator(a),d=c.next();!d.done;d=c.next())if(b(d.value))return!0;return!1},shaka.util.Iterables.filter=function(a,b){for(var c=[],d=$jscomp.makeIterator(a),e=d.next();!e.done;e=d.next())e=e.value,b(e)&&c.push(e);return c},shaka.util.MapUtils={},shaka.util.MapUtils.asMap=function(a){var b=new Map;return Object.keys(a).forEach(function(c){b.set(c,a[c])}),b},shaka.util.MapUtils.asObject=function(a){var b={};return a.forEach(function(a,c){b[c]=a}),b},shaka.util.MimeUtils=function(){},shaka.util.MimeUtils.getFullType=function(a,b){var c=a;return b&&(c+='; codecs="'+b+'"'),c},shaka.util.MimeUtils.getExtendedType=function(a){var b=[a.mimeType];return shaka.util.MimeUtils.EXTENDED_MIME_PARAMETERS_.forEach(function(c,d){var e=a[d];e&&b.push(c+'="'+e+'"')}),b.join(";")},shaka.util.MimeUtils.splitCodecs=function(a){return a.split(",")},shaka.util.MimeUtils.getCodecBase=function(a){return shaka.util.MimeUtils.getCodecParts_(a)[0]},shaka.util.MimeUtils.getCodecParts_=function(a){var b=a.split(".");return a=b[0],b.pop(),b=b.join("."),[a,b]},shaka.util.MimeUtils.EXTENDED_MIME_PARAMETERS_=(new Map).set("codecs","codecs").set("frameRate","framerate").set("bandwidth","bitrate").set("width","width").set("height","height").set("channelsCount","channels"),shaka.util.MimeUtils.CLOSED_CAPTION_MIMETYPE="application/cea-608",shaka.util.Platform=function(){},shaka.util.Platform.supportsMediaSource=function(){return!(!window.MediaSource||!MediaSource.isTypeSupported)},shaka.util.Platform.supportsMediaType=function(a){return""!=shaka.util.Platform.anyMediaElement_().canPlayType(a)},shaka.util.Platform.isEdge=function(){return shaka.util.Platform.userAgentContains_("Edge/")},shaka.util.Platform.isIE=function(){return shaka.util.Platform.userAgentContains_("Trident/")},shaka.util.Platform.isTizen=function(){return shaka.util.Platform.userAgentContains_("Tizen")},shaka.util.Platform.isTizen3=function(){return shaka.util.Platform.userAgentContains_("Tizen 3")},shaka.util.Platform.isWebOS=function(){return shaka.util.Platform.userAgentContains_("Web0S")},shaka.util.Platform.isChromecast=function(){return shaka.util.Platform.userAgentContains_("CrKey")},shaka.util.Platform.isChrome=function(){return shaka.util.Platform.userAgentContains_("Chrome")&&!shaka.util.Platform.isEdge()},shaka.util.Platform.isApple=function(){return!!navigator.vendor&&navigator.vendor.includes("Apple")},shaka.util.Platform.isMobile=function(){return/(?:iPhone|iPad|iPod|Android)/.test(navigator.userAgent)},shaka.util.Platform.userAgentContains_=function(a){return(navigator.userAgent||"").includes(a)},shaka.util.Platform.anyMediaElement_=function(){var a=shaka.util.Platform;return a.cachedMediaElement_?a.cachedMediaElement_:(a.cacheExpirationTimer_||(a.cacheExpirationTimer_=new shaka.util.Timer(function(){a.cachedMediaElement_=null})),a.cachedMediaElement_=document.querySelector("video")||document.querySelector("audio"),a.cachedMediaElement_||(a.cachedMediaElement_=document.createElement("video")),a.cacheExpirationTimer_.tickAfter(1),a.cachedMediaElement_)},shaka.util.Platform.cacheExpirationTimer_=null,shaka.util.Platform.cachedMediaElement_=null,shaka.util.StringUtils={},shaka.util.StringUtils.fromUTF8=function(a){if(!a)return"";a=new Uint8Array(a),239==a[0]&&187==a[1]&&191==a[2]&&(a=a.subarray(3)),a=shaka.util.StringUtils.fromCharCode(a),a=escape(a);try{return decodeURIComponent(a)}catch(b){throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.BAD_ENCODING)}},goog.exportSymbol("shaka.util.StringUtils.fromUTF8",shaka.util.StringUtils.fromUTF8),shaka.util.StringUtils.fromUTF16=function(a,b,c){if(!a)return"";if(!c&&0!=a.byteLength%2)throw shaka.log.error("Data has an incorrect length, must be even."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.BAD_ENCODING);if(a instanceof ArrayBuffer)var d=a;else c=new Uint8Array(a.byteLength),c.set(new Uint8Array(a)),d=c.buffer;a=Math.floor(a.byteLength/2),c=new Uint16Array(a),d=new DataView(d);for(var e=0;e<a;e++)c[e]=d.getUint16(2*e,b);return shaka.util.StringUtils.fromCharCode(c)},goog.exportSymbol("shaka.util.StringUtils.fromUTF16",shaka.util.StringUtils.fromUTF16),shaka.util.StringUtils.fromBytesAutoDetect=function(a){var b=shaka.util.StringUtils,c=new Uint8Array(a);if(239==c[0]&&187==c[1]&&191==c[2])return b.fromUTF8(c);if(254==c[0]&&255==c[1])return b.fromUTF16(c.subarray(2),!1);if(255==c[0]&&254==c[1])return b.fromUTF16(c.subarray(2),!0);var d=function(a,b){return a.byteLength<=b||32<=a[b]&&126>=a[b]}.bind(null,c);if(shaka.log.debug("Unable to find byte-order-mark, making an educated guess."),0==c[0]&&0==c[2])return b.fromUTF16(a,!1);if(0==c[1]&&0==c[3])return b.fromUTF16(a,!0);if(d(0)&&d(1)&&d(2)&&d(3))return b.fromUTF8(a);throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.UNABLE_TO_DETECT_ENCODING)},goog.exportSymbol("shaka.util.StringUtils.fromBytesAutoDetect",shaka.util.StringUtils.fromBytesAutoDetect),shaka.util.StringUtils.toUTF8=function(a){a=encodeURIComponent(a),a=unescape(a);for(var b=new Uint8Array(a.length),c=0;c<a.length;++c)b[c]=a.charCodeAt(c);return b.buffer},goog.exportSymbol("shaka.util.StringUtils.toUTF8",shaka.util.StringUtils.toUTF8),shaka.util.StringUtils.toUTF16=function(a,b){for(var c=new Uint8Array(2*a.length),d=new DataView(c.buffer),e=0;e<a.length;++e){var f=a.charCodeAt(e);d.setUint16(2*e,f,b)}return c.buffer},goog.exportSymbol("shaka.util.StringUtils.toUTF16",shaka.util.StringUtils.toUTF16),shaka.util.StringUtils.fromCharCode=function(a){if(!shaka.util.StringUtils.fromCharCodeImpl_)for(var b=function(a){try{var b=new Uint8Array(a),c=String.fromCharCode.apply(String,$jscomp.arrayFromIterable(b));return goog.asserts.assert(c,"Should get value"),!0}catch(d){return!1}},c={size:65536};0<c.size;c={size:c.size},c.size/=2)if(b(c.size)){shaka.util.StringUtils.fromCharCodeImpl_=function(a){return function(b){for(var c="",d=0;d<b.length;d+=a.size){var e=b.subarray(d,d+a.size);c+=String.fromCharCode.apply(String,$jscomp.arrayFromIterable(e))}return c}}(c);break}return goog.asserts.assert(shaka.util.StringUtils.fromCharCodeImpl_,"Unable to create a fromCharCode method"),shaka.util.StringUtils.fromCharCodeImpl_(a)},shaka.util.StringUtils.fromCharCodeImpl_=null,shaka.util.Uint8ArrayUtils={},shaka.util.Uint8ArrayUtils.toBase64=function(a,b){var c=shaka.util.StringUtils.fromCharCode(a);return b=void 0==b||b,c=window.btoa(c).replace(/\+/g,"-").replace(/\//g,"_"),b?c:c.replace(/=*$/,"")},goog.exportSymbol("shaka.util.Uint8ArrayUtils.toBase64",shaka.util.Uint8ArrayUtils.toBase64),shaka.util.Uint8ArrayUtils.fromBase64=function(a){a=window.atob(a.replace(/-/g,"+").replace(/_/g,"/"));for(var b=new Uint8Array(a.length),c=0;c<a.length;++c)b[c]=a.charCodeAt(c);return b},goog.exportSymbol("shaka.util.Uint8ArrayUtils.fromBase64",shaka.util.Uint8ArrayUtils.fromBase64),shaka.util.Uint8ArrayUtils.fromHex=function(a){for(var b=new Uint8Array(a.length/2),c=0;c<a.length;c+=2)b[c/2]=window.parseInt(a.substr(c,2),16);return b},goog.exportSymbol("shaka.util.Uint8ArrayUtils.fromHex",shaka.util.Uint8ArrayUtils.fromHex),shaka.util.Uint8ArrayUtils.toHex=function(a){for(var b="",c=0;c<a.length;++c){var d=a[c].toString(16);1==d.length&&(d="0"+d),b+=d}return b},goog.exportSymbol("shaka.util.Uint8ArrayUtils.toHex",shaka.util.Uint8ArrayUtils.toHex),shaka.util.Uint8ArrayUtils.equal=function(a,b){if(!a&&!b)return!0;if(!a||!b||a.length!=b.length)return!1;for(var c=0;c<a.length;++c)if(a[c]!=b[c])return!1;return!0},goog.exportSymbol("shaka.util.Uint8ArrayUtils.equal",shaka.util.Uint8ArrayUtils.equal),shaka.util.Uint8ArrayUtils.concat=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];for(var d=c=0;d<b.length;++d)c+=b[d].length;c=new Uint8Array(c);for(var e=d=0;e<b.length;++e)c.set(b[e],d),d+=b[e].length;return c},goog.exportSymbol("shaka.util.Uint8ArrayUtils.concat",shaka.util.Uint8ArrayUtils.concat),shaka.media={},shaka.media.DrmEngine=function(a){var b=this;this.playerInterface_=a,this.supportedTypes_=new Set,this.video_=this.mediaKeys_=null,this.initialized_=!1,this.currentDrmInfo_=null,this.eventManager_=new shaka.util.EventManager,this.activeSessions_=new Map,this.offlineSessionIds_=[],this.allSessionsLoaded_=new shaka.util.PublicPromise,this.config_=null,this.onError_=function(c){b.allSessionsLoaded_.reject(c),a.onError(c)},this.keyStatusByKeyId_=new Map,this.announcedKeyStatusByKeyId_=new Map,this.keyStatusTimer_=new shaka.util.Timer(function(){return b.processKeyStatusChanges_()}),this.isDestroying_=!1,this.finishedDestroyingPromise_=new shaka.util.PublicPromise,this.usePersistentLicenses_=!1,this.mediaKeyMessageEvents_=[],this.initialRequestsSent_=!1,this.expirationTimer_=new shaka.util.Timer(function(){b.pollExpiration_()}).tickEvery(1),this.allSessionsLoaded_["catch"](function(){})},shaka.media.DrmEngine.prototype.destroy=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function b(){return $jscomp.generator.createGenerator(b,function(b){switch(b.nextAddress){case 1:return a.isDestroying_?b["yield"](a.finishedDestroyingPromise_,0):(a.isDestroying_=!0,b["yield"](a.destroyNow_(),4));case 4:a.finishedDestroyingPromise_.resolve(),b.jumpTo(0)}})})},shaka.media.DrmEngine.prototype.destroyNow_=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function b(){var c;return $jscomp.generator.createGenerator(b,function(b){switch(b.nextAddress){case 1:return a.eventManager_.release(),a.eventManager_=null,a.allSessionsLoaded_.reject(),a.expirationTimer_.stop(),a.expirationTimer_=null,a.keyStatusTimer_.stop(),a.keyStatusTimer_=null,c=Array.from(a.activeSessions_.keys()),a.activeSessions_.clear(),b["yield"](Promise.all(c.map(function(a){return Promise.resolve().then(function(){return $jscomp.asyncExecutePromiseGeneratorFunction(function b(){return $jscomp.generator.createGenerator(b,function(b){switch(b.nextAddress){case 1:return shaka.log.v1("Closing session",a.sessionId),b.setCatchFinallyBlocks(2),b["yield"](shaka.media.DrmEngine.closeSession_(a),4);case 4:b.leaveTryBlock(0);break;case 2:b.enterCatchBlock(),b.jumpToEnd()}})})})})),2);case 2:if(!a.video_||shaka.util.Platform.isWebOS()){b.jumpTo(3);break}return goog.asserts.assert(!a.video_.src,"video src must be removed first!"),b.setCatchFinallyBlocks(4),b["yield"](a.video_.setMediaKeys(null),6);case 6:b.leaveTryBlock(5);break;case 4:b.enterCatchBlock();case 5:a.video_=null;case 3:a.currentDrmInfo_=null,a.supportedTypes_.clear(),a.mediaKeys_=null,a.offlineSessionIds_=[],a.config_=null,a.onError_=null,a.playerInterface_=null,b.jumpToEnd()}})})},shaka.media.DrmEngine.prototype.configure=function(a){this.config_=a},shaka.media.DrmEngine.prototype.initForStorage=function(a,b){return this.offlineSessionIds_=[],this.usePersistentLicenses_=b,this.init_(a)},shaka.media.DrmEngine.prototype.initForPlayback=function(a,b){return this.offlineSessionIds_=b,this.usePersistentLicenses_=0<b.length,this.init_(a)},shaka.media.DrmEngine.prototype.initForRemoval=function(a,b,c,d,e){var f=new Map;return f.set(a,{audioCapabilities:d,videoCapabilities:e,distinctiveIdentifier:"optional",persistentState:"required",sessionTypes:["persistent-license"],label:a,drmInfos:[{keySystem:a,licenseServerUri:b,distinctiveIdentifierRequired:!1,persistentStateRequired:!0,audioRobustness:"",videoRobustness:"",serverCertificate:c,initData:null,keyIds:null}]}),this.queryMediaKeys_(f)},shaka.media.DrmEngine.prototype.init_=function(a){goog.asserts.assert(this.config_,"DrmEngine configure() must be called before init()!");var b=a.some(function(a){return 0<a.drmInfos.length});if(!b){var c=shaka.util.MapUtils.asMap(this.config_.servers);shaka.media.DrmEngine.replaceDrmInfo_(a,c)}var d=this.configureClearKey_();if(d){var e=$jscomp.makeIterator(a);for(c=e.next();!c.done;c=e.next())c.value.drmInfos=[d]}for(d=$jscomp.makeIterator(a),c=d.next();!c.done;c=d.next())for(c=$jscomp.makeIterator(c.value.drmInfos),e=c.next();!e.done;e=c.next())shaka.media.DrmEngine.fillInDrmInfoDefaults_(e.value,shaka.util.MapUtils.asMap(this.config_.servers),shaka.util.MapUtils.asMap(this.config_.advanced||{}));return a=this.prepareMediaKeyConfigsForVariants_(a),a.size?(a=this.queryMediaKeys_(a),b?a:a["catch"](function(){})):(this.initialized_=!0,Promise.resolve())},shaka.media.DrmEngine.prototype.attach=function(a){var b=this;if(!this.mediaKeys_)return this.eventManager_.listenOnce(a,"encrypted",function(a){b.onError_(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.ENCRYPTED_CONTENT_WITHOUT_DRM_INFO))}),Promise.resolve();this.video_=a,this.eventManager_.listenOnce(this.video_,"play",function(){return b.onPlay_()}),a=this.video_.setMediaKeys(this.mediaKeys_),a=a["catch"](function(a){return Promise.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.FAILED_TO_ATTACH_TO_VIDEO,a.message))});var c=this.setServerCertificate();return Promise.all([a,c]).then(function(){return b.isDestroying_?Promise.reject():(b.createOrLoad(),void(b.currentDrmInfo_.initData.length||b.offlineSessionIds_.length||b.eventManager_.listen(b.video_,"encrypted",function(a){return b.newInitData(a.initDataType,new Uint8Array(a.initData))})))})["catch"](function(a){if(!b.isDestroying_)return Promise.reject(a)})},shaka.media.DrmEngine.prototype.setServerCertificate=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function b(){var c,d;return $jscomp.generator.createGenerator(b,function(b){switch(b.nextAddress){case 1:if(goog.asserts.assert(a.initialized_,"Must call init() before setServerCertificate"),!(a.mediaKeys_&&a.currentDrmInfo_&&a.currentDrmInfo_.serverCertificate&&a.currentDrmInfo_.serverCertificate.length)){b.jumpTo(0);break}return b.setCatchFinallyBlocks(3),b["yield"](a.mediaKeys_.setServerCertificate(a.currentDrmInfo_.serverCertificate),5);case 5:(c=b.yieldResult)||shaka.log.warning("Server certificates are not supported by the key system.  The server certificate has been ignored."),b.leaveTryBlock(0);break;case 3:return d=b.enterCatchBlock(),b["return"](Promise.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.INVALID_SERVER_CERTIFICATE,d.message)))}})})},shaka.media.DrmEngine.prototype.removeSession=function(a){var b=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function c(){var d,e,f;return $jscomp.generator.createGenerator(c,function(c){switch(c.nextAddress){case 1:return goog.asserts.assert(b.mediaKeys_,"Must call init() before removeSession"),c["yield"](b.loadOfflineSession_(a),2);case 2:return(d=c.yieldResult)?(e=[],(f=b.activeSessions_.get(d))&&(f.updatePromise=new shaka.util.PublicPromise,e.push(f.updatePromise)),shaka.log.v2("Attempting to remove session",a),e.push(d.remove()),c["yield"](Promise.all(e),0)):(shaka.log.v2("Ignoring attempt to remove missing session",a),c["return"]())}})})},shaka.media.DrmEngine.prototype.createOrLoad=function(){var a=this,b=this.currentDrmInfo_?this.currentDrmInfo_.initData:[];return b.forEach(function(b){return a.createTemporarySession_(b.initDataType,b.initData)}),this.offlineSessionIds_.forEach(function(b){return a.loadOfflineSession_(b)}),b.length||this.offlineSessionIds_.length||this.allSessionsLoaded_.resolve(),this.allSessionsLoaded_},shaka.media.DrmEngine.prototype.newInitData=function(a,b){var c=shaka.util.Uint8ArrayUtils,d=this.activeSessions_.values();d=$jscomp.makeIterator(d);for(var e=d.next();!e.done;e=d.next())if(c.equal(b,e.value.initData))return void shaka.log.debug("Ignoring duplicate init data.");this.createTemporarySession_(a,b)},shaka.media.DrmEngine.prototype.initialized=function(){return this.initialized_},shaka.media.DrmEngine.prototype.keySystem=function(){return this.currentDrmInfo_?this.currentDrmInfo_.keySystem:""},shaka.media.DrmEngine.prototype.willSupport=function(a){return!!shaka.util.Platform.isEdge()||this.supportedTypes_.has(a)},shaka.media.DrmEngine.prototype.getSessionIds=function(){var a=this.activeSessions_.keys();return a=shaka.util.Iterables.map(a,function(a){return a.sessionId}),Array.from(a)},shaka.media.DrmEngine.prototype.getExpiration=function(){var a=1/0,b=this.activeSessions_.keys();b=$jscomp.makeIterator(b);for(var c=b.next();!c.done;c=b.next())c=c.value,isNaN(c.expiration)||(a=Math.min(a,c.expiration));return a},shaka.media.DrmEngine.prototype.getDrmInfo=function(){return this.currentDrmInfo_},shaka.media.DrmEngine.prototype.getKeyStatuses=function(){return shaka.util.MapUtils.asObject(this.announcedKeyStatusByKeyId_)},shaka.media.DrmEngine.prototype.prepareMediaKeyConfigsForVariants_=function(a){for(var b=new Set,c=$jscomp.makeIterator(a),d=c.next();!d.done;d=c.next()){var e=$jscomp.makeIterator(d.value.drmInfos);for(d=e.next();!d.done;d=e.next())b.add(d.value)}for(c=$jscomp.makeIterator(b),d=c.next();!d.done;d=c.next())shaka.media.DrmEngine.fillInDrmInfoDefaults_(d.value,shaka.util.MapUtils.asMap(this.config_.servers),shaka.util.MapUtils.asMap(this.config_.advanced||{}));e=this.usePersistentLicenses_?"required":"optional";var f=this.usePersistentLicenses_?["persistent-license"]:["temporary"];for(c=new Map,b=$jscomp.makeIterator(b),d=b.next();!d.done;d=b.next())d=d.value,c.set(d.keySystem,{audioCapabilities:[],videoCapabilities:[],distinctiveIdentifier:"optional",persistentState:e,sessionTypes:f,label:d.keySystem,drmInfos:[]});for(a=$jscomp.makeIterator(a),d=a.next();!d.done;d=a.next()){d=d.value,b=d.audio,e=d.video,f=b?shaka.util.MimeUtils.getFullType(b.mimeType,b.codecs):"";var g=e?shaka.util.MimeUtils.getFullType(e.mimeType,e.codecs):"",h=$jscomp.makeIterator(d.drmInfos);for(d=h.next();!d.done;d=h.next()){d=d.value;var i=c.get(d.keySystem);goog.asserts.assert(i,"Any missing configs should have be filled in before."),i.drmInfos.push(d),d.distinctiveIdentifierRequired&&(i.distinctiveIdentifier="required"),d.persistentStateRequired&&(i.persistentState="required"),b&&i.audioCapabilities.push({robustness:d.audioRobustness||"",contentType:f}),e&&i.videoCapabilities.push({robustness:d.videoRobustness||"",contentType:g})}}return c},shaka.media.DrmEngine.prototype.queryMediaKeys_=function(a){if(1==a.size&&a.has(""))return Promise.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.NO_RECOGNIZED_KEY_SYSTEMS));for(var b=$jscomp.makeIterator(a.values()),c=b.next();!c.done;c=b.next())c=c.value,0==c.audioCapabilities.length&&delete c.audioCapabilities,0==c.videoCapabilities.length&&delete c.videoCapabilities;var d=b=new shaka.util.PublicPromise;return[!0,!1].forEach(function(b){var c=this;a.forEach(function(a,e){a.drmInfos.some(function(a){return!!a.licenseServerUri})==b&&(d=d["catch"](function(){if(!this.isDestroying_)return navigator.requestMediaKeySystemAccess(e,[a])}.bind(c)))})}.bind(this)),d=d["catch"](function(){return Promise.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.REQUESTED_KEY_SYSTEM_CONFIG_UNAVAILABLE))}),d=d.then(function(b){if(this.isDestroying_)return Promise.reject();this.supportedTypes_.clear();var c=b.getConfiguration(),d=c.videoCapabilities||[],e=$jscomp.makeIterator(c.audioCapabilities||[]);for(c=e.next();!c.done;c=e.next())this.supportedTypes_.add(c.value.contentType);for(d=$jscomp.makeIterator(d),c=d.next();!c.done;c=d.next())this.supportedTypes_.add(c.value.contentType);return goog.asserts.assert(this.supportedTypes_.size,"We should get at least one supported MIME type"),this.currentDrmInfo_=shaka.media.DrmEngine.createDrmInfoFor_(b.keySystem,a.get(b.keySystem)),this.currentDrmInfo_.licenseServerUri?b.createMediaKeys():Promise.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.NO_LICENSE_SERVER_GIVEN,this.currentDrmInfo_.keySystem))}.bind(this)).then(function(a){return this.isDestroying_?Promise.reject():(shaka.log.info("Created MediaKeys object for key system",this.currentDrmInfo_.keySystem),this.mediaKeys_=a,void(this.initialized_=!0))}.bind(this))["catch"](function(a){if(!this.isDestroying_)return this.currentDrmInfo_=null,this.supportedTypes_.clear(),a instanceof shaka.util.Error?Promise.reject(a):Promise.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.FAILED_TO_CREATE_CDM,a.message))}.bind(this)),b.reject(),d},shaka.media.DrmEngine.prototype.configureClearKey_=function(){var a=shaka.util.MapUtils.asMap(this.config_.clearKeys);if(0==a.size)return null;var b=shaka.util.StringUtils,c=shaka.util.Uint8ArrayUtils,d=[],e=[];a.forEach(function(a,b){var f=c.fromHex(b),g=c.fromHex(a);f={kty:"oct",kid:c.toBase64(f,!1),k:c.toBase64(g,!1)},d.push(f),e.push(f.kid)}),a=JSON.stringify({keys:d});var f=JSON.stringify({kids:e});return b=[{initData:new Uint8Array(b.toUTF8(f)),initDataType:"keyids"}],{keySystem:"org.w3.clearkey",licenseServerUri:"data:application/json;base64,"+window.btoa(a),distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:b,keyIds:[]}},shaka.media.DrmEngine.prototype.loadOfflineSession_=function(a){try{shaka.log.v1("Attempting to load an offline session",a);var b=this.mediaKeys_.createSession("persistent-license")}catch(c){var d=new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.FAILED_TO_CREATE_SESSION,c.message);return this.onError_(d),Promise.reject(d)}this.eventManager_.listen(b,"message",this.onSessionMessage_.bind(this)),this.eventManager_.listen(b,"keystatuseschange",this.onKeyStatusesChange_.bind(this));var e={initData:null,loaded:!1,oldExpiration:1/0,updatePromise:null};return this.activeSessions_.set(b,e),b.load(a).then(function(c){return this.isDestroying_?Promise.reject():(shaka.log.v2("Loaded offline session",a,c),c?(e.loaded=!0,this.areAllSessionsLoaded_()&&this.allSessionsLoaded_.resolve(),b):(this.activeSessions_["delete"](b),void this.onError_(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.OFFLINE_SESSION_REMOVED))))}.bind(this),function(a){this.isDestroying_||(this.activeSessions_["delete"](b),this.onError_(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.FAILED_TO_CREATE_SESSION,a.message)))}.bind(this))},shaka.media.DrmEngine.prototype.createTemporarySession_=function(a,b){var c=this;try{if(this.usePersistentLicenses_){shaka.log.v1("Creating new persistent session");var d=this.mediaKeys_.createSession("persistent-license")}else shaka.log.v1("Creating new temporary session"),d=this.mediaKeys_.createSession()}catch(e){return void this.onError_(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.FAILED_TO_CREATE_SESSION,e.message))}this.eventManager_.listen(d,"message",this.onSessionMessage_.bind(this)),this.eventManager_.listen(d,"keystatuseschange",this.onKeyStatusesChange_.bind(this)),this.activeSessions_.set(d,{initData:b,loaded:!1,oldExpiration:1/0,updatePromise:null});try{if(this.config_.initDataTransform)b=this.config_.initDataTransform(b);else if(this.keySystem().startsWith("com.apple.fps")){var f=this.currentDrmInfo_.serverCertificate,g=shaka.util.FairPlayUtils.defaultGetContentId(b);b=shaka.util.FairPlayUtils.initDataTransform(b,g,f)}}catch(e){return f=e,e instanceof shaka.util.Error||(f=new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.INIT_DATA_TRANSFORM_ERROR,e)),void this.onError_(f)}d.generateRequest(a,b.buffer)["catch"](function(a){if(!c.isDestroying_){if(c.activeSessions_["delete"](d),a.errorCode&&a.errorCode.systemCode){var b=a.errorCode.systemCode;0>b&&(b+=Math.pow(2,32)),b="0x"+b.toString(16)}c.onError_(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.FAILED_TO_GENERATE_LICENSE_REQUEST,a.message,a,b))}})},shaka.media.DrmEngine.prototype.onSessionMessage_=function(a){this.delayLicenseRequest_()?this.mediaKeyMessageEvents_.push(a):this.sendLicenseRequest_(a)},shaka.media.DrmEngine.prototype.delayLicenseRequest_=function(){return this.config_.delayLicenseRequestUntilPlayed&&this.video_.paused&&!this.initialRequestsSent_},shaka.media.DrmEngine.prototype.sendLicenseRequest_=function(a){var b=a.target;shaka.log.v2("Sending license request for session",b.sessionId);var c=this.activeSessions_.get(b),d=this.currentDrmInfo_.licenseServerUri,e=this.config_.advanced[this.currentDrmInfo_.keySystem];"individualization-request"==a.messageType&&e&&e.individualizationServer&&(d=e.individualizationServer),e=shaka.net.NetworkingEngine.RequestType.LICENSE,d=shaka.net.NetworkingEngine.makeRequest([d],this.config_.retryParameters),d.body=a.message,d.method="POST",d.licenseRequestType=a.messageType,d.sessionId=b.sessionId,"com.microsoft.playready"!=this.currentDrmInfo_.keySystem&&"com.chromecast.playready"!=this.currentDrmInfo_.keySystem||this.unpackPlayReadyRequest_(d),this.currentDrmInfo_.keySystem.startsWith("com.apple.fps")&&this.config_.fairPlayTransform&&this.formatFairPlayRequest_(d),this.playerInterface_.netEngine.request(e,d).promise.then(function(a){return this.isDestroying_?Promise.reject():(this.currentDrmInfo_.keySystem.startsWith("com.apple.fps")&&this.config_.fairPlayTransform&&this.parseFairPlayResponse_(a),b.update(a.data).then(function(){var a=this,b=new shaka.util.FakeEvent("drmsessionupdate");this.playerInterface_.onEvent(b),c&&(c.updatePromise&&c.updatePromise.resolve(),new shaka.util.Timer(function(){c.loaded=!0,a.areAllSessionsLoaded_()&&a.allSessionsLoaded_.resolve()}).tickAfter(shaka.media.DrmEngine.SESSION_LOAD_TIMEOUT_))}.bind(this)))}.bind(this),function(a){this.isDestroying_||(goog.asserts.assert(a instanceof shaka.util.Error,"Wrong NetworkingEngine error type!"),a=new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.LICENSE_REQUEST_FAILED,a),this.onError_(a),c&&c.updatePromise&&c.updatePromise.reject(a))}.bind(this))["catch"](function(a){this.isDestroying_||(a=new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.LICENSE_RESPONSE_REJECTED,a.message),this.onError_(a),c&&c.updatePromise&&c.updatePromise.reject(a))}.bind(this))},shaka.media.DrmEngine.prototype.unpackPlayReadyRequest_=function(a){var b=shaka.util.StringUtils.fromUTF16(a.body,!0,!0);if(b.includes("PlayReadyKeyMessage")){shaka.log.debug("Unwrapping PlayReady request."),b=(new DOMParser).parseFromString(b,"application/xml");for(var c=b.getElementsByTagName("HttpHeader"),d=0;d<c.length;++d){var e=c[d].querySelector("name"),f=c[d].querySelector("value");goog.asserts.assert(e&&f,"Malformed PlayReady headers!"),a.headers[e.textContent]=f.textContent}b=b.querySelector("Challenge"),goog.asserts.assert(b,"Malformed PlayReady challenge!"),goog.asserts.assert("base64encoded"==b.getAttribute("encoding"),"Unexpected PlayReady challenge encoding!"),a.body=shaka.util.Uint8ArrayUtils.fromBase64(b.textContent).buffer}else shaka.log.debug("PlayReady request is already unwrapped."),a.headers["Content-Type"]="text/xml; charset=utf-8"},shaka.media.DrmEngine.prototype.formatFairPlayRequest_=function(a){var b=new Uint8Array(a.body);b=shaka.util.Uint8ArrayUtils.toBase64(b),a.headers["Content-Type"]="application/x-www-form-urlencoded",a.body=shaka.util.StringUtils.toUTF8("spc="+b)},shaka.media.DrmEngine.prototype.parseFairPlayResponse_=function(a){try{var b=shaka.util.StringUtils.fromUTF8(a.data)}catch(c){return}b=b.trim(),"<ckc>"===b.substr(0,5)&&"</ckc>"===b.substr(-6)&&(b=b.slice(5,-6));try{b=JSON.parse(b).ckc}catch(c){}a.data=shaka.util.Uint8ArrayUtils.fromBase64(b).buffer},shaka.media.DrmEngine.prototype.onKeyStatusesChange_=function(a){a=a.target,shaka.log.v2("Key status changed for session",a.sessionId);var b=this.activeSessions_.get(a),c=!1;a.keyStatuses.forEach(function(a,d){if("string"==typeof d){var e=d;d=a,a=e}if("com.microsoft.playready"==this.currentDrmInfo_.keySystem&&16==d.byteLength&&!shaka.util.Platform.isTizen()){e=new DataView(d);var f=e.getUint32(0,!0),g=e.getUint16(4,!0),h=e.getUint16(6,!0);e.setUint32(0,f,!1),e.setUint16(4,g,!1),e.setUint16(6,h,!1)}"com.microsoft.playready"==this.currentDrmInfo_.keySystem&&"status-pending"==a&&(a="usable"),"status-pending"!=a&&(b.loaded=!0),b||goog.asserts.assert("usable"!=a,"Usable keys found in closed session"),"expired"==a&&(c=!0),e=shaka.util.Uint8ArrayUtils.toHex(new Uint8Array(d)),this.keyStatusByKeyId_.set(e,a)}.bind(this));var d=a.expiration-Date.now();(0>d||c&&1e3>d)&&b&&!b.updatePromise&&(shaka.log.debug("Session has expired",a.sessionId),this.activeSessions_["delete"](a),a.close()["catch"](function(){})),this.areAllSessionsLoaded_()&&(this.allSessionsLoaded_.resolve(),this.keyStatusTimer_.tickAfter(shaka.media.DrmEngine.KEY_STATUS_BATCH_TIME_))},shaka.media.DrmEngine.prototype.processKeyStatusChanges_=function(){var a=this.keyStatusByKeyId_,b=this.announcedKeyStatusByKeyId_;b.clear(),a.forEach(function(a,c){return b.set(c,a)}),a=Array.from(b.values()),a.length&&a.every(function(a){return"expired"==a})&&this.onError_(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.EXPIRED)),this.playerInterface_.onKeyStatus(shaka.util.MapUtils.asObject(b))},shaka.media.DrmEngine.isBrowserSupported=function(){return!!(window.MediaKeys&&window.navigator&&window.navigator.requestMediaKeySystemAccess&&window.MediaKeySystemAccess&&window.MediaKeySystemAccess.prototype.getConfiguration)},shaka.media.DrmEngine.probeSupport=function(){goog.asserts.assert(shaka.media.DrmEngine.isBrowserSupported(),"Must have basic EME support");var a=[{contentType:'video/mp4; codecs="avc1.42E01E"'},{contentType:'video/webm; codecs="vp8"'}],b=[{videoCapabilities:a,persistentState:"required",sessionTypes:["persistent-license"]},{videoCapabilities:a}],c=new Map,d=function(a){return $jscomp.asyncExecutePromiseGeneratorFunction(function d(){var e,f,g;return $jscomp.generator.createGenerator(d,function(d){switch(d.nextAddress){case 1:return d.setCatchFinallyBlocks(2),d["yield"](navigator.requestMediaKeySystemAccess(a,b),4);case 4:return e=d.yieldResult,g=!!(f=e.getConfiguration().sessionTypes)&&f.includes("persistent-license"),shaka.util.Platform.isTizen3()&&(g=!1),c.set(a,{persistentState:g}),d["yield"](e.createMediaKeys(),5);case 5:d.leaveTryBlock(0);break;case 2:d.enterCatchBlock(),c.set(a,null),d.jumpToEnd()}})})};return a="org.w3.clearkey com.widevine.alpha com.microsoft.playready com.apple.fps.3_0 com.apple.fps.2_0 com.apple.fps.1_0 com.apple.fps com.adobe.primetime".split(" ").map(function(a){return d(a)}),Promise.all(a).then(function(){return shaka.util.MapUtils.asObject(c)})},shaka.media.DrmEngine.prototype.onPlay_=function(){for(var a=0;a<this.mediaKeyMessageEvents_.length;a++)this.sendLicenseRequest_(this.mediaKeyMessageEvents_[a]);this.initialRequestsSent_=!0,this.mediaKeyMessageEvents_=[]},shaka.media.DrmEngine.prototype.supportsVariant=function(a){var b=a.audio,c=a.video;if(b&&b.encrypted&&(b=shaka.util.MimeUtils.getFullType(b.mimeType,b.codecs),!this.willSupport(b))||c&&c.encrypted&&(c=shaka.util.MimeUtils.getFullType(c.mimeType,c.codecs),!this.willSupport(c)))return!1;var d=this.keySystem();return 0==a.drmInfos.length||a.drmInfos.some(function(a){return a.keySystem==d;
})},shaka.media.DrmEngine.areDrmCompatible=function(a,b){return!a.length||!b.length||0<shaka.media.DrmEngine.getCommonDrmInfos(a,b).length},shaka.media.DrmEngine.getCommonDrmInfos=function(a,b){if(!a.length)return b;if(!b.length)return a;for(var c=[],d=0;d<a.length;d++)for(var e=0;e<b.length;e++)if(a[d].keySystem==b[e].keySystem){var f=a[d];e=b[e];var g=[];g=g.concat(f.initData||[]),g=g.concat(e.initData||[]);var h=[];h=h.concat(f.keyIds),h=h.concat(e.keyIds),c.push({keySystem:f.keySystem,licenseServerUri:f.licenseServerUri||e.licenseServerUri,distinctiveIdentifierRequired:f.distinctiveIdentifierRequired||e.distinctiveIdentifierRequired,persistentStateRequired:f.persistentStateRequired||e.persistentStateRequired,videoRobustness:f.videoRobustness||e.videoRobustness,audioRobustness:f.audioRobustness||e.audioRobustness,serverCertificate:f.serverCertificate||e.serverCertificate,initData:g,keyIds:h});break}return c},shaka.media.DrmEngine.prototype.pollExpiration_=function(){var a=this;this.activeSessions_.forEach(function(b,c){var d=b.oldExpiration,e=c.expiration;isNaN(e)&&(e=1/0),e!=d&&(a.playerInterface_.onExpirationUpdated(c.sessionId,e),b.oldExpiration=e)})},shaka.media.DrmEngine.prototype.areAllSessionsLoaded_=function(){var a=this.activeSessions_.values();return shaka.util.Iterables.every(a,function(a){return a.loaded})},shaka.media.DrmEngine.replaceDrmInfo_=function(a,b){var c=[];b.forEach(function(a,b){c.push({keySystem:b,licenseServerUri:a,distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:[],keyIds:[]})});for(var d=$jscomp.makeIterator(a),e=d.next();!e.done;e=d.next())e.value.drmInfos=c},shaka.media.DrmEngine.createDrmInfoFor_=function(a,b){var c=[],d=[],e=[],f=[];return shaka.media.DrmEngine.processDrmInfos_(b.drmInfos,c,d,e,f),1<d.length&&shaka.log.warning("Multiple unique server certificates found! Only the first will be used."),1<c.length&&shaka.log.warning("Multiple unique license server URIs found! Only the first will be used."),{keySystem:a,licenseServerUri:c[0],distinctiveIdentifierRequired:"required"==b.distinctiveIdentifier,persistentStateRequired:"required"==b.persistentState,audioRobustness:b.audioCapabilities?b.audioCapabilities[0].robustness:"",videoRobustness:b.videoCapabilities?b.videoCapabilities[0].robustness:"",serverCertificate:d[0],initData:e,keyIds:f}},shaka.media.DrmEngine.processDrmInfos_=function(a,b,c,d,e){a.forEach(function(a){var f=shaka.util.Uint8ArrayUtils;if(b.includes(a.licenseServerUri)||b.push(a.licenseServerUri),a.serverCertificate&&(c.some(function(b){return f.equal(b,a.serverCertificate)})||c.push(a.serverCertificate)),a.initData&&a.initData.forEach(function(a){d.some(function(b){return b=!(!b.keyId||b.keyId!=a.keyId)||b.initDataType==a.initDataType&&shaka.util.Uint8ArrayUtils.equal(b.initData,a.initData)})||d.push(a)}),a.keyIds)for(var g=0;g<a.keyIds.length;++g)e.includes(a.keyIds[g])||e.push(a.keyIds[g])})},shaka.media.DrmEngine.fillInDrmInfoDefaults_=function(a,b,c){!a.keySystem||"org.w3.clearkey"==a.keySystem&&a.licenseServerUri||(b.size&&(b=b.get(a.keySystem)||"",a.licenseServerUri=b),a.keyIds||(a.keyIds=[]),(c=c.get(a.keySystem))&&(a.distinctiveIdentifierRequired||(a.distinctiveIdentifierRequired=c.distinctiveIdentifierRequired),a.persistentStateRequired||(a.persistentStateRequired=c.persistentStateRequired),a.videoRobustness||(a.videoRobustness=c.videoRobustness),a.audioRobustness||(a.audioRobustness=c.audioRobustness),a.serverCertificate||(a.serverCertificate=c.serverCertificate)),window.cast&&window.cast.__platform__&&"com.microsoft.playready"==a.keySystem&&(a.keySystem="com.chromecast.playready"))},shaka.media.DrmEngine.closeSession_=function(a){return $jscomp.asyncExecutePromiseGeneratorFunction(function b(){var c,d,e;return $jscomp.generator.createGenerator(b,function(b){switch(b.nextAddress){case 1:return c=shaka.media.DrmEngine,d=new Promise(function(a){new shaka.util.Timer(a).tickAfter(c.CLOSE_TIMEOUT_)}),b["yield"](Promise.race([a.close().then(function(){return!0}),d.then(function(){return!1})]),2);case 2:(e=b.yieldResult)||shaka.log.warning("Timeout waiting for session close"),b.jumpToEnd()}})})},shaka.media.DrmEngine.CLOSE_TIMEOUT_=1,shaka.media.DrmEngine.SESSION_LOAD_TIMEOUT_=5,shaka.media.DrmEngine.KEY_STATUS_BATCH_TIME_=.5,shaka.media.IClosedCaptionParser=function(){},shaka.media.IClosedCaptionParser.prototype.init=function(a){},shaka.media.IClosedCaptionParser.prototype.parseFrom=function(a,b){},shaka.media.IClosedCaptionParser.prototype.reset=function(){},shaka.media.MuxJSClosedCaptionParser=function(){this.muxCaptionParser_=new muxjs.mp4.CaptionParser,this.videoTrackIds_=[],this.timescales_={}},shaka.media.MuxJSClosedCaptionParser.prototype.init=function(a){var b=muxjs.mp4.probe;a=new Uint8Array(a),this.videoTrackIds_=b.videoTrackIds(a),this.timescales_=b.timescale(a),this.muxCaptionParser_.init()},shaka.media.MuxJSClosedCaptionParser.prototype.parseFrom=function(a,b){var c=new Uint8Array(a);(c=this.muxCaptionParser_.parse(c,this.videoTrackIds_,this.timescales_))&&c.captions&&b(c.captions),this.muxCaptionParser_.clearParsedCaptions()},shaka.media.MuxJSClosedCaptionParser.prototype.reset=function(){this.muxCaptionParser_.resetCaptionStream()},shaka.media.MuxJSClosedCaptionParser.isSupported=function(){return!!window.muxjs},shaka.media.NoopCaptionParser=function(){},shaka.media.NoopCaptionParser.prototype.init=function(a){},shaka.media.NoopCaptionParser.prototype.parseFrom=function(a,b){},shaka.media.NoopCaptionParser.prototype.reset=function(){},shaka.media.TimeRangesUtils={},shaka.media.TimeRangesUtils.bufferStart=function(a){return!a||1==a.length&&1e-6>a.end(0)-a.start(0)?null:1==a.length&&0>a.start(0)?0:a.length?a.start(0):null},shaka.media.TimeRangesUtils.bufferEnd=function(a){return!a||1==a.length&&1e-6>a.end(0)-a.start(0)?null:a.length?a.end(a.length-1):null},shaka.media.TimeRangesUtils.isBuffered=function(a,b,c){return c=void 0===c?0:c,!(!a||!a.length||1==a.length&&1e-6>a.end(0)-a.start(0)||b>a.end(a.length-1))&&b+c>=a.start(0)},shaka.media.TimeRangesUtils.bufferedAheadOf=function(a,b){if(!a||!a.length||1==a.length&&1e-6>a.end(0)-a.start(0))return 0;for(var c=0,d=a.length-1;0<=d&&a.end(d)>b;--d)c+=a.end(d)-Math.max(a.start(d),b);return c},shaka.media.TimeRangesUtils.getGapIndex=function(a,b){var c=shaka.util.Platform;if(!a||!a.length||1==a.length&&1e-6>a.end(0)-a.start(0))return null;c=c.isEdge()||c.isIE()||c.isTizen()||c.isChromecast()?.5:.1;for(var d=0;d<a.length;d++)if(a.start(d)>b&&(0==d||a.end(d-1)-b<=c))return d;return null},shaka.media.TimeRangesUtils.getBufferedInfo=function(a){if(!a)return[];for(var b=[],c=0;c<a.length;c++)b.push({start:a.start(c),end:a.end(c)});return b},shaka.util.Functional={},shaka.util.Functional.createFallbackPromiseChain=function(a,b){return a.reduce(function(a,b,c){return b["catch"](a.bind(null,c))}.bind(null,b),Promise.reject())},shaka.util.Functional.collapseArrays=function(a,b){return a.concat(b)},shaka.util.Functional.noop=function(){},shaka.util.Functional.isNotNull=function(a){return null!=a},shaka.util.ManifestParserUtils={},shaka.util.ManifestParserUtils.resolveUris=function(a,b){var c=shaka.util.Functional;if(0==b.length)return a;var d=b.map(function(a){return new goog.Uri(a)});return a.map(function(a){return new goog.Uri(a)}).map(function(a){return d.map(a.resolve.bind(a))}).reduce(c.collapseArrays,[]).map(function(a){return a.toString()})},shaka.util.ManifestParserUtils.createDrmInfo=function(a,b){return{keySystem:a,licenseServerUri:"",distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:b||[],keyIds:[]}},shaka.util.ManifestParserUtils.ContentType={VIDEO:"video",AUDIO:"audio",TEXT:"text",APPLICATION:"application"},shaka.util.ManifestParserUtils.TextStreamKind={SUBTITLE:"subtitle",CLOSED_CAPTION:"caption"},shaka.util.ManifestParserUtils.GAP_OVERLAP_TOLERANCE_SECONDS=1/15,shaka.media.Transmuxer=function(){this.muxTransmuxer_=new muxjs.mp4.Transmuxer({keepOriginalTimestamps:!0}),this.transmuxPromise_=null,this.transmuxedData_=[],this.captions_=[],this.isTransmuxing_=!1,this.muxTransmuxer_.on("data",this.onTransmuxed_.bind(this)),this.muxTransmuxer_.on("done",this.onTransmuxDone_.bind(this))},shaka.media.Transmuxer.prototype.destroy=function(){return this.muxTransmuxer_.dispose(),this.muxTransmuxer_=null,Promise.resolve()},shaka.media.Transmuxer.isSupported=function(a,b){if(!window.muxjs||!shaka.media.Transmuxer.isTsContainer(a))return!1;var c=shaka.media.Transmuxer.convertTsCodecs;if(b)return MediaSource.isTypeSupported(c(b,a));var d=shaka.util.ManifestParserUtils.ContentType;return MediaSource.isTypeSupported(c(d.AUDIO,a))||MediaSource.isTypeSupported(c(d.VIDEO,a))},shaka.media.Transmuxer.isTsContainer=function(a){return"mp2t"==a.toLowerCase().split(";")[0].split("/")[1]},shaka.media.Transmuxer.convertTsCodecs=function(a,b){var c=shaka.util.ManifestParserUtils.ContentType,d=b.replace(/mp2t/i,"mp4");if(a==c.AUDIO&&(d=d.replace("video","audio")),c=/avc1\.(66|77|100)\.(\d+)/.exec(d)){var e="avc1.",f=c[1];"66"==f?e+="4200":"77"==f?e+="4d00":(goog.asserts.assert("100"==f,"Legacy avc1 parsing code out of sync with regex!"),e+="6400"),f=Number(c[2]),goog.asserts.assert(256>f,"Invalid legacy avc1 level number!"),e+=(f>>4).toString(16),e+=(15&f).toString(16),d=d.replace(c[0],e)}return d},shaka.media.Transmuxer.prototype.transmux=function(a){return goog.asserts.assert(!this.isTransmuxing_,"No transmuxing should be in progress."),this.isTransmuxing_=!0,this.transmuxPromise_=new shaka.util.PublicPromise,this.transmuxedData_=[],this.captions_=[],a=new Uint8Array(a),this.muxTransmuxer_.push(a),this.muxTransmuxer_.flush(),this.isTransmuxing_&&this.transmuxPromise_.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.TRANSMUXING_FAILED)),this.transmuxPromise_},shaka.media.Transmuxer.prototype.onTransmuxed_=function(a){this.captions_=a.captions;var b=new Uint8Array(a.data.byteLength+a.initSegment.byteLength);b.set(a.initSegment,0),b.set(a.data,a.initSegment.byteLength),this.transmuxedData_.push(b)},shaka.media.Transmuxer.prototype.onTransmuxDone_=function(){var a={data:shaka.util.Uint8ArrayUtils.concat.apply(null,this.transmuxedData_),captions:this.captions_};this.transmuxPromise_.resolve(a),this.isTransmuxing_=!1},shaka.text={},shaka.text.Cue=function(a,b,c){var d=shaka.text.Cue;this.startTime=a,this.direction=d.direction.HORIZONTAL_LEFT_TO_RIGHT,this.endTime=b,this.payload=c,this.region=new shaka.text.CueRegion,this.position=null,this.positionAlign=d.positionAlign.AUTO,this.size=100,this.textAlign=d.textAlign.CENTER,this.writingMode=d.writingMode.HORIZONTAL_TOP_TO_BOTTOM,this.lineInterpretation=d.lineInterpretation.LINE_NUMBER,this.line=null,this.lineHeight="",this.lineAlign=d.lineAlign.START,this.displayAlign=d.displayAlign.AFTER,this.fontSize=this.backgroundImage=this.backgroundColor=this.color="",this.fontWeight=d.fontWeight.NORMAL,this.fontStyle=d.fontStyle.NORMAL,this.fontFamily="",this.textDecoration=[],this.wrapLine=!0,this.id=""},goog.exportSymbol("shaka.text.Cue",shaka.text.Cue),shaka.text.Cue.positionAlign={LEFT:"line-left",RIGHT:"line-right",CENTER:"center",AUTO:"auto"},goog.exportProperty(shaka.text.Cue,"positionAlign",shaka.text.Cue.positionAlign),shaka.text.Cue.textAlign={LEFT:"left",RIGHT:"right",CENTER:"center",START:"start",END:"end"},goog.exportProperty(shaka.text.Cue,"textAlign",shaka.text.Cue.textAlign),shaka.text.Cue.displayAlign={BEFORE:"before",CENTER:"center",AFTER:"after"},goog.exportProperty(shaka.text.Cue,"displayAlign",shaka.text.Cue.displayAlign),shaka.text.Cue.direction={HORIZONTAL_LEFT_TO_RIGHT:"ltr",HORIZONTAL_RIGHT_TO_LEFT:"rtl"},goog.exportProperty(shaka.text.Cue,"direction",shaka.text.Cue.direction),shaka.text.Cue.writingMode={HORIZONTAL_TOP_TO_BOTTOM:"horizontal-tb",VERTICAL_LEFT_TO_RIGHT:"vertical-lr",VERTICAL_RIGHT_TO_LEFT:"vertical-rl"},goog.exportProperty(shaka.text.Cue,"writingMode",shaka.text.Cue.writingMode),shaka.text.Cue.lineInterpretation={LINE_NUMBER:0,PERCENTAGE:1},goog.exportProperty(shaka.text.Cue,"lineInterpretation",shaka.text.Cue.lineInterpretation),shaka.text.Cue.lineAlign={CENTER:"center",START:"start",END:"end"},goog.exportProperty(shaka.text.Cue,"lineAlign",shaka.text.Cue.lineAlign),shaka.text.Cue.fontWeight={NORMAL:400,BOLD:700},goog.exportProperty(shaka.text.Cue,"fontWeight",shaka.text.Cue.fontWeight),shaka.text.Cue.fontStyle={NORMAL:"normal",ITALIC:"italic",OBLIQUE:"oblique"},goog.exportProperty(shaka.text.Cue,"fontStyle",shaka.text.Cue.fontStyle),shaka.text.Cue.textDecoration={UNDERLINE:"underline",LINE_THROUGH:"lineThrough",OVERLINE:"overline"},goog.exportProperty(shaka.text.Cue,"textDecoration",shaka.text.Cue.textDecoration),shaka.text.CueRegion=function(){var a=shaka.text.CueRegion;this.id="",this.regionAnchorY=this.regionAnchorX=this.viewportAnchorY=this.viewportAnchorX=0,this.height=this.width=100,this.viewportAnchorUnits=this.widthUnits=this.heightUnits=a.units.PERCENTAGE,this.scroll=a.scrollMode.NONE},goog.exportSymbol("shaka.text.CueRegion",shaka.text.CueRegion),shaka.text.CueRegion.units={PX:0,PERCENTAGE:1,LINES:2},goog.exportProperty(shaka.text.CueRegion,"units",shaka.text.CueRegion.units),shaka.text.CueRegion.scrollMode={NONE:"",UP:"up"},goog.exportProperty(shaka.text.CueRegion,"scrollMode",shaka.text.CueRegion.scrollMode),shaka.text.TextEngine=function(a){this.parser_=null,this.displayer_=a,this.appendWindowStart_=this.timestampOffset_=0,this.appendWindowEnd_=1/0,this.bufferEnd_=this.bufferStart_=null,this.selectedClosedCaptionId_="",this.closedCaptionsMap_=new Map},shaka.text.TextEngine.parserMap_={},shaka.text.TextEngine.registerParser=function(a,b){shaka.text.TextEngine.parserMap_[a]=b},goog.exportSymbol("shaka.text.TextEngine.registerParser",shaka.text.TextEngine.registerParser),shaka.text.TextEngine.unregisterParser=function(a){delete shaka.text.TextEngine.parserMap_[a]},goog.exportSymbol("shaka.text.TextEngine.unregisterParser",shaka.text.TextEngine.unregisterParser),shaka.text.TextEngine.isTypeSupported=function(a){return!!(shaka.text.TextEngine.parserMap_[a]||window.muxjs&&a==shaka.util.MimeUtils.CLOSED_CAPTION_MIMETYPE)},shaka.text.TextEngine.prototype.destroy=function(){return this.displayer_=this.parser_=null,this.closedCaptionsMap_.clear(),Promise.resolve()},shaka.text.TextEngine.prototype.setDisplayer=function(a){this.displayer_=a},shaka.text.TextEngine.prototype.initParser=function(a){a!=shaka.util.MimeUtils.CLOSED_CAPTION_MIMETYPE&&(a=shaka.text.TextEngine.parserMap_[a],goog.asserts.assert(a,"Text type negotiation should have happened already"),this.parser_=new a)},shaka.text.TextEngine.prototype.getStartTime=function(a){goog.asserts.assert(this.parser_,"The parser should already be initialized");var b={periodStart:0,segmentStart:null,segmentEnd:0};try{return this.parser_.parseMedia(new Uint8Array(a),b)[0].startTime}catch(c){throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.UNABLE_TO_EXTRACT_CUE_START_TIME,c)}},shaka.text.TextEngine.prototype.appendBuffer=function(a,b,c){return goog.asserts.assert(this.parser_,"The parser should already be initialized"),Promise.resolve().then(function(){if(this.parser_&&this.displayer_)if(null==b||null==c)this.parser_.parseInit(new Uint8Array(a));else{var d={periodStart:this.timestampOffset_,segmentStart:b,segmentEnd:c};d=this.parser_.parseMedia(new Uint8Array(a),d).filter(function(a){return a.startTime>=this.appendWindowStart_&&a.startTime<this.appendWindowEnd_}.bind(this)),this.displayer_.append(d),null==this.bufferStart_?this.bufferStart_=Math.max(b,this.appendWindowStart_):(goog.asserts.assert(null!=this.bufferEnd_,"There should already be a buffered range end."),goog.asserts.assert(1>=b-this.bufferEnd_,"There should not be a gap in text references >1s")),this.bufferEnd_=Math.min(c,this.appendWindowEnd_)}}.bind(this))},shaka.text.TextEngine.prototype.remove=function(a,b){return Promise.resolve().then(function(){this.displayer_&&this.displayer_.remove(a,b)&&(null==this.bufferStart_?goog.asserts.assert(null==this.bufferEnd_,"end must be null if startTime is null"):(goog.asserts.assert(null!=this.bufferEnd_,"end must be non-null if startTime is non-null"),b<=this.bufferStart_||a>=this.bufferEnd_||(a<=this.bufferStart_&&b>=this.bufferEnd_?this.bufferStart_=this.bufferEnd_=null:a<=this.bufferStart_&&b<this.bufferEnd_?this.bufferStart_=b:a>this.bufferStart_&&b>=this.bufferEnd_?this.bufferEnd_=a:goog.asserts.assert(!1,"removal from the middle is not supported by TextEngine"))))}.bind(this))},shaka.text.TextEngine.prototype.setTimestampOffset=function(a){this.timestampOffset_=a},shaka.text.TextEngine.prototype.setAppendWindow=function(a,b){this.appendWindowStart_=a,this.appendWindowEnd_=b},shaka.text.TextEngine.prototype.bufferStart=function(){return this.bufferStart_},shaka.text.TextEngine.prototype.bufferEnd=function(){return this.bufferEnd_},shaka.text.TextEngine.prototype.isBuffered=function(a){return null!=this.bufferStart_&&null!=this.bufferEnd_&&(a>=this.bufferStart_&&a<this.bufferEnd_)},shaka.text.TextEngine.prototype.bufferedAheadOf=function(a){return null==this.bufferEnd_||this.bufferEnd_<a?0:(goog.asserts.assert(null!=this.bufferStart_,"start should not be null if end is not null"),this.bufferEnd_-Math.max(a,this.bufferStart_))},shaka.text.TextEngine.prototype.appendCues=function(a){this.displayer_.append(a)},goog.exportProperty(shaka.text.TextEngine.prototype,"appendCues",shaka.text.TextEngine.prototype.appendCues),shaka.text.TextEngine.prototype.setSelectedClosedCaptionId=function(a,b){this.selectedClosedCaptionId_=a;var c=this.closedCaptionsMap_.get(a);if(c)for(var d=$jscomp.makeIterator(c.keys()),e=d.next();!e.done;e=d.next())(e=c.get(e.value))&&(e=e.filter(function(a){return a.endTime<=b}),this.displayer_.append(e))},goog.exportProperty(shaka.text.TextEngine.prototype,"setSelectedClosedCaptionId",shaka.text.TextEngine.prototype.setSelectedClosedCaptionId),shaka.text.TextEngine.prototype.storeAndAppendClosedCaptions=function(a,b,c,d){var e=b+" "+c,f=new Map;a=$jscomp.makeIterator(a);for(var g=a.next();!g.done;g=a.next()){var h=g.value;g=h.stream,f.has(g)||f.set(g,new Map),f.get(g).has(e)||f.get(g).set(e,[]),h.startTime+=d,h.endTime+=d,h.startTime>=this.appendWindowStart_&&h.startTime<this.appendWindowEnd_&&(h=new shaka.text.Cue(h.startTime,h.endTime,h.text),f.get(g).get(e).push(h),g==this.selectedClosedCaptionId_&&this.displayer_.append([h]))}for(d=$jscomp.makeIterator(f.keys()),e=d.next();!e.done;e=d.next())for(e=e.value,this.closedCaptionsMap_.has(e)||this.closedCaptionsMap_.set(e,new Map),a=$jscomp.makeIterator(f.get(e).keys()),g=a.next();!g.done;g=a.next())g=g.value,h=f.get(e).get(g),this.closedCaptionsMap_.get(e).set(g,h);this.bufferStart_=null==this.bufferStart_?Math.max(b,this.appendWindowStart_):Math.min(this.bufferStart_,Math.max(b,this.appendWindowStart_)),this.bufferEnd_=Math.max(this.bufferEnd_,Math.min(c,this.appendWindowEnd_))},shaka.text.TextEngine.prototype.getNumberOfClosedCaptionChannels=function(){return this.closedCaptionsMap_.size},shaka.text.TextEngine.prototype.getNumberOfClosedCaptionsInChannel=function(a){return(a=this.closedCaptionsMap_.get(a))?a.size:0},shaka.media.MediaSourceEngine=function(a,b,c){this.video_=a,this.textDisplayer_=c,this.sourceBuffers_={},this.textEngine_=null,this.queues_={},this.eventManager_=new shaka.util.EventManager,this.destroyed_=!1,this.transmuxers_={},this.captionParser_=b,this.mediaSourceOpen_=new shaka.util.PublicPromise,this.mediaSource_=this.createMediaSource(this.mediaSourceOpen_)},shaka.media.MediaSourceEngine.createObjectURL=window.URL.createObjectURL,shaka.media.MediaSourceEngine.prototype.createMediaSource=function(a){var b=new MediaSource;return this.eventManager_.listenOnce(b,"sourceopen",a.resolve),this.video_.src=shaka.media.MediaSourceEngine.createObjectURL(b),b},shaka.media.MediaSourceEngine.isStreamSupported=function(a){var b=shaka.util.MimeUtils.getFullType(a.mimeType,a.codecs),c=shaka.util.MimeUtils.getExtendedType(a);return shaka.text.TextEngine.isTypeSupported(b)||MediaSource.isTypeSupported(c)||shaka.media.Transmuxer.isSupported(b,a.type)},shaka.media.MediaSourceEngine.probeSupport=function(){for(var a={},b=$jscomp.makeIterator('video/mp4; codecs="avc1.42E01E",video/mp4; codecs="avc3.42E01E",video/mp4; codecs="hev1.1.6.L93.90",video/mp4; codecs="hvc1.1.6.L93.90",video/mp4; codecs="hev1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="hvc1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="vp9",video/mp4; codecs="vp09.00.10.08",audio/mp4; codecs="mp4a.40.2",audio/mp4; codecs="ac-3",audio/mp4; codecs="ec-3",audio/mp4; codecs="opus",audio/mp4; codecs="flac",video/webm; codecs="vp8",video/webm; codecs="vp9",video/webm; codecs="vp09.00.10.08",audio/webm; codecs="vorbis",audio/webm; codecs="opus",video/mp2t; codecs="avc1.42E01E",video/mp2t; codecs="avc3.42E01E",video/mp2t; codecs="hvc1.1.6.L93.90",video/mp2t; codecs="mp4a.40.2",video/mp2t; codecs="ac-3",video/mp2t; codecs="ec-3",text/vtt,application/mp4; codecs="wvtt",application/ttml+xml,application/mp4; codecs="stpp"'.split(",")),c=b.next();!c.done;c=b.next()){c=c.value,shaka.util.Platform.supportsMediaSource()?shaka.text.TextEngine.isTypeSupported(c)?a[c]=!0:a[c]=MediaSource.isTypeSupported(c)||shaka.media.Transmuxer.isSupported(c):a[c]=shaka.util.Platform.supportsMediaType(c);var d=c.split(";")[0];a[d]=a[d]||a[c]}return a},shaka.media.MediaSourceEngine.prototype.destroy=function(){var a=this,b=shaka.util.Functional;this.destroyed_=!0;var c,d=[];for(c in this.queues_){var e=this.queues_[c],f=e[0];for(this.queues_[c]=e.slice(0,1),f&&d.push(f.p["catch"](b.noop)),f=1;f<e.length;++f)e[f].p.reject()}this.textEngine_&&d.push(this.textEngine_.destroy()),this.textDisplayer_&&d.push(this.textDisplayer_.destroy());for(var g in this.transmuxers_)d.push(this.transmuxers_[g].destroy());return Promise.all(d).then(function(){if(a.eventManager_&&(a.eventManager_.release(),a.eventManager_=null),a.video_&&!shaka.util.Platform.isWebOS()&&(a.video_.removeAttribute("src"),a.video_.load(),a.video_=null),a.mediaSource_=null,a.textEngine_=null,a.textDisplayer_=null,a.sourceBuffers_={},a.transmuxers_={},a.captionParser_=null,goog.DEBUG)for(var b in a.queues_)goog.asserts.assert(0==a.queues_[b].length,b+" queue should be empty after destroy!");a.queues_={}})},shaka.media.MediaSourceEngine.prototype.open=function(){return this.mediaSourceOpen_},shaka.media.MediaSourceEngine.prototype.init=function(a,b){var c=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function d(){var e;return $jscomp.generator.createGenerator(d,function(d){switch(d.nextAddress){case 1:return e=shaka.util.ManifestParserUtils.ContentType,d["yield"](c.mediaSourceOpen_,2);case 2:a.forEach(function(a,d){goog.asserts.assert(shaka.media.MediaSourceEngine.isStreamSupported(a),"Type negotiation should happen before MediaSourceEngine.init!");var f=shaka.util.MimeUtils.getFullType(a.mimeType,a.codecs);d==e.TEXT?c.reinitText(f):(!b&&MediaSource.isTypeSupported(f)||!shaka.media.Transmuxer.isSupported(f,d)||(c.transmuxers_[d]=new shaka.media.Transmuxer,f=shaka.media.Transmuxer.convertTsCodecs(d,f)),f=c.mediaSource_.addSourceBuffer(f),c.eventManager_.listen(f,"error",c.onError_.bind(c,d)),c.eventManager_.listen(f,"updateend",c.onUpdateEnd_.bind(c,d)),c.sourceBuffers_[d]=f,c.queues_[d]=[])}),d.jumpToEnd()}})})},shaka.media.MediaSourceEngine.prototype.reinitText=function(a){this.textEngine_||(this.textEngine_=new shaka.text.TextEngine(this.textDisplayer_)),this.textEngine_.initParser(a)},shaka.media.MediaSourceEngine.prototype.ended=function(){return!this.mediaSource_||"ended"==this.mediaSource_.readyState},shaka.media.MediaSourceEngine.prototype.bufferStart=function(a){return a==shaka.util.ManifestParserUtils.ContentType.TEXT?this.textEngine_.bufferStart():shaka.media.TimeRangesUtils.bufferStart(this.getBuffered_(a))},shaka.media.MediaSourceEngine.prototype.bufferEnd=function(a){return a==shaka.util.ManifestParserUtils.ContentType.TEXT?this.textEngine_.bufferEnd():shaka.media.TimeRangesUtils.bufferEnd(this.getBuffered_(a))},shaka.media.MediaSourceEngine.prototype.isBuffered=function(a,b,c){return a==shaka.util.ManifestParserUtils.ContentType.TEXT?this.textEngine_.isBuffered(b):(a=this.getBuffered_(a),shaka.media.TimeRangesUtils.isBuffered(a,b,c))},shaka.media.MediaSourceEngine.prototype.bufferedAheadOf=function(a,b){if(a==shaka.util.ManifestParserUtils.ContentType.TEXT)return this.textEngine_.bufferedAheadOf(b);var c=this.getBuffered_(a);return shaka.media.TimeRangesUtils.bufferedAheadOf(c,b)},shaka.media.MediaSourceEngine.prototype.getBufferedInfo=function(a){var b=shaka.util.ManifestParserUtils.ContentType,c=shaka.media.TimeRangesUtils.getBufferedInfo;a.total=c(this.video_.buffered),a.audio=c(this.getBuffered_(b.AUDIO)),a.video=c(this.getBuffered_(b.VIDEO)),a.text=[],this.textEngine_&&(b=this.textEngine_.bufferStart(),c=this.textEngine_.bufferEnd(),null!=b&&null!=c&&a.text.push({start:b,end:c}))},shaka.media.MediaSourceEngine.prototype.getBuffered_=function(a){try{return this.sourceBuffers_[a].buffered}catch(b){return a in this.sourceBuffers_&&shaka.log.error("failed to get buffered range for "+a,b),null}},shaka.media.MediaSourceEngine.prototype.appendBuffer=function(a,b,c,d,e){var f=this,g=shaka.util.ManifestParserUtils.ContentType;return a==g.TEXT?this.textEngine_.appendBuffer(b,c,d):this.transmuxers_[a]?this.transmuxers_[a].transmux(b).then(function(b){return this.textEngine_||this.reinitText("text/vtt"),b.captions&&this.textEngine_.storeAndAppendClosedCaptions(b.captions,c,d,this.sourceBuffers_[g.VIDEO].timestampOffset),this.enqueueOperation_(a,this.append_.bind(this,a,b.data.buffer))}.bind(this)):(e&&window.muxjs&&(this.textEngine_||this.reinitText("text/vtt"),null==c&&null==d?this.captionParser_.init(b):this.captionParser_.parseFrom(b,function(a){a.length&&f.textEngine_.storeAndAppendClosedCaptions(a,c,d,f.sourceBuffers_[g.VIDEO].timestampOffset)})),this.enqueueOperation_(a,this.append_.bind(this,a,b)))},shaka.media.MediaSourceEngine.prototype.setSelectedClosedCaptionId=function(a){var b=this.bufferEnd(shaka.util.ManifestParserUtils.ContentType.VIDEO)||0;this.textEngine_.setSelectedClosedCaptionId(a,b)},shaka.media.MediaSourceEngine.prototype.remove=function(a,b,c){return goog.asserts.assert(c<Number.MAX_VALUE,"remove() with MAX_VALUE or Infinity is not IE-compatible!"),a==shaka.util.ManifestParserUtils.ContentType.TEXT?this.textEngine_.remove(b,c):this.enqueueOperation_(a,this.remove_.bind(this,a,b,c))},shaka.media.MediaSourceEngine.prototype.clear=function(a){return a==shaka.util.ManifestParserUtils.ContentType.TEXT?this.textEngine_?(this.captionParser_.reset(),this.textEngine_.remove(0,1/0)):Promise.resolve():this.enqueueOperation_(a,this.remove_.bind(this,a,0,this.mediaSource_.duration))},shaka.media.MediaSourceEngine.prototype.flush=function(a){return a==shaka.util.ManifestParserUtils.ContentType.TEXT?Promise.resolve():this.enqueueOperation_(a,this.flush_.bind(this,a))},shaka.media.MediaSourceEngine.prototype.setStreamProperties=function(a,b,c,d){return a==shaka.util.ManifestParserUtils.ContentType.TEXT?(this.textEngine_.setTimestampOffset(b),this.textEngine_.setAppendWindow(c,d),Promise.resolve()):Promise.all([this.enqueueOperation_(a,this.abort_.bind(this,a)),this.enqueueOperation_(a,this.setTimestampOffset_.bind(this,a,b)),this.enqueueOperation_(a,this.setAppendWindow_.bind(this,a,c,d))])},shaka.media.MediaSourceEngine.prototype.endOfStream=function(a){return this.enqueueBlockingOperation_(function(){this.ended()||(a?this.mediaSource_.endOfStream(a):this.mediaSource_.endOfStream())}.bind(this))},shaka.media.MediaSourceEngine.prototype.setDuration=function(a){return goog.asserts.assert(isNaN(this.mediaSource_.duration)||this.mediaSource_.duration<=a,"duration cannot decrease: "+this.mediaSource_.duration+" -> "+a),this.enqueueBlockingOperation_(function(){this.mediaSource_.duration=a}.bind(this))},shaka.media.MediaSourceEngine.prototype.getDuration=function(){return this.mediaSource_.duration},shaka.media.MediaSourceEngine.prototype.append_=function(a,b){this.sourceBuffers_[a].appendBuffer(b)},shaka.media.MediaSourceEngine.prototype.remove_=function(a,b,c){c<=b?this.onUpdateEnd_(a):this.sourceBuffers_[a].remove(b,c)},shaka.media.MediaSourceEngine.prototype.abort_=function(a){var b=this.sourceBuffers_[a].appendWindowStart,c=this.sourceBuffers_[a].appendWindowEnd;this.sourceBuffers_[a].abort(),this.sourceBuffers_[a].appendWindowStart=b,this.sourceBuffers_[a].appendWindowEnd=c,this.onUpdateEnd_(a)},shaka.media.MediaSourceEngine.prototype.flush_=function(a){goog.asserts.assert(0==this.video_.buffered.length,"MediaSourceEngine.flush_ should only be used after clearing all data!"),this.video_.currentTime-=.001,this.onUpdateEnd_(a)},shaka.media.MediaSourceEngine.prototype.setTimestampOffset_=function(a,b){0>b&&(b+=.001),this.sourceBuffers_[a].timestampOffset=b,this.onUpdateEnd_(a)},shaka.media.MediaSourceEngine.prototype.setAppendWindow_=function(a,b,c){this.sourceBuffers_[a].appendWindowStart=0,this.sourceBuffers_[a].appendWindowEnd=c,this.sourceBuffers_[a].appendWindowStart=b,this.onUpdateEnd_(a)},shaka.media.MediaSourceEngine.prototype.onError_=function(a,b){var c=this.queues_[a][0];goog.asserts.assert(c,"Spurious error event!"),goog.asserts.assert(!this.sourceBuffers_[a].updating,"SourceBuffer should not be updating on error!"),c.p.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.MEDIA_SOURCE_OPERATION_FAILED,this.video_.error?this.video_.error.code:0))},shaka.media.MediaSourceEngine.prototype.onUpdateEnd_=function(a){var b=this.queues_[a][0];goog.asserts.assert(b,"Spurious updateend event!"),b&&(goog.asserts.assert(!this.sourceBuffers_[a].updating,"SourceBuffer should not be updating on updateend!"),b.p.resolve(),this.popFromQueue_(a))},shaka.media.MediaSourceEngine.prototype.enqueueOperation_=function(a,b){if(this.destroyed_)return Promise.reject();var c={start:b,p:new shaka.util.PublicPromise};if(this.queues_[a].push(c),1==this.queues_[a].length)try{c.start()}catch(d){"QuotaExceededError"==d.name?c.p.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.QUOTA_EXCEEDED_ERROR,a)):c.p.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.MEDIA_SOURCE_OPERATION_THREW,d)),this.popFromQueue_(a)}return c.p},shaka.media.MediaSourceEngine.prototype.enqueueBlockingOperation_=function(a){if(this.destroyed_)return Promise.reject();var b,c=[];for(b in this.sourceBuffers_){var d=new shaka.util.PublicPromise,e={start:function(a){a.resolve()}.bind(null,d),p:d};this.queues_[b].push(e),c.push(d),1==this.queues_[b].length&&e.start()}return Promise.all(c).then(function(){if(goog.DEBUG)for(var b in this.sourceBuffers_)goog.asserts.assert(0==this.sourceBuffers_[b].updating,"SourceBuffers should not be updating after a blocking op!");try{a()}catch(c){var d=Promise.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.MEDIA_SOURCE_OPERATION_THREW,c))}for(var e in this.sourceBuffers_)this.popFromQueue_(e);return d}.bind(this),function(a){if(goog.asserts.assert(this.destroyed_,"Should be destroyed by now"),goog.DEBUG)for(var b in this.sourceBuffers_)this.queues_[b].length&&(goog.asserts.assert(1==this.queues_[b].length,"Should be at most one item in queue!"),goog.asserts.assert(c.includes(this.queues_[b][0].p),"The item in queue should be one of our waiters!"),this.queues_[b].shift());throw a}.bind(this))},shaka.media.MediaSourceEngine.prototype.popFromQueue_=function(a){this.queues_[a].shift();var b=this.queues_[a][0];if(b)try{b.start()}catch(c){b.p.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.MEDIA_SOURCE_OPERATION_THREW,c)),
this.popFromQueue_(a)}},shaka.media.MediaSourceEngine.prototype.getTextDisplayer=function(){return goog.asserts.assert(this.textDisplayer_,"TextDisplayer should only be null when this is destroyed"),this.textDisplayer_},shaka.media.MediaSourceEngine.prototype.setTextDisplayer=function(a){var b=this.textDisplayer_;this.textDisplayer_=a,b&&(a.setTextVisibility(b.isTextVisible()),b.destroy()),this.textEngine_&&this.textEngine_.setDisplayer(a)},shaka.util.LanguageUtils=function(){},shaka.util.LanguageUtils.areLocaleCompatible=function(a,b){var c=shaka.util.LanguageUtils;return a=c.normalize(a),b=c.normalize(b),a==b},shaka.util.LanguageUtils.areLanguageCompatible=function(a,b){var c=shaka.util.LanguageUtils;a=c.normalize(a),b=c.normalize(b);var d=c.disassembleLocale_(a);return c=c.disassembleLocale_(b),d[0]==c[0]},shaka.util.LanguageUtils.isParentOf=function(a,b){var c=shaka.util.LanguageUtils;a=c.normalize(a),b=c.normalize(b);var d=c.disassembleLocale_(a);return c=c.disassembleLocale_(b),d[0]==c[0]&&1==d.length&&2==c.length},shaka.util.LanguageUtils.isSiblingOf=function(a,b){var c=shaka.util.LanguageUtils;a=c.normalize(a),b=c.normalize(b);var d=c.disassembleLocale_(a);return c=c.disassembleLocale_(b),2==d.length&&2==c.length&&d[0]==c[0]},shaka.util.LanguageUtils.normalize=function(a){var b=shaka.util.LanguageUtils,c=a.split("-");return a=c[0]||"",c=c[1]||"",a=a.toLowerCase(),a=b.isoMap_.get(a)||a,(c=c.toUpperCase())?a+"-"+c:a},shaka.util.LanguageUtils.areSiblings=function(a,b){var c=shaka.util.LanguageUtils,d=c.getBase(a);return c=c.getBase(b),a!=d&&b!=c&&d==c},shaka.util.LanguageUtils.getBase=function(a){var b=shaka.util.LanguageUtils,c=a.indexOf("-");return a=0<=c?a.substring(0,c):a,a=a.toLowerCase(),a=b.isoMap_.get(a)||a},shaka.util.LanguageUtils.getLocaleForText=function(a){var b=shaka.util.LanguageUtils;return goog.asserts.assert(a.type==shaka.util.ManifestParserUtils.ContentType.TEXT,"Can only get language from text streams"),b.normalize(a.language||"und")},shaka.util.LanguageUtils.getLocaleForVariant=function(a){var b=shaka.util.LanguageUtils;return a.language?b.normalize(a.language):a.audio&&a.audio.language?b.normalize(a.audio.language):a.video&&a.video.language?b.normalize(a.video.language):"und"},shaka.util.LanguageUtils.findClosestLocale=function(a,b){for(var c=shaka.util.LanguageUtils,d=c.normalize(a),e=new Set,f=$jscomp.makeIterator(b),g=f.next();!g.done;g=f.next())e.add(c.normalize(g.value));for(f=$jscomp.makeIterator(e),g=f.next();!g.done;g=f.next())if(g=g.value,g==d)return g;for(f=$jscomp.makeIterator(e),g=f.next();!g.done;g=f.next())if(g=g.value,c.isParentOf(g,d))return g;for(f=$jscomp.makeIterator(e),g=f.next();!g.done;g=f.next())if(g=g.value,c.isSiblingOf(g,d))return g;for(e=$jscomp.makeIterator(e),g=e.next();!g.done;g=e.next())if(g=g.value,c.isParentOf(d,g))return g;return null},shaka.util.LanguageUtils.disassembleLocale_=function(a){var b=a.split("-");return goog.asserts.assert(2>=b.length,["Locales should not have more than 2 components. ",a," has too many components."].join()),b},shaka.util.LanguageUtils.isoMap_=new Map([["aar","aa"],["abk","ab"],["afr","af"],["aka","ak"],["alb","sq"],["amh","am"],["ara","ar"],["arg","an"],["arm","hy"],["asm","as"],["ava","av"],["ave","ae"],["aym","ay"],["aze","az"],["bak","ba"],["bam","bm"],["baq","eu"],["bel","be"],["ben","bn"],["bih","bh"],["bis","bi"],["bod","bo"],["bos","bs"],["bre","br"],["bul","bg"],["bur","my"],["cat","ca"],["ces","cs"],["cha","ch"],["che","ce"],["chi","zh"],["chu","cu"],["chv","cv"],["cor","kw"],["cos","co"],["cre","cr"],["cym","cy"],["cze","cs"],["dan","da"],["deu","de"],["div","dv"],["dut","nl"],["dzo","dz"],["ell","el"],["eng","en"],["epo","eo"],["est","et"],["eus","eu"],["ewe","ee"],["fao","fo"],["fas","fa"],["fij","fj"],["fin","fi"],["fra","fr"],["fre","fr"],["fry","fy"],["ful","ff"],["geo","ka"],["ger","de"],["gla","gd"],["gle","ga"],["glg","gl"],["glv","gv"],["gre","el"],["grn","gn"],["guj","gu"],["hat","ht"],["hau","ha"],["heb","he"],["her","hz"],["hin","hi"],["hmo","ho"],["hrv","hr"],["hun","hu"],["hye","hy"],["ibo","ig"],["ice","is"],["ido","io"],["iii","ii"],["iku","iu"],["ile","ie"],["ina","ia"],["ind","id"],["ipk","ik"],["isl","is"],["ita","it"],["jav","jv"],["jpn","ja"],["kal","kl"],["kan","kn"],["kas","ks"],["kat","ka"],["kau","kr"],["kaz","kk"],["khm","km"],["kik","ki"],["kin","rw"],["kir","ky"],["kom","kv"],["kon","kg"],["kor","ko"],["kua","kj"],["kur","ku"],["lao","lo"],["lat","la"],["lav","lv"],["lim","li"],["lin","ln"],["lit","lt"],["ltz","lb"],["lub","lu"],["lug","lg"],["mac","mk"],["mah","mh"],["mal","ml"],["mao","mi"],["mar","mr"],["may","ms"],["mkd","mk"],["mlg","mg"],["mlt","mt"],["mon","mn"],["mri","mi"],["msa","ms"],["mya","my"],["nau","na"],["nav","nv"],["nbl","nr"],["nde","nd"],["ndo","ng"],["nep","ne"],["nld","nl"],["nno","nn"],["nob","nb"],["nor","no"],["nya","ny"],["oci","oc"],["oji","oj"],["ori","or"],["orm","om"],["oss","os"],["pan","pa"],["per","fa"],["pli","pi"],["pol","pl"],["por","pt"],["pus","ps"],["que","qu"],["roh","rm"],["ron","ro"],["rum","ro"],["run","rn"],["rus","ru"],["sag","sg"],["san","sa"],["sin","si"],["slk","sk"],["slo","sk"],["slv","sl"],["sme","se"],["smo","sm"],["sna","sn"],["snd","sd"],["som","so"],["sot","st"],["spa","es"],["sqi","sq"],["srd","sc"],["srp","sr"],["ssw","ss"],["sun","su"],["swa","sw"],["swe","sv"],["tah","ty"],["tam","ta"],["tat","tt"],["tel","te"],["tgk","tg"],["tgl","tl"],["tha","th"],["tib","bo"],["tir","ti"],["ton","to"],["tsn","tn"],["tso","ts"],["tuk","tk"],["tur","tr"],["twi","tw"],["uig","ug"],["ukr","uk"],["urd","ur"],["uzb","uz"],["ven","ve"],["vie","vi"],["vol","vo"],["wel","cy"],["wln","wa"],["wol","wo"],["xho","xh"],["yid","yi"],["yor","yo"],["zha","za"],["zho","zh"],["zul","zu"]]),shaka.util.StreamUtils={},shaka.util.StreamUtils.meetsRestrictions=function(a,b,c){var d=function(a,b,c){return a>=b&&a<=c},e=a.video;return!(e&&e.width&&e.height&&!(d(e.width,b.minWidth,Math.min(b.maxWidth,c.width))&&d(e.height,b.minHeight,Math.min(b.maxHeight,c.height))&&d(e.width*e.height,b.minPixels,b.maxPixels))||!d(a.bandwidth,b.minBandwidth,b.maxBandwidth))},shaka.util.StreamUtils.applyRestrictions=function(a,b,c){var d=!1;return a.forEach(function(a){var e=a.allowedByApplication;a.allowedByApplication=shaka.util.StreamUtils.meetsRestrictions(a,b,c),e!=a.allowedByApplication&&(d=!0)}),d},shaka.util.StreamUtils.filterNewPeriod=function(a,b,c,d){var e=shaka.util.StreamUtils;b&&goog.asserts.assert(e.isAudio(b),"Audio streams must have the audio type."),c&&goog.asserts.assert(e.isVideo(c),"Video streams must have the video type."),d.variants=d.variants.filter(function(d){if(a&&a.initialized()&&!a.supportsVariant(d))return shaka.log.debug("Dropping variant - not compatible with key system",d),!1;var f=d.audio;return d=d.video,f&&!shaka.media.MediaSourceEngine.isStreamSupported(f)?(shaka.log.debug("Dropping variant - audio not compatible with platform",e.getStreamSummaryString_(f)),!1):d&&!shaka.media.MediaSourceEngine.isStreamSupported(d)?(shaka.log.debug("Dropping variant - video not compatible with platform",e.getStreamSummaryString_(d)),!1):f&&b&&!e.areStreamsCompatible_(f,b)?(shaka.log.debug("Droping variant - not compatible with active audio","active audio",e.getStreamSummaryString_(b),"variant.audio",e.getStreamSummaryString_(f)),!1):!(d&&c&&!e.areStreamsCompatible_(d,c))||(shaka.log.debug("Droping variant - not compatible with active video","active video",e.getStreamSummaryString_(c),"variant.video",e.getStreamSummaryString_(d)),!1)}),d.textStreams=d.textStreams.filter(function(a){var b=shaka.util.MimeUtils.getFullType(a.mimeType,a.codecs);return(b=shaka.text.TextEngine.isTypeSupported(b))||shaka.log.debug("Dropping text stream. Is not supported by the platform.",a),b})},shaka.util.StreamUtils.areStreamsCompatible_=function(a,b){return a.mimeType==b.mimeType&&a.codecs.split(".")[0]==b.codecs.split(".")[0]},shaka.util.StreamUtils.variantToTrack=function(a){var b=a.audio,c=a.video,d=b?b.codecs:null,e=c?c.codecs:null,f=[];e&&f.push(e),d&&f.push(d);var g=[];c&&g.push(c.mimeType),b&&g.push(b.mimeType),g=g[0]||null;var h=[];b&&h.push(b.kind),c&&h.push(c.kind),h=h[0]||null;var i=new Set;return b&&b.roles.forEach(function(a){return i.add(a)}),c&&c.roles.forEach(function(a){return i.add(a)}),a={id:a.id,active:!1,type:"variant",bandwidth:a.bandwidth,language:a.language,label:null,kind:h,width:null,height:null,frameRate:null,mimeType:g,codecs:f.join(", "),audioCodec:d,videoCodec:e,primary:a.primary,roles:Array.from(i),audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null},c&&(a.videoId=c.id,a.originalVideoId=c.originalId,a.width=c.width||null,a.height=c.height||null,a.frameRate=c.frameRate||null,a.videoBandwidth=c.bandwidth||null),b&&(a.audioId=b.id,a.originalAudioId=b.originalId,a.channelsCount=b.channelsCount,a.audioBandwidth=b.bandwidth||null,a.label=b.label,a.audioRoles=b.roles),a},shaka.util.StreamUtils.textStreamToTrack=function(a){return{id:a.id,active:!1,type:shaka.util.ManifestParserUtils.ContentType.TEXT,bandwidth:0,language:a.language,label:a.label,kind:a.kind||null,width:null,height:null,frameRate:null,mimeType:a.mimeType,codecs:a.codecs||null,audioCodec:null,videoCodec:null,primary:a.primary,roles:a.roles,audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:a.originalId}},shaka.util.StreamUtils.html5TrackId=function(a){return a.__shaka_id||(a.__shaka_id=shaka.util.StreamUtils.nextTrackId_++),a.__shaka_id},shaka.util.StreamUtils.nextTrackId_=0,shaka.util.StreamUtils.html5TextTrackToTrack=function(a){var b=shaka.util.MimeUtils.CLOSED_CAPTION_MIMETYPE,c=shaka.util.StreamUtils.html5TrackToGenericShakaTrack_(a);return c.active="disabled"!=a.mode,c.type="text",c.originalTextId=a.id,"captions"==a.kind&&(c.mimeType=b),c},shaka.util.StreamUtils.html5AudioTrackToTrack=function(a){var b=shaka.util.StreamUtils.html5TrackToGenericShakaTrack_(a);return b.active=a.enabled,b.type="variant",b.originalAudioId=a.id,"main"==a.kind?(b.primary=!0,b.roles=["main"],b.audioRoles=["main"]):b.audioRoles=[],b},shaka.util.StreamUtils.html5TrackToGenericShakaTrack_=function(a){return{id:shaka.util.StreamUtils.html5TrackId(a),active:!1,type:"",bandwidth:0,language:shaka.util.LanguageUtils.normalize(a.language),label:a.label,kind:a.kind,width:null,height:null,frameRate:null,mimeType:null,codecs:null,audioCodec:null,videoCodec:null,primary:!1,roles:[],audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null}},shaka.util.StreamUtils.isPlayable=function(a){return a.allowedByApplication&&a.allowedByKeySystem},shaka.util.StreamUtils.getPlayableVariants=function(a){return a.filter(function(a){return shaka.util.StreamUtils.isPlayable(a)})},shaka.util.StreamUtils.filterVariantsByAudioChannelCount=function(a,b){var c=a.filter(function(a){return a.audio&&a.audio.channelsCount}),d=new Map;c=$jscomp.makeIterator(c);for(var e=c.next();!e.done;e=c.next()){e=e.value;var f=e.audio.channelsCount;goog.asserts.assert(null!=f,"Must have count after filtering!"),d.has(f)||d.set(f,[]),d.get(f).push(e)}return c=Array.from(d.keys()),0==c.length?a:(e=c.filter(function(a){return a<=b}),e.length?d.get(Math.max.apply(null,e)):d.get(Math.min.apply(null,c)))},shaka.util.StreamUtils.filterStreamsByLanguageAndRole=function(a,b,c){var d=shaka.util.LanguageUtils,e=a,f=a.filter(function(a){return a.primary});f.length&&(e=f);var g=e.length?e[0].language:"";if(e=e.filter(function(a){return a.language==g}),b){var h=d.findClosestLocale(d.normalize(b),a.map(function(a){return a.language}));h&&(e=a.filter(function(a){return d.normalize(a.language)==h}))}if(c){if(a=shaka.util.StreamUtils.filterTextStreamsByRole_(e,c),a.length)return a;shaka.log.warning("No exact match for the text role could be found.")}else if(a=e.filter(function(a){return 0==a.roles.length}),a.length)return a;return a=e.map(function(a){return a.roles}).reduce(shaka.util.Functional.collapseArrays,[]),a.length?shaka.util.StreamUtils.filterTextStreamsByRole_(e,a[0]):e},shaka.util.StreamUtils.filterTextStreamsByRole_=function(a,b){return a.filter(function(a){return a.roles.includes(b)})},shaka.util.StreamUtils.getVariantByStreams=function(a,b,c){a&&goog.asserts.assert(shaka.util.StreamUtils.isAudio(a),"Audio streams must have the audio type."),b&&goog.asserts.assert(shaka.util.StreamUtils.isVideo(b),"Video streams must have the video type.");for(var d=0;d<c.length;d++)if(c[d].audio==a&&c[d].video==b)return c[d];return null},shaka.util.StreamUtils.isAudio=function(a){return a.type==shaka.util.ManifestParserUtils.ContentType.AUDIO},shaka.util.StreamUtils.isVideo=function(a){return a.type==shaka.util.ManifestParserUtils.ContentType.VIDEO},shaka.util.StreamUtils.getVariantStreams=function(a){var b=[];return a.audio&&b.push(a.audio),a.video&&b.push(a.video),b},shaka.util.StreamUtils.getStreamSummaryString_=function(a){return shaka.util.StreamUtils.isAudio(a)?"type=audio codecs="+a.codecs+" bandwidth="+a.bandwidth+" channelsCount="+a.channelsCount:shaka.util.StreamUtils.isVideo(a)?"type=video codecs="+a.codecs+" bandwidth="+a.bandwidth+" frameRate="+a.frameRate+" width="+a.width+" height="+a.height:"unexpected stream type"},shaka.abr.SimpleAbrManager=function(){this.switch_=null,this.enabled_=!1,this.bandwidthEstimator_=new shaka.abr.EwmaBandwidthEstimator,this.variants_=[],this.startupComplete_=!1,this.config_=this.lastTimeChosenMs_=null},goog.exportSymbol("shaka.abr.SimpleAbrManager",shaka.abr.SimpleAbrManager),shaka.abr.SimpleAbrManager.prototype.stop=function(){this.switch_=null,this.enabled_=!1,this.variants_=[],this.lastTimeChosenMs_=null},goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"stop",shaka.abr.SimpleAbrManager.prototype.stop),shaka.abr.SimpleAbrManager.prototype.init=function(a){this.switch_=a},goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"init",shaka.abr.SimpleAbrManager.prototype.init),shaka.abr.SimpleAbrManager.prototype.chooseVariant=function(){var a=shaka.abr.SimpleAbrManager,b=a.filterAndSortVariants_(this.config_.restrictions,this.variants_),c=this.bandwidthEstimator_.getBandwidthEstimate(this.config_.defaultBandwidthEstimate);this.variants_.length&&!b.length&&(shaka.log.warning("No variants met the ABR restrictions. Choosing a variant by lowest bandwidth."),b=a.filterAndSortVariants_(null,this.variants_),b=[b[0]]),a=b[0]||null;for(var d=0;d<b.length;++d){var e=b[d],f=e.bandwidth/this.config_.bandwidthDowngradeTarget,g=(b[d+1]||{bandwidth:1/0}).bandwidth/this.config_.bandwidthUpgradeTarget;shaka.log.v2("Bandwidth ranges:",(e.bandwidth/1e6).toFixed(3),(f/1e6).toFixed(3),(g/1e6).toFixed(3)),c>=f&&c<=g&&(a=e)}return this.lastTimeChosenMs_=Date.now(),a},goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"chooseVariant",shaka.abr.SimpleAbrManager.prototype.chooseVariant),shaka.abr.SimpleAbrManager.prototype.enable=function(){this.enabled_=!0},goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"enable",shaka.abr.SimpleAbrManager.prototype.enable),shaka.abr.SimpleAbrManager.prototype.disable=function(){this.enabled_=!1},goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"disable",shaka.abr.SimpleAbrManager.prototype.disable),shaka.abr.SimpleAbrManager.prototype.segmentDownloaded=function(a,b){shaka.log.v2("Segment downloaded:","deltaTimeMs="+a,"numBytes="+b,"lastTimeChosenMs="+this.lastTimeChosenMs_,"enabled="+this.enabled_),goog.asserts.assert(0<=a,"expected a non-negative duration"),this.bandwidthEstimator_.sample(a,b),null!=this.lastTimeChosenMs_&&this.enabled_&&this.suggestStreams_()},goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"segmentDownloaded",shaka.abr.SimpleAbrManager.prototype.segmentDownloaded),shaka.abr.SimpleAbrManager.prototype.getBandwidthEstimate=function(){return this.bandwidthEstimator_.getBandwidthEstimate(this.config_.defaultBandwidthEstimate)},goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"getBandwidthEstimate",shaka.abr.SimpleAbrManager.prototype.getBandwidthEstimate),shaka.abr.SimpleAbrManager.prototype.setVariants=function(a){this.variants_=a},goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"setVariants",shaka.abr.SimpleAbrManager.prototype.setVariants),shaka.abr.SimpleAbrManager.prototype.configure=function(a){this.config_=a},goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"configure",shaka.abr.SimpleAbrManager.prototype.configure),shaka.abr.SimpleAbrManager.prototype.suggestStreams_=function(){if(shaka.log.v2("Suggesting Streams..."),goog.asserts.assert(null!=this.lastTimeChosenMs_,"lastTimeChosenMs_ should not be null"),this.startupComplete_){if(Date.now()-this.lastTimeChosenMs_<1e3*this.config_.switchInterval)return void shaka.log.v2("Still within switch interval...")}else{if(!this.bandwidthEstimator_.hasGoodEstimate())return void shaka.log.v2("Still waiting for a good estimate...");this.startupComplete_=!0}var a=this.chooseVariant(),b=this.bandwidthEstimator_.getBandwidthEstimate(this.config_.defaultBandwidthEstimate);shaka.log.debug("Calling switch_(), bandwidth="+Math.round(b/1e3)+" kbps"),this.switch_(a)},shaka.abr.SimpleAbrManager.filterAndSortVariants_=function(a,b){return a&&(b=b.filter(function(b){return goog.asserts.assert(a,"Restrictions should exist!"),shaka.util.StreamUtils.meetsRestrictions(b,a,{width:1/0,height:1/0})})),b.sort(function(a,b){return a.bandwidth-b.bandwidth})},shaka.deprecate={},shaka.deprecate.Version=function(a,b){this.major_=a,this.minor_=b},shaka.deprecate.Version.prototype.major=function(){return this.major_},shaka.deprecate.Version.prototype.minor=function(){return this.minor_},shaka.deprecate.Version.prototype.compareTo=function(a){var b=this.minor_-a.minor_;return this.major_-a.major_||b},shaka.deprecate.Version.prototype.toString=function(){return"v"+this.major_+"."+this.minor_},shaka.deprecate.Version.parse=function(a){return a=a.substring(1).split(".",2),new shaka.deprecate.Version(Number(a[0]),Number(a[1]))},shaka.deprecate.Enforcer=function(a,b,c){this.libraryVersion_=a,this.onPending_=b,this.onExpired_=c},shaka.deprecate.Enforcer.prototype.enforce=function(a,b,c){(0<a.compareTo(this.libraryVersion_)?this.onPending_:this.onExpired_)(this.libraryVersion_,a,b,c)},shaka.Deprecate=function(){},shaka.Deprecate.init=function(a){goog.asserts.assert(null==shaka.Deprecate.enforcer_,"Deprecate.init should only be called once."),shaka.Deprecate.enforcer_=new shaka.deprecate.Enforcer(shaka.deprecate.Version.parse(a),shaka.Deprecate.onPending_,shaka.Deprecate.onExpired_)},shaka.Deprecate.deprecateFeature=function(a,b,c,d){var e=shaka.Deprecate.enforcer_;goog.asserts.assert(e,"Missing deprecation enforcer. Was |init| called?"),a=new shaka.deprecate.Version(a,b),e.enforce(a,c,d)},shaka.Deprecate.onPending_=function(a,b,c,d){shaka.log.alwaysWarn([c,"has been deprecated and will be removed in",b,". We are currently at version",a,". Additional information:",d].join(" "))},shaka.Deprecate.onExpired_=function(a,b,c,d){a=[c,"has been deprecated and has been removed in",b,". We are now at version",a,". Additional information:",d].join(""),shaka.log.alwaysError(a),goog.asserts.assert(!1,a)},shaka.Deprecate.enforcer_=null,shaka.cast={},shaka.cast.CastUtils={},shaka.cast.CastUtils.VideoEvents="ended play playing pause pausing ratechange seeked seeking timeupdate volumechange".split(" "),shaka.cast.CastUtils.VideoAttributes="buffered currentTime duration ended loop muted paused playbackRate seeking videoHeight videoWidth volume".split(" "),shaka.cast.CastUtils.VideoInitStateAttributes=["loop","playbackRate"],shaka.cast.CastUtils.VideoVoidMethods=["pause","play"],shaka.cast.CastUtils.PlayerEvents="abrstatuschanged adaptation buffering emsg error loading streaming texttrackvisibility timelineregionadded timelineregionenter timelineregionexit trackschanged unloading variantchanged textchanged".split(" "),shaka.cast.CastUtils.PlayerGetterMethods={getAssetUri:2,getAudioLanguages:2,getAudioLanguagesAndRoles:2,getBufferedInfo:2,getConfiguration:2,getExpiration:2,getPlaybackRate:2,getTextLanguages:2,getTextLanguagesAndRoles:2,getTextTracks:2,getStats:5,getVariantTracks:2,isAudioOnly:10,isBuffering:1,isInProgress:1,isLive:10,isTextTrackVisible:1,keySystem:10,seekRange:1,usingEmbeddedTextTrack:2,getLoadMode:10},shaka.cast.CastUtils.PlayerGetterMethodsThatRequireLive={getPlayheadTimeAsDate:1,getPresentationStartTimeAsDate:20},shaka.cast.CastUtils.PlayerInitState=[["getConfiguration","configure"]],shaka.cast.CastUtils.PlayerInitAfterLoadState=[["isTextTrackVisible","setTextTrackVisibility"]],shaka.cast.CastUtils.PlayerVoidMethods="addTextTrack cancelTrickPlay configure resetConfiguration retryStreaming selectAudioLanguage selectEmbeddedTextTrack selectTextLanguage selectTextTrack selectVariantTrack setTextTrackVisibility trickPlay".split(" "),shaka.cast.CastUtils.PlayerPromiseMethods=["attach","detach","load","unload"],shaka.cast.CastUtils.SHAKA_MESSAGE_NAMESPACE="urn:x-cast:com.google.shaka.v2",shaka.cast.CastUtils.GENERIC_MESSAGE_NAMESPACE="urn:x-cast:com.google.cast.media",shaka.cast.CastUtils.serialize=function(a){return JSON.stringify(a,function(a,b){if("function"!=typeof b){if(b instanceof Event||b instanceof shaka.util.FakeEvent){var c,d={};for(c in b){var e=b[c];e&&"object"==typeof e?"detail"==c&&(d[c]=e):c in Event||(d[c]=e)}return d}return b instanceof TimeRanges?shaka.cast.CastUtils.unpackTimeRanges_(b):b instanceof Uint8Array?shaka.cast.CastUtils.unpackUint8Array_(b):"number"==typeof b?isNaN(b)?"NaN":isFinite(b)?b:0>b?"-Infinity":"Infinity":b}})},shaka.cast.CastUtils.deserialize=function(a){return JSON.parse(a,function(a,b){return"NaN"==b?NaN:"-Infinity"==b?-(1/0):"Infinity"==b?1/0:b&&"object"==typeof b&&"TimeRanges"==b.__type__?shaka.cast.CastUtils.simulateTimeRanges_(b):b&&"object"==typeof b&&"Uint8Array"==b.__type__?shaka.cast.CastUtils.makeUint8Array_(b):b})},shaka.cast.CastUtils.unpackTimeRanges_=function(a){for(var b={__type__:"TimeRanges",length:a.length,start:[],end:[]},c=0;c<a.length;++c)b.start.push(a.start(c)),b.end.push(a.end(c));return b},shaka.cast.CastUtils.simulateTimeRanges_=function(a){return{length:a.length,start:function(b){return a.start[b]},end:function(b){return a.end[b]}}},shaka.cast.CastUtils.unpackUint8Array_=function(a){return{__type__:"Uint8Array",entries:Array.from(a)}},shaka.cast.CastUtils.makeUint8Array_=function(a){return new Uint8Array(a.entries)},shaka.cast.CastSender=function(a,b,c,d,e,f){this.receiverAppId_=a,this.statusChangeTimer_=new shaka.util.Timer(b),this.onFirstCastStateUpdate_=c,this.hasJoinedExistingSession_=!1,this.onRemoteEvent_=d,this.onResumeLocal_=e,this.onInitStateRequired_=f,this.isCasting_=this.apiReady_=!1,this.receiverName_="",this.appData_=null,this.onConnectionStatusChangedBound_=this.onConnectionStatusChanged_.bind(this),this.onMessageReceivedBound_=this.onMessageReceived_.bind(this),this.cachedProperties_={video:{},player:{}},this.nextAsyncCallId_=0,this.asyncCallPromises_={},this.castPromise_=null},shaka.cast.CastSender.hasReceivers_=!1,shaka.cast.CastSender.session_=null,shaka.cast.CastSender.prototype.destroy=function(){return this.rejectAllPromises_(),shaka.cast.CastSender.session_&&this.removeListeners_(),this.statusChangeTimer_&&(this.statusChangeTimer_.stop(),this.statusChangeTimer_=null),this.onResumeLocal_=this.onRemoteEvent_=null,this.isCasting_=this.apiReady_=!1,this.onMessageReceivedBound_=this.onConnectionStatusChangedBound_=this.castPromise_=this.asyncCallPromises_=this.cachedProperties_=this.appData_=null,Promise.resolve()},shaka.cast.CastSender.prototype.apiReady=function(){return this.apiReady_},shaka.cast.CastSender.prototype.hasReceivers=function(){return shaka.cast.CastSender.hasReceivers_},shaka.cast.CastSender.prototype.isCasting=function(){return this.isCasting_},shaka.cast.CastSender.prototype.receiverName=function(){return this.receiverName_},shaka.cast.CastSender.prototype.hasRemoteProperties=function(){return 0!=Object.keys(this.cachedProperties_.video).length},shaka.cast.CastSender.prototype.init=function(){if(window.chrome&&chrome.cast&&chrome.cast.isAvailable){delete window.__onGCastApiAvailable,this.apiReady_=!0,this.statusChangeTimer_.tickNow();var a=new chrome.cast.SessionRequest(this.receiverAppId_);a=new chrome.cast.ApiConfig(a,this.onExistingSessionJoined_.bind(this),this.onReceiverStatusChanged_.bind(this),"origin_scoped"),chrome.cast.initialize(a,function(){shaka.log.debug("CastSender: init")},function(a){shaka.log.error("CastSender: init error",a)}),shaka.cast.CastSender.hasReceivers_&&this.statusChangeTimer_.tickAfter(.02),(a=shaka.cast.CastSender.session_)&&a.status!=chrome.cast.SessionStatus.STOPPED?(shaka.log.debug("CastSender: re-using existing connection"),this.onExistingSessionJoined_(a)):shaka.cast.CastSender.session_=null}else window.__onGCastApiAvailable=function(a){a&&this.init()}.bind(this)},shaka.cast.CastSender.prototype.setAppData=function(a){this.appData_=a,this.isCasting_&&this.sendMessage_({type:"appData",appData:this.appData_})},shaka.cast.CastSender.prototype.cast=function(a){return this.apiReady_?shaka.cast.CastSender.hasReceivers_?this.isCasting_?Promise.reject(new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.CAST,shaka.util.Error.Code.ALREADY_CASTING)):(this.castPromise_=new shaka.util.PublicPromise,chrome.cast.requestSession(this.onSessionInitiated_.bind(this,a),this.onConnectionError_.bind(this)),this.castPromise_):Promise.reject(new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.CAST,shaka.util.Error.Code.NO_CAST_RECEIVERS)):Promise.reject(new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.CAST,shaka.util.Error.Code.CAST_API_UNAVAILABLE))},shaka.cast.CastSender.prototype.showDisconnectDialog=function(){if(this.isCasting_){var a=this.onInitStateRequired_();chrome.cast.requestSession(this.onSessionInitiated_.bind(this,a),this.onConnectionError_.bind(this))}},shaka.cast.CastSender.prototype.forceDisconnect=function(){this.isCasting_&&(this.rejectAllPromises_(),shaka.cast.CastSender.session_&&(this.removeListeners_(),shaka.cast.CastSender.session_.stop(function(){},function(){}),shaka.cast.CastSender.session_=null))},shaka.cast.CastSender.prototype.get=function(a,b){goog.asserts.assert("video"==a||"player"==a,"Unexpected target name");var c=shaka.cast.CastUtils;if("video"==a){if(c.VideoVoidMethods.includes(b))return this.remoteCall_.bind(this,a,b)}else if("player"==a){if(c.PlayerGetterMethodsThatRequireLive[b]){var d=this.get("player","isLive")();if(goog.asserts.assert(d,b+" should be called on a live stream!"),!d)return function(){}}if(c.PlayerVoidMethods.includes(b))return this.remoteCall_.bind(this,a,b);if(c.PlayerPromiseMethods.includes(b))return this.remoteAsyncCall_.bind(this,a,b);if(c.PlayerGetterMethods[b])return this.propertyGetter_.bind(this,a,b)}return this.propertyGetter_(a,b)},shaka.cast.CastSender.prototype.set=function(a,b,c){goog.asserts.assert("video"==a||"player"==a,"Unexpected target name"),this.cachedProperties_[a][b]=c,this.sendMessage_({type:"set",targetName:a,property:b,value:c})},shaka.cast.CastSender.prototype.onSessionInitiated_=function(a,b){shaka.log.debug("CastSender: onSessionInitiated"),this.onSessionCreated_(b),this.sendMessage_({type:"init",initState:a,appData:this.appData_}),this.castPromise_.resolve()},shaka.cast.CastSender.prototype.onConnectionError_=function(a){var b=shaka.util.Error.Code.UNEXPECTED_CAST_ERROR;switch(a.code){case"cancel":b=shaka.util.Error.Code.CAST_CANCELED_BY_USER;break;case"timeout":b=shaka.util.Error.Code.CAST_CONNECTION_TIMED_OUT;break;case"receiver_unavailable":b=shaka.util.Error.Code.CAST_RECEIVER_APP_UNAVAILABLE}this.castPromise_.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.CAST,b,a))},shaka.cast.CastSender.prototype.propertyGetter_=function(a,b){return goog.asserts.assert("video"==a||"player"==a,"Unexpected target name"),this.cachedProperties_[a][b]},shaka.cast.CastSender.prototype.remoteCall_=function(a,b,c){for(var d=[],e=2;e<arguments.length;++e)d[e-2]=arguments[e];goog.asserts.assert("video"==a||"player"==a,"Unexpected target name"),this.sendMessage_({type:"call",targetName:a,methodName:b,args:d})},shaka.cast.CastSender.prototype.remoteAsyncCall_=function(a,b,c){for(var d=[],e=2;e<arguments.length;++e)d[e-2]=arguments[e];goog.asserts.assert("video"==a||"player"==a,"Unexpected target name"),e=new shaka.util.PublicPromise;var f=this.nextAsyncCallId_.toString();return this.nextAsyncCallId_++,this.asyncCallPromises_[f]=e,this.sendMessage_({type:"asyncCall",targetName:a,methodName:b,args:d,id:f}),e},shaka.cast.CastSender.prototype.onExistingSessionJoined_=function(a){shaka.log.debug("CastSender: onExistingSessionJoined");var b=this.onInitStateRequired_();this.castPromise_=new shaka.util.PublicPromise,this.hasJoinedExistingSession_=!0,this.onSessionInitiated_(b,a)},shaka.cast.CastSender.prototype.onReceiverStatusChanged_=function(a){shaka.log.debug("CastSender: receiver status",a),shaka.cast.CastSender.hasReceivers_="available"==a,this.statusChangeTimer_.tickNow()},shaka.cast.CastSender.prototype.onSessionCreated_=function(a){shaka.cast.CastSender.session_=a,a.addUpdateListener(this.onConnectionStatusChangedBound_),a.addMessageListener(shaka.cast.CastUtils.SHAKA_MESSAGE_NAMESPACE,this.onMessageReceivedBound_),this.onConnectionStatusChanged_()},shaka.cast.CastSender.prototype.removeListeners_=function(){var a=shaka.cast.CastSender.session_;a.removeUpdateListener(this.onConnectionStatusChangedBound_),a.removeMessageListener(shaka.cast.CastUtils.SHAKA_MESSAGE_NAMESPACE,this.onMessageReceivedBound_)},shaka.cast.CastSender.prototype.onConnectionStatusChanged_=function(){var a=!!shaka.cast.CastSender.session_&&"connected"==shaka.cast.CastSender.session_.status;if(shaka.log.debug("CastSender: connection status",a),this.isCasting_&&!a){this.onResumeLocal_();for(var b in this.cachedProperties_)this.cachedProperties_[b]={};this.rejectAllPromises_()}this.receiverName_=(this.isCasting_=a)?shaka.cast.CastSender.session_.receiver.friendlyName:"",this.statusChangeTimer_.tickNow()},shaka.cast.CastSender.prototype.rejectAllPromises_=function(){for(var a in this.asyncCallPromises_){var b=this.asyncCallPromises_[a];delete this.asyncCallPromises_[a],b.reject(new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.LOAD_INTERRUPTED))}},shaka.cast.CastSender.prototype.onMessageReceived_=function(a,b){var c=shaka.cast.CastUtils.deserialize(b);switch(shaka.log.v2("CastSender: message",c),c.type){case"event":var d=c.targetName;c=c.event,c=new shaka.util.FakeEvent(c.type,c),this.onRemoteEvent_(d,c);break;case"update":d=c.update;for(var e in d){c=this.cachedProperties_[e]||{};for(var f in d[e])c[f]=d[e][f]}this.hasJoinedExistingSession_&&(this.onFirstCastStateUpdate_(),this.hasJoinedExistingSession_=!1);break;case"asyncComplete":if(e=c.id,c=c.error,f=this.asyncCallPromises_[e],delete this.asyncCallPromises_[e],goog.asserts.assert(f,"Unexpected async id"),f)if(c){e=new shaka.util.Error(c.severity,c.category,c.code);for(d in c)e[d]=c[d];f.reject(e)}else f.resolve()}},shaka.cast.CastSender.prototype.sendMessage_=function(a){a=shaka.cast.CastUtils.serialize(a),shaka.cast.CastSender.session_.sendMessage(shaka.cast.CastUtils.SHAKA_MESSAGE_NAMESPACE,a,function(){},shaka.log.error)},shaka.cast.CastProxy=function(a,b,c){var d=this;shaka.util.FakeEventTarget.call(this),this.localVideo_=a,this.localPlayer_=b,this.eventManager_=this.playerEventTarget_=this.videoEventTarget_=this.playerProxy_=this.videoProxy_=null,(this.receiverAppId_=c)&&(this.sender_=new shaka.cast.CastSender(c,function(){return d.onCastStatusChanged_()},function(){return d.onFirstCastStateUpdate_();
},function(a,b){return d.onRemoteEvent_(a,b)},function(){return d.onResumeLocal_()},function(){return d.getInitState_()})),this.init_()},goog.inherits(shaka.cast.CastProxy,shaka.util.FakeEventTarget),goog.exportSymbol("shaka.cast.CastProxy",shaka.cast.CastProxy),shaka.cast.CastProxy.prototype.destroy=function(a){return a&&this.sender_&&this.sender_.forceDisconnect(),this.eventManager_&&(this.eventManager_.release(),this.eventManager_=null),a=[],this.localPlayer_&&(a.push(this.localPlayer_.destroy()),this.localPlayer_=null),this.sender_&&(a.push(this.sender_.destroy()),this.sender_=null),this.playerProxy_=this.videoProxy_=this.localVideo_=null,Promise.all(a)},goog.exportProperty(shaka.cast.CastProxy.prototype,"destroy",shaka.cast.CastProxy.prototype.destroy),shaka.cast.CastProxy.prototype.getVideo=function(){return this.videoProxy_},goog.exportProperty(shaka.cast.CastProxy.prototype,"getVideo",shaka.cast.CastProxy.prototype.getVideo),shaka.cast.CastProxy.prototype.getPlayer=function(){return this.playerProxy_},goog.exportProperty(shaka.cast.CastProxy.prototype,"getPlayer",shaka.cast.CastProxy.prototype.getPlayer),shaka.cast.CastProxy.prototype.canCast=function(){return!!this.sender_&&(this.sender_.apiReady()&&this.sender_.hasReceivers())},goog.exportProperty(shaka.cast.CastProxy.prototype,"canCast",shaka.cast.CastProxy.prototype.canCast),shaka.cast.CastProxy.prototype.isCasting=function(){return!!this.sender_&&this.sender_.isCasting()},goog.exportProperty(shaka.cast.CastProxy.prototype,"isCasting",shaka.cast.CastProxy.prototype.isCasting),shaka.cast.CastProxy.prototype.receiverName=function(){return this.sender_?this.sender_.receiverName():""},goog.exportProperty(shaka.cast.CastProxy.prototype,"receiverName",shaka.cast.CastProxy.prototype.receiverName),shaka.cast.CastProxy.prototype.cast=function(){if(!this.sender_)throw new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.CAST,shaka.util.Error.Code.CAST_RECEIVER_APP_ID_MISSING);var a=this.getInitState_();return this.sender_.cast(a).then(function(){if(this.localPlayer_)return this.localPlayer_.unload()}.bind(this))},goog.exportProperty(shaka.cast.CastProxy.prototype,"cast",shaka.cast.CastProxy.prototype.cast),shaka.cast.CastProxy.prototype.setAppData=function(a){this.sender_&&this.sender_.setAppData(a)},goog.exportProperty(shaka.cast.CastProxy.prototype,"setAppData",shaka.cast.CastProxy.prototype.setAppData),shaka.cast.CastProxy.prototype.suggestDisconnect=function(){this.sender_&&this.sender_.showDisconnectDialog()},goog.exportProperty(shaka.cast.CastProxy.prototype,"suggestDisconnect",shaka.cast.CastProxy.prototype.suggestDisconnect),shaka.cast.CastProxy.prototype.changeReceiverId=function(a){var b=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function c(){return $jscomp.generator.createGenerator(c,function(c){switch(c.nextAddress){case 1:if(a==b.receiverAppId_)return c["return"]();if(b.receiverAppId_=a,!b.sender_){c.jumpTo(2);break}return b.sender_.forceDisconnect(),c["yield"](b.sender_.destroy(),3);case 3:b.sender_=null;case 2:b.sender_=new shaka.cast.CastSender(a,function(){return b.onCastStatusChanged_()},function(){return b.onFirstCastStateUpdate_()},function(a,c){return b.onRemoteEvent_(a,c)},function(){return b.onResumeLocal_()},function(){return b.getInitState_()}),b.sender_.init(),c.jumpToEnd()}})})},goog.exportProperty(shaka.cast.CastProxy.prototype,"changeReceiverId",shaka.cast.CastProxy.prototype.changeReceiverId),shaka.cast.CastProxy.prototype.forceDisconnect=function(){this.sender_&&this.sender_.forceDisconnect()},goog.exportProperty(shaka.cast.CastProxy.prototype,"forceDisconnect",shaka.cast.CastProxy.prototype.forceDisconnect),shaka.cast.CastProxy.prototype.init_=function(){this.sender_&&this.sender_.init(),this.eventManager_=new shaka.util.EventManager,shaka.cast.CastUtils.VideoEvents.forEach(function(a){this.eventManager_.listen(this.localVideo_,a,this.videoProxyLocalEvent_.bind(this))}.bind(this)),shaka.cast.CastUtils.PlayerEvents.forEach(function(a){this.eventManager_.listen(this.localPlayer_,a,this.playerProxyLocalEvent_.bind(this))}.bind(this)),this.videoProxy_={};for(var a in this.localVideo_)Object.defineProperty(this.videoProxy_,a,{configurable:!1,enumerable:!0,get:this.videoProxyGet_.bind(this,a),set:this.videoProxySet_.bind(this,a)});this.playerProxy_={};for(var b in this.localPlayer_)Object.defineProperty(this.playerProxy_,b,{configurable:!1,enumerable:!0,get:this.playerProxyGet_.bind(this,b)});this.videoEventTarget_=new shaka.util.FakeEventTarget,this.videoEventTarget_.dispatchTarget=this.videoProxy_,this.playerEventTarget_=new shaka.util.FakeEventTarget,this.playerEventTarget_.dispatchTarget=this.playerProxy_},shaka.cast.CastProxy.prototype.getInitState_=function(){var a={video:{},player:{},playerAfterLoad:{},manifest:this.localPlayer_.getAssetUri(),startTime:null};return this.localVideo_.pause(),shaka.cast.CastUtils.VideoInitStateAttributes.forEach(function(b){a.video[b]=this.localVideo_[b]}.bind(this)),this.localVideo_.ended||(a.startTime=this.localVideo_.currentTime),shaka.cast.CastUtils.PlayerInitState.forEach(function(b){var c=b[1];b=this.localPlayer_[b[0]](),a.player[c]=b}.bind(this)),shaka.cast.CastUtils.PlayerInitAfterLoadState.forEach(function(b){var c=b[1];b=this.localPlayer_[b[0]](),a.playerAfterLoad[c]=b}.bind(this)),a},shaka.cast.CastProxy.prototype.onCastStatusChanged_=function(){var a=new shaka.util.FakeEvent("caststatuschanged");this.dispatchEvent(a)},shaka.cast.CastProxy.prototype.onFirstCastStateUpdate_=function(){var a=new shaka.util.FakeEvent(this.videoProxy_.paused?"pause":"play");this.videoEventTarget_.dispatchEvent(a)},shaka.cast.CastProxy.prototype.onResumeLocal_=function(){var a=this;goog.asserts.assert(this.sender_,"Cast sender should not be null!"),shaka.cast.CastUtils.PlayerInitState.forEach(function(a){var b=a[1];a=this.sender_.get("player",a[0])(),this.localPlayer_[b](a)}.bind(this));var b=this.sender_.get("player","getAssetUri")(),c=this.sender_.get("video","ended"),d=Promise.resolve(),e=this.localVideo_.autoplay,f=null;c||(f=this.sender_.get("video","currentTime")),b&&(this.localVideo_.autoplay=!1,d=this.localPlayer_.load(b,f));var g={};shaka.cast.CastUtils.VideoInitStateAttributes.forEach(function(a){g[a]=this.sender_.get("video",a)}.bind(this)),d.then(function(){a.localVideo_&&(shaka.cast.CastUtils.VideoInitStateAttributes.forEach(function(a){this.localVideo_[a]=g[a]}.bind(a)),shaka.cast.CastUtils.PlayerInitAfterLoadState.forEach(function(a){var b=a[1];a=this.sender_.get("player",a[0])(),this.localPlayer_[b](a)}.bind(a)),a.localVideo_.autoplay=e,b&&a.localVideo_.play())},function(b){goog.asserts.assert(b instanceof shaka.util.Error,"Wrong error type!"),b=new shaka.util.FakeEvent("error",{detail:b}),a.localPlayer_.dispatchEvent(b)})},shaka.cast.CastProxy.prototype.videoProxyGet_=function(a){if("addEventListener"==a)return this.videoEventTarget_.addEventListener.bind(this.videoEventTarget_);if("removeEventListener"==a)return this.videoEventTarget_.removeEventListener.bind(this.videoEventTarget_);if(this.sender_&&this.sender_.isCasting()&&!this.sender_.hasRemoteProperties()){var b=this.localVideo_[a];if("function"!=typeof b)return b}return this.sender_&&this.sender_.isCasting()?this.sender_.get("video",a):(a=this.localVideo_[a],"function"==typeof a&&(a=a.bind(this.localVideo_)),a)},shaka.cast.CastProxy.prototype.videoProxySet_=function(a,b){this.sender_&&this.sender_.isCasting()?this.sender_.set("video",a,b):this.localVideo_[a]=b},shaka.cast.CastProxy.prototype.videoProxyLocalEvent_=function(a){this.sender_&&this.sender_.isCasting()||(a=new shaka.util.FakeEvent(a.type,a),this.videoEventTarget_.dispatchEvent(a))},shaka.cast.CastProxy.prototype.playerProxyGet_=function(a){if("addEventListener"==a)return this.playerEventTarget_.addEventListener.bind(this.playerEventTarget_);if("removeEventListener"==a)return this.playerEventTarget_.removeEventListener.bind(this.playerEventTarget_);if("getMediaElement"==a)return function(){return this.videoProxy_}.bind(this);if("getSharedConfiguration"==a)return shaka.log.warning("Can't share configuration across a network. Returning copy."),this.sender_?this.sender_.get("player","getConfiguration"):this.localPlayer_.getConfiguration();if("getNetworkingEngine"==a)return this.sender_&&this.sender_.isCasting()&&shaka.log.warning("NOTE: getNetworkingEngine() is always local!"),this.localPlayer_.getNetworkingEngine.bind(this.localPlayer_);if(this.sender_&&this.sender_.isCasting()){if("getManifest"==a||"drmInfo"==a)return function(){return shaka.log.alwaysWarn(a+"() does not work while casting!"),null};if("getManifestUri"==a)return shaka.Deprecate.deprecateFeature(2,6,"getManifestUri",'Please use "getAssetUri" instead.'),this.playerProxyGet_("getAssetUri");if("attach"==a||"detach"==a)return function(){return shaka.log.alwaysWarn(a+"() does not work while casting!"),Promise.resolve()}}if(this.sender_&&this.sender_.isCasting()&&!this.sender_.hasRemoteProperties()&&shaka.cast.CastUtils.PlayerGetterMethods[a]){var b=this.localPlayer_[a];return goog.asserts.assert("function"==typeof b,"only methods on Player"),b.bind(this.localPlayer_)}return this.sender_&&this.sender_.isCasting()?this.sender_.get("player",a):(b=this.localPlayer_[a],goog.asserts.assert("function"==typeof b,"only methods on Player"),b.bind(this.localPlayer_))},shaka.cast.CastProxy.prototype.playerProxyLocalEvent_=function(a){this.sender_&&this.sender_.isCasting()||this.playerEventTarget_.dispatchEvent(a)},shaka.cast.CastProxy.prototype.onRemoteEvent_=function(a,b){goog.asserts.assert(this.sender_&&this.sender_.isCasting(),"Should only receive remote events while casting"),this.sender_.isCasting()&&("video"==a?this.videoEventTarget_.dispatchEvent(b):"player"==a&&this.playerEventTarget_.dispatchEvent(b))},shaka.cast.CastReceiver=function(a,b,c,d){var e=this;shaka.util.FakeEventTarget.call(this),this.video_=a,this.player_=b,this.eventManager_=new shaka.util.EventManager,this.targets_={video:a,player:b},this.appDataCallback_=c||function(){},this.contentIdCallback_=d||function(a){return a},this.isConnected_=!1,this.isIdle_=!0,this.updateNumber_=0,this.startUpdatingUpdateNumber_=!1,this.initialStatusUpdatePending_=!0,this.genericBus_=this.shakaBus_=null,this.pollTimer_=new shaka.util.Timer(function(){e.pollAttributes_()}),this.init_()},goog.inherits(shaka.cast.CastReceiver,shaka.util.FakeEventTarget),goog.exportSymbol("shaka.cast.CastReceiver",shaka.cast.CastReceiver),shaka.cast.CastReceiver.prototype.isConnected=function(){return this.isConnected_},goog.exportProperty(shaka.cast.CastReceiver.prototype,"isConnected",shaka.cast.CastReceiver.prototype.isConnected),shaka.cast.CastReceiver.prototype.isIdle=function(){return this.isIdle_},goog.exportProperty(shaka.cast.CastReceiver.prototype,"isIdle",shaka.cast.CastReceiver.prototype.isIdle),shaka.cast.CastReceiver.prototype.destroy=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function b(){var c,d;return $jscomp.generator.createGenerator(b,function(b){switch(b.nextAddress){case 1:return a.eventManager_&&(a.eventManager_.release(),a.eventManager_=null),c=[],a.player_&&(c.push(a.player_.destroy()),a.player_=null),a.pollTimer_&&(a.pollTimer_.stop(),a.pollTimer_=null),a.video_=null,a.targets_=null,a.appDataCallback_=null,a.isConnected_=!1,a.isIdle_=!0,a.shakaBus_=null,a.genericBus_=null,b["yield"](Promise.all(c),2);case 2:d=cast.receiver.CastReceiverManager.getInstance(),d.stop(),b.jumpToEnd()}})})},goog.exportProperty(shaka.cast.CastReceiver.prototype,"destroy",shaka.cast.CastReceiver.prototype.destroy),shaka.cast.CastReceiver.prototype.init_=function(){var a=cast.receiver.CastReceiverManager.getInstance();a.onSenderConnected=this.onSendersChanged_.bind(this),a.onSenderDisconnected=this.onSendersChanged_.bind(this),a.onSystemVolumeChanged=this.fakeVolumeChangeEvent_.bind(this),this.genericBus_=a.getCastMessageBus(shaka.cast.CastUtils.GENERIC_MESSAGE_NAMESPACE),this.genericBus_.onMessage=this.onGenericMessage_.bind(this),this.shakaBus_=a.getCastMessageBus(shaka.cast.CastUtils.SHAKA_MESSAGE_NAMESPACE),this.shakaBus_.onMessage=this.onShakaMessage_.bind(this),goog.DEBUG?shaka.util.Platform.isChromecast()&&a.start():a.start(),shaka.cast.CastUtils.VideoEvents.forEach(function(a){this.eventManager_.listen(this.video_,a,this.proxyEvent_.bind(this,"video"))}.bind(this)),shaka.cast.CastUtils.PlayerEvents.forEach(function(a){this.eventManager_.listen(this.player_,a,this.proxyEvent_.bind(this,"player"))}.bind(this)),cast.__platform__&&cast.__platform__.canDisplayType('video/mp4; codecs="avc1.640028"; width=3840; height=2160')?this.player_.setMaxHardwareResolution(3840,2160):this.player_.setMaxHardwareResolution(1920,1080),this.eventManager_.listen(this.video_,"loadeddata",function(){this.startUpdatingUpdateNumber_=!0}.bind(this)),this.eventManager_.listen(this.player_,"loading",function(){this.isIdle_=!1,this.onCastStatusChanged_()}.bind(this)),this.eventManager_.listen(this.video_,"playing",function(){this.isIdle_=!1,this.onCastStatusChanged_()}.bind(this)),this.eventManager_.listen(this.video_,"pause",function(){this.onCastStatusChanged_()}.bind(this)),this.eventManager_.listen(this.player_,"unloading",function(){this.isIdle_=!0,this.onCastStatusChanged_()}.bind(this)),this.eventManager_.listen(this.video_,"ended",function(){var a=this;new shaka.util.Timer(function(){a.video_&&a.video_.ended&&(a.isIdle_=!0,a.onCastStatusChanged_())}).tickAfter(5)}.bind(this))},shaka.cast.CastReceiver.prototype.onSendersChanged_=function(){this.updateNumber_=0,this.initialStatusUpdatePending_=!0,this.isConnected_=0!=cast.receiver.CastReceiverManager.getInstance().getSenders().length,this.onCastStatusChanged_()},shaka.cast.CastReceiver.prototype.onCastStatusChanged_=function(){Promise.resolve().then(function(){if(this.player_){var a=new shaka.util.FakeEvent("caststatuschanged");this.dispatchEvent(a),this.maybeSendMediaInfoMessage_()||this.sendMediaStatus_(0)}}.bind(this))},shaka.cast.CastReceiver.prototype.initState_=function(a,b){var c=this;for(d in a.player)this.player_[d](a.player[d]);this.appDataCallback_(b);var d=Promise.resolve(),e=this.video_.autoplay;a.manifest&&(this.video_.autoplay=!1,d=this.player_.load(a.manifest,a.startTime)),d.then(function(){if(c.player_){for(var b in a.video)c.video_[b]=a.video[b];for(var d in a.playerAfterLoad)c.player_[d](a.playerAfterLoad[d]);c.video_.autoplay=e,a.manifest&&(c.video_.play(),c.sendMediaStatus_(0))}},function(a){goog.asserts.assert(a instanceof shaka.util.Error,"Wrong error type!"),a=new shaka.util.FakeEvent("error",{detail:a}),c.player_.dispatchEvent(a)})},shaka.cast.CastReceiver.prototype.proxyEvent_=function(a,b){this.player_&&(this.pollAttributes_(),this.sendMessage_({type:"event",targetName:a,event:b},this.shakaBus_))},shaka.cast.CastReceiver.prototype.pollAttributes_=function(){this.pollTimer_.tickAfter(.5);var a={video:{},player:{}};if(shaka.cast.CastUtils.VideoAttributes.forEach(function(b){a.video[b]=this.video_[b]}.bind(this)),this.player_.isLive())for(var b in shaka.cast.CastUtils.PlayerGetterMethodsThatRequireLive)0==this.updateNumber_%shaka.cast.CastUtils.PlayerGetterMethodsThatRequireLive[b]&&(a.player[b]=this.player_[b]());for(var c in shaka.cast.CastUtils.PlayerGetterMethods)0==this.updateNumber_%shaka.cast.CastUtils.PlayerGetterMethods[c]&&(a.player[c]=this.player_[c]());(b=cast.receiver.CastReceiverManager.getInstance().getSystemVolume())&&(a.video.volume=b.level,a.video.muted=b.muted),this.startUpdatingUpdateNumber_&&(this.updateNumber_+=1),this.sendMessage_({type:"update",update:a},this.shakaBus_),this.maybeSendMediaInfoMessage_()},shaka.cast.CastReceiver.prototype.maybeSendMediaInfoMessage_=function(){return!(!this.initialStatusUpdatePending_||!this.video_.duration&&!this.player_.isLive())&&(this.sendMediaInfoMessage_(),this.initialStatusUpdatePending_=!1,!0)},shaka.cast.CastReceiver.prototype.sendMediaInfoMessage_=function(){var a={contentId:this.player_.getAssetUri(),streamType:this.player_.isLive()?"LIVE":"BUFFERED",duration:this.video_.duration,contentType:""};this.sendMediaStatus_(0,a)},shaka.cast.CastReceiver.prototype.fakeVolumeChangeEvent_=function(){var a=cast.receiver.CastReceiverManager.getInstance().getSystemVolume();goog.asserts.assert(a,"System volume should not be null!"),a&&this.sendMessage_({type:"update",update:{video:{volume:a.level,muted:a.muted}}},this.shakaBus_),this.sendMessage_({type:"event",targetName:"video",event:{type:"volumechange"}},this.shakaBus_)},shaka.cast.CastReceiver.prototype.onShakaMessage_=function(a){var b=shaka.cast.CastUtils.deserialize(a.data);switch(shaka.log.debug("CastReceiver: message",b),b.type){case"init":this.updateNumber_=0,this.startUpdatingUpdateNumber_=!1,this.initialStatusUpdatePending_=!0,this.initState_(b.initState,b.appData),this.pollAttributes_();break;case"appData":this.appDataCallback_(b.appData);break;case"set":var c=b.targetName,d=b.property;if(b=b.value,"video"==c){var e=cast.receiver.CastReceiverManager.getInstance();if("volume"==d){e.setSystemVolumeLevel(b);break}if("muted"==d){e.setSystemVolumeMuted(b);break}}this.targets_[c][d]=b;break;case"call":c=this.targets_[b.targetName],c[b.methodName].apply(c,b.args);break;case"asyncCall":c=b.targetName,d=b.methodName,"player"==c&&"load"==d&&(this.updateNumber_=0,this.startUpdatingUpdateNumber_=!1),e=b.id,a=a.senderId;var f=this.targets_[c];b=f[d].apply(f,b.args),"player"==c&&"load"==d&&(b=b.then(function(){this.initialStatusUpdatePending_=!0}.bind(this))),b.then(this.sendAsyncComplete_.bind(this,a,e,null),this.sendAsyncComplete_.bind(this,a,e))}},shaka.cast.CastReceiver.prototype.onGenericMessage_=function(a){var b=shaka.cast.CastUtils.deserialize(a.data);switch(shaka.log.debug("CastReceiver: message",b),b.type){case"PLAY":this.video_.play(),this.sendMediaStatus_(0);break;case"PAUSE":this.video_.pause(),this.sendMediaStatus_(0);break;case"SEEK":a=b.currentTime;var c=b.resumeState;null!=a&&(this.video_.currentTime=Number(a)),c&&"PLAYBACK_START"==c?(this.video_.play(),this.sendMediaStatus_(0)):c&&"PLAYBACK_PAUSE"==c&&(this.video_.pause(),this.sendMediaStatus_(0));break;case"STOP":this.player_.unload().then(function(){this.player_&&this.sendMediaStatus_(0)}.bind(this));break;case"GET_STATUS":this.sendMediaStatus_(Number(b.requestId));break;case"VOLUME":c=b.volume,a=c.level,c=c.muted;var d=this.video_.volume,e=this.video_.muted;null!=a&&(this.video_.volume=Number(a)),null!=c&&(this.video_.muted=c),d==this.video_.volume&&e==this.video_.muted||this.sendMediaStatus_(0);break;case"LOAD":this.updateNumber_=0,this.initialStatusUpdatePending_=this.startUpdatingUpdateNumber_=!1,a=b.media,c=b.currentTime,d=this.contentIdCallback_(a.contentId),e=b.autoplay||!0,this.appDataCallback_(a.customData),e&&(this.video_.autoplay=!0),this.player_.load(d,c).then(function(){this.player_&&this.sendMediaInfoMessage_()}.bind(this))["catch"](function(a){var c="LOAD_FAILED";a.category==shaka.util.Error.Category.PLAYER&&a.code==shaka.util.Error.Code.LOAD_INTERRUPTED&&(c="LOAD_CANCELLED"),this.sendMessage_({requestId:Number(b.requestId),type:c},this.genericBus_)}.bind(this));break;default:shaka.log.warning("Unrecognized message type from the generic Chromecast controller!",b.type),this.sendMessage_({requestId:Number(b.requestId),type:"INVALID_REQUEST",reason:"INVALID_COMMAND"},this.genericBus_)}},shaka.cast.CastReceiver.prototype.sendAsyncComplete_=function(a,b,c){this.player_&&this.sendMessage_({type:"asyncComplete",id:b,error:c},this.shakaBus_,a)},shaka.cast.CastReceiver.prototype.sendMessage_=function(a,b,c){this.isConnected_&&(a=shaka.cast.CastUtils.serialize(a),c?b.getCastChannel(c).send(a):b.broadcast(a))},shaka.cast.CastReceiver.prototype.getPlayState_=function(){var a=shaka.cast.CastReceiver.PLAY_STATE;return this.isIdle_?a.IDLE:this.player_.isBuffering()?a.BUFFERING:this.video_.paused?a.PAUSED:a.PLAYING},shaka.cast.CastReceiver.prototype.sendMediaStatus_=function(a,b){var c={mediaSessionId:0,playbackRate:this.video_.playbackRate,playerState:this.getPlayState_(),currentTime:this.video_.currentTime,supportedMediaCommands:15,volume:{level:this.video_.volume,muted:this.video_.muted}};b&&(c.media=b),this.sendMessage_({requestId:a,type:"MEDIA_STATUS",status:[c]},this.genericBus_)},shaka.cast.CastReceiver.PLAY_STATE={IDLE:"IDLE",PLAYING:"PLAYING",BUFFERING:"BUFFERING",PAUSED:"PAUSED"},shaka.util.DataViewReader=function(a,b){this.dataView_=a,this.littleEndian_=b==shaka.util.DataViewReader.Endianness.LITTLE_ENDIAN,this.position_=0},goog.exportSymbol("shaka.util.DataViewReader",shaka.util.DataViewReader),shaka.util.DataViewReader.Endianness={BIG_ENDIAN:0,LITTLE_ENDIAN:1},goog.exportProperty(shaka.util.DataViewReader,"Endianness",shaka.util.DataViewReader.Endianness),shaka.util.DataViewReader.prototype.hasMoreData=function(){return this.position_<this.dataView_.byteLength},goog.exportProperty(shaka.util.DataViewReader.prototype,"hasMoreData",shaka.util.DataViewReader.prototype.hasMoreData),shaka.util.DataViewReader.prototype.getPosition=function(){return this.position_},goog.exportProperty(shaka.util.DataViewReader.prototype,"getPosition",shaka.util.DataViewReader.prototype.getPosition),shaka.util.DataViewReader.prototype.getLength=function(){return this.dataView_.byteLength},goog.exportProperty(shaka.util.DataViewReader.prototype,"getLength",shaka.util.DataViewReader.prototype.getLength),shaka.util.DataViewReader.prototype.readUint8=function(){try{var a=this.dataView_.getUint8(this.position_);return this.position_+=1,a}catch(b){this.throwOutOfBounds_()}},goog.exportProperty(shaka.util.DataViewReader.prototype,"readUint8",shaka.util.DataViewReader.prototype.readUint8),shaka.util.DataViewReader.prototype.readUint16=function(){try{var a=this.dataView_.getUint16(this.position_,this.littleEndian_);return this.position_+=2,a}catch(b){this.throwOutOfBounds_()}},goog.exportProperty(shaka.util.DataViewReader.prototype,"readUint16",shaka.util.DataViewReader.prototype.readUint16),shaka.util.DataViewReader.prototype.readUint32=function(){try{var a=this.dataView_.getUint32(this.position_,this.littleEndian_);return this.position_+=4,a}catch(b){this.throwOutOfBounds_()}},goog.exportProperty(shaka.util.DataViewReader.prototype,"readUint32",shaka.util.DataViewReader.prototype.readUint32),shaka.util.DataViewReader.prototype.readInt32=function(){try{var a=this.dataView_.getInt32(this.position_,this.littleEndian_);return this.position_+=4,a}catch(b){this.throwOutOfBounds_()}},goog.exportProperty(shaka.util.DataViewReader.prototype,"readInt32",shaka.util.DataViewReader.prototype.readInt32),shaka.util.DataViewReader.prototype.readUint64=function(){try{if(this.littleEndian_)var a=this.dataView_.getUint32(this.position_,!0),b=this.dataView_.getUint32(this.position_+4,!0);else b=this.dataView_.getUint32(this.position_,!1),a=this.dataView_.getUint32(this.position_+4,!1)}catch(c){this.throwOutOfBounds_()}if(2097151<b)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.JS_INTEGER_OVERFLOW);return this.position_+=8,b*Math.pow(2,32)+a},goog.exportProperty(shaka.util.DataViewReader.prototype,"readUint64",shaka.util.DataViewReader.prototype.readUint64),shaka.util.DataViewReader.prototype.readBytes=function(a){goog.asserts.assert(0<=a,"Bad call to DataViewReader.readBytes"),this.position_+a>this.dataView_.byteLength&&this.throwOutOfBounds_();var b=new Uint8Array(this.dataView_.buffer,this.dataView_.byteOffset+this.position_,a);return this.position_+=a,new Uint8Array(b)},goog.exportProperty(shaka.util.DataViewReader.prototype,"readBytes",shaka.util.DataViewReader.prototype.readBytes),shaka.util.DataViewReader.prototype.skip=function(a){goog.asserts.assert(0<=a,"Bad call to DataViewReader.skip"),this.position_+a>this.dataView_.byteLength&&this.throwOutOfBounds_(),this.position_+=a},goog.exportProperty(shaka.util.DataViewReader.prototype,"skip",shaka.util.DataViewReader.prototype.skip),shaka.util.DataViewReader.prototype.rewind=function(a){goog.asserts.assert(0<=a,"Bad call to DataViewReader.rewind"),this.position_<a&&this.throwOutOfBounds_(),this.position_-=a},goog.exportProperty(shaka.util.DataViewReader.prototype,"rewind",shaka.util.DataViewReader.prototype.rewind),shaka.util.DataViewReader.prototype.seek=function(a){goog.asserts.assert(0<=a,"Bad call to DataViewReader.seek"),(0>a||a>this.dataView_.byteLength)&&this.throwOutOfBounds_(),this.position_=a},goog.exportProperty(shaka.util.DataViewReader.prototype,"seek",shaka.util.DataViewReader.prototype.seek),shaka.util.DataViewReader.prototype.readTerminatedString=function(){for(var a=this.position_;this.hasMoreData()&&0!=this.dataView_.getUint8(this.position_);)this.position_+=1;return a=new Uint8Array(this.dataView_.buffer,this.dataView_.byteOffset+a,this.position_-a),this.position_+=1,shaka.util.StringUtils.fromUTF8(a)},goog.exportProperty(shaka.util.DataViewReader.prototype,"readTerminatedString",shaka.util.DataViewReader.prototype.readTerminatedString),shaka.util.DataViewReader.prototype.throwOutOfBounds_=function(){throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.BUFFER_READ_OUT_OF_BOUNDS)},shaka.util.Mp4Parser=function(){this.headers_=[],this.boxDefinitions_=[],this.done_=!1},goog.exportSymbol("shaka.util.Mp4Parser",shaka.util.Mp4Parser),shaka.util.Mp4Parser.BoxType_={BASIC_BOX:0,FULL_BOX:1},shaka.util.Mp4Parser.prototype.box=function(a,b){var c=shaka.util.Mp4Parser.typeFromString_(a);return this.headers_[c]=shaka.util.Mp4Parser.BoxType_.BASIC_BOX,this.boxDefinitions_[c]=b,this},goog.exportProperty(shaka.util.Mp4Parser.prototype,"box",shaka.util.Mp4Parser.prototype.box),shaka.util.Mp4Parser.prototype.fullBox=function(a,b){var c=shaka.util.Mp4Parser.typeFromString_(a);return this.headers_[c]=shaka.util.Mp4Parser.BoxType_.FULL_BOX,this.boxDefinitions_[c]=b,this},goog.exportProperty(shaka.util.Mp4Parser.prototype,"fullBox",shaka.util.Mp4Parser.prototype.fullBox),shaka.util.Mp4Parser.prototype.stop=function(){this.done_=!0},goog.exportProperty(shaka.util.Mp4Parser.prototype,"stop",shaka.util.Mp4Parser.prototype.stop),shaka.util.Mp4Parser.prototype.parse=function(a,b){var c=new Uint8Array(a);for(c=new shaka.util.DataViewReader(new DataView(c.buffer,c.byteOffset,c.byteLength),shaka.util.DataViewReader.Endianness.BIG_ENDIAN),this.done_=!1;c.hasMoreData()&&!this.done_;)this.parseNext(0,c,b)},goog.exportProperty(shaka.util.Mp4Parser.prototype,"parse",shaka.util.Mp4Parser.prototype.parse),shaka.util.Mp4Parser.prototype.parseNext=function(a,b,c){var d=b.getPosition(),e=b.readUint32(),f=b.readUint32(),g=shaka.util.Mp4Parser.typeToString(f);switch(shaka.log.v2("Parsing MP4 box",g),e){case 0:e=b.getLength()-d;break;case 1:e=b.readUint64()}if(g=this.boxDefinitions_[f]){var h=null,i=null;this.headers_[f]==shaka.util.Mp4Parser.BoxType_.FULL_BOX&&(i=b.readUint32(),h=i>>>24,i&=16777215),f=d+e,c&&f>b.getLength()&&(f=b.getLength()),f-=b.getPosition(),b=0<f?b.readBytes(f):new Uint8Array(0),b=new shaka.util.DataViewReader(new DataView(b.buffer,b.byteOffset,b.byteLength),shaka.util.DataViewReader.Endianness.BIG_ENDIAN),g({parser:this,partialOkay:c||!1,version:h,flags:i,reader:b,size:e,start:d+a})}else a=Math.min(d+e-b.getPosition(),b.getLength()-b.getPosition()),b.skip(a)},goog.exportProperty(shaka.util.Mp4Parser.prototype,"parseNext",shaka.util.Mp4Parser.prototype.parseNext),shaka.util.Mp4Parser.children=function(a){for(;a.reader.hasMoreData()&&!a.parser.done_;)a.parser.parseNext(a.start,a.reader,a.partialOkay)},goog.exportProperty(shaka.util.Mp4Parser,"children",shaka.util.Mp4Parser.children),shaka.util.Mp4Parser.sampleDescription=function(a){for(var b=a.reader.readUint32();0<b&&!a.parser.done_;--b)a.parser.parseNext(a.start,a.reader,a.partialOkay)},goog.exportProperty(shaka.util.Mp4Parser,"sampleDescription",shaka.util.Mp4Parser.sampleDescription),shaka.util.Mp4Parser.allData=function(a){return function(b){var c=b.reader.getLength()-b.reader.getPosition();a(b.reader.readBytes(c))}},goog.exportProperty(shaka.util.Mp4Parser,"allData",shaka.util.Mp4Parser.allData),shaka.util.Mp4Parser.typeFromString_=function(a){goog.asserts.assert(4==a.length,"Mp4 box names must be 4 characters long");for(var b=0,c=0;c<a.length;c++)b=b<<8|a.charCodeAt(c);return b},shaka.util.Mp4Parser.typeToString=function(a){return String.fromCharCode(a>>24&255,a>>16&255,a>>8&255,255&a)},goog.exportProperty(shaka.util.Mp4Parser,"typeToString",shaka.util.Mp4Parser.typeToString),shaka.util.Pssh=function(a){this.systemIds=[],this.cencKeyIds=[],this.dataBoundaries=[],(new shaka.util.Mp4Parser).fullBox("pssh",this.parseBox_.bind(this)).parse(a.buffer),0==this.dataBoundaries.length&&shaka.log.warning("No pssh box found!")},shaka.util.Pssh.prototype.parseBox_=function(a){if(goog.asserts.assert(null!=a.version,"PSSH boxes are full boxes and must have a valid version"),goog.asserts.assert(null!=a.flags,"PSSH boxes are full boxes and must have a valid flag"),1<a.version)shaka.log.warning("Unrecognized PSSH version found!");else{var b=shaka.util.Uint8ArrayUtils.toHex(a.reader.readBytes(16)),c=[];if(0<a.version)for(var d=a.reader.readUint32(),e=0;e<d;++e){var f=shaka.util.Uint8ArrayUtils.toHex(a.reader.readBytes(16));c.push(f)}d=a.reader.readUint32(),a.reader.skip(d),this.cencKeyIds.push.apply(this.cencKeyIds,c),this.systemIds.push(b),this.dataBoundaries.push({start:a.start,end:a.start+a.size-1}),a.reader.getPosition()!=a.reader.getLength()&&shaka.log.warning("Mismatch between box size and data size!")}},shaka.util.Pssh.createPssh=function(a,b){var c=a.length,d=12+b.length+4+c,e=new ArrayBuffer(d),f=new Uint8Array(e);e=new DataView(e);var g=0;return e.setUint32(g,d),g+=4,e.setUint32(g,1886614376),g+=4,e.setUint32(g,0),g+=4,f.set(b,g),g+=b.length,e.setUint32(g,c),g+=4,f.set(a,g),goog.asserts.assert(g+c===d,"MS PRO invalid length."),f},shaka.util.XmlUtils={},shaka.util.XmlUtils.findChild=function(a,b){var c=shaka.util.XmlUtils.findChildren(a,b);return 1!=c.length?null:c[0]},shaka.util.XmlUtils.findChildNS=function(a,b,c){return a=shaka.util.XmlUtils.findChildrenNS(a,b,c),1!=a.length?null:a[0]},shaka.util.XmlUtils.findChildren=function(a,b){return Array.prototype.filter.call(a.childNodes,function(a){return a instanceof Element&&a.tagName==b})},shaka.util.XmlUtils.findChildrenNS=function(a,b,c){return Array.prototype.filter.call(a.childNodes,function(a){return a instanceof Element&&a.localName==c&&a.namespaceURI==b})},shaka.util.XmlUtils.getAttributeNS=function(a,b,c){return a.hasAttributeNS(b,c)?a.getAttributeNS(b,c):null},shaka.util.XmlUtils.getContents=function(a){return Array.prototype.every.call(a.childNodes,function(a){return a.nodeType==Node.TEXT_NODE||a.nodeType==Node.CDATA_SECTION_NODE})?a.textContent.trim():null},shaka.util.XmlUtils.parseAttr=function(a,b,c,d){d=void 0===d?null:d;var e=null;return a=a.getAttribute(b),null!=a&&(e=c(a)),null==e?d:e},shaka.util.XmlUtils.parseDate=function(a){return a?(/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(a)&&(a+="Z"),a=Date.parse(a),isNaN(a)?null:Math.floor(a/1e3)):null},shaka.util.XmlUtils.parseDuration=function(a){if(!a)return null;var b=/^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$/.exec(a);return b?(a=31536e3*Number(b[1]||null)+2592e3*Number(b[2]||null)+86400*Number(b[3]||null)+3600*Number(b[4]||null)+60*Number(b[5]||null)+Number(b[6]||null),isFinite(a)?a:null):(shaka.log.warning("Invalid duration string:",a),null)},shaka.util.XmlUtils.parseRange=function(a){var b=/([0-9]+)-([0-9]+)/.exec(a);return b?(a=Number(b[1]),isFinite(a)?(b=Number(b[2]),isFinite(b)?{start:a,end:b}:null):null):null},shaka.util.XmlUtils.parseInt=function(a){return a=Number(a),0===a%1?a:null},shaka.util.XmlUtils.parsePositiveInt=function(a){return a=Number(a),0===a%1&&0<a?a:null},shaka.util.XmlUtils.parseNonNegativeInt=function(a){return a=Number(a),0===a%1&&0<=a?a:null},shaka.util.XmlUtils.parseFloat=function(a){
return a=Number(a),isNaN(a)?null:a},shaka.util.XmlUtils.evalDivision=function(a){var b;return a=(b=a.match(/^(\d+)\/(\d+)$/))?Number(b[1])/Number(b[2]):Number(a),isNaN(a)?null:a},shaka.util.XmlUtils.parseXmlString=function(a,b){var c=new DOMParser;try{var d=c.parseFromString(a,"text/xml")}catch(e){}if(d&&d.documentElement.tagName==b)var f=d.documentElement;return f&&0<f.getElementsByTagName("parsererror").length?null:f},shaka.util.XmlUtils.parseXml=function(a,b){try{var c=shaka.util.StringUtils.fromUTF8(a);return shaka.util.XmlUtils.parseXmlString(c,b)}catch(d){}},shaka.dash={},shaka.dash.ContentProtection={},shaka.dash.ContentProtection.defaultKeySystems_=(new Map).set("urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b","org.w3.clearkey").set("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine.alpha").set("urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95","com.microsoft.playready").set("urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb","com.adobe.primetime"),shaka.dash.ContentProtection.MP4Protection_="urn:mpeg:dash:mp4protection:2011",shaka.dash.ContentProtection.CencNamespaceUri_="urn:mpeg:cenc:2013",shaka.dash.ContentProtection.parseFromAdaptationSet=function(a,b,c){var d=shaka.dash.ContentProtection,e=shaka.util.ManifestParserUtils,f=d.parseElements_(a),g=null;a=[];var h=[],i=new Set(f.map(function(a){return a.keyId}));if(i["delete"](null),1<i.size)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_CONFLICTING_KEY_IDS);if(c||(h=f.filter(function(a){return a.schemeUri!=d.MP4Protection_||(goog.asserts.assert(!a.init||a.init.length,"Init data must be null or non-empty."),g=a.init||g,!1)}),h.length&&(a=d.convertElements_(g,b,h),0==a.length&&(a=[e.createDrmInfo("",g)]))),f.length&&(c||!h.length))for(a=[],b=$jscomp.makeIterator(d.defaultKeySystems_.values()),c=b.next();!c.done;c=b.next())c=c.value,"org.w3.clearkey"!=c&&(c=e.createDrmInfo(c,g),a.push(c));if(e=Array.from(i)[0]||null)for(i=$jscomp.makeIterator(a),b=i.next();!b.done;b=i.next())for(b=$jscomp.makeIterator(b.value.initData),c=b.next();!c.done;c=b.next())c.value.keyId=e;return{defaultKeyId:e,defaultInit:g,drmInfos:a,firstRepresentation:!0}},shaka.dash.ContentProtection.parseFromRepresentation=function(a,b,c,d){var e=shaka.dash.ContentProtection.parseFromAdaptationSet(a,b,d);if(c.firstRepresentation)a=1==c.drmInfos.length&&!c.drmInfos[0].keySystem,b=0==e.drmInfos.length,(0==c.drmInfos.length||a&&!b)&&(c.drmInfos=e.drmInfos),c.firstRepresentation=!1;else if(0<e.drmInfos.length&&(c.drmInfos=c.drmInfos.filter(function(a){return e.drmInfos.some(function(b){return b.keySystem==a.keySystem})}),0==c.drmInfos.length))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_NO_COMMON_KEY_SYSTEM);return e.defaultKeyId||c.defaultKeyId},shaka.dash.ContentProtection.getWidevineLicenseUrl=function(a){return(a=shaka.util.XmlUtils.findChildNS(a.node,"urn:microsoft","laurl"))?a.getAttribute("licenseUrl")||"":""},shaka.dash.ContentProtection.PLAYREADY_RECORD_TYPES={RIGHTS_MANAGEMENT:1,RESERVED:2,EMBEDDED_LICENSE:3},shaka.dash.ContentProtection.parseMsProRecords_=function(a,b){for(var c=[],d=new DataView(a);b<a.byteLength-1;){var e=d.getUint16(b,!0);b+=2;var f=d.getUint16(b,!0);b+=2,goog.asserts.assert(0===(1&f),"expected byteLength to be an even number");var g=new Uint8Array(a,b,f);c.push({type:e,value:g}),b+=f}return c},shaka.dash.ContentProtection.parseMsPro_=function(a){var b=0,c=new DataView(a).getUint32(b,!0);return b+=4,c!==a.byteLength?(shaka.log.warning("PlayReady Object with invalid length encountered."),[]):shaka.dash.ContentProtection.parseMsProRecords_(a,b+2)},shaka.dash.ContentProtection.getLaurl_=function(a){return(a=a.querySelector("DATA > LA_URL"))?a.textContent:""},shaka.dash.ContentProtection.getPlayReadyLicenseUrl=function(a){var b=shaka.util.XmlUtils.findChildNS(a.node,"urn:microsoft:playready","pro");if(!b)return"";a=shaka.dash.ContentProtection;var c=a.PLAYREADY_RECORD_TYPES;return b=shaka.util.Uint8ArrayUtils.fromBase64(b.textContent),(b=a.parseMsPro_(b.buffer).filter(function(a){return a.type===c.RIGHTS_MANAGEMENT})[0])?(b=shaka.util.StringUtils.fromUTF16(b.value,!0),(b=shaka.util.XmlUtils.parseXmlString(b,"WRMHEADER"))?a.getLaurl_(b):""):""},shaka.dash.ContentProtection.getInitDataFromPro_=function(a){var b=shaka.util.XmlUtils.findChildNS(a.node,"urn:microsoft:playready","pro");if(!b)return null;b=shaka.util.Uint8ArrayUtils.fromBase64(b.textContent);var c=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);return[{initData:shaka.util.Pssh.createPssh(b,c),initDataType:"cenc",keyId:a.keyId}]},shaka.dash.ContentProtection.convertElements_=function(a,b,c){var d=shaka.dash.ContentProtection,e=shaka.util.ManifestParserUtils,f=d.defaultKeySystems_,g=d.licenseUrlParsers_,h=[];c=$jscomp.makeIterator(c);for(var i=c.next();!i.done;i=c.next()){i=i.value;var j=f.get(i.schemeUri);if(j){goog.asserts.assert(!i.init||i.init.length,"Init data must be null or non-empty.");var k=d.getInitDataFromPro_(i);k=e.createDrmInfo(j,i.init||a||k),(j=g.get(j))&&(k.licenseServerUri=j(i)),h.push(k)}else for(goog.asserts.assert(b,"ContentProtection callback is required"),i=b(i.node)||[],i=$jscomp.makeIterator(i),j=i.next();!j.done;j=i.next())h.push(j.value)}return h},shaka.dash.ContentProtection.licenseUrlParsers_=(new Map).set("com.widevine.alpha",shaka.dash.ContentProtection.getWidevineLicenseUrl).set("com.microsoft.playready",shaka.dash.ContentProtection.getPlayReadyLicenseUrl),shaka.dash.ContentProtection.parseElements_=function(a){var b=[];a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next())(c=shaka.dash.ContentProtection.parseElement_(c.value))&&b.push(c);return b},shaka.dash.ContentProtection.parseElement_=function(a){var b=shaka.dash.ContentProtection.CencNamespaceUri_,c=a.getAttribute("schemeIdUri"),d=shaka.util.XmlUtils.getAttributeNS(a,b,"default_KID");if(b=shaka.util.XmlUtils.findChildrenNS(a,b,"pssh").map(shaka.util.XmlUtils.getContents),!c)return shaka.log.error("Missing required schemeIdUri attribute on","ContentProtection element",a),null;if(c=c.toLowerCase(),d&&(d=d.replace(/-/g,"").toLowerCase(),d.includes(" ")))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_MULTIPLE_KEY_IDS_NOT_SUPPORTED);var e=[];try{e=b.map(function(a){return{initDataType:"cenc",initData:shaka.util.Uint8ArrayUtils.fromBase64(a),keyId:null}})}catch(f){throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_PSSH_BAD_ENCODING)}return{node:a,schemeUri:c,keyId:d,init:0<e.length?e:null}},shaka.dash.MpdUtils={},shaka.dash.MpdUtils.XlinkNamespaceUri_="http://www.w3.org/1999/xlink",shaka.dash.MpdUtils.fillUriTemplate=function(a,b,c,d,e){var f={RepresentationID:b,Number:c,Bandwidth:d,Time:e};return a.replace(/\$(RepresentationID|Number|Bandwidth|Time)?(?:%0([0-9]+)([diouxX]))?\$/g,function(b,c,d,e){if("$$"==b)return"$";var g=f[c];if(goog.asserts.assert(void 0!==g,"Unrecognized identifier"),null==g)return shaka.log.warning("URL template does not have an available substitution for identifier",'"'+c+'":',a),b;switch("RepresentationID"==c&&d&&(shaka.log.warning("URL template should not contain a width specifier for identifier",'"RepresentationID":',a),d=void 0),"Time"==c&&(goog.asserts.assert(.2>Math.abs(g-Math.round(g)),"Calculated $Time$ values must be close to integers"),g=Math.round(g)),e){case void 0:case"d":case"i":case"u":b=g.toString();break;case"o":b=g.toString(8);break;case"x":b=g.toString(16);break;case"X":b=g.toString(16).toUpperCase();break;default:goog.asserts.assert(!1,"Unhandled format specifier"),b=g.toString()}return d=window.parseInt(d,10)||1,Array(Math.max(0,d-b.length)+1).join("0")+b})},shaka.dash.MpdUtils.createTimeline=function(a,b,c,d){goog.asserts.assert(0<b&&1/0>b,"timescale must be a positive, finite integer"),goog.asserts.assert(0<d,"period duration must be a positive integer");var e=shaka.util.XmlUtils;a=e.findChildren(a,"S");for(var f=[],g=0,h=0;h<a.length;++h){var i=a[h],j=e.parseAttr(i,"t",e.parseNonNegativeInt),k=e.parseAttr(i,"d",e.parseNonNegativeInt),l=e.parseAttr(i,"r",e.parseInt);if(null!=j&&(j-=c),!k){shaka.log.warning('"S" element must have a duration:','ignoring the remaining "S" elements.',i);break}if(j=null!=j?j:g,l=l||0,0>l)if(h+1<a.length){if(l=e.parseAttr(a[h+1],"t",e.parseNonNegativeInt),null==l){shaka.log.warning('An "S" element cannot have a negative repeat','if the next "S" element does not have a valid start time:','ignoring the remaining "S" elements.',i);break}if(j>=l){shaka.log.warning('An "S" element cannot have a negative repeat','if its start time exceeds the next "S" element\'s start time:','ignoring the remaining "S" elements.',i);break}l=Math.ceil((l-j)/k)-1}else{if(1/0==d){shaka.log.warning('The last "S" element cannot have a negative repeat',"if the Period has an infinite duration:",'ignoring the last "S" element.',i);break}if(j/b>=d){shaka.log.warning('The last "S" element cannot have a negative repeat',"if its start time exceeds the Period's duration:",'igoring the last "S" element.',i);break}l=Math.ceil((d*b-j)/k)-1}for(0<f.length&&j!=g&&(Math.abs((j-g)/b)>=shaka.util.ManifestParserUtils.GAP_OVERLAP_TOLERANCE_SECONDS&&shaka.log.warning("SegmentTimeline contains a large gap/overlap:","the content may have errors in it.",i),f[f.length-1].end=j/b),i=0;i<=l;++i)g=j+k,f.push({start:j/b,end:g/b,unscaledStart:j}),j=g}return f},shaka.dash.MpdUtils.parseSegmentInfo=function(a,b){goog.asserts.assert(b(a.representation),"There must be at least one element of the given type.");var c=shaka.dash.MpdUtils,d=shaka.util.XmlUtils,e=c.inheritAttribute(a,b,"timescale"),f=1;e&&(f=d.parsePositiveInt(e)||1),e=c.inheritAttribute(a,b,"duration"),(e=d.parsePositiveInt(e||""))&&(e/=f);var g=c.inheritAttribute(a,b,"startNumber"),h=Number(c.inheritAttribute(a,b,"presentationTimeOffset"))||0;d=d.parseNonNegativeInt(g||""),null!=g&&null!=d||(d=1),g=c.inheritChild(a,b,"SegmentTimeline");var i=null;return g&&(i=c.createTimeline(g,f,h,a.periodInfo.duration||1/0)),{timescale:f,segmentDuration:e,startNumber:d,scaledPresentationTimeOffset:h/f||0,unscaledPresentationTimeOffset:h,timeline:i}},shaka.dash.MpdUtils.inheritAttribute=function(a,b,c){var d=shaka.util.Functional;return goog.asserts.assert(b(a.representation),"There must be at least one element of the given type"),[b(a.representation),b(a.adaptationSet),b(a.period)].filter(d.isNotNull).map(function(a){return a.getAttribute(c)}).reduce(function(a,b){return a||b})},shaka.dash.MpdUtils.inheritChild=function(a,b,c){var d=shaka.util.Functional;goog.asserts.assert(b(a.representation),"There must be at least one element of the given type"),a=[b(a.representation),b(a.adaptationSet),b(a.period)].filter(d.isNotNull);var e=shaka.util.XmlUtils;return a.map(function(a){return e.findChild(a,c)}).reduce(function(a,b){return a||b})},shaka.dash.MpdUtils.handleXlinkInElement_=function(a,b,c,d,e,f){var g=shaka.util.XmlUtils,h=shaka.util.Error,i=shaka.util.ManifestParserUtils,j=shaka.dash.MpdUtils.XlinkNamespaceUri_,k=g.getAttributeNS(a,j,"href");g=g.getAttributeNS(a,j,"actuate")||"onRequest";for(var l=0;l<a.attributes.length;l++){var m=a.attributes[l];m.namespaceURI==j&&(a.removeAttributeNS(m.namespaceURI,m.localName),--l)}if(5<=f)return shaka.util.AbortableOperation.failed(new h(h.Severity.CRITICAL,h.Category.MANIFEST,h.Code.DASH_XLINK_DEPTH_LIMIT));if("onLoad"!=g)return shaka.util.AbortableOperation.failed(new h(h.Severity.CRITICAL,h.Category.MANIFEST,h.Code.DASH_UNSUPPORTED_XLINK_ACTUATE));var n=i.resolveUris([d],[k]);return d=shaka.net.NetworkingEngine.RequestType.MANIFEST,i=shaka.net.NetworkingEngine.makeRequest(n,b),d=e.request(d,i),goog.asserts.assert(d instanceof shaka.util.AbortableOperation,"Unexpected implementation of IAbortableOperation!"),d.chain(function(d){if(d=shaka.util.XmlUtils.parseXml(d.data,a.tagName),!d)return shaka.util.AbortableOperation.failed(new h(h.Severity.CRITICAL,h.Category.MANIFEST,h.Code.DASH_INVALID_XML,k));for(;a.childNodes.length;)a.removeChild(a.childNodes[0]);for(;d.childNodes.length;){var g=d.childNodes[0];d.removeChild(g),a.appendChild(g)}for(g=0;g<d.attributes.length;g++){var i=d.attributes[g].nodeName,j=d.getAttribute(i);a.setAttribute(i,j)}return shaka.dash.MpdUtils.processXlinks(a,b,c,n[0],e,f+1)})},shaka.dash.MpdUtils.processXlinks=function(a,b,c,d,e,f){f=void 0===f?0:f;var g=shaka.dash.MpdUtils,h=shaka.util.XmlUtils,i=g.XlinkNamespaceUri_;if(h.getAttributeNS(a,i,"href"))return h=g.handleXlinkInElement_(a,b,c,d,e,f),c&&(h=h.chain(void 0,function(h){return g.processXlinks(a,b,c,d,e,f)})),h;for(var j=[],k=0;k<a.childNodes.length;k++){var l=a.childNodes[k];l instanceof Element&&("urn:mpeg:dash:resolve-to-zero:2013"==h.getAttributeNS(l,i,"href")?(a.removeChild(l),--k):"SegmentTimeline"!=l.tagName&&j.push(shaka.dash.MpdUtils.processXlinks(l,b,c,d,e,f)))}return shaka.util.AbortableOperation.all(j).chain(function(){return a})},shaka.media.InitSegmentReference=function(a,b,c){this.getUris=a,this.startByte=b,this.endByte=c},goog.exportSymbol("shaka.media.InitSegmentReference",shaka.media.InitSegmentReference),shaka.media.InitSegmentReference.prototype.createUris=function(){return this.getUris()},goog.exportProperty(shaka.media.InitSegmentReference.prototype,"createUris",shaka.media.InitSegmentReference.prototype.createUris),shaka.media.InitSegmentReference.prototype.getStartByte=function(){return this.startByte},goog.exportProperty(shaka.media.InitSegmentReference.prototype,"getStartByte",shaka.media.InitSegmentReference.prototype.getStartByte),shaka.media.InitSegmentReference.prototype.getEndByte=function(){return this.endByte},goog.exportProperty(shaka.media.InitSegmentReference.prototype,"getEndByte",shaka.media.InitSegmentReference.prototype.getEndByte),shaka.media.InitSegmentReference.prototype.getSize=function(){return this.endByte?this.endByte-this.startByte:null},shaka.media.SegmentReference=function(a,b,c,d,e,f){goog.asserts.assert(b<c,"startTime must be less than endTime"),goog.asserts.assert(e<f||null==f,"startByte must be < endByte"),this.position=a,this.startTime=b,this.endTime=c,this.getUris=d,this.startByte=e,this.endByte=f},goog.exportSymbol("shaka.media.SegmentReference",shaka.media.SegmentReference),shaka.media.SegmentReference.prototype.getPosition=function(){return this.position},goog.exportProperty(shaka.media.SegmentReference.prototype,"getPosition",shaka.media.SegmentReference.prototype.getPosition),shaka.media.SegmentReference.prototype.getStartTime=function(){return this.startTime},goog.exportProperty(shaka.media.SegmentReference.prototype,"getStartTime",shaka.media.SegmentReference.prototype.getStartTime),shaka.media.SegmentReference.prototype.getEndTime=function(){return this.endTime},goog.exportProperty(shaka.media.SegmentReference.prototype,"getEndTime",shaka.media.SegmentReference.prototype.getEndTime),shaka.media.SegmentReference.prototype.createUris=function(){return this.getUris()},goog.exportProperty(shaka.media.SegmentReference.prototype,"createUris",shaka.media.SegmentReference.prototype.createUris),shaka.media.SegmentReference.prototype.getStartByte=function(){return this.startByte},goog.exportProperty(shaka.media.SegmentReference.prototype,"getStartByte",shaka.media.SegmentReference.prototype.getStartByte),shaka.media.SegmentReference.prototype.getEndByte=function(){return this.endByte},goog.exportProperty(shaka.media.SegmentReference.prototype,"getEndByte",shaka.media.SegmentReference.prototype.getEndByte),shaka.media.SegmentReference.prototype.getSize=function(){return this.endByte?this.endByte-this.startByte:null},shaka.media.Mp4SegmentIndexParser=function(a,b,c,d){var e,f=shaka.media.Mp4SegmentIndexParser,g=(new shaka.util.Mp4Parser).fullBox("sidx",function(a){e=f.parseSIDX_(b,d,c,a)});if(a&&g.parse(a),e)return e;throw shaka.log.error('Invalid box type, expected "sidx".'),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.MP4_SIDX_WRONG_BOX_TYPE)},shaka.media.Mp4SegmentIndexParser.parseSIDX_=function(a,b,c,d){goog.asserts.assert(null!=d.version,"SIDX is a full box and should have a valid version.");var e=[];d.reader.skip(4);var f=d.reader.readUint32();if(0==f)throw shaka.log.error("Invalid timescale."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.MP4_SIDX_INVALID_TIMESCALE);if(0==d.version)var g=d.reader.readUint32(),h=d.reader.readUint32();else g=d.reader.readUint64(),h=d.reader.readUint64();d.reader.skip(2);var i=d.reader.readUint16();for(a=a+d.size+h,h=0;h<i;h++){var j=d.reader.readUint32(),k=(2147483648&j)>>>31;j&=2147483647;var l=d.reader.readUint32();if(d.reader.skip(4),1==k)throw shaka.log.error("Heirarchical SIDXs are not supported."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.MP4_SIDX_TYPE_NOT_SUPPORTED);e.push(new shaka.media.SegmentReference(e.length,g/f-b,(g+l)/f-b,function(){return c},a,a+j-1)),g+=l,a+=j}return d.parser.stop(),e},shaka.media.SegmentIndex=function(a){goog.DEBUG&&shaka.media.SegmentIndex.assertCorrectReferences_(a),this.references_=a},goog.exportSymbol("shaka.media.SegmentIndex",shaka.media.SegmentIndex),shaka.media.SegmentIndex.prototype.destroy=function(){return this.references_=null,Promise.resolve()},goog.exportProperty(shaka.media.SegmentIndex.prototype,"destroy",shaka.media.SegmentIndex.prototype.destroy),shaka.media.SegmentIndex.prototype.find=function(a){for(var b=this.references_.length-1;0<=b;--b){var c=this.references_[b];if(a>=c.startTime&&a<c.endTime)return c.position}return this.references_.length&&a<this.references_[0].startTime?this.references_[0].position:null},goog.exportProperty(shaka.media.SegmentIndex.prototype,"find",shaka.media.SegmentIndex.prototype.find),shaka.media.SegmentIndex.prototype.get=function(a){return 0==this.references_.length?null:(a-=this.references_[0].position,0>a||a>=this.references_.length?null:this.references_[a])},goog.exportProperty(shaka.media.SegmentIndex.prototype,"get",shaka.media.SegmentIndex.prototype.get),shaka.media.SegmentIndex.prototype.offset=function(a){for(var b=0;b<this.references_.length;++b)this.references_[b].startTime+=a,this.references_[b].endTime+=a},goog.exportProperty(shaka.media.SegmentIndex.prototype,"offset",shaka.media.SegmentIndex.prototype.offset),shaka.media.SegmentIndex.prototype.merge=function(a){goog.DEBUG&&shaka.media.SegmentIndex.assertCorrectReferences_(a);for(var b=[],c=0,d=0;c<this.references_.length&&d<a.length;){var e=this.references_[c],f=a[d];e.startTime<f.startTime?(b.push(e),c++):(e.startTime>f.startTime?0==c?b.push(f):shaka.log.warning("Refusing to rewrite original references on update!"):(.1<Math.abs(e.endTime-f.endTime)?(goog.asserts.assert(f.endTime>e.endTime&&c==this.references_.length-1&&d==a.length-1,"This should be an update of the last segment in a period"),e=new shaka.media.SegmentReference(e.position,f.startTime,f.endTime,f.getUris,f.startByte,f.endByte),b.push(e)):b.push(e),c++),d++)}for(;c<this.references_.length;)b.push(this.references_[c++]);if(b.length)for(c=b[b.length-1].position+1;d<a.length;)e=a[d++],e=new shaka.media.SegmentReference((c++),e.startTime,e.endTime,e.getUris,e.startByte,e.endByte),b.push(e);else b=a;goog.DEBUG&&shaka.media.SegmentIndex.assertCorrectReferences_(b),this.references_=b},goog.exportProperty(shaka.media.SegmentIndex.prototype,"merge",shaka.media.SegmentIndex.prototype.merge),shaka.media.SegmentIndex.prototype.replace=function(a){goog.DEBUG&&shaka.media.SegmentIndex.assertCorrectReferences_(a),this.references_=a},shaka.media.SegmentIndex.prototype.evict=function(a){for(var b=0;b<this.references_.length;++b)if(this.references_[b].endTime>a)return void this.references_.splice(0,b);this.references_=[]},goog.exportProperty(shaka.media.SegmentIndex.prototype,"evict",shaka.media.SegmentIndex.prototype.evict),shaka.media.SegmentIndex.prototype.fit=function(a){for(goog.asserts.assert(null!=a,"Period duration must be known for static content!"),goog.asserts.assert(1/0!=a,"Period duration must be finite for static content!");this.references_.length&&this.references_[this.references_.length-1].startTime>=a;)this.references_.pop();for(;this.references_.length&&0>=this.references_[0].endTime;)this.references_.shift();if(0!=this.references_.length){var b=this.references_[this.references_.length-1];this.references_[this.references_.length-1]=new shaka.media.SegmentReference(b.position,b.startTime,a,b.getUris,b.startByte,b.endByte)}},goog.DEBUG&&(shaka.media.SegmentIndex.assertCorrectReferences_=function(a){goog.asserts.assert(a.every(function(b,c){if(0==c)return!0;var d=a[c-1];return b.position==d.position+1&&(d.startTime<b.startTime||!(d.startTime>b.startTime)&&d.endTime<=b.endTime)}),"SegmentReferences are incorrect")}),shaka.util.EbmlParser=function(a){this.dataView_=a,this.reader_=new shaka.util.DataViewReader(a,shaka.util.DataViewReader.Endianness.BIG_ENDIAN),shaka.util.EbmlParser.DYNAMIC_SIZES||(shaka.util.EbmlParser.DYNAMIC_SIZES=[new Uint8Array([255]),new Uint8Array([127,255]),new Uint8Array([63,255,255]),new Uint8Array([31,255,255,255]),new Uint8Array([15,255,255,255,255]),new Uint8Array([7,255,255,255,255,255]),new Uint8Array([3,255,255,255,255,255,255]),new Uint8Array([1,255,255,255,255,255,255,255])])},shaka.util.EbmlParser.prototype.hasMoreData=function(){return this.reader_.hasMoreData()},shaka.util.EbmlParser.prototype.parseElement=function(){var a=this.parseId_(),b=this.parseVint_();b=shaka.util.EbmlParser.isDynamicSizeValue_(b)?this.dataView_.byteLength-this.reader_.getPosition():shaka.util.EbmlParser.getVintValue_(b),b=this.reader_.getPosition()+b<=this.dataView_.byteLength?b:this.dataView_.byteLength-this.reader_.getPosition();var c=new DataView(this.dataView_.buffer,this.dataView_.byteOffset+this.reader_.getPosition(),b);return this.reader_.skip(b),new shaka.util.EbmlElement(a,c)},shaka.util.EbmlParser.prototype.parseId_=function(){var a=this.parseVint_();if(7<a.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.EBML_OVERFLOW);for(var b=0,c=0;c<a.length;c++)b=256*b+a[c];return b},shaka.util.EbmlParser.prototype.parseVint_=function(){var a,b=this.reader_.readUint8();for(a=1;8>=a&&!(b&1<<8-a);a++);if(8<a)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.EBML_OVERFLOW);var c=new Uint8Array(a);for(c[0]=b,b=1;b<a;b++)c[b]=this.reader_.readUint8();return c},shaka.util.EbmlParser.getVintValue_=function(a){if(8==a.length&&224&a[1])throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.JS_INTEGER_OVERFLOW);for(var b=a[0]&(1<<8-a.length)-1,c=1;c<a.length;c++)b=256*b+a[c];return b},shaka.util.EbmlParser.isDynamicSizeValue_=function(a){for(var b=shaka.util.EbmlParser,c=shaka.util.Uint8ArrayUtils.equal,d=0;d<b.DYNAMIC_SIZES.length;d++)if(c(a,b.DYNAMIC_SIZES[d]))return!0;return!1},shaka.util.EbmlElement=function(a,b){this.id=a,this.dataView_=b},shaka.util.EbmlElement.prototype.getOffset=function(){return this.dataView_.byteOffset},shaka.util.EbmlElement.prototype.createParser=function(){return new shaka.util.EbmlParser(this.dataView_)},shaka.util.EbmlElement.prototype.getUint=function(){if(8<this.dataView_.byteLength)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.EBML_OVERFLOW);if(8==this.dataView_.byteLength&&224&this.dataView_.getUint8(0))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.JS_INTEGER_OVERFLOW);for(var a=0,b=0;b<this.dataView_.byteLength;b++){var c=this.dataView_.getUint8(b);a=256*a+c}return a},shaka.util.EbmlElement.prototype.getFloat=function(){if(4==this.dataView_.byteLength)return this.dataView_.getFloat32(0);if(8==this.dataView_.byteLength)return this.dataView_.getFloat64(0);throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.EBML_BAD_FLOATING_POINT_SIZE)},shaka.media.WebmSegmentIndexParser=function(){},shaka.media.WebmSegmentIndexParser.EBML_ID=440786851,shaka.media.WebmSegmentIndexParser.SEGMENT_ID=408125543,shaka.media.WebmSegmentIndexParser.INFO_ID=357149030,shaka.media.WebmSegmentIndexParser.TIMECODE_SCALE_ID=2807729,shaka.media.WebmSegmentIndexParser.DURATION_ID=17545,shaka.media.WebmSegmentIndexParser.CUES_ID=475249515,shaka.media.WebmSegmentIndexParser.CUE_POINT_ID=187,shaka.media.WebmSegmentIndexParser.CUE_TIME_ID=179,shaka.media.WebmSegmentIndexParser.CUE_TRACK_POSITIONS_ID=183,shaka.media.WebmSegmentIndexParser.CUE_CLUSTER_POSITION=241,shaka.media.WebmSegmentIndexParser.prototype.parse=function(a,b,c,d){if(b=this.parseWebmContainer_(b),a=new shaka.util.EbmlParser(new DataView(a)).parseElement(),a.id!=shaka.media.WebmSegmentIndexParser.CUES_ID)throw shaka.log.error("Not a Cues element."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.WEBM_CUES_ELEMENT_MISSING);return this.parseCues_(a,b.segmentOffset,b.timecodeScale,b.duration,c,d)},shaka.media.WebmSegmentIndexParser.prototype.parseWebmContainer_=function(a){if(a=new shaka.util.EbmlParser(new DataView(a)),a.parseElement().id!=shaka.media.WebmSegmentIndexParser.EBML_ID)throw shaka.log.error("Not an EBML element."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.WEBM_EBML_HEADER_ELEMENT_MISSING);var b=a.parseElement();if(b.id!=shaka.media.WebmSegmentIndexParser.SEGMENT_ID)throw shaka.log.error("Not a Segment element."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.WEBM_SEGMENT_ELEMENT_MISSING);return a=b.getOffset(),b=this.parseSegment_(b),{segmentOffset:a,timecodeScale:b.timecodeScale,duration:b.duration}},shaka.media.WebmSegmentIndexParser.prototype.parseSegment_=function(a){a=a.createParser();for(var b=null;a.hasMoreData();){var c=a.parseElement();if(c.id==shaka.media.WebmSegmentIndexParser.INFO_ID){b=c;break}}if(!b)throw shaka.log.error("Not an Info element."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.WEBM_INFO_ELEMENT_MISSING);return this.parseInfo_(b)},shaka.media.WebmSegmentIndexParser.prototype.parseInfo_=function(a){var b=a.createParser(),c=1e6;for(a=null;b.hasMoreData();){var d=b.parseElement();d.id==shaka.media.WebmSegmentIndexParser.TIMECODE_SCALE_ID?c=d.getUint():d.id==shaka.media.WebmSegmentIndexParser.DURATION_ID&&(a=d.getFloat())}if(null==a)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.WEBM_DURATION_ELEMENT_MISSING);return b=c/1e9,{timecodeScale:b,duration:a*b}},shaka.media.WebmSegmentIndexParser.prototype.parseCues_=function(a,b,c,d,e,f){var g=[],h=function(){return e};a=a.createParser();for(var i=null,j=null;a.hasMoreData();){var k=a.parseElement();if(k.id==shaka.media.WebmSegmentIndexParser.CUE_POINT_ID){var l=this.parseCuePoint_(k);l&&(k=c*l.unscaledTime,l=b+l.relativeOffset,null!=i&&(goog.asserts.assert(null!=j,"last offset cannot be null"),g.push(new shaka.media.SegmentReference(g.length,i-f,k-f,h,j,l-1))),i=k,j=l)}}return null!=i&&(goog.asserts.assert(null!=j,"last offset cannot be null"),g.push(new shaka.media.SegmentReference(g.length,i-f,d-f,h,j,null))),g},shaka.media.WebmSegmentIndexParser.prototype.parseCuePoint_=function(a){var b=a.createParser();if(a=b.parseElement(),a.id!=shaka.media.WebmSegmentIndexParser.CUE_TIME_ID)throw shaka.log.warning("Not a CueTime element."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.WEBM_CUE_TIME_ELEMENT_MISSING);if(a=a.getUint(),b=b.parseElement(),b.id!=shaka.media.WebmSegmentIndexParser.CUE_TRACK_POSITIONS_ID)throw shaka.log.warning("Not a CueTrackPositions element."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.WEBM_CUE_TRACK_POSITIONS_ELEMENT_MISSING);b=b.createParser();for(var c=0;b.hasMoreData();){var d=b.parseElement();if(d.id==shaka.media.WebmSegmentIndexParser.CUE_CLUSTER_POSITION){c=d.getUint();break}}return{unscaledTime:a,relativeOffset:c}},shaka.dash.SegmentBase={},shaka.dash.SegmentBase.createInitSegment=function(a,b){var c=shaka.util.XmlUtils,d=shaka.util.ManifestParserUtils,e=shaka.dash.MpdUtils.inheritChild(a,b,"Initialization");if(!e)return null;var f=a.representation.baseUris,g=e.getAttribute("sourceURL");return g&&(f=d.resolveUris(a.representation.baseUris,[g])),d=0,g=null,(c=c.parseAttr(e,"range",c.parseRange))&&(d=c.start,g=c.end),new shaka.media.InitSegmentReference(function(){return f},d,g)},shaka.dash.SegmentBase.createStream=function(a,b){goog.asserts.assert(a.representation.segmentBase,"Should only be called with SegmentBase");var c=shaka.dash.MpdUtils,d=shaka.dash.SegmentBase,e=shaka.util.XmlUtils,f=Number(c.inheritAttribute(a,d.fromInheritance_,"presentationTimeOffset"))||0;c=c.inheritAttribute(a,d.fromInheritance_,"timescale");var g=1;return c&&(g=e.parsePositiveInt(c)||1),e=f/g||0,f=d.createInitSegment(a,d.fromInheritance_),d=d.createSegmentIndex_(a,b,f,e),{createSegmentIndex:d.createSegmentIndex,findSegmentPosition:d.findSegmentPosition,getSegmentReference:d.getSegmentReference,initSegmentReference:f,scaledPresentationTimeOffset:e}},shaka.dash.SegmentBase.createSegmentIndexFromUris=function(a,b,c,d,e,f,g,h){var i=a.presentationTimeline,j=!a.dynamic||!a.periodInfo.isLastPeriod,k=a.periodInfo.start,l=a.periodInfo.duration,m=b,n=null;return{createSegmentIndex:function(){var a=[m(d,e,f),"webm"==g?m(c.getUris(),c.startByte,c.endByte):null];return m=null,Promise.all(a).then(function(a){var b=a[0];a=a[1]||null,"mp4"==g?b=shaka.media.Mp4SegmentIndexParser(b,e,d,h):(goog.asserts.assert(a,"WebM requires init data"),b=(new shaka.media.WebmSegmentIndexParser).parse(b,a,d,h)),i.notifySegments(b,k),goog.asserts.assert(!n,"Should not call createSegmentIndex twice"),n=new shaka.media.SegmentIndex(b),j&&n.fit(l)})},findSegmentPosition:function(a){return goog.asserts.assert(n,"Must call createSegmentIndex first"),n.find(a)},getSegmentReference:function(a){return goog.asserts.assert(n,"Must call createSegmentIndex first"),n.get(a)}}},shaka.dash.SegmentBase.fromInheritance_=function(a){return a.segmentBase},shaka.dash.SegmentBase.createSegmentIndex_=function(a,b,c,d){var e=shaka.dash.MpdUtils,f=shaka.dash.SegmentBase,g=shaka.util.XmlUtils,h=shaka.util.ManifestParserUtils,i=shaka.util.ManifestParserUtils.ContentType,j=a.representation.contentType,k=a.representation.mimeType.split("/")[1];if(j!=i.TEXT&&"mp4"!=k&&"webm"!=k)throw shaka.log.error("SegmentBase specifies an unsupported container type.",a.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_UNSUPPORTED_CONTAINER);if("webm"==k&&!c)throw shaka.log.error("SegmentBase does not contain sufficient segment information:","the SegmentBase uses a WebM container,","but does not contain an Initialization element.",a.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_WEBM_MISSING_INIT);if(i=e.inheritChild(a,f.fromInheritance_,"RepresentationIndex"),f=e.inheritAttribute(a,f.fromInheritance_,"indexRange"),e=a.representation.baseUris,f=g.parseRange(f||""),i&&((j=i.getAttribute("sourceURL"))&&(e=h.resolveUris(a.representation.baseUris,[j])),f=g.parseAttr(i,"range",g.parseRange,f)),!f)throw shaka.log.error("SegmentBase does not contain sufficient segment information:","the SegmentBase does not contain @indexRange","or a RepresentationIndex element.",a.representation),
new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_NO_SEGMENT_INFO);return shaka.dash.SegmentBase.createSegmentIndexFromUris(a,b,c,e,f.start,f.end,k,d)},shaka.dash.SegmentList={},shaka.dash.SegmentList.createStream=function(a,b){goog.asserts.assert(a.representation.segmentList,"Should only be called with SegmentList");var c=shaka.dash.SegmentList,d=shaka.dash.SegmentBase.createInitSegment(a,c.fromInheritance_),e=c.parseSegmentListInfo_(a);c.checkSegmentListInfo_(a,e);var f=null,g=null;return a.period.id&&a.representation.id&&(g=a.period.id+","+a.representation.id,f=b[g]),c=c.createSegmentReferences_(a.periodInfo.duration,e.startNumber,a.representation.baseUris,e),f?(f.merge(c),g=a.presentationTimeline.getSegmentAvailabilityStart(),f.evict(g-a.periodInfo.start)):(a.presentationTimeline.notifySegments(c,a.periodInfo.start),f=new shaka.media.SegmentIndex(c),g&&a.dynamic&&(b[g]=f)),a.dynamic&&a.periodInfo.isLastPeriod||f.fit(a.periodInfo.duration),{createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:f.find.bind(f),getSegmentReference:f.get.bind(f),initSegmentReference:d,scaledPresentationTimeOffset:e.scaledPresentationTimeOffset}},shaka.dash.SegmentList.fromInheritance_=function(a){return a.segmentList},shaka.dash.SegmentList.parseSegmentListInfo_=function(a){var b=shaka.dash.SegmentList,c=shaka.dash.MpdUtils,d=b.parseMediaSegments_(a);return a=c.parseSegmentInfo(a,b.fromInheritance_),b=a.startNumber,0==b&&(shaka.log.warning("SegmentList@startNumber must be > 0"),b=1),c=0,a.segmentDuration?c=a.segmentDuration*(b-1):a.timeline&&0<a.timeline.length&&(c=a.timeline[0].start),{segmentDuration:a.segmentDuration,startTime:c,startNumber:b,scaledPresentationTimeOffset:a.scaledPresentationTimeOffset,timeline:a.timeline,mediaSegments:d}},shaka.dash.SegmentList.checkSegmentListInfo_=function(a,b){if(!b.segmentDuration&&!b.timeline&&1<b.mediaSegments.length)throw shaka.log.warning("SegmentList does not contain sufficient segment information:","the SegmentList specifies multiple segments,","but does not specify a segment duration or timeline.",a.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_NO_SEGMENT_INFO);if(!b.segmentDuration&&!a.periodInfo.duration&&!b.timeline&&1==b.mediaSegments.length)throw shaka.log.warning("SegmentList does not contain sufficient segment information:","the SegmentList specifies one segment,","but does not specify a segment duration, period duration,","or timeline.",a.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_NO_SEGMENT_INFO);if(b.timeline&&0==b.timeline.length)throw shaka.log.warning("SegmentList does not contain sufficient segment information:","the SegmentList has an empty timeline.",a.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_NO_SEGMENT_INFO)},shaka.dash.SegmentList.createSegmentReferences_=function(a,b,c,d){var e=shaka.util.ManifestParserUtils,f=d.mediaSegments.length;d.timeline&&d.timeline.length!=d.mediaSegments.length&&(f=Math.min(d.timeline.length,d.mediaSegments.length),shaka.log.warning("The number of items in the segment timeline and the number of segment","URLs do not match, truncating",d.mediaSegments.length,"to",f));for(var g=[],h=d.startTime,i=0;i<f;i++){var j=d.mediaSegments[i],k=e.resolveUris(c,[j.mediaUri]),l=void 0;null!=d.segmentDuration?l=h+d.segmentDuration:d.timeline?l=d.timeline[i].end:(goog.asserts.assert(1==d.mediaSegments.length&&a,"There should be exactly one segment with a Period duration."),l=h+a),k=function(a){return a}.bind(null,k),g.push(new shaka.media.SegmentReference(i+b,h,l,k,j.start,j.end)),h=l}return g},shaka.dash.SegmentList.parseMediaSegments_=function(a){var b=[a.representation.segmentList,a.adaptationSet.segmentList,a.period.segmentList].filter(shaka.util.Functional.isNotNull),c=shaka.util.XmlUtils;return b.map(function(a){return c.findChildren(a,"SegmentURL")}).reduce(function(a,b){return 0<a.length?a:b}).map(function(b){b.getAttribute("indexRange")&&!a.indexRangeWarningGiven&&(a.indexRangeWarningGiven=!0,shaka.log.warning("We do not support the SegmentURL@indexRange attribute on SegmentList.  We only use the SegmentList@duration attribute or SegmentTimeline, which must be accurate."));var d=b.getAttribute("media");return b=c.parseAttr(b,"mediaRange",c.parseRange,{start:0,end:null}),{mediaUri:d,start:b.start,end:b.end}})},shaka.dash.SegmentTemplate={},shaka.dash.SegmentTemplate.createStream=function(a,b,c,d){goog.asserts.assert(a.representation.segmentTemplate,"Should only be called with SegmentTemplate");var e=shaka.dash.SegmentTemplate,f=e.createInitSegment_(a),g=e.parseSegmentTemplateInfo_(a);if(e.checkSegmentTemplateInfo_(a,g),g.indexTemplate)a=e.createFromIndexTemplate_(a,b,f,g);else if(g.segmentDuration)d||(a.presentationTimeline.notifyMaxSegmentDuration(g.segmentDuration),a.presentationTimeline.notifyMinSegmentStartTime(a.periodInfo.start)),a=e.createFromDuration_(a,g);else{d=b=null,a.period.id&&a.representation.id&&(d=a.period.id+","+a.representation.id,b=c[d]);var h=e.createFromTimeline_(a,g);e=!a.dynamic||!a.periodInfo.isLastPeriod,b?(e&&new shaka.media.SegmentIndex(h).fit(a.periodInfo.duration),b.merge(h),c=a.presentationTimeline.getSegmentAvailabilityStart(),b.evict(c-a.periodInfo.start)):(a.presentationTimeline.notifySegments(h,a.periodInfo.start),b=new shaka.media.SegmentIndex(h),d&&a.dynamic&&(c[d]=b)),e&&b.fit(a.periodInfo.duration),a={createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:b.find.bind(b),getSegmentReference:b.get.bind(b)}}return{createSegmentIndex:a.createSegmentIndex,findSegmentPosition:a.findSegmentPosition,getSegmentReference:a.getSegmentReference,initSegmentReference:f,scaledPresentationTimeOffset:g.scaledPresentationTimeOffset}},shaka.dash.SegmentTemplate.fromInheritance_=function(a){return a.segmentTemplate},shaka.dash.SegmentTemplate.parseSegmentTemplateInfo_=function(a){var b=shaka.dash.SegmentTemplate,c=shaka.dash.MpdUtils,d=c.parseSegmentInfo(a,b.fromInheritance_),e=c.inheritAttribute(a,b.fromInheritance_,"media");return a=c.inheritAttribute(a,b.fromInheritance_,"index"),{segmentDuration:d.segmentDuration,timescale:d.timescale,startNumber:d.startNumber,scaledPresentationTimeOffset:d.scaledPresentationTimeOffset,unscaledPresentationTimeOffset:d.unscaledPresentationTimeOffset,timeline:d.timeline,mediaTemplate:e,indexTemplate:a}},shaka.dash.SegmentTemplate.checkSegmentTemplateInfo_=function(a,b){var c=b.indexTemplate?1:0;if(c+=b.timeline?1:0,c+=b.segmentDuration?1:0,0==c)throw shaka.log.error("SegmentTemplate does not contain any segment information:","the SegmentTemplate must contain either an index URL template","a SegmentTimeline, or a segment duration.",a.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_NO_SEGMENT_INFO);if(1!=c&&(shaka.log.warning("SegmentTemplate containes multiple segment information sources:","the SegmentTemplate should only contain an index URL template,","a SegmentTimeline or a segment duration.",a.representation),b.indexTemplate?(shaka.log.info("Using the index URL template by default."),b.timeline=null):(goog.asserts.assert(b.timeline,"There should be a timeline"),shaka.log.info("Using the SegmentTimeline by default.")),b.segmentDuration=null),!b.indexTemplate&&!b.mediaTemplate)throw shaka.log.error("SegmentTemplate does not contain sufficient segment information:","the SegmentTemplate's media URL template is missing.",a.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_NO_SEGMENT_INFO)},shaka.dash.SegmentTemplate.createFromIndexTemplate_=function(a,b,c,d){var e=shaka.dash.MpdUtils,f=shaka.util.ManifestParserUtils,g=a.representation.mimeType.split("/")[1];if("mp4"!=g&&"webm"!=g)throw shaka.log.error("SegmentTemplate specifies an unsupported container type.",a.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_UNSUPPORTED_CONTAINER);if("webm"==g&&!c)throw shaka.log.error("SegmentTemplate does not contain sufficient segment information:","the SegmentTemplate uses a WebM container,","but does not contain an initialization URL template.",a.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_WEBM_MISSING_INIT);return goog.asserts.assert(d.indexTemplate,"must be using index template"),e=e.fillUriTemplate(d.indexTemplate,a.representation.id,null,a.bandwidth||null,null),f=f.resolveUris(a.representation.baseUris,[e]),shaka.dash.SegmentBase.createSegmentIndexFromUris(a,b,c,f,0,null,g,d.scaledPresentationTimeOffset)},shaka.dash.SegmentTemplate.createFromDuration_=function(a,b){goog.asserts.assert(b.mediaTemplate,"There should be a media template with duration");var c=shaka.dash.MpdUtils,d=shaka.util.ManifestParserUtils,e=a.periodInfo.duration,f=b.segmentDuration,g=b.startNumber,h=b.timescale,i=b.mediaTemplate,j=a.bandwidth||null,k=a.representation.id,l=a.representation.baseUris;return{createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(a){return 0>a||e&&a>=e?null:Math.floor(a/f)},getSegmentReference:function(a){var b=a*f,m=b+f;return e&&(m=Math.min(m,e)),0>m||e&&b>=e?null:new shaka.media.SegmentReference(a,b,m,function(){var e=c.fillUriTemplate(i,k,a+g,j,b*h);return d.resolveUris(l,[e])},0,null)}}},shaka.dash.SegmentTemplate.createFromTimeline_=function(a,b){goog.asserts.assert(b.mediaTemplate,"There should be a media template with a timeline");for(var c=shaka.dash.MpdUtils,d=shaka.util.ManifestParserUtils,e=[],f=0;f<b.timeline.length;f++){var g=b.timeline[f].start,h=b.timeline[f].end,i=f+b.startNumber,j=function(a,b,e,f,g,h){return a=c.fillUriTemplate(a,b,g,e,h),d.resolveUris(f,[a]).map(function(a){return a.toString()})}.bind(null,b.mediaTemplate,a.representation.id,a.bandwidth||null,a.representation.baseUris,i,b.timeline[f].unscaledStart+b.unscaledPresentationTimeOffset);e.push(new shaka.media.SegmentReference(i,g,h,j,0,null))}return e},shaka.dash.SegmentTemplate.createInitSegment_=function(a){var b=shaka.dash.MpdUtils,c=shaka.util.ManifestParserUtils,d=b.inheritAttribute(a,shaka.dash.SegmentTemplate.fromInheritance_,"initialization");if(!d)return null;var e=a.representation.id,f=a.bandwidth||null,g=a.representation.baseUris;return new shaka.media.InitSegmentReference(function(){goog.asserts.assert(d,"Should have returned earler");var a=b.fillUriTemplate(d,e,null,f,null);return c.resolveUris(g,[a])},0,null)},shaka.media.ManifestParser={},shaka.media.ManifestParser.parsersByMime={},shaka.media.ManifestParser.parsersByExtension={},shaka.media.ManifestParser.registerParserByExtension=function(a,b){shaka.media.ManifestParser.parsersByExtension[a]=b},goog.exportSymbol("shaka.media.ManifestParser.registerParserByExtension",shaka.media.ManifestParser.registerParserByExtension),shaka.media.ManifestParser.registerParserByMime=function(a,b){shaka.media.ManifestParser.parsersByMime[a]=b},goog.exportSymbol("shaka.media.ManifestParser.registerParserByMime",shaka.media.ManifestParser.registerParserByMime),shaka.media.ManifestParser.probeSupport=function(){var a=shaka.media.ManifestParser,b={};if(shaka.util.Platform.supportsMediaSource()){for(var c in a.parsersByMime)b[c]=!0;for(var d in a.parsersByExtension)b[d]=!0}c={mpd:"application/dash+xml",m3u8:"application/x-mpegurl",ism:"application/vnd.ms-sstr+xml"},d=$jscomp.makeIterator(["application/dash+xml","application/x-mpegurl","application/vnd.apple.mpegurl","application/vnd.ms-sstr+xml"]);for(var e=d.next();!e.done;e=d.next())e=e.value,shaka.util.Platform.supportsMediaSource()?b[e]=!!a.parsersByMime[e]:b[e]=shaka.util.Platform.supportsMediaType(e);for(var f in c)shaka.util.Platform.supportsMediaSource()?b[f]=!!a.parsersByExtension[f]:b[f]=shaka.util.Platform.supportsMediaType(c[f]);return b},shaka.media.ManifestParser.create=function(a,b,c,d){return $jscomp.asyncExecutePromiseGeneratorFunction(function e(){var f,g;return $jscomp.generator.createGenerator(e,function(e){switch(e.nextAddress){case 1:return e.setCatchFinallyBlocks(2),e["yield"](shaka.media.ManifestParser.getFactory_(a,b,c,d),4);case 4:return f=e.yieldResult,e["return"](new f);case 2:throw g=e.enterCatchBlock(),goog.asserts.assert(g instanceof shaka.util.Error,"Incorrect error type"),g.severity=shaka.util.Error.Severity.CRITICAL,g}})})},shaka.media.ManifestParser.getFactory_=function(a,b,c,d){return $jscomp.asyncExecutePromiseGeneratorFunction(function e(){var f,g,h,i,j;return $jscomp.generator.createGenerator(e,function(e){switch(e.nextAddress){case 1:if(f=shaka.media.ManifestParser,d){if(g=f.parsersByMime[d.toLowerCase()])return e["return"](g);shaka.log.warning("Could not determine manifest type using MIME type ",d)}if(h=f.getExtension(a)){if(i=f.parsersByExtension[h])return e["return"](i);shaka.log.warning("Could not determine manifest type for extension ",h)}else shaka.log.warning("Could not find extension for ",a);if(d){e.jumpTo(2);break}return e["yield"](f.getMimeType(a,b,c),3);case 3:if(d=e.yieldResult){if(j=shaka.media.ManifestParser.parsersByMime[d])return e["return"](j);shaka.log.warning("Could not determine manifest type using MIME type",d)}case 2:throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.UNABLE_TO_GUESS_MANIFEST_TYPE,a)}})})},shaka.media.ManifestParser.getMimeType=function(a,b,c){return $jscomp.asyncExecutePromiseGeneratorFunction(function d(){var e,f,g,h;return $jscomp.generator.createGenerator(d,function(d){switch(d.nextAddress){case 1:return e=shaka.net.NetworkingEngine.RequestType.MANIFEST,f=shaka.net.NetworkingEngine.makeRequest([a],c),f.method="HEAD",d["yield"](b.request(e,f).promise,2);case 2:return g=d.yieldResult,h=g.headers["content-type"],d["return"](h?h.toLowerCase():"")}})})},shaka.media.ManifestParser.getExtension=function(a){return a=new goog.Uri(a).getPath().split("/").pop().split("."),1==a.length?"":a.pop().toLowerCase()},shaka.media.ManifestParser.isSupported=function(a,b){return!!shaka.util.Platform.supportsMediaSource()&&(b in shaka.media.ManifestParser.parsersByMime||shaka.media.ManifestParser.getExtension(a)in shaka.media.ManifestParser.parsersByExtension)},shaka.media.PresentationTimeline=function(a,b,c){this.presentationStartTime_=a,this.presentationDelay_=b,this.segmentAvailabilityDuration_=this.duration_=1/0,this.maxSegmentDuration_=1,this.maxSegmentEndTime_=this.minSegmentStartTime_=null,this.clockOffset_=0,this.static_=!0,this.userSeekStart_=0,this.autoCorrectDrift_=void 0===c||c},goog.exportSymbol("shaka.media.PresentationTimeline",shaka.media.PresentationTimeline),shaka.media.PresentationTimeline.prototype.getDuration=function(){return this.duration_},goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getDuration",shaka.media.PresentationTimeline.prototype.getDuration),shaka.media.PresentationTimeline.prototype.getMaxSegmentDuration=function(){return this.maxSegmentDuration_},shaka.media.PresentationTimeline.prototype.setDuration=function(a){goog.asserts.assert(0<a,"duration must be > 0"),this.duration_=a},goog.exportProperty(shaka.media.PresentationTimeline.prototype,"setDuration",shaka.media.PresentationTimeline.prototype.setDuration),shaka.media.PresentationTimeline.prototype.getPresentationStartTime=function(){return this.presentationStartTime_},goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getPresentationStartTime",shaka.media.PresentationTimeline.prototype.getPresentationStartTime),shaka.media.PresentationTimeline.prototype.setClockOffset=function(a){this.clockOffset_=a},goog.exportProperty(shaka.media.PresentationTimeline.prototype,"setClockOffset",shaka.media.PresentationTimeline.prototype.setClockOffset),shaka.media.PresentationTimeline.prototype.setStatic=function(a){this.static_=a},goog.exportProperty(shaka.media.PresentationTimeline.prototype,"setStatic",shaka.media.PresentationTimeline.prototype.setStatic),shaka.media.PresentationTimeline.prototype.setSegmentAvailabilityDuration=function(a){goog.asserts.assert(0<=a,"segmentAvailabilityDuration must be >= 0"),this.segmentAvailabilityDuration_=a},goog.exportProperty(shaka.media.PresentationTimeline.prototype,"setSegmentAvailabilityDuration",shaka.media.PresentationTimeline.prototype.setSegmentAvailabilityDuration),shaka.media.PresentationTimeline.prototype.setDelay=function(a){goog.asserts.assert(0<=a,"delay must be >= 0"),this.presentationDelay_=a},goog.exportProperty(shaka.media.PresentationTimeline.prototype,"setDelay",shaka.media.PresentationTimeline.prototype.setDelay),shaka.media.PresentationTimeline.prototype.getDelay=function(){return this.presentationDelay_},goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getDelay",shaka.media.PresentationTimeline.prototype.getDelay),shaka.media.PresentationTimeline.prototype.notifySegments=function(a,b){if(0!=a.length){var c=a[a.length-1].endTime+b;this.notifyMinSegmentStartTime(a[0].startTime+b),this.maxSegmentDuration_=a.reduce(function(a,b){return Math.max(a,b.endTime-b.startTime)},this.maxSegmentDuration_),this.maxSegmentEndTime_=Math.max(this.maxSegmentEndTime_,c),null!=this.presentationStartTime_&&this.autoCorrectDrift_&&(this.presentationStartTime_=(Date.now()+this.clockOffset_)/1e3-this.maxSegmentEndTime_-this.maxSegmentDuration_),shaka.log.v1("notifySegments:","maxSegmentDuration="+this.maxSegmentDuration_)}},goog.exportProperty(shaka.media.PresentationTimeline.prototype,"notifySegments",shaka.media.PresentationTimeline.prototype.notifySegments),shaka.media.PresentationTimeline.prototype.notifyMinSegmentStartTime=function(a){this.minSegmentStartTime_=null==this.minSegmentStartTime_?a:Math.min(this.minSegmentStartTime_,a)},goog.exportProperty(shaka.media.PresentationTimeline.prototype,"notifyMinSegmentStartTime",shaka.media.PresentationTimeline.prototype.notifyMinSegmentStartTime),shaka.media.PresentationTimeline.prototype.notifyMaxSegmentDuration=function(a){this.maxSegmentDuration_=Math.max(this.maxSegmentDuration_,a),shaka.log.v1("notifyNewSegmentDuration:","maxSegmentDuration="+this.maxSegmentDuration_)},goog.exportProperty(shaka.media.PresentationTimeline.prototype,"notifyMaxSegmentDuration",shaka.media.PresentationTimeline.prototype.notifyMaxSegmentDuration),shaka.media.PresentationTimeline.prototype.offset=function(a){null!=this.minSegmentStartTime_&&(this.minSegmentStartTime_+=a),null!=this.maxSegmentEndTime_&&(this.maxSegmentEndTime_+=a)},goog.exportProperty(shaka.media.PresentationTimeline.prototype,"offset",shaka.media.PresentationTimeline.prototype.offset),shaka.media.PresentationTimeline.prototype.isLive=function(){return 1/0==this.duration_&&!this.static_},goog.exportProperty(shaka.media.PresentationTimeline.prototype,"isLive",shaka.media.PresentationTimeline.prototype.isLive),shaka.media.PresentationTimeline.prototype.isInProgress=function(){return 1/0!=this.duration_&&!this.static_},goog.exportProperty(shaka.media.PresentationTimeline.prototype,"isInProgress",shaka.media.PresentationTimeline.prototype.isInProgress),shaka.media.PresentationTimeline.prototype.getSegmentAvailabilityStart=function(){if(goog.asserts.assert(0<=this.segmentAvailabilityDuration_,"The availability duration should be positive"),1/0==this.segmentAvailabilityDuration_)return this.userSeekStart_;var a=this.getSegmentAvailabilityEnd()-this.segmentAvailabilityDuration_;return Math.max(this.userSeekStart_,a)},goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getSegmentAvailabilityStart",shaka.media.PresentationTimeline.prototype.getSegmentAvailabilityStart),shaka.media.PresentationTimeline.prototype.setUserSeekStart=function(a){this.userSeekStart_=a},goog.exportProperty(shaka.media.PresentationTimeline.prototype,"setUserSeekStart",shaka.media.PresentationTimeline.prototype.setUserSeekStart),shaka.media.PresentationTimeline.prototype.getSegmentAvailabilityEnd=function(){return this.isLive()||this.isInProgress()?Math.min(this.getLiveEdge_(),this.duration_):this.duration_},goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getSegmentAvailabilityEnd",shaka.media.PresentationTimeline.prototype.getSegmentAvailabilityEnd),shaka.media.PresentationTimeline.prototype.getSafeSeekRangeStart=function(a){var b=Math.max(this.minSegmentStartTime_,this.userSeekStart_);if(1/0==this.segmentAvailabilityDuration_)return b;var c=this.getSegmentAvailabilityEnd()-this.segmentAvailabilityDuration_;return a=Math.min(c+a,this.getSeekRangeEnd()),Math.max(b,a)},goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getSafeSeekRangeStart",shaka.media.PresentationTimeline.prototype.getSafeSeekRangeStart),shaka.media.PresentationTimeline.prototype.getSeekRangeStart=function(){return this.getSafeSeekRangeStart(0)},goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getSeekRangeStart",shaka.media.PresentationTimeline.prototype.getSeekRangeStart),shaka.media.PresentationTimeline.prototype.getSeekRangeEnd=function(){var a=this.isLive()||this.isInProgress()?this.presentationDelay_:0;return Math.max(0,this.getSegmentAvailabilityEnd()-a)},goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getSeekRangeEnd",shaka.media.PresentationTimeline.prototype.getSeekRangeEnd),shaka.media.PresentationTimeline.prototype.usingPresentationStartTime=function(){return null!=this.presentationStartTime_&&null==this.maxSegmentEndTime_},goog.exportProperty(shaka.media.PresentationTimeline.prototype,"usingPresentationStartTime",shaka.media.PresentationTimeline.prototype.usingPresentationStartTime),shaka.media.PresentationTimeline.prototype.getLiveEdge_=function(){goog.asserts.assert(null!=this.presentationStartTime_,"Cannot compute timeline live edge without start time");var a=(Date.now()+this.clockOffset_)/1e3;return Math.max(0,a-this.maxSegmentDuration_-this.presentationStartTime_)},goog.DEBUG&&(shaka.media.PresentationTimeline.prototype.assertIsValid=function(){this.isLive()?goog.asserts.assert(null!=this.presentationStartTime_,"Detected as live stream, but does not match our model of live!"):this.isInProgress()?goog.asserts.assert(null!=this.presentationStartTime_&&1/0==this.segmentAvailabilityDuration_,"Detected as IPR stream, but does not match our model of IPR!"):goog.asserts.assert(1/0==this.segmentAvailabilityDuration_&&1/0!=this.duration_&&this.static_,"Detected as VOD stream, but does not match our model of VOD!")}),shaka.util.Networking=function(){},shaka.util.Networking.createSegmentRequest=function(a,b,c,d){return a=shaka.net.NetworkingEngine.makeRequest(a,d),0==b&&null==c||(a.headers.Range=c?"bytes="+b+"-"+c:"bytes="+b+"-"),a},shaka.dash.DashParser=function(){var a=this;this.playerInterface_=this.config_=null,this.manifestUris_=[],this.manifest_=null,this.periodIds_=[],this.globalId_=1,this.segmentIndexMap_={},this.updatePeriod_=0,this.averageUpdateDuration_=new shaka.abr.Ewma(5),this.updateTimer_=new shaka.util.Timer(function(){a.onUpdate_()}),this.operationManager_=new shaka.util.OperationManager},goog.exportSymbol("shaka.dash.DashParser",shaka.dash.DashParser),shaka.dash.DashParser.MIN_UPDATE_PERIOD_=3,shaka.dash.DashParser.prototype.configure=function(a){goog.asserts.assert(null!=a.dash,"DashManifestConfiguration should not be null!"),this.config_=a},shaka.dash.DashParser.prototype.start=function(a,b){var c=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function d(){var e;return $jscomp.generator.createGenerator(d,function(d){switch(d.nextAddress){case 1:return goog.asserts.assert(c.config_,"Must call configure() before start()!"),c.manifestUris_=[a],c.playerInterface_=b,d["yield"](c.requestManifest_(),2);case 2:if(e=d.yieldResult,c.playerInterface_&&c.setUpdateTimer_(e),!c.playerInterface_)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.OPERATION_ABORTED);return goog.asserts.assert(c.manifest_,"Manifest should be non-null!"),d["return"](c.manifest_)}})})},shaka.dash.DashParser.prototype.stop=function(){return this.config_=this.playerInterface_=null,this.manifestUris_=[],this.manifest_=null,this.periodIds_=[],this.segmentIndexMap_={},null!=this.updateTimer_&&(this.updateTimer_.stop(),this.updateTimer_=null),this.operationManager_.destroy()},shaka.dash.DashParser.prototype.update=function(){this.requestManifest_()["catch"](function(a){this.playerInterface_&&this.playerInterface_.onError(a)}.bind(this))},shaka.dash.DashParser.prototype.onExpirationUpdated=function(a,b){},shaka.dash.DashParser.prototype.requestManifest_=function(){var a=this,b=shaka.net.NetworkingEngine.RequestType.MANIFEST,c=shaka.net.NetworkingEngine.makeRequest(this.manifestUris_,this.config_.retryParameters),d=this.playerInterface_.networkingEngine,e=Date.now();return b=d.request(b,c),this.operationManager_.manage(b),b.promise.then(function(b){if(a.playerInterface_)return b.uri&&!a.manifestUris_.includes(b.uri)&&a.manifestUris_.unshift(b.uri),a.parseManifest_(b.data,b.uri)}).then(function(){var b=(Date.now()-e)/1e3;return a.averageUpdateDuration_.sample(1,b),b})},shaka.dash.DashParser.prototype.parseManifest_=function(a,b){var c=this,d=shaka.util.Error,e=shaka.dash.MpdUtils,f=shaka.util.XmlUtils.parseXml(a,"MPD");if(!f)throw new d(d.Severity.CRITICAL,d.Category.MANIFEST,d.Code.DASH_INVALID_XML,b);return d=e.processXlinks(f,this.config_.retryParameters,this.config_.dash.xlinkFailGracefully,b,this.playerInterface_.networkingEngine),this.operationManager_.manage(d),d.promise.then(function(a){return c.processManifest_(a,b)})},shaka.dash.DashParser.prototype.processManifest_=function(a,b){var c=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function d(){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B;return $jscomp.generator.createGenerator(d,function(d){switch(d.nextAddress){case 1:if(e=shaka.util.Functional,f=shaka.util.XmlUtils,g=[b],h=f.findChildren(a,"Location").map(f.getContents).filter(e.isNotNull),0<h.length&&(i=shaka.util.ManifestParserUtils.resolveUris(g,h),g=c.manifestUris_=i),j=f.findChildren(a,"BaseURL").map(f.getContents),k=shaka.util.ManifestParserUtils.resolveUris(g,j),l=c.config_.dash.ignoreMinBufferTime,m=0,l||(m=f.parseAttr(a,"minBufferTime",f.parseDuration)),c.updatePeriod_=f.parseAttr(a,"minimumUpdatePeriod",f.parseDuration,-1),n=f.parseAttr(a,"availabilityStartTime",f.parseDate),o=f.parseAttr(a,"timeShiftBufferDepth",f.parseDuration),p=f.parseAttr(a,"suggestedPresentationDelay",f.parseDuration),q=f.parseAttr(a,"maxSegmentDuration",f.parseDuration),r=a.getAttribute("type")||"static",c.manifest_?s=c.manifest_.presentationTimeline:(t=Math.max(c.config_.dash.defaultPresentationDelay,1.5*m),u=null!=p?p:t,s=new shaka.media.PresentationTimeline(n,u,c.config_.dash.autoCorrectDrift)),v={dynamic:"static"!=r,presentationTimeline:s,period:null,periodInfo:null,adaptationSet:null,representation:null,bandwidth:0,indexRangeWarningGiven:!1},w=c.parsePeriods_(v,k,a),x=w.duration,y=w.periods,s.setStatic("static"==r),"static"!=r&&w.durationDerivedFromPeriods||s.setDuration(x||1/0),(z=s.isLive())&&!isNaN(c.config_.availabilityWindowOverride)&&(o=c.config_.availabilityWindowOverride),null==o&&(o=1/0),s.setSegmentAvailabilityDuration(o),s.notifyMaxSegmentDuration(q||1),goog.DEBUG&&s.assertIsValid(),c.manifest_){d.jumpTo(0);break}if(c.manifest_={presentationTimeline:s,periods:y,offlineSessionIds:[],minBufferTime:m||0},!s.usingPresentationStartTime()){d.jumpTo(0);break}return A=f.findChildren(a,"UTCTiming"),d["yield"](c.parseUtcTiming_(k,A),4);case 4:if(B=d.yieldResult,!c.playerInterface_)return d["return"]();s.setClockOffset(B),d.jumpToEnd()}})})},shaka.dash.DashParser.prototype.parsePeriods_=function(a,b,c){var d=shaka.util.XmlUtils,e=d.parseAttr(c,"mediaPresentationDuration",d.parseDuration),f=[],g=0;c=d.findChildren(c,"Period");for(var h=0;h<c.length;h++){var i=c[h];g=d.parseAttr(i,"start",d.parseDuration,g);var j=d.parseAttr(i,"duration",d.parseDuration),k=null;if(h!=c.length-1){var l=d.parseAttr(c[h+1],"start",d.parseDuration);null!=l&&(k=l-g)}else null!=e&&(k=e-g);if(l=shaka.util.ManifestParserUtils.GAP_OVERLAP_TOLERANCE_SECONDS,k&&j&&Math.abs(k-j)>l&&shaka.log.warning("There is a gap/overlap between Periods",i),null==k&&(k=j),i=this.parsePeriod_(a,b,{start:g,duration:k,node:i,isLastPeriod:null==k||h==c.length-1}),f.push(i),j=a.period.id,goog.asserts.assert(j,"Period IDs should not be null!"),this.periodIds_.includes(j)||(this.periodIds_.push(j),this.manifest_&&(this.playerInterface_.filterNewPeriod(i),this.manifest_.periods.push(i))),null==k){h!=c.length-1&&shaka.log.warning("Skipping Period",h+1,"and any subsequent Periods:","Period",h+1,"does not have a valid start time.",f[h+1]),g=null;break}g+=k}return null==this.manifest_&&this.playerInterface_.filterAllPeriods(f),null!=e?(g!=e&&shaka.log.warning("@mediaPresentationDuration does not match the total duration of all","Periods."),{periods:f,duration:e,durationDerivedFromPeriods:!1}):{periods:f,duration:g,durationDerivedFromPeriods:!0}},shaka.dash.DashParser.prototype.parsePeriod_=function(a,b,c){var d=shaka.util.Functional,e=shaka.util.XmlUtils,f=shaka.util.ManifestParserUtils.ContentType;if(a.period=this.createFrame_(c.node,null,b),a.periodInfo=c,a.period.id||(shaka.log.info("No Period ID given for Period with start time "+c.start+",  Assigning a default"),a.period.id="__shaka_period_"+c.start),e.findChildren(c.node,"EventStream").forEach(this.parseEventStream_.bind(this,c.start,c.duration)),b=e.findChildren(c.node,"AdaptationSet").map(this.parseAdaptationSet_.bind(this,a)).filter(d.isNotNull),a.dynamic){for(a=[],d=$jscomp.makeIterator(b),e=d.next();!e.done;e=d.next()){e=$jscomp.makeIterator(e.value.representationIds);for(var g=e.next();!g.done;g=e.next())a.push(g.value)}if(d=new Set(a),a.length!=d.size)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_DUPLICATE_REPRESENTATION_ID)}var h=b.filter(function(a){return!a.trickModeFor});if(b.filter(function(a){return a.trickModeFor}).forEach(function(a){var b=a.streams[0],c=a.trickModeFor;h.forEach(function(a){a.id==c&&a.streams.forEach(function(a){a.trickModeVideo=b})})}),a=this.getSetsOfType_(h,f.VIDEO),d=this.getSetsOfType_(h,f.AUDIO),!a.length&&!d.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_EMPTY_PERIOD);for(d.length||(d=[null]),a.length||(a=[null]),b=[],e=0;e<d.length;e++)for(g=0;g<a.length;g++)this.createVariants_(d[e],a[g],b);for(f=this.getSetsOfType_(h,f.TEXT),a=[],d=0;d<f.length;d++)a.push.apply(a,f[d].streams);return{startTime:c.start,textStreams:a,variants:b}},shaka.dash.DashParser.prototype.getSetsOfType_=function(a,b){return a.filter(function(a){return a.contentType==b})},shaka.dash.DashParser.prototype.createVariants_=function(a,b,c){var d=shaka.util.ManifestParserUtils.ContentType;if(goog.asserts.assert(!a||a.contentType==d.AUDIO,"Audio parameter mismatch!"),goog.asserts.assert(!b||b.contentType==d.VIDEO,"Video parameter mismatch!"),a||b)if(a&&b){if(d=shaka.media.DrmEngine,d.areDrmCompatible(a.drmInfos,b.drmInfos))for(var e=d.getCommonDrmInfos(a.drmInfos,b.drmInfos),f=0;f<a.streams.length;f++)for(var g=0;g<b.streams.length;g++)d=(b.streams[g].bandwidth||0)+(a.streams[f].bandwidth||0),d={id:this.globalId_++,language:a.language,primary:a.main||b.main,audio:a.streams[f],video:b.streams[g],bandwidth:d,drmInfos:e,allowedByApplication:!0,allowedByKeySystem:!0},c.push(d)}else for(e=a||b,f=0;f<e.streams.length;f++)d=e.streams[f].bandwidth||0,d={id:this.globalId_++,language:e.language||"und",primary:e.main,audio:a?e.streams[f]:null,video:b?e.streams[f]:null,bandwidth:d,
drmInfos:e.drmInfos,allowedByApplication:!0,allowedByKeySystem:!0},c.push(d)},shaka.dash.DashParser.prototype.parseAdaptationSet_=function(a,b){var c=shaka.util.XmlUtils,d=shaka.util.Functional,e=shaka.util.ManifestParserUtils,f=e.ContentType;a.adaptationSet=this.createFrame_(b,a.period,null);var g=!1,h=c.findChildren(b,"Role"),i=h.map(function(a){return a.getAttribute("value")}).filter(d.isNotNull),j=void 0;(d=a.adaptationSet.contentType==e.ContentType.TEXT)&&(j=e.TextStreamKind.SUBTITLE);for(var k=0;k<h.length;k++){var l=h[k].getAttribute("schemeIdUri");if(null==l||"urn:mpeg:dash:role:2011"==l)switch(l=h[k].getAttribute("value")){case"main":g=!0;break;case"caption":case"subtitle":j=l}}var m=null,n=!1;c.findChildren(b,"EssentialProperty").forEach(function(a){"http://dashif.org/guidelines/trickmode"==a.getAttribute("schemeIdUri")?m=a.getAttribute("value"):n=!0}),k=c.findChildren(b,"Accessibility");var o=shaka.util.LanguageUtils,p=new Map;for(h={},k=$jscomp.makeIterator(k),l=k.next();!l.done;h={channelId:h.channelId},l=k.next()){var q=l.value;l=q.getAttribute("schemeIdUri"),q=q.getAttribute("value"),"urn:scte:dash:cc:cea-608:2015"==l||"urn:scte:dash:cc:cea-708:2015"==l?(h.channelId=1,null!=q?q.split(";").forEach(function(a){return function(b){if(b.includes("=")){b=b.split("=");var c=b[0].startsWith("CC")?b[0]:"CC"+b[0];b=b[1].split(",")[0].split(":").pop()}else c="CC"+a.channelId,a.channelId+=2;p.set(c,o.normalize(b))}}(h)):p.set("CC1","und")):"urn:mpeg:dash:role:2011"==l&&null!=q&&(i.push(q),"captions"==q&&(j=e.TextStreamKind.CLOSED_CAPTION))}if(n)return null;e=c.findChildren(b,"ContentProtection");var r=shaka.dash.ContentProtection.parseFromAdaptationSet(e,this.config_.dash.customScheme,this.config_.dash.ignoreDrmInfo);if(e=shaka.util.LanguageUtils.normalize(b.getAttribute("lang")||"und"),h=b.getAttribute("label"),c=c.findChildren(b,"Representation"),i=c.map(this.parseRepresentation_.bind(this,a,r,j,e,h,g,i,p)).filter(function(a){return!!a}),0==i.length){if(d)return null;throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_EMPTY_ADAPTATION_SET)}return a.adaptationSet.contentType&&a.adaptationSet.contentType!=f.APPLICATION||(a.adaptationSet.contentType=shaka.dash.DashParser.guessContentType_(i[0].mimeType,i[0].codecs),i.forEach(function(b){b.type=a.adaptationSet.contentType})),i.forEach(function(a){r.drmInfos.forEach(function(b){a.keyId&&b.keyIds.push(a.keyId)})}),f=c.map(function(a){return a.getAttribute("id")}).filter(shaka.util.Functional.isNotNull),{id:a.adaptationSet.id||"__fake__"+this.globalId_++,contentType:a.adaptationSet.contentType,language:e,main:g,streams:i,drmInfos:r.drmInfos,trickModeFor:m,representationIds:f}},shaka.dash.DashParser.prototype.parseRepresentation_=function(a,b,c,d,e,f,g,h,i){var j=shaka.util.XmlUtils,k=shaka.util.ManifestParserUtils.ContentType;if(a.representation=this.createFrame_(i,a.adaptationSet,null),!this.verifyRepresentation_(a.representation))return shaka.log.warning("Skipping Representation",a.representation),null;a.bandwidth=j.parseAttr(i,"bandwidth",j.parsePositiveInt)||0;var l=a.representation.contentType;k=l==k.TEXT||l==k.APPLICATION;try{var m=this.requestInitSegment_.bind(this);if(a.representation.segmentBase)var n=shaka.dash.SegmentBase.createStream(a,m);else if(a.representation.segmentList)n=shaka.dash.SegmentList.createStream(a,this.segmentIndexMap_);else if(a.representation.segmentTemplate)n=shaka.dash.SegmentTemplate.createStream(a,m,this.segmentIndexMap_,!!this.manifest_);else{goog.asserts.assert(k,"Must have Segment* with non-text streams.");var o=a.representation.baseUris,p=a.periodInfo.duration||0;n={createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(a){return 0<=a&&a<p?1:null},getSegmentReference:function(a){return 1!=a?null:new shaka.media.SegmentReference(1,0,p,function(){return o},0,null)},initSegmentReference:null,scaledPresentationTimeOffset:0}}}catch(q){if(k&&q.code==shaka.util.Error.Code.DASH_NO_SEGMENT_INFO)return null;throw q}return i=j.findChildren(i,"ContentProtection"),i=shaka.dash.ContentProtection.parseFromRepresentation(i,this.config_.dash.customScheme,b,this.config_.dash.ignoreDrmInfo),{id:this.globalId_++,originalId:a.representation.id,createSegmentIndex:n.createSegmentIndex,findSegmentPosition:n.findSegmentPosition,getSegmentReference:n.getSegmentReference,initSegmentReference:n.initSegmentReference,presentationTimeOffset:n.scaledPresentationTimeOffset,mimeType:a.representation.mimeType,codecs:a.representation.codecs,frameRate:a.representation.frameRate,bandwidth:a.bandwidth,width:a.representation.width,height:a.representation.height,kind:c,encrypted:0<b.drmInfos.length,keyId:i,language:d,label:e,type:a.adaptationSet.contentType,primary:f,trickModeVideo:null,emsgSchemeIdUris:a.representation.emsgSchemeIdUris,roles:g,channelsCount:a.representation.numChannels,closedCaptions:h}},shaka.dash.DashParser.prototype.onUpdate_=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function b(){var c,d;return $jscomp.generator.createGenerator(b,function(b){switch(b.nextAddress){case 1:return goog.asserts.assert(0<=a.updatePeriod_,"There should be an update period"),shaka.log.info("Updating manifest..."),c=0,b.setCatchFinallyBlocks(2),b["yield"](a.requestManifest_(),4);case 4:c=b.yieldResult,b.leaveTryBlock(3);break;case 2:d=b.enterCatchBlock(),goog.asserts.assert(d instanceof shaka.util.Error,"Should only receive a Shaka error"),a.playerInterface_&&(d.severity=shaka.util.Error.Severity.RECOVERABLE,a.playerInterface_.onError(d));case 3:if(!a.playerInterface_)return b["return"]();a.setUpdateTimer_(c),b.jumpToEnd()}})})},shaka.dash.DashParser.prototype.setUpdateTimer_=function(a){0>this.updatePeriod_||(a=Math.max(shaka.dash.DashParser.MIN_UPDATE_PERIOD_,this.updatePeriod_-a,this.averageUpdateDuration_.getEstimate()),this.updateTimer_.tickAfter(a))},shaka.dash.DashParser.prototype.createFrame_=function(a,b,c){goog.asserts.assert(b||c,"Must provide either parent or baseUris");var d=shaka.util.ManifestParserUtils,e=shaka.util.XmlUtils;b=b||{contentType:"",mimeType:"",codecs:"",emsgSchemeIdUris:[],frameRate:void 0,numChannels:null},c=c||b.baseUris;var f=e.parseNonNegativeInt,g=e.evalDivision,h=e.findChildren(a,"BaseURL").map(e.getContents),i=a.getAttribute("contentType")||b.contentType,j=a.getAttribute("mimeType")||b.mimeType,k=a.getAttribute("codecs")||b.codecs;g=e.parseAttr(a,"frameRate",g)||b.frameRate;var l=this.emsgSchemeIdUris_(e.findChildren(a,"InbandEventStream"),b.emsgSchemeIdUris),m=e.findChildren(a,"AudioChannelConfiguration");return m=this.parseAudioChannels_(m)||b.numChannels,i||(i=shaka.dash.DashParser.guessContentType_(j,k)),{baseUris:d.resolveUris(c,h),segmentBase:e.findChild(a,"SegmentBase")||b.segmentBase,segmentList:e.findChild(a,"SegmentList")||b.segmentList,segmentTemplate:e.findChild(a,"SegmentTemplate")||b.segmentTemplate,width:e.parseAttr(a,"width",f)||b.width,height:e.parseAttr(a,"height",f)||b.height,contentType:i,mimeType:j,codecs:k,frameRate:g,emsgSchemeIdUris:l,id:a.getAttribute("id"),numChannels:m}},shaka.dash.DashParser.prototype.emsgSchemeIdUris_=function(a,b){for(var c=b.slice(),d=$jscomp.makeIterator(a),e=d.next();!e.done;e=d.next())e=e.value.getAttribute("schemeIdUri"),c.includes(e)||c.push(e);return c},shaka.dash.DashParser.prototype.parseAudioChannels_=function(a){for(var b=0;b<a.length;++b){var c=a[b],d=c.getAttribute("schemeIdUri");if(d&&(c=c.getAttribute("value")))switch(d){case"urn:mpeg:dash:outputChannelPositionList:2012":return c.trim().split(/ +/).length;case"urn:mpeg:dash:23003:3:audio_channel_configuration:2011":case"urn:dts:dash:audio_channel_configuration:2012":var e=parseInt(c,10);if(!e){shaka.log.warning("Channel parsing failure! Ignoring scheme and value",d,c);continue}return e;case"tag:dolby.com,2014:dash:audio_channel_configuration:2011":case"urn:dolby:dash:audio_channel_configuration:2011":if(e=parseInt(c,16),!e){shaka.log.warning("Channel parsing failure! Ignoring scheme and value",d,c);continue}for(a=0;e;)1&e&&++a,e>>=1;return a;default:shaka.log.warning("Unrecognized audio channel scheme:",d,c)}}return null},shaka.dash.DashParser.prototype.verifyRepresentation_=function(a){var b=shaka.util.ManifestParserUtils.ContentType,c=a.segmentBase?1:0;return c+=a.segmentList?1:0,c+=a.segmentTemplate?1:0,0==c?a.contentType==b.TEXT||a.contentType==b.APPLICATION||(shaka.log.warning("Representation does not contain a segment information source:","the Representation must contain one of SegmentBase, SegmentList,",'SegmentTemplate, or explicitly indicate that it is "text".',a),!1):(1!=c&&(shaka.log.warning("Representation contains multiple segment information sources:","the Representation should only contain one of SegmentBase,","SegmentList, or SegmentTemplate.",a),a.segmentBase?(shaka.log.info("Using SegmentBase by default."),a.segmentList=null):(goog.asserts.assert(a.segmentList,"There should be a SegmentList"),shaka.log.info("Using SegmentList by default.")),a.segmentTemplate=null),!0)},shaka.dash.DashParser.prototype.requestForTiming_=function(a,b,c){return a=shaka.util.ManifestParserUtils.resolveUris(a,[b]),a=shaka.net.NetworkingEngine.makeRequest(a,this.config_.retryParameters),a.method=c,a=this.playerInterface_.networkingEngine.request(shaka.net.NetworkingEngine.RequestType.TIMING,a),this.operationManager_.manage(a),a.promise.then(function(a){if("HEAD"==c){if(!a.headers||!a.headers.date)return shaka.log.warning("UTC timing response is missing","expected date header"),0;a=a.headers.date}else a=shaka.util.StringUtils.fromUTF8(a.data);return a=Date.parse(a),isNaN(a)?(shaka.log.warning("Unable to parse date from UTC timing response"),0):a-Date.now()})},shaka.dash.DashParser.prototype.parseUtcTiming_=function(a,b){var c=b.map(function(a){return{scheme:a.getAttribute("schemeIdUri"),value:a.getAttribute("value")}}),d=this.config_.dash.clockSyncUri;return!c.length&&d&&c.push({scheme:"urn:mpeg:dash:utc:http-head:2014",value:d}),shaka.util.Functional.createFallbackPromiseChain(c,function(b){var c=b.scheme;switch(b=b.value,c){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":return this.requestForTiming_(a,b,"HEAD");case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":return this.requestForTiming_(a,b,"GET");case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":return c=Date.parse(b),isNaN(c)?0:c-Date.now();case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":return shaka.log.alwaysWarn("NTP UTCTiming scheme is not supported"),Promise.reject();default:return shaka.log.alwaysWarn("Unrecognized scheme in UTCTiming element",c),Promise.reject()}}.bind(this))["catch"](function(){return shaka.log.alwaysWarn("A UTCTiming element should always be given in live manifests! This content may not play on clients with bad clocks!"),0})},shaka.dash.DashParser.prototype.parseEventStream_=function(a,b,c){var d=shaka.util.XmlUtils,e=d.parseNonNegativeInt,f=c.getAttribute("schemeIdUri")||"",g=c.getAttribute("value")||"",h=d.parseAttr(c,"timescale",e)||1;d.findChildren(c,"Event").forEach(function(c){var i=d.parseAttr(c,"presentationTime",e)||0,j=d.parseAttr(c,"duration",e)||0;i=i/h+a,j=i+j/h,null!=b&&(i=Math.min(i,a+b),j=Math.min(j,a+b)),c={schemeIdUri:f,value:g,startTime:i,endTime:j,id:c.getAttribute("id")||"",eventElement:c},this.playerInterface_.onTimelineRegionAdded(c)}.bind(this))},shaka.dash.DashParser.prototype.requestInitSegment_=function(a,b,c){var d=shaka.net.NetworkingEngine.RequestType.SEGMENT;return a=shaka.util.Networking.createSegmentRequest(a,b,c,this.config_.retryParameters),d=this.playerInterface_.networkingEngine.request(d,a),this.operationManager_.manage(d),d.promise.then(function(a){return a.data})},shaka.dash.DashParser.guessContentType_=function(a,b){var c=shaka.util.MimeUtils.getFullType(a,b);return shaka.text.TextEngine.isTypeSupported(c)?shaka.util.ManifestParserUtils.ContentType.TEXT:a.split("/")[0]},shaka.media.ManifestParser.registerParserByExtension("mpd",shaka.dash.DashParser),shaka.media.ManifestParser.registerParserByMime("application/dash+xml",shaka.dash.DashParser),shaka.hls={},shaka.hls.Playlist=function(a,b,c,d){this.absoluteUri=a,this.type=b,this.tags=c,this.segments=d||null},shaka.hls.PlaylistType={MASTER:0,MEDIA:1},shaka.hls.Tag=function(a,b,c,d){this.id=a,this.name=b,this.attributes=c,this.value=void 0===d?null:d},shaka.hls.Tag.prototype.toString=function(){var a=function(a){var b=isNaN(Number(a.value))?'"'+a.value+'"':a.value;return a.name+"="+b},b="#"+this.name;return a=this.attributes?this.attributes.map(a):[],this.value&&a.unshift(this.value),0<a.length&&(b+=":"+a.join(",")),b},shaka.hls.Attribute=function(a,b){this.name=a,this.value=b},shaka.hls.Tag.prototype.addAttribute=function(a){this.attributes.push(a)},shaka.hls.Tag.prototype.getAttribute=function(a){var b=this.attributes.filter(function(b){return b.name==a});return goog.asserts.assert(2>b.length,"A tag should not have multiple attributes with the same name!"),b.length?b[0]:null},shaka.hls.Tag.prototype.getAttributeValue=function(a,b){var c=this.getAttribute(a);return c?c.value:b||null},shaka.hls.Segment=function(a,b){this.tags=b,this.absoluteUri=a},shaka.hls.Utils={},shaka.hls.Utils.filterTagsByName=function(a,b){return a.filter(function(a){return a.name==b})},shaka.hls.Utils.getFirstTagWithName=function(a,b){var c=shaka.hls.Utils.filterTagsByName(a,b);return c.length?c[0]:null},shaka.hls.Utils.findMediaTags=function(a,b,c){return a.filter(function(a){var d=a.getAttribute("TYPE");return a=a.getAttribute("GROUP-ID"),d.value==b&&a.value==c})},shaka.hls.Utils.constructAbsoluteUri=function(a,b){return shaka.util.ManifestParserUtils.resolveUris([a],[b])[0]},shaka.hls.Utils.isComment=function(a){return/^#(?!EXT)/m.test(a)},shaka.util.TextParser=function(a){this.data_=a,this.position_=0},shaka.util.TextParser.prototype.atEnd=function(){return this.position_==this.data_.length},shaka.util.TextParser.prototype.readLine=function(){return this.readRegexReturnCapture_(/(.*?)(\n|$)/gm,1)},shaka.util.TextParser.prototype.readWord=function(){return this.readRegexReturnCapture_(/[^ \t\n]*/gm,0)},shaka.util.TextParser.prototype.skipWhitespace=function(){this.readRegex(/[ \t]+/gm)},shaka.util.TextParser.prototype.readRegex=function(a){return a=this.indexOf_(a),this.atEnd()||null==a||a.position!=this.position_?null:(this.position_+=a.length,a.results)},shaka.util.TextParser.prototype.readRegexReturnCapture_=function(a,b){if(this.atEnd())return null;var c=this.readRegex(a);return c?c[b]:null},shaka.util.TextParser.prototype.indexOf_=function(a){return goog.asserts.assert(a.global,"global flag should be set"),a.lastIndex=this.position_,a=a.exec(this.data_),null==a?null:{position:a.index,length:a[0].length,results:a}},shaka.hls.ManifestTextParser=function(){this.globalId_=0},shaka.hls.ManifestTextParser.prototype.parsePlaylist=function(a,b){var c=shaka.hls.ManifestTextParser.MEDIA_PLAYLIST_TAGS,d=shaka.hls.ManifestTextParser.SEGMENT_TAGS,e=shaka.util.StringUtils.fromUTF8(a);e=e.replace(/\r\n|\r(?=[^\n]|$)/gm,"\n").trim();var f=e.split(/\n+/m);if(!/^#EXTM3U($|[ \t\n])/m.test(f[0]))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_PLAYLIST_HEADER_MISSING);e=shaka.hls.PlaylistType.MASTER;for(var g=1;g<f.length;g++)if(!shaka.hls.Utils.isComment(f[g])){var h=this.parseTag_(f[g]);if(--this.globalId_,c.includes(h.name)){e=shaka.hls.PlaylistType.MEDIA;break}"EXT-X-STREAM-INF"==h.name&&(g+=1)}for(c=[],g=1;g<f.length;)if(shaka.hls.Utils.isComment(f[g]))g+=1;else{if(h=this.parseTag_(f[g]),d.includes(h.name)){if(e!=shaka.hls.PlaylistType.MEDIA)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_INVALID_PLAYLIST_HIERARCHY);return d=f.splice(g,f.length-g),d=this.parseSegments_(b,d,c),new shaka.hls.Playlist(b,e,c,d)}if(c.push(h),g+=1,"EXT-X-STREAM-INF"==h.name){var i=new shaka.hls.Attribute("URI",f[g]);h.addAttribute(i),g+=1}}return new shaka.hls.Playlist(b,e,c)},shaka.hls.ManifestTextParser.prototype.parseSegments_=function(a,b,c){var d=this,e=[],f=[];return b.forEach(function(b){if(/^(#EXT)/.test(b))b=d.parseTag_(b),shaka.hls.ManifestTextParser.MEDIA_PLAYLIST_TAGS.includes(b.name)?c.push(b):f.push(b);else{if(shaka.hls.Utils.isComment(b))return[];b=b.trim(),b=shaka.hls.Utils.constructAbsoluteUri(a,b),b=new shaka.hls.Segment(b,f),e.push(b),f=[]}}),e},shaka.hls.ManifestTextParser.prototype.parseTag_=function(a){return shaka.hls.ManifestTextParser.parseTag(this.globalId_++,a)},shaka.hls.ManifestTextParser.parseTag=function(a,b){var c=b.match(/^#(EXT[^:]*)(?::(.*))?$/);if(!c)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.INVALID_HLS_TAG,b);var d=c[1],e=c[2];c=[];var f;if(e){e=new shaka.util.TextParser(e);var g,h=e.readRegex(/^([^,=]+)(?:,|$)/g);for(h&&(f=h[1]),h=/([^=]+)=(?:"([^"]*)"|([^",]*))(?:,|$)/g;g=e.readRegex(h);)g=new shaka.hls.Attribute(g[1],g[2]||g[3]),c.push(g)}return new shaka.hls.Tag(a,d,c,f)},shaka.hls.ManifestTextParser.MEDIA_PLAYLIST_TAGS="EXT-X-TARGETDURATION EXT-X-MEDIA-SEQUENCE EXT-X-DISCONTINUITY-SEQUENCE EXT-X-PLAYLIST-TYPE EXT-X-MAP EXT-X-I-FRAMES-ONLY EXT-X-ENDLIST".split(" "),shaka.hls.ManifestTextParser.SEGMENT_TAGS="EXTINF EXT-X-BYTERANGE EXT-X-DISCONTINUITY EXT-X-PROGRAM-DATE-TIME EXT-X-KEY EXT-X-DATERANGE".split(" "),shaka.net.DataUriPlugin=function(a,b,c,d){try{var e=shaka.net.DataUriPlugin.parse(a);return shaka.util.AbortableOperation.completed({uri:a,originalUri:a,data:e.data,headers:{"content-type":e.contentType}})}catch(f){return shaka.util.AbortableOperation.failed(f)}},goog.exportSymbol("shaka.net.DataUriPlugin",shaka.net.DataUriPlugin),shaka.net.DataUriPlugin.parse=function(a){var b=a.split(":");if(2>b.length||"data"!=b[0])throw shaka.log.error("Bad data URI, failed to parse scheme"),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.MALFORMED_DATA_URI,a);if(b=b.slice(1).join(":").split(","),2>b.length)throw shaka.log.error("Bad data URI, failed to extract encoding and MIME type"),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.MALFORMED_DATA_URI,a);var c=b[0];b=window.decodeURIComponent(b.slice(1).join(",")),c=c.split(";");var d=null;if(1<c.length&&(d=c[1]),"base64"==d)a=shaka.util.Uint8ArrayUtils.fromBase64(b).buffer;else{if(d)throw shaka.log.error("Bad data URI, unknown encoding"),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.UNKNOWN_DATA_URI_ENCODING,a);a=shaka.util.StringUtils.toUTF8(b)}return{data:a,contentType:c[0]}},shaka.net.NetworkingEngine.registerScheme("data",shaka.net.DataUriPlugin),shaka.hls.HlsParser=function(){var a=this;this.config_=this.playerInterface_=null,this.globalId_=1,this.mediaTagsToStreamInfosMap_=new Map,this.variantUriSet_=new Set,this.uriToStreamInfosMap_=new Map,this.presentationTimeline_=null,this.masterPlaylistUri_="",this.manifestTextParser_=new shaka.hls.ManifestTextParser,this.updatePlaylistDelay_=0,this.updatePlaylistTimer_=new shaka.util.Timer(function(){a.onUpdate_()}),this.presentationType_=shaka.hls.HlsParser.PresentationType_.VOD,this.manifest_=null,this.maxTargetDuration_=0,this.minTargetDuration_=1/0,this.operationManager_=new shaka.util.OperationManager,this.segmentsToNotifyByStream_=[],this.groupIdToClosedCaptionsMap_=new Map,this.aesEncrypted_=!1},goog.exportSymbol("shaka.hls.HlsParser",shaka.hls.HlsParser),shaka.hls.HlsParser.prototype.configure=function(a){this.config_=a},shaka.hls.HlsParser.prototype.start=function(a,b){var c=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function d(){var e,f;return $jscomp.generator.createGenerator(d,function(d){switch(d.nextAddress){case 1:return goog.asserts.assert(c.config_,"Must call configure() before start()!"),c.playerInterface_=b,d["yield"](c.requestManifest_(a),2);case 2:return e=d.yieldResult,c.masterPlaylistUri_=e.uri,goog.asserts.assert(e.data,"Response data should be non-null!"),d["yield"](c.parseManifest_(e.data),3);case 3:return f=c.updatePlaylistDelay_,0<f&&c.updatePlaylistTimer_.tickAfter(f),goog.asserts.assert(c.manifest_,"Manifest should be non-null"),d["return"](c.manifest_)}})})},shaka.hls.HlsParser.prototype.stop=function(){this.updatePlaylistTimer_&&(this.updatePlaylistTimer_.stop(),this.updatePlaylistTimer_=null);var a=[];return this.operationManager_&&(a.push(this.operationManager_.destroy()),this.operationManager_=null),this.config_=this.playerInterface_=null,this.mediaTagsToStreamInfosMap_.clear(),this.variantUriSet_.clear(),this.uriToStreamInfosMap_.clear(),this.manifest_=null,Promise.all(a)},shaka.hls.HlsParser.prototype.update=function(){if(this.isLive_()){for(var a=[],b=$jscomp.makeIterator(this.uriToStreamInfosMap_.values()),c=b.next();!c.done;c=b.next())a.push(this.updateStream_(c.value));return Promise.all(a)}},shaka.hls.HlsParser.prototype.updateStream_=function(a){var b=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function c(){var d,e,f,g,h,i,j,k,l,m,n;return $jscomp.generator.createGenerator(c,function(c){switch(c.nextAddress){case 1:return d=shaka.hls.Utils,e=shaka.hls.HlsParser.PresentationType_,f=a.absoluteMediaPlaylistUri,c["yield"](b.requestManifest_(f),2);case 2:if(g=c.yieldResult,h=b.manifestTextParser_.parsePlaylist(g.data,g.uri),h.type!=shaka.hls.PlaylistType.MEDIA)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_INVALID_PLAYLIST_HIERARCHY);return j=(i=d.getFirstTagWithName(h.tags,"EXT-X-MEDIA-SEQUENCE"))?Number(i.value):0,k=a.stream,c["yield"](b.createSegments_(a.verbatimMediaPlaylistUri,h,j,k.mimeType,k.codecs),3);case 3:l=c.yieldResult,a.segmentIndex.replace(l),m=l[l.length-1],goog.asserts.assert(m,"Should have segments!"),(n=d.getFirstTagWithName(h.tags,"EXT-X-ENDLIST"))&&(b.setPresentationType_(e.VOD),b.presentationTimeline_.setDuration(m.endTime)),c.jumpToEnd()}})})},shaka.hls.HlsParser.prototype.onExpirationUpdated=function(a,b){},shaka.hls.HlsParser.prototype.parseManifest_=function(a){var b=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function c(){var d,e,f,g,h,i,j,k,l,m,n,o,p;return $jscomp.generator.createGenerator(c,function(c){switch(c.nextAddress){case 1:if(goog.asserts.assert(b.masterPlaylistUri_,"Master playlist URI must be set before calling parseManifest_!"),d=b.manifestTextParser_.parsePlaylist(a,b.masterPlaylistUri_),d.type!=shaka.hls.PlaylistType.MASTER)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_MASTER_PLAYLIST_NOT_PROVIDED);return c["yield"](b.createPeriod_(d),2);case 2:if(e=c.yieldResult,!b.playerInterface_)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.OPERATION_ABORTED);if(b.aesEncrypted_&&0==e.variants.length)throw shaka.log.info("No stream is created, because we don't support AES-128","encryption yet"),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_AES_128_ENCRYPTION_NOT_SUPPORTED);b.playerInterface_.filterAllPeriods([e]),f=1/0,h=g=0,i=1/0;for(var q=$jscomp.makeIterator(b.uriToStreamInfosMap_.values()),r=q.next();!r.done;r=q.next())j=r.value,f=Math.min(f,j.minTimestamp),g=Math.max(g,j.minTimestamp),h=Math.max(h,j.maxTimestamp),"text"!=j.stream.type&&(i=Math.min(i,j.duration));if(goog.asserts.assert(null==b.presentationTimeline_,"Presentation timeline created early!"),b.createPresentationTimeline_(h),goog.asserts.assert(b.presentationTimeline_,"Presentation timeline not created!"),b.isLive_()){for(b.updatePlaylistDelay_=b.minTargetDuration_,k=shaka.hls.HlsParser.PresentationType_,b.presentationType_==k.LIVE&&(l=b.presentationTimeline_.getDelay(),isNaN(b.config_.availabilityWindowOverride)||(l=b.config_.availabilityWindowOverride),b.presentationTimeline_.setSegmentAvailabilityDuration(l)),m=shaka.hls.HlsParser.TS_ROLLOVER_/shaka.hls.HlsParser.TS_TIMESCALE_,n=0;g>=m;)n+=m,g-=m;if(n)for(shaka.log.debug("Offsetting live streams by",n,"to compensate for rollover"),q=$jscomp.makeIterator(b.uriToStreamInfosMap_.values()),r=q.next();!r.done;r=q.next())o=r.value,o.minTimestamp<m?(shaka.log.v1("Offset applied to",o.stream.type),o.stream.presentationTimeOffset=-n,o.segmentIndex.offset(n)):shaka.log.v1("Offset NOT applied to",o.stream.type)}else for(b.presentationTimeline_.setDuration(i),b.presentationTimeline_.offset(-f),q=$jscomp.makeIterator(b.uriToStreamInfosMap_.values()),r=q.next();!r.done;r=q.next())p=r.value,p.stream.presentationTimeOffset=f,p.segmentIndex.offset(-f),p.segmentIndex.fit(i);b.manifest_={presentationTimeline:b.presentationTimeline_,periods:[e],offlineSessionIds:[],minBufferTime:0},c.jumpToEnd()}})})},shaka.hls.HlsParser.prototype.createPeriod_=function(a){var b=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function c(){var d,e,f,g,h,i,j,k,l,m,n,o;return $jscomp.generator.createGenerator(c,function(c){switch(c.nextAddress){case 1:return d=shaka.hls.Utils,e=shaka.util.Functional,f=a.tags,g=d.filterTagsByName(a.tags,"EXT-X-MEDIA"),h=g.filter(function(a){return"SUBTITLES"==shaka.hls.HlsParser.getRequiredAttributeValue_(a,"TYPE")}.bind(b)),i=h.map(function(b){var c=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function d(){var e;return $jscomp.generator.createGenerator(d,function(d){switch(d.nextAddress){case 1:return d.setCatchFinallyBlocks(2),d["yield"](c.createTextStream_(b,a),4);case 4:return d["return"](d.yieldResult);case 2:if(e=d.enterCatchBlock(),c.config_.hls.ignoreTextStreamFailures)return d["return"](null);throw e}})})}.bind(b)),j=g.filter(function(a){return"CLOSED-CAPTIONS"==shaka.hls.HlsParser.getRequiredAttributeValue_(a,"TYPE")}),b.parseClosedCaptions_(j),c["yield"](Promise.all(i),2);case 2:return k=c.yieldResult,l=d.filterTagsByName(f,"EXT-X-STREAM-INF"),m=l.map(function(b){return this.createVariantsForTag_(b,a)}.bind(b)),c["yield"](Promise.all(m),3);case 3:return n=c.yieldResult,o=n.reduce(e.collapseArrays,[]),o=o.filter(function(a){return null!=a}),c["return"]({startTime:0,variants:o,textStreams:k.filter(function(a){return null!=a})})}})})},shaka.hls.HlsParser.prototype.createVariantsForTag_=function(a,b){var c=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function d(){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E;return $jscomp.generator.createGenerator(d,function(d){switch(d.nextAddress){case 1:return goog.asserts.assert("EXT-X-STREAM-INF"==a.name,"Should only be called on variant tags!"),e=shaka.util.ManifestParserUtils.ContentType,f=shaka.hls.Utils,g=a.getAttributeValue("CODECS","avc1.42E01E,mp4a.40.2"),h=shaka.hls.HlsParser.filterDuplicateCodecs_(g.split(/\s*,\s*/)),i=a.getAttribute("RESOLUTION"),k=j=null,l=a.getAttributeValue("FRAME-RATE"),m=Number(shaka.hls.HlsParser.getRequiredAttributeValue_(a,"BANDWIDTH")),i&&(n=i.value.split("x"),j=n[0],k=n[1]),o=f.filterTagsByName(b.tags,"EXT-X-MEDIA"),o=o.filter(function(a){return"CLOSED-CAPTIONS"!=shaka.hls.HlsParser.getRequiredAttributeValue_(a,"TYPE")}),o=o.filter(function(a){var b=a.getAttributeValue("URI")||"";return"SUBTITLES"==(a.getAttributeValue("TYPE")||"")||""!=b}),p=a.getAttributeValue("AUDIO"),q=a.getAttributeValue("VIDEO"),goog.asserts.assert(null==p||null==q,"Unexpected: both video and audio described by media tags!"),p?o=f.findMediaTags(o,"AUDIO",p):q&&(o=f.findMediaTags(o,"VIDEO",q)),(r=c.guessCodecsSafe_(e.TEXT,h))&&((s=a.getAttributeValue("SUBTITLES"))&&(t=f.findMediaTags(o,"SUBTITLES",s),goog.asserts.assert(1==t.length,"Exactly one text tag expected!"),t.length&&(u=c.mediaTagsToStreamInfosMap_.get(t[0].id))&&(u.stream.codecs=r)),shaka.util.ArrayUtils.remove(h,r)),v=o.map(function(a){return this.createStreamInfoFromMediaTag_(a,h)}.bind(c)),w=[],x=[],d["yield"](Promise.all(v),2);case 2:if(z=d.yieldResult,z=z.filter(function(a){return null!=a}),p?w=z:q&&(x=z),shaka.log.debug("Guessing stream type for",a.toString()),B=!1,w.length||x.length?w.length?(D=shaka.hls.HlsParser.getRequiredAttributeValue_(a,"URI"),E=w[0].verbatimMediaPlaylistUri,D==E?(shaka.log.debug("Guessing audio-only."),A=e.AUDIO,B=!0):(shaka.log.debug("Guessing video."),A=e.VIDEO)):(goog.asserts.assert(x.length,"No video streams!  This should have been handled already!"),shaka.log.debug("Guessing audio."),A=e.AUDIO):1==h.length?(C=c.guessCodecsSafe_(e.VIDEO,h),i||l||C?(shaka.log.debug("Guessing video-only."),A=e.VIDEO):(shaka.log.debug("Guessing audio-only."),A=e.AUDIO)):(shaka.log.debug("Guessing multiplexed audio+video."),A=e.VIDEO,h=[h.join(",")]),goog.asserts.assert(A,"Type should have been set by now!"),B){d.jumpTo(3);break}return d["yield"](c.createStreamInfoFromVariantTag_(a,h,A),4);case 4:y=d.yieldResult;case 3:if(y)y.stream.type==e.AUDIO?w=[y]:x=[y];else if(null===y)return shaka.log.debug("streamInfo is null"),d["return"]([]);return goog.asserts.assert(x.length||w.length,"We should have created a stream!"),x&&c.filterLegacyCodecs_(x),w&&c.filterLegacyCodecs_(w),d["return"](c.createVariants_(w,x,m,j,k,l))}})})},shaka.hls.HlsParser.prototype.filterLegacyCodecs_=function(a){a.forEach(function(a){var b=a.stream.codecs.split(",");b=b.filter(function(a){return"mp4a.40.34"!=a}),a.stream.codecs=b.join(",")})},shaka.hls.HlsParser.prototype.createVariants_=function(a,b,c,d,e,f){var g=shaka.media.DrmEngine;b.forEach(function(a){this.addVideoAttributes_(a.stream,d,e,f)}.bind(this)),a.length||(a=[null]),b.length||(b=[null]);var h=[];a=$jscomp.makeIterator(a);for(var i=a.next();!i.done;i=a.next()){i=i.value;for(var j=$jscomp.makeIterator(b),k=j.next();!k.done;k=j.next()){var l=k.value;k=i?i.stream:null;var m=l?l.stream:null,n=i?i.drmInfos:null,o=l?l.drmInfos:null;l=(l?l.verbatimMediaPlaylistUri:"")+" - "+(i?i.verbatimMediaPlaylistUri:"");var p=void 0;if(k&&m){if(!g.areDrmCompatible(n,o)){shaka.log.warning("Incompatible DRM info in HLS variant.  Skipping.");continue}p=g.getCommonDrmInfos(n,o)}else k?p=n:m&&(p=o);this.variantUriSet_.has(l)?shaka.log.debug("Skipping variant which only differs in text streams."):(k=this.createVariant_(k,m,c,p),h.push(k),this.variantUriSet_.add(l))}}return h},shaka.hls.HlsParser.prototype.createVariant_=function(a,b,c,d){var e=shaka.util.ManifestParserUtils.ContentType;return goog.asserts.assert(!a||a.type==e.AUDIO,"Audio parameter mismatch!"),goog.asserts.assert(!b||b.type==e.VIDEO,"Video parameter mismatch!"),{id:this.globalId_++,language:a?a.language:"und",primary:!!a&&a.primary||!!b&&b.primary,audio:a,video:b,bandwidth:c,drmInfos:d,allowedByApplication:!0,allowedByKeySystem:!0}},shaka.hls.HlsParser.prototype.createTextStream_=function(a,b){var c=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function d(){var b,e;return $jscomp.generator.createGenerator(d,function(d){switch(d.nextAddress){case 1:return goog.asserts.assert("EXT-X-MEDIA"==a.name,"Should only be called on media tags!"),b=shaka.hls.HlsParser.getRequiredAttributeValue_(a,"TYPE"),goog.asserts.assert("SUBTITLES"==b,'Should only be called on tags with TYPE="SUBTITLES"!'),d["yield"](c.createStreamInfoFromMediaTag_(a,[]),2);case 2:return e=d.yieldResult,goog.asserts.assert(e,"Should always have a streamInfo for text"),d["return"](e.stream)}})})},shaka.hls.HlsParser.prototype.parseClosedCaptions_=function(a){a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next()){b=b.value,goog.asserts.assert("EXT-X-MEDIA"==b.name,"Should only be called on media tags!");var c=shaka.hls.HlsParser.getRequiredAttributeValue_(b,"TYPE");goog.asserts.assert("CLOSED-CAPTIONS"==c,'Should only be called on tags with TYPE="CLOSED-CAPTIONS"!'),c=shaka.util.LanguageUtils;
var d=b.getAttributeValue("LANGUAGE")||"und";c=c.normalize(d),d=shaka.hls.HlsParser.getRequiredAttributeValue_(b,"GROUP-ID"),b=shaka.hls.HlsParser.getRequiredAttributeValue_(b,"INSTREAM-ID"),this.groupIdToClosedCaptionsMap_.get(d)||this.groupIdToClosedCaptionsMap_.set(d,new Map),this.groupIdToClosedCaptionsMap_.get(d).set(b,c)}},shaka.hls.HlsParser.prototype.createStreamInfoFromMediaTag_=function(a,b){var c=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function d(){var e,f,g,h,i,j,k,l,m,n,o,p,q;return $jscomp.generator.createGenerator(d,function(d){switch(d.nextAddress){case 1:return goog.asserts.assert("EXT-X-MEDIA"==a.name,"Should only be called on media tags!"),e=shaka.hls.HlsParser,f=e.getRequiredAttributeValue_(a,"URI"),c.uriToStreamInfosMap_.has(f)?d["return"](c.uriToStreamInfosMap_.get(f)):(g=e.getRequiredAttributeValue_(a,"TYPE").toLowerCase(),h=shaka.util.ManifestParserUtils.ContentType,"subtitles"==g&&(g=h.TEXT),i=shaka.util.LanguageUtils,j=i.normalize(a.getAttributeValue("LANGUAGE","und")),k=a.getAttributeValue("NAME"),l=a.getAttribute("DEFAULT"),m=a.getAttribute("AUTOSELECT"),n=a.getAttributeValue("CHANNELS"),o="audio"==g?c.getChannelCount_(n):null,p=!!l||!!m,d["yield"](c.createStreamInfo_(f,b,g,j,p,k,o,null),2));case 2:return q=d.yieldResult,null==q?d["return"](null):c.uriToStreamInfosMap_.has(f)?d["return"](c.uriToStreamInfosMap_.get(f)):(c.mediaTagsToStreamInfosMap_.set(a.id,q),c.uriToStreamInfosMap_.set(f,q),d["return"](q))}})})},shaka.hls.HlsParser.prototype.getChannelCount_=function(a){return a?(a=a.split("/")[0],parseInt(a,10)):null},shaka.hls.HlsParser.prototype.createStreamInfoFromVariantTag_=function(a,b,c){var d=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function e(){var f,g,h,i,j,k;return $jscomp.generator.createGenerator(e,function(e){switch(e.nextAddress){case 1:return goog.asserts.assert("EXT-X-STREAM-INF"==a.name,"Should only be called on media tags!"),f=shaka.util.ManifestParserUtils.ContentType,g=shaka.hls.HlsParser,h=g.getRequiredAttributeValue_(a,"URI"),d.uriToStreamInfosMap_.has(h)?e["return"](d.uriToStreamInfosMap_.get(h)):(i=a.getAttributeValue("CLOSED-CAPTIONS"),j=null,c==f.VIDEO&&i&&"NONE"!=i&&(j=d.groupIdToClosedCaptionsMap_.get(i)),e["yield"](d.createStreamInfo_(h,b,c,"und",!1,null,null,j),2));case 2:return k=e.yieldResult,null==k?e["return"](null):d.uriToStreamInfosMap_.has(h)?e["return"](d.uriToStreamInfosMap_.get(h)):(d.uriToStreamInfosMap_.set(h,k),e["return"](k))}})})},shaka.hls.HlsParser.prototype.createStreamInfo_=function(a,b,c,d,e,f,g,h){var i=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function j(){var k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J;return $jscomp.generator.createGenerator(j,function(j){switch(j.nextAddress){case 1:return k=shaka.hls.Utils,l=k.constructAbsoluteUri(i.masterPlaylistUri_,a),n="",j["yield"](i.requestManifest_(l),2);case 2:if(p=j.yieldResult,l=p.uri,m=i.manifestTextParser_.parsePlaylist(p.data,l),m.type!=shaka.hls.PlaylistType.MEDIA)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_INVALID_PLAYLIST_HIERARCHY);q=[],m.segments.forEach(function(a){a=k.filterTagsByName(a.tags,"EXT-X-KEY"),q.push.apply(q,a)}),r=!1,s=[],t=null;for(var K=$jscomp.makeIterator(q),L=K.next();!L.done;L=K.next())if(u=L.value,v=shaka.hls.HlsParser.getRequiredAttributeValue_(u,"METHOD"),"NONE"!=v){if(r=!0,"AES-128"==v)return shaka.log.warning("Unsupported HLS Encryption",v),i.aesEncrypted_=!0,j["return"](null);w=shaka.hls.HlsParser.getRequiredAttributeValue_(u,"KEYFORMAT"),(y=(x=shaka.hls.HlsParser.KEYFORMATS_TO_DRM_PARSERS_[w])?x(u):null)?(y.keyIds.length&&(t=y.keyIds[0]),s.push(y)):shaka.log.warning("Unsupported HLS KEYFORMAT",w)}if(r&&!s.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_KEYFORMATS_NOT_SUPPORTED);return goog.asserts.assert(null!=m.segments,"Media playlist should have segments!"),i.determinePresentationType_(m),n=i.guessCodecs_(c,b),j["yield"](i.guessMimeType_(c,n,m),3);case 3:return o=z=j.yieldResult,B=(A=k.getFirstTagWithName(m.tags,"EXT-X-MEDIA-SEQUENCE"))?Number(A.value):0,j["yield"](i.createSegments_(a,m,B,o,n),4);case 4:return C=j.yieldResult,D=C[0].startTime,E=C[C.length-1].endTime,F=E-D,G=new shaka.media.SegmentIndex(C),H=i.createInitSegmentReference_(m),I=void 0,c==shaka.util.ManifestParserUtils.ContentType.TEXT&&(I=shaka.util.ManifestParserUtils.TextStreamKind.SUBTITLE),J={id:i.globalId_++,originalId:f,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:G.find.bind(G),getSegmentReference:G.get.bind(G),initSegmentReference:H,presentationTimeOffset:0,mimeType:o,codecs:n,kind:I,encrypted:r,keyId:t,language:d,label:f,type:c,primary:e,trickModeVideo:null,emsgSchemeIdUris:null,frameRate:void 0,width:void 0,height:void 0,bandwidth:void 0,roles:[],channelsCount:g,closedCaptions:h},j["return"]({stream:J,segmentIndex:G,drmInfos:s,verbatimMediaPlaylistUri:a,absoluteMediaPlaylistUri:l,minTimestamp:D,maxTimestamp:E,duration:F})}})})},shaka.hls.HlsParser.prototype.determinePresentationType_=function(a){var b=shaka.hls.Utils,c=shaka.hls.HlsParser.PresentationType_,d=b.getFirstTagWithName(a.tags,"EXT-X-PLAYLIST-TYPE");b=b.getFirstTagWithName(a.tags,"EXT-X-ENDLIST"),b=d&&"VOD"==d.value||b,d=d&&"EVENT"==d.value&&!b,d=!b&&!d,b?this.setPresentationType_(c.VOD):(d?this.setPresentationType_(c.LIVE):this.setPresentationType_(c.EVENT),a=this.getRequiredTag_(a.tags,"EXT-X-TARGETDURATION"),a=Number(a.value),this.maxTargetDuration_=Math.max(a,this.maxTargetDuration_),this.minTargetDuration_=Math.min(a,this.minTargetDuration_))},shaka.hls.HlsParser.prototype.createPresentationTimeline_=function(a){this.isLive_()?(this.presentationTimeline_=new shaka.media.PresentationTimeline(0,3*this.maxTargetDuration_),this.presentationTimeline_.setStatic(!1)):(this.presentationTimeline_=new shaka.media.PresentationTimeline(null,0),this.presentationTimeline_.setStatic(!0)),this.notifySegments_(),goog.asserts.assert(!this.presentationTimeline_.usingPresentationStartTime(),"We should not be using the presentation start time in HLS!")},shaka.hls.HlsParser.prototype.createInitSegmentReference_=function(a){var b=shaka.hls.Utils,c=b.filterTagsByName(a.tags,"EXT-X-MAP");if(!c.length)return null;if(1<c.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_MULTIPLE_MEDIA_INIT_SECTIONS_FOUND);c=c[0];var d=shaka.hls.HlsParser.getRequiredAttributeValue_(c,"URI"),e=b.constructAbsoluteUri(a.absoluteUri,d);return a=0,b=null,(c=c.getAttributeValue("BYTERANGE"))&&(a=c.split("@"),c=Number(a[0]),a=Number(a[1]),b=a+c-1),new shaka.media.InitSegmentReference(function(){return[e]},a,b)},shaka.hls.HlsParser.prototype.createSegmentReference_=function(a,b,c,d,e){a=shaka.hls.Utils;var f=c.tags,g=c.absoluteUri;c=this.getRequiredTag_(f,"EXTINF").value.split(","),c=e+Number(c[0]);var h=0,i=null;return(a=a.getFirstTagWithName(f,"EXT-X-BYTERANGE"))&&(f=a.value.split("@"),a=Number(f[0]),f[1]?h=Number(f[1]):(goog.asserts.assert(b,"Cannot refer back to previous HLS segment!"),h=b.endByte+1),i=h+a-1),new shaka.media.SegmentReference(d,e,c,function(){return[g]},h,i)},shaka.hls.HlsParser.prototype.notifySegments_=function(){var a=this;this.presentationTimeline_&&(this.segmentsToNotifyByStream_.forEach(function(b){a.presentationTimeline_.notifySegments(b,0)}),this.segmentsToNotifyByStream_=[])},shaka.hls.HlsParser.prototype.createSegments_=function(a,b,c,d,e){var f=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function g(){var h,i,j,k,l,m,n,o,p,q,r;return $jscomp.generator.createGenerator(g,function(g){switch(g.nextAddress){case 1:return h=b.segments,i=[],goog.asserts.assert(h.length,"Playlist should have segments!"),j=h[0].absoluteUri,k=f.createSegmentReference_(b,null,h[0],c,0),l=f.createInitSegmentReference_(b),g["yield"](f.getStartTime_(a,l,k,d,e),2);case 2:m=g.yieldResult,shaka.log.debug("First segment",j.split("/").pop(),"starts at",m);for(var s=0;s<h.length;++s)n=h[s],o=i[i.length-1],p=0==s?m:o.endTime,q=c+s,r=f.createSegmentReference_(b,o,n,q,p),i.push(r);return f.segmentsToNotifyByStream_.push(i),f.notifySegments_(),g["return"](i)}})})},shaka.hls.HlsParser.prototype.fetchPartialSegment_=function(a){var b=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function c(){var d,e,f,g,h,i;return $jscomp.generator.createGenerator(c,function(c){switch(c.nextAddress){case 1:return d=shaka.net.NetworkingEngine.RequestType,e=shaka.util.Networking.createSegmentRequest(a.getUris(),a.startByte,a.startByte+shaka.hls.HlsParser.PARTIAL_SEGMENT_SIZE_-1,b.config_.retryParameters),f=shaka.util.Networking.createSegmentRequest(a.getUris(),a.startByte,a.endByte,b.config_.retryParameters),c.setCatchFinallyBlocks(2),c["yield"](b.makeNetworkRequest_(e,d.SEGMENT),4);case 4:return g=c.yieldResult,c["return"](g);case 2:if(h=c.enterCatchBlock(),h.code==shaka.util.Error.Code.OPERATION_ABORTED)throw h;return shaka.log.alwaysWarn("Unable to fetch a partial HLS segment! Falling back to a full segment request, which is expensive!  Your server should support Range requests and CORS preflights.",e.uris[0]),c["yield"](b.makeNetworkRequest_(f,d.SEGMENT),5);case 5:return i=c.yieldResult,c["return"](i)}})})},shaka.hls.HlsParser.prototype.getStartTime_=function(a,b,c,d,e){var f=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function g(){var h,i,j,k,l,m,n,o,p;return $jscomp.generator.createGenerator(g,function(g){switch(g.nextAddress){case 1:if(f.manifest_){if(h=f.uriToStreamInfosMap_.get(a),i=h.segmentIndex,j=i.get(c.position))return shaka.log.v1("Found segment start time in previous manifest"),g["return"](j.startTime);shaka.log.debug("Unable to find segment start time in previous manifest!")}if(shaka.log.v1("Fetching segment to find start time"),"audio/mpeg"==d)return g["return"](0);if("video/mp4"!=d&&"audio/mp4"!=d){g.jumpTo(2);break}return k=[f.fetchPartialSegment_(c)],b&&k.push(f.fetchPartialSegment_(b)),g["yield"](Promise.all(k),3);case 3:return l=g.yieldResult,m=l[0],n=l[1]||l[0],g["return"](f.getStartTimeFromMp4Segment_(m.data,n.data));case 2:if("video/mp2t"!=d){g.jumpTo(4);break}return g["yield"](f.fetchPartialSegment_(c),5);case 5:return o=g.yieldResult,goog.asserts.assert(o.data,"Should have a response body!"),g["return"](f.getStartTimeFromTsSegment_(o.data));case 4:if("application/mp4"!=d&&!d.startsWith("text/")){g.jumpTo(6);break}return g["yield"](f.fetchPartialSegment_(c),7);case 7:return p=g.yieldResult,goog.asserts.assert(p.data,"Should have a response body!"),g["return"](f.getStartTimeFromTextSegment_(d,e,p.data));case 6:if("video/webm"==d)return shaka.log.warning("Hls+WebM combination is not supported at the moment. Skipping."),g["return"](null);throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_COULD_NOT_PARSE_SEGMENT_START_TIME)}})})},shaka.hls.HlsParser.prototype.getStartTimeFromMp4Segment_=function(a,b){var c=shaka.util.Mp4Parser,d=0;if((new c).box("moov",c.children).box("trak",c.children).box("mdia",c.children).fullBox("mdhd",function(a){goog.asserts.assert(0==a.version||1==a.version,"MDHD version can only be 0 or 1"),a.reader.skip(0==a.version?8:16),d=a.reader.readUint32(),a.parser.stop()}).parse(b,!0),!d)throw shaka.log.error("Unable to find timescale in init segment!"),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_COULD_NOT_PARSE_SEGMENT_START_TIME);var e=0,f=!1;if((new c).box("moof",c.children).box("traf",c.children).fullBox("tfdt",function(a){goog.asserts.assert(0==a.version||1==a.version,"TFDT version can only be 0 or 1"),e=(0==a.version?a.reader.readUint32():a.reader.readUint64())/d,f=!0,a.parser.stop()}).parse(a,!0),!f)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_COULD_NOT_PARSE_SEGMENT_START_TIME);return e},shaka.hls.HlsParser.prototype.getStartTimeFromTsSegment_=function(a){a=new shaka.util.DataViewReader(new DataView(a),shaka.util.DataViewReader.Endianness.BIG_ENDIAN);for(var b=function(){throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_COULD_NOT_PARSE_SEGMENT_START_TIME)},c=0,d=0;;){if(c=a.getPosition(),d=a.readUint8(),71!=d&&b(),16384&a.readUint16()||b(),d=(48&a.readUint8())>>4,0!=d&&2!=d||b(),3==d&&(d=a.readUint8(),a.skip(d)),1==a.readUint32()>>8)return a.skip(3),c=a.readUint8()>>6,0!=c&&1!=c||b(),d=a.readUint8(),0==d&&b(),2==c?goog.asserts.assert(5==d,"Bad PES header?"):3==c&&goog.asserts.assert(10==d,"Bad PES header?"),b=a.readUint8(),c=a.readUint16(),a=a.readUint16(),(1073741824*((14&b)>>1)+((65534&c)<<14|(65534&a)>>1))/shaka.hls.HlsParser.TS_TIMESCALE_;a.seek(c+188),d=a.readUint8(),71!=d&&(a.seek(c+192),d=a.readUint8()),71!=d&&(a.seek(c+204),d=a.readUint8()),71!=d&&b(),a.rewind(1)}},shaka.hls.HlsParser.prototype.getStartTimeFromTextSegment_=function(a,b,c){return a=shaka.util.MimeUtils.getFullType(a,b),shaka.text.TextEngine.isTypeSupported(a)?(b=new shaka.text.TextEngine(null),b.initParser(a),b.getStartTime(c)):0},shaka.hls.HlsParser.filterDuplicateCodecs_=function(a){var b=new Set,c=[];a=$jscomp.makeIterator(a);for(var d=a.next();!d.done;d=a.next()){d=d.value;var e=shaka.util.MimeUtils.getCodecBase(d);b.has(e)?shaka.log.debug("Ignoring duplicate codec"):(c.push(d),b.add(e))}return c},shaka.hls.HlsParser.prototype.guessCodecsSafe_=function(a,b){for(var c=shaka.util.ManifestParserUtils.ContentType,d=shaka.hls.HlsParser.CODEC_REGEXPS_BY_CONTENT_TYPE_[a],e=0;e<d.length;e++)for(var f=0;f<b.length;f++)if(d[e].test(b[f].trim()))return b[f].trim();return a==c.TEXT?"":null},shaka.hls.HlsParser.prototype.guessCodecs_=function(a,b){if(1==b.length)return b[0];var c=this.guessCodecsSafe_(a,b);if(null!=c)return c;throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_COULD_NOT_GUESS_CODECS,b)},shaka.hls.HlsParser.prototype.guessMimeType_=function(a,b,c){var d=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function e(){var f,g,h,i,j,k,l,m,n,o,p;return $jscomp.generator.createGenerator(e,function(e){switch(e.nextAddress){case 1:return f=shaka.util.ManifestParserUtils.ContentType,g=shaka.hls.HlsParser,h=shaka.net.NetworkingEngine.RequestType,goog.asserts.assert(c.segments.length,"Playlist should have segments!"),i=c.segments[0].absoluteUri,j=new goog.Uri(i),k=j.getPath().split(".").pop(),l=g.EXTENSION_MAP_BY_CONTENT_TYPE_[a],(m=l[k])?e["return"](m):a==f.TEXT?b&&"vtt"!=b?e["return"]("application/mp4"):e["return"]("text/vtt"):(n=shaka.net.NetworkingEngine.makeRequest([i],d.config_.retryParameters),n.method="HEAD",e["yield"](d.makeNetworkRequest_(n,h.SEGMENT),2));case 2:if(o=e.yieldResult,p=o.headers["content-type"],!p)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_COULD_NOT_GUESS_MIME_TYPE,k);return e["return"](p.split(";")[0])}})})},shaka.hls.HlsParser.getRequiredAttributeValue_=function(a,b){var c=a.getAttribute(b);if(!c)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_REQUIRED_ATTRIBUTE_MISSING,b);return c.value},shaka.hls.HlsParser.prototype.getRequiredTag_=function(a,b){var c=shaka.hls.Utils.getFirstTagWithName(a,b);if(!c)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_REQUIRED_TAG_MISSING,b);return c},shaka.hls.HlsParser.prototype.addVideoAttributes_=function(a,b,c,d){a&&(a.width=Number(b)||void 0,a.height=Number(c)||void 0,a.frameRate=Number(d)||void 0)},shaka.hls.HlsParser.prototype.requestManifest_=function(a){var b=shaka.net.NetworkingEngine.RequestType;return a=shaka.net.NetworkingEngine.makeRequest([a],this.config_.retryParameters),this.makeNetworkRequest_(a,b.MANIFEST)},shaka.hls.HlsParser.VIDEO_CODEC_REGEXPS_=[/^avc/,/^hev/,/^hvc/,/^vp0?[89]/,/^av1$/],shaka.hls.HlsParser.AUDIO_CODEC_REGEXPS_=[/^vorbis$/,/^opus$/,/^flac$/,/^mp4a/,/^[ae]c-3$/],shaka.hls.HlsParser.TEXT_CODEC_REGEXPS_=[/^vtt$/,/^wvtt/,/^stpp/],shaka.hls.HlsParser.CODEC_REGEXPS_BY_CONTENT_TYPE_={audio:shaka.hls.HlsParser.AUDIO_CODEC_REGEXPS_,video:shaka.hls.HlsParser.VIDEO_CODEC_REGEXPS_,text:shaka.hls.HlsParser.TEXT_CODEC_REGEXPS_},shaka.hls.HlsParser.AUDIO_EXTENSIONS_TO_MIME_TYPES_={mp4:"audio/mp4",m4s:"audio/mp4",m4i:"audio/mp4",m4a:"audio/mp4",ts:"video/mp2t"},shaka.hls.HlsParser.VIDEO_EXTENSIONS_TO_MIME_TYPES_={mp4:"video/mp4",m4s:"video/mp4",m4i:"video/mp4",m4v:"video/mp4",ts:"video/mp2t"},shaka.hls.HlsParser.TEXT_EXTENSIONS_TO_MIME_TYPES_={mp4:"application/mp4",m4s:"application/mp4",m4i:"application/mp4",vtt:"text/vtt",ttml:"application/ttml+xml"},shaka.hls.HlsParser.EXTENSION_MAP_BY_CONTENT_TYPE_={audio:shaka.hls.HlsParser.AUDIO_EXTENSIONS_TO_MIME_TYPES_,video:shaka.hls.HlsParser.VIDEO_EXTENSIONS_TO_MIME_TYPES_,text:shaka.hls.HlsParser.TEXT_EXTENSIONS_TO_MIME_TYPES_},shaka.hls.HlsParser.widevineDrmParser_=function(a){var b=shaka.hls.HlsParser,c=b.getRequiredAttributeValue_(a,"METHOD");shaka.Deprecate.deprecateFeature(2,6,"HLS SAMPLE-AES-CENC","SAMPLE-AES-CENC will no longer be supported, see Issue #1227");var d=["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"];return d.includes(c)?(b=b.getRequiredAttributeValue_(a,"URI"),b=shaka.net.DataUriPlugin.parse(b),b=new Uint8Array(b.data),b=shaka.util.ManifestParserUtils.createDrmInfo("com.widevine.alpha",[{initDataType:"cenc",initData:b}]),(a=a.getAttributeValue("KEYID"))&&(goog.asserts.assert(a.startsWith("0x"),"Incorrect KEYID format!"),b.keyIds=[a.substr(2).toLowerCase()]),b):(shaka.log.error("Widevine in HLS is only supported with [",d.join(", "),"], not",c),null)},shaka.hls.HlsParser.prototype.onUpdate_=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function b(){var c,d;return $jscomp.generator.createGenerator(b,function(b){switch(b.nextAddress){case 1:return shaka.log.info("Updating manifest..."),goog.asserts.assert(0<a.updatePlaylistDelay_,"We should only call |onUpdate_| when we are suppose to be updating."),a.playerInterface_?(b.setCatchFinallyBlocks(2),b["yield"](a.update(),4)):b["return"]();case 4:c=a.updatePlaylistDelay_,a.updatePlaylistTimer_.tickAfter(c),b.leaveTryBlock(0);break;case 2:d=b.enterCatchBlock(),goog.asserts.assert(d instanceof shaka.util.Error,"Should only receive a Shaka error"),d.severity=shaka.util.Error.Severity.RECOVERABLE,a.playerInterface_.onError(d),a.updatePlaylistTimer_.tickAfter(.1),b.jumpToEnd()}})})},shaka.hls.HlsParser.prototype.isLive_=function(){return this.presentationType_!=shaka.hls.HlsParser.PresentationType_.VOD},shaka.hls.HlsParser.prototype.setPresentationType_=function(a){this.presentationType_=a,this.presentationTimeline_&&this.presentationTimeline_.setStatic(!this.isLive_()),this.isLive_()||this.updatePlaylistTimer_.stop()},shaka.hls.HlsParser.prototype.makeNetworkRequest_=function(a,b){if(!this.operationManager_)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.OPERATION_ABORTED);var c=this.playerInterface_.networkingEngine.request(b,a);return this.operationManager_.manage(c),c.promise},shaka.hls.HlsParser.KEYFORMATS_TO_DRM_PARSERS_={"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":shaka.hls.HlsParser.widevineDrmParser_},shaka.hls.HlsParser.PresentationType_={VOD:"VOD",EVENT:"EVENT",LIVE:"LIVE"},shaka.hls.HlsParser.TS_TIMESCALE_=9e4,shaka.hls.HlsParser.TS_ROLLOVER_=8589934592,shaka.hls.HlsParser.PARTIAL_SEGMENT_SIZE_=2048,shaka.media.ManifestParser.registerParserByExtension("m3u8",shaka.hls.HlsParser),shaka.media.ManifestParser.registerParserByMime("application/x-mpegurl",shaka.hls.HlsParser),shaka.media.ManifestParser.registerParserByMime("application/vnd.apple.mpegurl",shaka.hls.HlsParser),shaka.media.ActiveStreamMap=function(){this.history_=new Map},shaka.media.ActiveStreamMap.prototype.clear=function(){this.history_.clear()},shaka.media.ActiveStreamMap.prototype.useVariant=function(a,b){this.getFrameFor_(a).variant=b},shaka.media.ActiveStreamMap.prototype.useText=function(a,b){this.getFrameFor_(a).text=b},shaka.media.ActiveStreamMap.prototype.getVariant=function(a){return this.getFrameFor_(a).variant},shaka.media.ActiveStreamMap.prototype.getText=function(a){return this.getFrameFor_(a).text},shaka.media.ActiveStreamMap.prototype.getFrameFor_=function(a){if(!this.history_.has(a)){var b=new shaka.media.ActiveStreamMap.Frame;this.history_.set(a,b)}return this.history_.get(a)},shaka.media.ActiveStreamMap.Frame=function(){this.text=this.variant=null},shaka.media.AdaptationSet=function(a,b){this.root_=a,this.variants_=new Set([a]),b=b||[];for(var c=$jscomp.makeIterator(b),d=c.next();!d.done;d=c.next())this.add(d.value)},shaka.media.AdaptationSet.prototype.add=function(a){return this.canInclude(a)?(this.variants_.add(a),!0):(shaka.log.warning("Rejecting variant - not compatible with root."),!1)},shaka.media.AdaptationSet.prototype.canInclude=function(a){return shaka.media.AdaptationSet.areAdaptable(this.root_,a)},shaka.media.AdaptationSet.areAdaptable=function(a,b){var c=shaka.media.AdaptationSet;return!!a.audio==!!b.audio&&!!a.video==!!b.video&&a.language==b.language&&(goog.asserts.assert(!!a.audio==!!b.audio,"Both should either have audio or not have audio."),!(a.audio&&b.audio&&!c.areAudiosCompatible_(a.audio,b.audio))&&(goog.asserts.assert(!!a.video==!!b.video,"Both should either have video or not have video."),!(a.video&&b.video&&!c.areVideosCompatible_(a.video,b.video))))},shaka.media.AdaptationSet.prototype.values=function(){return this.variants_.values()},shaka.media.AdaptationSet.areAudiosCompatible_=function(a,b){var c=shaka.media.AdaptationSet;return!(a.channelsCount!=b.channelsCount||!c.canTransitionBetween_(a,b)||!c.areRolesEqual_(a.roles,b.roles))},shaka.media.AdaptationSet.areVideosCompatible_=function(a,b){var c=shaka.media.AdaptationSet;return!(!c.canTransitionBetween_(a,b)||!c.areRolesEqual_(a.roles,b.roles))},shaka.media.AdaptationSet.canTransitionBetween_=function(a,b){if(a.mimeType!=b.mimeType)return!1;var c=shaka.util.MimeUtils.splitCodecs(a.codecs).map(function(a){return shaka.util.MimeUtils.getCodecBase(a)}),d=shaka.util.MimeUtils.splitCodecs(b.codecs).map(function(a){return shaka.util.MimeUtils.getCodecBase(a)});if(c.length!=d.length)return!1;c.sort(),d.sort();for(var e=0;e<c.length;e++)if(c[e]!=d[e])return!1;return!0},shaka.media.AdaptationSet.areRolesEqual_=function(a,b){var c=new Set(a),d=new Set(b);if(c["delete"]("main"),d["delete"]("main"),c.size!=d.size)return!1;c=$jscomp.makeIterator(c);for(var e=c.next();!e.done;e=c.next())if(!d.has(e.value))return!1;return!0},shaka.media.AdaptationSetCriteria=function(){},shaka.media.AdaptationSetCriteria.prototype.create=function(a){},shaka.media.ExampleBasedCriteria=function(a){this.example_=a,this.fallback_=new shaka.media.PreferenceBasedCriteria(a.language,"",a.audio&&a.audio.channelsCount?a.audio.channelsCount:0)},shaka.media.ExampleBasedCriteria.prototype.create=function(a){var b=this,c=a.filter(function(a){return shaka.media.AdaptationSet.areAdaptable(b.example_,a)});return c.length?new shaka.media.AdaptationSet(c[0],c):this.fallback_.create(a)},shaka.media.PreferenceBasedCriteria=function(a,b,c){this.language_=a,this.role_=b,this.channelCount_=c},shaka.media.PreferenceBasedCriteria.prototype.create=function(a){var b=shaka.media.PreferenceBasedCriteria,c=shaka.util.StreamUtils,d=[];d=b.filterByLanguage_(a,this.language_);var e=a.filter(function(a){return a.primary});for(d=d.length?d:e.length?e:a,this.role_&&(a=b.filterVariantsByRole_(d,this.role_),a.length?d=a:shaka.log.warning("No exact match for variant role could be found.")),this.channelCount_&&(c=c.filterVariantsByAudioChannelCount(d,this.channelCount_),c.length?d=c:shaka.log.warning("No exact match for the channel count could be found.")),c=new shaka.media.AdaptationSet(d[0]),d=$jscomp.makeIterator(d),a=d.next();!a.done;a=d.next())a=a.value,c.canInclude(a)&&c.add(a);return c},shaka.media.PreferenceBasedCriteria.filterByLanguage_=function(a,b){var c=shaka.util.LanguageUtils,d=c.normalize(b),e=c.findClosestLocale(d,a.map(function(a){return c.getLocaleForVariant(a)}));return e?a.filter(function(a){return e==c.getLocaleForVariant(a)}):[]},shaka.media.PreferenceBasedCriteria.filterVariantsByRole_=function(a,b){return a.filter(function(a){var c=a.audio;return a=a.video,c&&0<=c.roles.indexOf(b)||a&&0<=a.roles.indexOf(b)})},shaka.media.BufferingObserver=function(a,b){var c=shaka.media.BufferingObserver.State;this.previousState_=c.SATISFIED,this.thresholds_=(new Map).set(c.SATISFIED,b).set(c.STARVING,a)},shaka.media.BufferingObserver.prototype.update=function(a,b){var c=shaka.media.BufferingObserver.State,d=this.thresholds_.get(this.previousState_),e=this.previousState_;return this.previousState_=c=b||a>=d?c.SATISFIED:c.STARVING,e!=c},shaka.media.BufferingObserver.prototype.setState=function(a){this.previousState_=a},shaka.media.BufferingObserver.prototype.getState=function(){return this.previousState_},shaka.media.BufferingObserver.State={STARVING:0,SATISFIED:1},shaka.media.StallDetector=function(a,b){this.implementation_=a,this.wasMakingProgress_=a.shouldBeMakingProgress(),this.value_=a.getPresentationSeconds(),this.lastUpdateSeconds_=a.getWallSeconds(),this.stallThresholdSeconds_=b,this.onStall_=function(){}},shaka.media.StallDetector.prototype.release=function(){this.implementation_=null,this.onStall_=function(){}},shaka.media.StallDetector.prototype.onStall=function(a){this.onStall_=a},shaka.media.StallDetector.prototype.poll=function(){var a=this.implementation_,b=a.shouldBeMakingProgress(),c=a.getPresentationSeconds();a=a.getWallSeconds(),this.value_==c&&this.wasMakingProgress_==b||(this.lastUpdateSeconds_=a,this.value_=c,this.wasMakingProgress_=b),c=a-this.lastUpdateSeconds_,c>=this.stallThresholdSeconds_&&b&&this.onStall_(this.value_,c)},shaka.media.StallDetector.Implementation=function(){},shaka.media.StallDetector.Implementation.prototype.shouldBeMakingProgress=function(){},shaka.media.StallDetector.Implementation.prototype.getPresentationSeconds=function(){},shaka.media.StallDetector.Implementation.prototype.getWallSeconds=function(){},shaka.media.StallDetector.MediaElementImplementation=function(a){this.mediaElement_=a},shaka.media.StallDetector.MediaElementImplementation.prototype.shouldBeMakingProgress=function(){return!this.mediaElement_.paused&&0!=this.mediaElement_.playbackRate&&null!=this.mediaElement_.buffered&&shaka.media.StallDetector.MediaElementImplementation.hasContentFor_(this.mediaElement_.buffered,this.mediaElement_.currentTime)},shaka.media.StallDetector.MediaElementImplementation.prototype.getPresentationSeconds=function(){return this.mediaElement_.currentTime},shaka.media.StallDetector.MediaElementImplementation.prototype.getWallSeconds=function(){return Date.now()/1e3},shaka.media.StallDetector.MediaElementImplementation.hasContentFor_=function(a,b){for(var c=0;c<a.length;c++){var d=a.start(c),e=a.end(c);if(!(b<d||b>e-.5))return!0}return!1},shaka.media.GapJumpingController=function(a,b,c,d,e){var f=this;this.video_=a,this.timeline_=b,this.config_=c,this.onEvent_=e,this.eventManager_=new shaka.util.EventManager,this.seekingEventReceived_=!1,this.prevReadyState_=a.readyState,this.didFireLargeGap_=!1,this.stallDetector_=d,this.hadSegmentAppended_=!1,this.eventManager_.listen(a,"waiting",function(){return f.onPollGapJump_()}),this.gapJumpTimer_=new shaka.util.Timer(function(){f.onPollGapJump_()}).tickEvery(.25)},shaka.media.GapJumpingController.BROWSER_GAP_TOLERANCE=.001,shaka.media.GapJumpingController.prototype.release=function(){this.eventManager_&&(this.eventManager_.release(),this.eventManager_=null),null!=this.gapJumpTimer_&&(this.gapJumpTimer_.stop(),this.gapJumpTimer_=null),this.stallDetector_&&(this.stallDetector_.release(),this.stallDetector_=null),this.video_=this.timeline_=this.onEvent_=null},shaka.media.GapJumpingController.prototype.onSegmentAppended=function(){this.hadSegmentAppended_=!0,this.onPollGapJump_()},shaka.media.GapJumpingController.prototype.onSeeking=function(){this.seekingEventReceived_=!0,this.didFireLargeGap_=this.hadSegmentAppended_=!1},shaka.media.GapJumpingController.prototype.onPollGapJump_=function(){if(0!=this.video_.readyState){if(this.video_.seeking){if(!this.seekingEventReceived_)return}else this.seekingEventReceived_=!1;if(!this.video_.paused){this.video_.readyState!=this.prevReadyState_&&(this.didFireLargeGap_=!1,this.prevReadyState_=this.video_.readyState);var a=this.config_.smallGapLimit,b=this.video_.currentTime,c=this.video_.buffered,d=shaka.media.TimeRangesUtils.getGapIndex(c,b);if(null==d)this.stallDetector_&&this.stallDetector_.poll();else if(0!=d||this.hadSegmentAppended_){var e=c.start(d),f=this.timeline_.getSeekRangeEnd();if(!(e>=f)){f=e-b,a=f<=a;var g=!1;if(!(f<shaka.media.GapJumpingController.BROWSER_GAP_TOLERANCE)){if(!a&&!this.didFireLargeGap_){this.didFireLargeGap_=!0;var h=new shaka.util.FakeEvent("largegap",{currentTime:b,gapSize:f});h.cancelable=!0,this.onEvent_(h),this.config_.jumpLargeGaps&&!h.defaultPrevented?g=!0:shaka.log.info("Ignoring large gap at",b,"size",f)}(a||g)&&(0==d?shaka.log.info("Jumping forward",f,"seconds because of gap before start time of",e):shaka.log.info("Jumping forward",f,"seconds because of gap starting at",c.end(d-1),"and ending at",e),this.video_.currentTime=e)}}}}}},shaka.media.IPlayheadObserver=function(){},shaka.media.IPlayheadObserver.prototype.poll=function(a,b){},shaka.media.PlayheadObserverManager=function(a){var b=this;this.mediaElement_=a,this.observers_=new Set,this.pollingLoop_=new shaka.util.Timer(function(){b.pollAllObservers_(!1)}).tickEvery(.25)},shaka.media.PlayheadObserverManager.prototype.release=function(){this.pollingLoop_.stop();for(var a=$jscomp.makeIterator(this.observers_),b=a.next();!b.done;b=a.next())b.value.release();this.observers_.clear()},shaka.media.PlayheadObserverManager.prototype.manage=function(a){this.observers_.add(a)},shaka.media.PlayheadObserverManager.prototype.notifyOfSeek=function(){this.pollAllObservers_(!0)},shaka.media.PlayheadObserverManager.prototype.pollAllObservers_=function(a){for(var b=$jscomp.makeIterator(this.observers_),c=b.next();!c.done;c=b.next())c.value.poll(this.mediaElement_.currentTime,a)},shaka.util.Periods=function(){},shaka.util.Periods.getAllVariantsFrom=function(a){var b=[];a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next()){c=$jscomp.makeIterator(c.value.variants);for(var d=c.next();!d.done;d=c.next())b.push(d.value)}return b},shaka.util.Periods.findPeriodForTime=function(a,b){for(var c=null,d=$jscomp.makeIterator(a),e=d.next();!e.done;e=d.next())e=e.value,b>=e.startTime&&(c=e);return c},shaka.media.PeriodObserver=function(a){this.manifest_=a,this.currentPeriod_=null,this.onChangedPeriods_=function(a){}},shaka.media.PeriodObserver.prototype.release=function(){this.currentPeriod_=this.manifest_=null,this.onChangedPeriods_=function(a){}},shaka.media.PeriodObserver.prototype.poll=function(a,b){var c=this.currentPeriod_,d=this.findCurrentPeriod_(a);c!=d&&this.onChangedPeriods_(d),this.currentPeriod_=d},shaka.media.PeriodObserver.prototype.setListeners=function(a){this.onChangedPeriods_=a},shaka.media.PeriodObserver.prototype.findCurrentPeriod_=function(a){var b=this.manifest_.periods;return shaka.util.Periods.findPeriodForTime(b,a)||b[0]},shaka.media.PlayRateController=function(a){var b=this;this.harness_=a,this.isBuffering_=!1,this.rate_=this.harness_.getRate(),this.pollRate_=.25,this.timer_=new shaka.util.Timer(function(){b.harness_.movePlayhead(b.rate_*b.pollRate_)})},shaka.media.PlayRateController.prototype.release=function(){this.timer_&&(this.timer_.stop(),this.timer_=null),this.harness_=null},shaka.media.PlayRateController.prototype.setBuffering=function(a){
this.isBuffering_=a,this.apply_()},shaka.media.PlayRateController.prototype.set=function(a){goog.asserts.assert(0!=a,"Should never set rate of 0 explicitly!"),this.rate_=a,this.apply_()},shaka.media.PlayRateController.prototype.getActiveRate=function(){return this.calculateCurrentRate_()},shaka.media.PlayRateController.prototype.apply_=function(){this.timer_.stop();var a=this.calculateCurrentRate_();if(0<=a)try{return void this.applyRate_(a)}catch(b){}this.timer_.tickEvery(this.pollRate_),this.applyRate_(0)},shaka.media.PlayRateController.prototype.calculateCurrentRate_=function(){return this.isBuffering_?0:this.rate_},shaka.media.PlayRateController.prototype.applyRate_=function(a){var b=this.harness_.getRate();return b!=a&&this.harness_.setRate(a),b!=a},shaka.media.VideoWrapper=function(a,b,c){this.video_=a,this.onSeek_=b,this.startTime_=c,this.started_=!1,this.eventManager_=new shaka.util.EventManager,this.mover_=new shaka.media.VideoWrapper.PlayheadMover(a,10),0<a.readyState?this.setStartTime_(c):this.delaySetStartTime_(c)},shaka.media.VideoWrapper.prototype.release=function(){this.eventManager_&&(this.eventManager_.release(),this.eventManager_=null),null!=this.mover_&&(this.mover_.release(),this.mover_=null),this.onSeek_=function(){},this.video_=null},shaka.media.VideoWrapper.prototype.getTime=function(){return this.started_?this.video_.currentTime:this.startTime_},shaka.media.VideoWrapper.prototype.setTime=function(a){0<this.video_.readyState?this.mover_.moveTo(a):this.delaySetStartTime_(a)},shaka.media.VideoWrapper.prototype.delaySetStartTime_=function(a){var b=this;this.startTime_=a,this.eventManager_.unlisten(this.video_,"loadedmetadata"),this.eventManager_.listenOnce(this.video_,"loadedmetadata",function(){b.setStartTime_(a)})},shaka.media.VideoWrapper.prototype.setStartTime_=function(a){var b=this;.001>Math.abs(this.video_.currentTime-a)?this.startListeningToSeeks_():(this.eventManager_.listenOnce(this.video_,"seeking",function(){b.startListeningToSeeks_()}),this.mover_.moveTo(0==this.video_.currentTime?a:this.video_.currentTime))},shaka.media.VideoWrapper.prototype.startListeningToSeeks_=function(){var a=this;goog.asserts.assert(0<this.video_.readyState,"The media element should be ready before we listen for seeking."),this.started_=!0,this.eventManager_.listen(this.video_,"seeking",function(){return a.onSeek_()})},shaka.media.VideoWrapper.PlayheadMover=function(a,b){var c=this;this.mediaElement_=a,this.maxAttempts_=b,this.targetTime_=this.originTime_=this.remainingAttempts_=0,this.timer_=new shaka.util.Timer(function(){return c.onTick_()})},shaka.media.VideoWrapper.PlayheadMover.prototype.release=function(){this.timer_&&(this.timer_.stop(),this.timer_=null),this.mediaElement_=null},shaka.media.VideoWrapper.PlayheadMover.prototype.moveTo=function(a){this.originTime_=this.mediaElement_.currentTime,this.targetTime_=a,this.remainingAttempts_=this.maxAttempts_,this.mediaElement_.currentTime=a,this.timer_.tickEvery(.1)},shaka.media.VideoWrapper.PlayheadMover.prototype.onTick_=function(){0>=this.remainingAttempts_?(shaka.log.warning(["Failed to move playhead from",this.originTime_,"to",this.targetTime_].join(" ")),this.timer_.stop()):this.mediaElement_.currentTime!=this.originTime_?this.timer_.stop():(this.mediaElement_.currentTime=this.targetTime_,this.remainingAttempts_--)},shaka.media.Playhead=function(){},shaka.media.Playhead.prototype.setStartTime=function(a){},shaka.media.Playhead.prototype.getTime=function(){},shaka.media.Playhead.prototype.notifyOfBufferingChange=function(){},shaka.media.SrcEqualsPlayhead=function(a){var b=this;this.mediaElement_=a,this.started_=!1,this.startTime_=null,this.eventManager_=new shaka.util.EventManager,a=function(){null==b.startTime_?b.started_=!0:(b.eventManager_.listenOnce(b.mediaElement_,"seeking",function(){b.started_=!0}),b.mediaElement_.currentTime=b.startTime_)},0==this.mediaElement_.readyState?this.eventManager_.listenOnce(this.mediaElement_,"loadedmetadata",a):a()},shaka.media.SrcEqualsPlayhead.prototype.release=function(){this.eventManager_&&(this.eventManager_.release(),this.eventManager_=null),this.mediaElement_=null},shaka.media.SrcEqualsPlayhead.prototype.setStartTime=function(a){this.startTime_=this.started_?this.startTime_:a},shaka.media.SrcEqualsPlayhead.prototype.getTime=function(){return(this.started_?this.mediaElement_.currentTime:this.startTime_)||0},shaka.media.SrcEqualsPlayhead.prototype.notifyOfBufferingChange=function(){},shaka.media.MediaSourcePlayhead=function(a,b,c,d,e,f){var g=this;this.minSeekRange_=3,this.mediaElement_=a,this.timeline_=b.presentationTimeline,this.minBufferTime_=b.minBufferTime||0,this.config_=c,this.onSeek_=e,this.lastCorrectiveSeek_=null,this.gapController_=new shaka.media.GapJumpingController(a,b.presentationTimeline,c,this.createStallDetector_(a,c),f),this.videoWrapper_=new shaka.media.VideoWrapper(a,function(){return g.onSeeking_()},this.getStartTime_(d)),this.checkWindowTimer_=new shaka.util.Timer(function(){g.onPollWindow_()}).tickEvery(.25)},shaka.media.MediaSourcePlayhead.prototype.release=function(){this.videoWrapper_&&(this.videoWrapper_.release(),this.videoWrapper_=null),this.gapController_&&(this.gapController_.release(),this.gapController_=null),this.checkWindowTimer_&&(this.checkWindowTimer_.stop(),this.checkWindowTimer_=null),this.mediaElement_=this.videoWrapper_=this.timeline_=this.config_=null,this.onSeek_=function(){}},shaka.media.MediaSourcePlayhead.prototype.setStartTime=function(a){this.videoWrapper_.setTime(a)},shaka.media.MediaSourcePlayhead.prototype.getTime=function(){var a=this.videoWrapper_.getTime();return 0<this.mediaElement_.readyState&&!this.mediaElement_.paused?this.clampTime_(a):a},shaka.media.MediaSourcePlayhead.prototype.getStartTime_=function(a){return null==a?a=1/0>this.timeline_.getDuration()?this.timeline_.getSeekRangeStart():this.timeline_.getSeekRangeEnd():0>a&&(a=this.timeline_.getSeekRangeEnd()+a),this.clampSeekToDuration_(this.clampTime_(a))},shaka.media.MediaSourcePlayhead.prototype.notifyOfBufferingChange=function(){this.gapController_.onSegmentAppended()},shaka.media.MediaSourcePlayhead.prototype.onPollWindow_=function(){if(0!=this.mediaElement_.readyState&&!this.mediaElement_.paused){var a=this.mediaElement_.currentTime,b=this.timeline_.getSeekRangeStart(),c=this.timeline_.getSeekRangeEnd();c-b<this.minSeekRange_&&(b=c-this.minSeekRange_),a<b&&(b=this.reposition_(a),shaka.log.info("Jumping forward "+(b-a)+" seconds to catch up with the seek range."),this.mediaElement_.currentTime=b)}},shaka.media.MediaSourcePlayhead.prototype.onSeeking_=function(){this.gapController_.onSeeking();var a=this.videoWrapper_.getTime(),b=this.reposition_(a);if(Math.abs(b-a)>shaka.media.GapJumpingController.BROWSER_GAP_TOLERANCE){var c=(new Date).getTime()/1e3;if(!this.lastCorrectiveSeek_||this.lastCorrectiveSeek_<c-1)return this.lastCorrectiveSeek_=c,void this.videoWrapper_.setTime(b)}shaka.log.v1("Seek to "+a),this.onSeek_()},shaka.media.MediaSourcePlayhead.prototype.clampSeekToDuration_=function(a){var b=this.timeline_.getDuration();return a>=b?(goog.asserts.assert(0<=this.config_.durationBackoff,"Duration backoff must be non-negative!"),b-this.config_.durationBackoff):a},shaka.media.MediaSourcePlayhead.prototype.reposition_=function(a){goog.asserts.assert(this.config_,"Cannot reposition playhead when it has beeen destroyed");var b=shaka.media.TimeRangesUtils.isBuffered.bind(null,this.mediaElement_.buffered),c=Math.max(this.minBufferTime_,this.config_.rebufferingGoal),d=this.config_.safeSeekOffset,e=this.timeline_.getSeekRangeStart(),f=this.timeline_.getSeekRangeEnd(),g=this.timeline_.getDuration();f-e<this.minSeekRange_&&(e=f-this.minSeekRange_);var h=this.timeline_.getSafeSeekRangeStart(c),i=this.timeline_.getSafeSeekRangeStart(d);return c=this.timeline_.getSafeSeekRangeStart(c+d),a>=g?(shaka.log.v1("Playhead past duration."),this.clampSeekToDuration_(a)):a>f?(shaka.log.v1("Playhead past end."),f):a<e?b(i)?(shaka.log.v1("Playhead before start & start is buffered"),i):(shaka.log.v1("Playhead before start & start is unbuffered"),c):a>=h||b(a)?(shaka.log.v1("Playhead in safe region or in buffered region."),a):(shaka.log.v1("Playhead outside safe region & in unbuffered region."),c)},shaka.media.MediaSourcePlayhead.prototype.clampTime_=function(a){var b=this.timeline_.getSeekRangeStart();return a<b?b:(b=this.timeline_.getSeekRangeEnd(),a>b?b:a)},shaka.media.MediaSourcePlayhead.prototype.createStallDetector_=function(a,b){if(!b.stallEnabled)return null;var c=b.stallThreshold,d=b.stallSkip;return c=new shaka.media.StallDetector(new shaka.media.StallDetector.MediaElementImplementation(a),c),c.onStall(function(b,c){shaka.log.debug(["Stall detected at",b,"for",c,"seconds. Seeking forward",d,"seconds."].join(" ")),a.currentTime+=d}),c},shaka.media.RegionTimeline=function(){this.onAddRegion_=function(a){},this.regions_=new Set},shaka.media.RegionTimeline.prototype.release=function(){this.onAddRegion_=function(a){},this.regions_.clear()},shaka.media.RegionTimeline.prototype.setListeners=function(a){this.onAddRegion_=a},shaka.media.RegionTimeline.prototype.addRegion=function(a){null==this.findSimilarRegion_(a)&&(this.regions_.add(a),this.onAddRegion_(a))},shaka.media.RegionTimeline.prototype.findSimilarRegion_=function(a){for(var b=$jscomp.makeIterator(this.regions_),c=b.next();!c.done;c=b.next())if(c=c.value,c.schemeIdUri==a.schemeIdUri&&c.startTime==a.startTime&&c.endTime==a.endTime)return c;return null},shaka.media.RegionTimeline.prototype.regions=function(){return this.regions_},shaka.media.RegionObserver=function(a){var b=this;this.timeline_=a,this.oldPosition_=new Map,this.onEnter_=function(a,b){},this.onExit_=function(a,b){},this.onSkip_=function(a,b){};var c=shaka.media.RegionObserver.RelativePosition_;a=c.BEFORE_THE_REGION;var d=c.IN_THE_REGION;c=c.AFTER_THE_REGION,this.rules_=[{weWere:null,weAre:d,invoke:function(a,c){return b.onEnter_(a,c)}},{weWere:a,weAre:d,invoke:function(a,c){return b.onEnter_(a,c)}},{weWere:c,weAre:d,invoke:function(a,c){return b.onEnter_(a,c)}},{weWere:d,weAre:a,invoke:function(a,c){return b.onExit_(a,c)}},{weWere:d,weAre:c,invoke:function(a,c){return b.onExit_(a,c)}},{weWere:a,weAre:c,invoke:function(a,c){return b.onSkip_(a,c)}},{weWere:c,weAre:a,invoke:function(a,c){return b.onSkip_(a,c)}}]},shaka.media.RegionObserver.prototype.release=function(){this.timeline_=null,this.oldPosition_.clear(),this.onEnter_=function(a,b){},this.onExit_=function(a,b){},this.onSkip_=function(a,b){}},shaka.media.RegionObserver.prototype.poll=function(a,b){for(var c=shaka.media.RegionObserver,d=$jscomp.makeIterator(this.timeline_.regions()),e=d.next();!e.done;e=d.next()){e=e.value;var f=this.oldPosition_.get(e),g=c.determinePositionRelativeTo_(e,a);this.oldPosition_.set(e,g);for(var h=$jscomp.makeIterator(this.rules_),i=h.next();!i.done;i=h.next())i=i.value,i.weWere==f&&i.weAre==g&&i.invoke(e,b)}},shaka.media.RegionObserver.prototype.setListeners=function(a,b,c){this.onEnter_=a,this.onExit_=b,this.onSkip_=c},shaka.media.RegionObserver.determinePositionRelativeTo_=function(a,b){var c=shaka.media.RegionObserver.RelativePosition_;return b<a.startTime?c.BEFORE_THE_REGION:b>a.endTime?c.AFTER_THE_REGION:c.IN_THE_REGION},shaka.media.RegionObserver.RelativePosition_={BEFORE_THE_REGION:1,IN_THE_REGION:2,AFTER_THE_REGION:3},shaka.media.StreamingEngine=function(a,b){this.playerInterface_=b,this.manifest_=a,this.config_=null,this.bufferingGoalScale_=1,this.setupPeriodPromise_=Promise.resolve(),this.canSwitchPeriod_=[],this.canSwitchStream_=new Map,this.mediaStates_=new Map,this.startupComplete_=!1,this.failureCallbackBackoff_=null,this.unloadingTextStream_=this.destroyed_=this.fatalError_=!1,this.textStreamSequenceId_=0},shaka.media.StreamingEngine.APPEND_WINDOW_START_FUDGE_=.1,shaka.media.StreamingEngine.APPEND_WINDOW_END_FUDGE_=.01,shaka.media.StreamingEngine.MAX_RUN_AHEAD_SEGMENTS_=1,shaka.media.StreamingEngine.prototype.destroy=function(){for(var a=$jscomp.makeIterator(this.mediaStates_.values()),b=a.next();!b.done;b=a.next())this.cancelUpdate_(b.value);return this.mediaStates_.clear(),this.canSwitchStream_.clear(),this.config_=this.canSwitchPeriod_=this.setupPeriodPromise_=this.manifest_=this.playerInterface_=null,this.destroyed_=!0,Promise.resolve()},shaka.media.StreamingEngine.prototype.configure=function(a){this.config_=a,this.failureCallbackBackoff_=new shaka.net.Backoff({maxAttempts:Math.max(a.retryParameters.maxAttempts,2),baseDelay:a.retryParameters.baseDelay,backoffFactor:a.retryParameters.backoffFactor,fuzzFactor:a.retryParameters.fuzzFactor,timeout:0,stallTimeout:a.retryParameters.stallTimeout},(!0))},shaka.media.StreamingEngine.prototype.start=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function b(){var c,d,e,f,g,h,i;return $jscomp.generator.createGenerator(b,function(b){switch(b.nextAddress){case 1:return goog.asserts.assert(a.config_,"StreamingEngine configure() must be called before init()!"),c=a.playerInterface_.getPresentationTime(),d=a.findPeriodForTime_(c),e=a.manifest_.periods[d].textStreams,f={},a.manifest_.periods[d].variants.forEach(function(a){f.hasOwnProperty(a.audio.id)||(f[a.audio.id]=!0,e.push(a.audio)),f.hasOwnProperty(a.video.id)||(f[a.video.id]=!0,e.push(a.video))}),g=e.map(function(a){return a.createSegmentIndex()}),b["yield"](Promise.all(g),2);case 2:return h=new shaka.util.FakeEvent("vuduSegmentIndexCreated"),a.playerInterface_.onEvent(h),i=a.playerInterface_.onChooseStreams(a.manifest_.periods[d]),i.variant||i.text?b["yield"](a.initStreams_(i.variant?i.variant.audio:null,i.variant?i.variant.video:null,i.text,c),3):(shaka.log.error("init: no Streams chosen"),b["return"](new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STREAMING,shaka.util.Error.Code.INVALID_STREAMS_CHOSEN)));case 3:if(a.destroyed_)return b["return"]();shaka.log.debug("init: completed initial Stream setup"),a.playerInterface_&&a.playerInterface_.onInitialStreamsSetup&&(shaka.log.v1("init: calling onInitialStreamsSetup()..."),a.playerInterface_.onInitialStreamsSetup()),b.jumpToEnd()}})})},shaka.media.StreamingEngine.prototype.getBufferingPeriod=function(){var a=shaka.util.ManifestParserUtils.ContentType,b=this.mediaStates_.get(a.VIDEO);return b?this.manifest_.periods[b.needPeriodIndex]:(a=this.mediaStates_.get(a.AUDIO))?this.manifest_.periods[a.needPeriodIndex]:null},shaka.media.StreamingEngine.prototype.getBufferingAudio=function(){return this.getStream_(shaka.util.ManifestParserUtils.ContentType.AUDIO)},shaka.media.StreamingEngine.prototype.getBufferingVideo=function(){return this.getStream_(shaka.util.ManifestParserUtils.ContentType.VIDEO)},shaka.media.StreamingEngine.prototype.getBufferingText=function(){return this.getStream_(shaka.util.ManifestParserUtils.ContentType.TEXT)},shaka.media.StreamingEngine.prototype.getStream_=function(a){return(a=this.mediaStates_.get(a))?a.restoreStreamAfterTrickPlay||a.stream:null},shaka.media.StreamingEngine.prototype.loadNewTextStream=function(a){var b=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function c(){var d,e,f,g,h,i,j,k,l,m;return $jscomp.generator.createGenerator(c,function(c){switch(c.nextAddress){case 1:return d=shaka.util.ManifestParserUtils.ContentType,c["yield"](b.playerInterface_.mediaSourceEngine.clear(d.TEXT),2);case 2:return b.textStreamSequenceId_++,b.unloadingTextStream_=!1,e=b.textStreamSequenceId_,f=b.playerInterface_.mediaSourceEngine,g=new Map,h=new Set,g.set(d.TEXT,a),h.add(a),c["yield"](f.init(g,!1),3);case 3:return b.destroyed_?c["return"]():c["yield"](b.setupStreams_(h),4);case 4:if(b.destroyed_)return c["return"]();j=(i=b.playerInterface_.mediaSourceEngine.getTextDisplayer().isTextVisible())||b.config_.alwaysStreamText,b.textStreamSequenceId_!=e||b.mediaStates_.has(d.TEXT)||b.unloadingTextStream_||!j||(k=b.playerInterface_.getPresentationTime(),l=b.findPeriodForTime_(k),m=b.createMediaState_(a,l,0),b.mediaStates_.set(d.TEXT,m),b.scheduleUpdate_(m,0)),c.jumpToEnd()}})})},shaka.media.StreamingEngine.prototype.unloadTextStream=function(){var a=shaka.util.ManifestParserUtils.ContentType;this.unloadingTextStream_=!0;var b=this.mediaStates_.get(a.TEXT);b&&(this.cancelUpdate_(b),this.mediaStates_["delete"](a.TEXT))},shaka.media.StreamingEngine.prototype.setTrickPlay=function(a){var b=this.mediaStates_.get(shaka.util.ManifestParserUtils.ContentType.VIDEO);if(b){var c=b.stream;c&&(shaka.log.debug("setTrickPlay",a),a?(a=c.trickModeVideo)&&!b.restoreStreamAfterTrickPlay&&(shaka.log.debug("Engaging trick mode stream",a),this.switchInternal_(a,!1,0,!1),b.restoreStreamAfterTrickPlay=c):(c=b.restoreStreamAfterTrickPlay)&&(shaka.log.debug("Restoring non-trick-mode stream",c),b.restoreStreamAfterTrickPlay=null,this.switchInternal_(c,!0,0,!1)))}},shaka.media.StreamingEngine.prototype.switchVariant=function(a,b,c){a.video&&this.switchInternal_(a.video,b,c,!1),a.audio&&this.switchInternal_(a.audio,b,c,!1)},shaka.media.StreamingEngine.prototype.switchTextStream=function(a){var b=shaka.util.ManifestParserUtils.ContentType;goog.asserts.assert(a&&a.type==b.TEXT,"Wrong stream type passed to switchTextStream!"),this.switchInternal_(a,!0,0,!1)},shaka.media.StreamingEngine.prototype.reloadTextStream=function(){var a=this.mediaStates_.get(shaka.util.ManifestParserUtils.ContentType.TEXT);a&&this.switchInternal_(a.stream,!0,0,!0)},shaka.media.StreamingEngine.prototype.switchInternal_=function(a,b,c,d){var e=this,f=shaka.util.ManifestParserUtils.ContentType,g=this.mediaStates_.get(a.type);if(!g&&a.type==f.TEXT&&this.config_.ignoreTextStreamFailures)this.loadNewTextStream(a);else if(goog.asserts.assert(g,"switch: expected mediaState to exist"),g){var h=this.findPeriodContainingStream_(a),i=Array.from(this.mediaStates_.values()).every(function(a){return a.needPeriodIndex==g.needPeriodIndex});b&&h!=g.needPeriodIndex&&i?(shaka.log.debug("switch: switching to stream in another Period; clearing buffer and changing Periods"),this.mediaStates_.forEach(function(a){e.forceClearBuffer_(a)})):(g.restoreStreamAfterTrickPlay&&(shaka.log.debug("switch during trick play mode",a),a.trickModeVideo?(g.restoreStreamAfterTrickPlay=a,a=a.trickModeVideo,shaka.log.debug("switch found trick play stream",a)):(g.restoreStreamAfterTrickPlay=null,shaka.log.debug("switch found no special trick play stream"))),i=this.canSwitchPeriod_[h],goog.asserts.assert(i&&i.resolved,"switch: expected Period "+h+" to be ready"),i&&i.resolved&&(i=this.canSwitchStream_.get(a.id),goog.asserts.assert(i&&i.resolved,"switch: expected Stream "+a.id+" to be ready"),i&&i.resolved&&(g.stream!=a||d?(a.type==f.TEXT&&(d=shaka.util.MimeUtils.getFullType(a.mimeType,a.codecs),this.playerInterface_.mediaSourceEngine.reinitText(d)),g.stream=a,g.needInitSegment=!0,a=shaka.media.StreamingEngine.logPrefix_(g),shaka.log.debug("switch: switching to Stream "+a),this.shouldAbortCurrentRequest_(g,h)&&(shaka.log.info("Aborting current segment request to switch."),g.operation.abort()),b&&(g.clearingBuffer?g.waitingToFlushBuffer=!0:g.performingUpdate?(g.waitingToClearBuffer=!0,g.clearBufferSafeMargin=c,g.waitingToFlushBuffer=!0):(this.cancelUpdate_(g),this.clearBuffer_(g,!0,c)["catch"](function(a){e.playerInterface_&&e.playerInterface_.onError(a)})))):(b=shaka.media.StreamingEngine.logPrefix_(g),shaka.log.debug("switch: Stream "+b+" already active")))))}},shaka.media.StreamingEngine.prototype.shouldAbortCurrentRequest_=function(a,b){if(!a.operation)return!1;var c=this.playerInterface_.getPresentationTime(),d=this.playerInterface_.mediaSourceEngine.bufferEnd(a.type),e=this.getSegmentReferenceNeeded_(a,c,d,b);if(e=e?e.getSize():null,null==e)return!1;var f=a.stream.initSegmentReference;return f&&(e+=f.getSize()||0),f=this.playerInterface_.getBandwidthEstimate(),8*e/f<d-c-Math.max(this.manifest_.minBufferTime||0,this.config_.rebufferingGoal)||a.operation.getBytesRemaining()>e},shaka.media.StreamingEngine.prototype.seeked=function(){var a=this,b=shaka.util.Iterables,c=this.playerInterface_.getPresentationTime(),d=this.config_.smallGapLimit,e=function(b){return a.playerInterface_.mediaSourceEngine.isBuffered(b,c,d)},f=!1,g=this.findPeriodForTime_(c);if(b.every(this.mediaStates_.values(),function(a){return a.needPeriodIndex==g})){b=$jscomp.makeIterator(this.mediaStates_.keys());for(var h=b.next();!h.done;h=b.next())h=h.value,e(h)||(this.forceClearBuffer_(this.mediaStates_.get(h)),f=!0)}else b.every(this.mediaStates_.keys(),e)||(shaka.log.debug("(all): seeked: unbuffered seek: clearing all buffers"),this.mediaStates_.forEach(function(b){a.forceClearBuffer_(b)}),f=!0);f||shaka.log.debug("(all): seeked: buffered seek: presentationTime="+c)},shaka.media.StreamingEngine.prototype.forceClearBuffer_=function(a){var b=this,c=shaka.media.StreamingEngine.logPrefix_(a);a.clearingBuffer?shaka.log.debug(c,"clear: already clearing the buffer"):a.waitingToClearBuffer?shaka.log.debug(c,"clear: already waiting"):a.performingUpdate?(shaka.log.debug(c,"clear: currently updating"),a.waitingToClearBuffer=!0,a.clearBufferSafeMargin=0):null==this.playerInterface_.mediaSourceEngine.bufferStart(a.type)?(shaka.log.debug(c,"clear: nothing buffered"),null==a.updateTimer&&this.scheduleUpdate_(a,0)):(shaka.log.debug(c,"clear: handling right now"),this.cancelUpdate_(a),this.clearBuffer_(a,!1,0)["catch"](function(a){b.playerInterface_&&b.playerInterface_.onError(a)}))},shaka.media.StreamingEngine.prototype.initStreams_=function(a,b,c,d){var e=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function f(){var g,h,i,j,k,l,m;return $jscomp.generator.createGenerator(f,function(f){switch(f.nextAddress){case 1:return goog.asserts.assert(e.config_,"StreamingEngine configure() must be called before init()!"),g=e.playerInterface_.getPresentationTime(),h=e.findPeriodForTime_(g),i=shaka.util.ManifestParserUtils.ContentType,j=new Map,k=new Set,a&&(j.set(i.AUDIO,a),k.add(a)),b&&(j.set(i.VIDEO,b),k.add(b)),c&&(j.set(i.TEXT,c),k.add(c)),l=e.playerInterface_.mediaSourceEngine,m=e.config_.forceTransmuxTS,f["yield"](l.init(j,m),2);case 2:return e.destroyed_?f["return"]():(e.setDuration_(),f["yield"](e.setupStreams_(k),3));case 3:if(e.destroyed_)return f["return"]();j.forEach(function(a,b){if(!e.mediaStates_.has(b)){var c=e.createMediaState_(a,h,d);e.mediaStates_.set(b,c),e.scheduleUpdate_(c,0)}}),f.jumpToEnd()}})})},shaka.media.StreamingEngine.prototype.createMediaState_=function(a,b,c){return{stream:a,type:a.type,lastStream:null,lastSegmentReference:null,restoreStreamAfterTrickPlay:null,needInitSegment:!0,needPeriodIndex:b,endOfStream:!1,performingUpdate:!1,updateTimer:null,waitingToClearBuffer:!1,clearBufferSafeMargin:0,waitingToFlushBuffer:!1,clearingBuffer:!1,recovering:!1,hasError:!1,resumeAt:c||0,operation:null}},shaka.media.StreamingEngine.prototype.setupPeriod_=function(a){var b=this.canSwitchPeriod_[a];if(b)return shaka.log.debug("(all) Period "+a+" is being or has been set up"),goog.asserts.assert(b.promise,"promise must not be null"),b.promise;shaka.log.debug("(all) setting up Period "+a),b={promise:new shaka.util.PublicPromise,resolved:!1},this.canSwitchPeriod_[a]=b;for(var c=new Set,d=$jscomp.makeIterator(this.manifest_.periods[a].variants),e=d.next();!e.done;e=d.next())e=e.value,e.video&&c.add(e.video),e.video&&e.video.trickModeVideo&&c.add(e.video.trickModeVideo),e.audio&&c.add(e.audio);for(d=$jscomp.makeIterator(this.manifest_.periods[a].textStreams),e=d.next();!e.done;e=d.next())c.add(e.value);return this.setupPeriodPromise_=this.setupPeriodPromise_.then(function(){if(!this.destroyed_)return this.setupStreams_(c)}.bind(this)).then(function(){this.destroyed_||(this.canSwitchPeriod_[a].promise.resolve(),this.canSwitchPeriod_[a].resolved=!0,shaka.log.v1("(all) setup Period "+a))}.bind(this))["catch"](function(b){this.destroyed_||(this.canSwitchPeriod_[a].promise["catch"](function(){}),this.canSwitchPeriod_[a].promise.reject(),delete this.canSwitchPeriod_[a],shaka.log.warning("(all) failed to setup Period "+a),this.playerInterface_.onError(b))}.bind(this)),b.promise},shaka.media.StreamingEngine.prototype.setupStreams_=function(a){var b=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function c(){var d,e,f,g,h,i,j;return $jscomp.generator.createGenerator(c,function(c){switch(c.nextAddress){case 1:d=[];for(var k=$jscomp.makeIterator(a),l=k.next();!l.done;l=k.next())e=l.value,(f=b.canSwitchStream_.get(e.id))?(shaka.log.debug("(all) Stream "+e.id+" is being or has been set up"),d.push(f.promise)):(shaka.log.v1("(all) setting up Stream "+e.id),b.canSwitchStream_.set(e.id,{promise:new shaka.util.PublicPromise,resolved:!1}));return c.setCatchFinallyBlocks(2),c["yield"](Promise.all(d),4);case 4:if(b.destroyed_)return c["return"]();c.leaveTryBlock(3);break;case 2:if(g=c.enterCatchBlock(),b.destroyed_)return c["return"]();for(c=$jscomp.makeIterator(a),l=c.next();!l.done;l=c.next())h=l.value,b.canSwitchStream_.get(h.id).promise["catch"](function(){}),b.canSwitchStream_.get(h.id).promise.reject(),b.canSwitchStream_["delete"](h.id);throw g;case 3:for(k=$jscomp.makeIterator(a),l=k.next();!l.done;l=k.next())i=l.value,j=b.canSwitchStream_.get(i.id),j.resolved||(j.promise.resolve(),j.resolved=!0,shaka.log.v1("(all) setup Stream "+i.id));c.jumpToEnd()}})})},shaka.media.StreamingEngine.prototype.setDuration_=function(){var a=this.manifest_.presentationTimeline.getDuration();1/0>a?this.playerInterface_.mediaSourceEngine.setDuration(a):this.playerInterface_.mediaSourceEngine.setDuration(Math.pow(2,32))},shaka.media.StreamingEngine.prototype.onUpdate_=function(a){if(!this.destroyed_){var b=shaka.media.StreamingEngine.logPrefix_(a);if(goog.asserts.assert(!a.performingUpdate&&null!=a.updateTimer,b+" unexpected call to onUpdate_()"),!a.performingUpdate&&null!=a.updateTimer&&(goog.asserts.assert(!a.clearingBuffer,b+" onUpdate_() should not be called when clearing the buffer"),!a.clearingBuffer))if(a.updateTimer=null,a.waitingToClearBuffer)shaka.log.debug(b,"skipping update and clearing the buffer"),this.clearBuffer_(a,a.waitingToFlushBuffer,a.clearBufferSafeMargin);else{try{var c=this.update_(a);null!=c&&(this.scheduleUpdate_(a,c),a.hasError=!1)}catch(d){return void this.handleStreamingError_(d)}c=Array.from(this.mediaStates_.values()),this.handlePeriodTransition_(a),this.startupComplete_&&c.every(function(a){return a.endOfStream})&&(shaka.log.v1(b,"calling endOfStream()..."),this.playerInterface_.mediaSourceEngine.endOfStream().then(function(){if(!this.destroyed_){var a=this.playerInterface_.mediaSourceEngine.getDuration();0!=a&&a<this.manifest_.presentationTimeline.getDuration()&&this.manifest_.presentationTimeline.setDuration(a)}}.bind(this)))}}},shaka.media.StreamingEngine.prototype.update_=function(a){var b=this;goog.asserts.assert(this.manifest_,"manifest_ should not be null"),goog.asserts.assert(this.config_,"config_ should not be null");var c=shaka.util.ManifestParserUtils.ContentType;if(shaka.media.StreamingEngine.isEmbeddedText_(a))return this.playerInterface_.mediaSourceEngine.setSelectedClosedCaptionId(a.stream.originalId||""),null;var d=shaka.media.StreamingEngine.logPrefix_(a),e=this.playerInterface_.getPresentationTime(),f=this.getTimeNeeded_(a,e);shaka.log.v2(d,"timeNeeded="+f);var g=this.findPeriodContainingStream_(a.stream),h=this.findPeriodForTime_(f),i=this.playerInterface_.mediaSourceEngine.bufferedAheadOf(a.type,e);shaka.log.v2(d,"update_:","presentationTime="+e,"bufferedAhead="+i);var j=Math.max(this.manifest_.minBufferTime||0,this.config_.rebufferingGoal,this.config_.bufferingGoal)*this.bufferingGoalScale_;if(f>=this.manifest_.presentationTimeline.getDuration())return shaka.log.debug(d,"buffered to end of presentation"),a.endOfStream=!0,a.type==c.VIDEO&&(a=this.mediaStates_.get(c.TEXT))&&a.stream.mimeType==shaka.util.MimeUtils.CLOSED_CAPTION_MIMETYPE&&(a.endOfStream=!0),null;if(a.endOfStream=!1,a.needPeriodIndex=h,h!=g)return shaka.log.debug(d,"need Period "+h,"presentationTime="+e,"timeNeeded="+f,"currentPeriodIndex="+g),null;if(i>=j)return shaka.log.v2(d,"buffering goal met"),.5;if(c=this.playerInterface_.mediaSourceEngine.bufferEnd(a.type),c=this.getSegmentReferenceNeeded_(a,e,c,g),!c)return 1;var k=1/0;return Array.from(this.mediaStates_.values()).forEach(function(a){shaka.media.StreamingEngine.isEmbeddedText_(a)||(a=b.getTimeNeeded_(a,e),k=Math.min(k,a))}),d=this.manifest_.presentationTimeline.getMaxSegmentDuration()*shaka.media.StreamingEngine.MAX_RUN_AHEAD_SEGMENTS_,f>=k+d?1:(a.resumeAt=0,this.fetchAndAppend_(a,e,g,c),null)},shaka.media.StreamingEngine.prototype.getTimeNeeded_=function(a,b){if(!a.lastStream||!a.lastSegmentReference)return Math.max(b,a.resumeAt);var c=this.findPeriodContainingStream_(a.lastStream);return this.manifest_.periods[c].startTime+a.lastSegmentReference.endTime},shaka.media.StreamingEngine.prototype.getSegmentReferenceNeeded_=function(a,b,c,d){var e=shaka.media.StreamingEngine.logPrefix_(a);return a.lastSegmentReference&&a.stream==a.lastStream?(c=a.lastSegmentReference.position+1,shaka.log.v2(e,"next position known:","position="+c),this.getSegmentReferenceIfAvailable_(a,d,c)):(a.lastSegmentReference?(goog.asserts.assert(a.lastStream,"lastStream should not be null"),shaka.log.v1(e,"next position unknown: another Stream buffered"),e=this.findPeriodContainingStream_(a.lastStream),e=this.lookupSegmentPosition_(a,this.manifest_.periods[e].startTime+a.lastSegmentReference.endTime,d)):(goog.asserts.assert(!a.lastStream,"lastStream should be null"),shaka.log.v1(e,"next position unknown: nothing buffered"),e=this.lookupSegmentPosition_(a,c||b,d)),null==e?null:(b=null,null==c&&(b=this.getSegmentReferenceIfAvailable_(a,d,Math.max(0,e-1))),b||this.getSegmentReferenceIfAvailable_(a,d,e)))},shaka.media.StreamingEngine.prototype.lookupSegmentPosition_=function(a,b,c){var d=shaka.media.StreamingEngine.logPrefix_(a);return c=this.manifest_.periods[c],shaka.log.debug(d,"looking up segment:","presentationTime="+b,"currentPeriod.startTime="+c.startTime),b=Math.max(0,b-c.startTime),a=a.stream.findSegmentPosition(b),null==a&&shaka.log.warning(d,"cannot find segment:","currentPeriod.startTime="+c.startTime,"lookupTime="+b),a},shaka.media.StreamingEngine.prototype.getSegmentReferenceIfAvailable_=function(a,b,c){var d=shaka.media.StreamingEngine.logPrefix_(a);if(b=this.manifest_.periods[b],a=a.stream.getSegmentReference(c),!a)return shaka.log.v1(d,"segment does not exist:","currentPeriod.startTime="+b.startTime,"position="+c),null;var e=this.manifest_.presentationTimeline;return c=e.getSegmentAvailabilityStart(),e=e.getSegmentAvailabilityEnd(),b.startTime+a.endTime<c||b.startTime+a.startTime>e?(shaka.log.v2(d,"segment is not available:","currentPeriod.startTime="+b.startTime,"reference.startTime="+a.startTime,"reference.endTime="+a.endTime,"availabilityStart="+c,"availabilityEnd="+e),null):a},shaka.media.StreamingEngine.prototype.fetchAndAppend_=function(a,b,c,d){var e=shaka.util.ManifestParserUtils.ContentType,f=shaka.media.StreamingEngine,g=f.logPrefix_(a),h=this.manifest_.periods[c];shaka.log.v1(g,"fetchAndAppend_:","presentationTime="+b,"currentPeriod.startTime="+h.startTime,"reference.position="+d.position,"reference.startTime="+d.startTime,"reference.endTime="+d.endTime);var i=a.stream,j=this.manifest_.presentationTimeline.getDuration(),k=this.manifest_.periods[c+1],l=Math.max(0,h.startTime-f.APPEND_WINDOW_START_FUDGE_);f=k?k.startTime+f.APPEND_WINDOW_END_FUDGE_:j,goog.asserts.assert(d.startTime<=f,g+" segment should start before append window end"),c=this.initSourceBuffer_(a,c,l,f),a.performingUpdate=!0,a.needInitSegment=!1,shaka.log.v2(g,"fetching segment"),l=this.fetch_(a,d),Promise.all([c,l]).then(function(c){if(!this.destroyed_&&!this.fatalError_)return this.append_(a,b,h,i,d,c[1])}.bind(this)).then(function(){this.destroyed_||this.fatalError_||(a.performingUpdate=!1,a.recovering=!1,a.waitingToClearBuffer||this.playerInterface_.onSegmentAppended(),this.scheduleUpdate_(a,0),this.handleStartup_(a,i),shaka.log.v1(g,"finished fetch and append"))}.bind(this))["catch"](function(b){
this.destroyed_||this.fatalError_||(goog.asserts.assert(b instanceof shaka.util.Error,"Should only receive a Shaka error"),a.performingUpdate=!1,a.type==e.TEXT&&this.config_.ignoreTextStreamFailures?(b.code==shaka.util.Error.Code.BAD_HTTP_STATUS?shaka.log.warning(g,"Text stream failed to download. Proceeding without it."):shaka.log.warning(g,"Text stream failed to parse. Proceeding without it."),this.mediaStates_["delete"](e.TEXT)):b.code==shaka.util.Error.Code.OPERATION_ABORTED?(a.performingUpdate=!1,a.updateTimer=null,this.scheduleUpdate_(a,0)):b.code==shaka.util.Error.Code.QUOTA_EXCEEDED_ERROR?this.handleQuotaExceeded_(a,b):(shaka.log.error(g,"failed fetch and append: code="+b.code),a.hasError=!0,b.severity=shaka.util.Error.Severity.CRITICAL,this.handleStreamingError_(b)))}.bind(this))},shaka.media.StreamingEngine.prototype.retry=function(){if(this.destroyed_)return shaka.log.error("Unable to retry after StreamingEngine is destroyed!"),!1;if(this.fatalError_)return shaka.log.error("Unable to retry after StreamingEngine encountered a fatal error!"),!1;for(var a=$jscomp.makeIterator(this.mediaStates_.values()),b=a.next();!b.done;b=a.next()){b=b.value;var c=shaka.media.StreamingEngine.logPrefix_(b);b.hasError&&(shaka.log.info(c,"Retrying after failure..."),b.hasError=!1,this.scheduleUpdate_(b,.1))}return!0},shaka.media.StreamingEngine.prototype.handleQuotaExceeded_=function(a,b){var c=shaka.media.StreamingEngine.logPrefix_(a);if(Array.from(this.mediaStates_.values()).some(function(b){return b!=a&&b.recovering}))shaka.log.debug(c,"MediaSource threw QuotaExceededError:","waiting for another stream to recover...");else{var d=Math.round(100*this.bufferingGoalScale_);if(20<d)this.bufferingGoalScale_-=.2;else{if(!(4<d))return shaka.log.error(c,"MediaSource threw QuotaExceededError too many times"),this.fatalError_=a.hasError=!0,void this.playerInterface_.onError(b);this.bufferingGoalScale_-=.04}shaka.log.warning(c,"MediaSource threw QuotaExceededError:","reducing buffering goals by "+(100-Math.round(100*this.bufferingGoalScale_))+"%"),a.recovering=!0}this.scheduleUpdate_(a,4)},shaka.media.StreamingEngine.prototype.initSourceBuffer_=function(a,b,c,d){if(!a.needInitSegment)return Promise.resolve();var e=shaka.media.StreamingEngine.logPrefix_(a);return b=this.manifest_.periods[b].startTime-a.stream.presentationTimeOffset,shaka.log.v1(e,"setting timestamp offset to "+b),shaka.log.v1(e,"setting append window start to "+c),shaka.log.v1(e,"setting append window end to "+d),c=this.playerInterface_.mediaSourceEngine.setStreamProperties(a.type,b,c,d),a.stream.initSegmentReference?(shaka.log.v1(e,"fetching init segment"),d=this.fetch_(a,a.stream.initSegmentReference).then(function(b){if(!this.destroyed_)return shaka.log.v1(e,"appending init segment"),this.playerInterface_.mediaSourceEngine.appendBuffer(a.type,b,null,null,a.stream.closedCaptions&&0<a.stream.closedCaptions.size)}.bind(this))["catch"](function(b){return a.needInitSegment=!0,Promise.reject(b)}),Promise.all([c,d])):c},shaka.media.StreamingEngine.prototype.append_=function(a,b,c,d,e,f){var g=shaka.media.StreamingEngine.logPrefix_(a),h=d.closedCaptions&&0<d.closedCaptions.size;return null!=d.emsgSchemeIdUris&&0<d.emsgSchemeIdUris.length&&(new shaka.util.Mp4Parser).fullBox("emsg",this.parseEMSG_.bind(this,c,e,d.emsgSchemeIdUris)).parse(f),this.evict_(a,b).then(function(){if(!this.destroyed_)return shaka.log.v1(g,"appending media segment"),this.playerInterface_.mediaSourceEngine.appendBuffer(a.type,f,e.startTime+c.startTime,e.endTime+c.startTime,h)}.bind(this)).then(function(){if(!this.destroyed_)return shaka.log.v2(g,"appended media segment"),a.lastStream=d,a.lastSegmentReference=e,Promise.resolve()}.bind(this))},shaka.media.StreamingEngine.prototype.parseEMSG_=function(a,b,c,d){var e=d.reader.readTerminatedString(),f=d.reader.readTerminatedString(),g=d.reader.readUint32(),h=d.reader.readUint32(),i=d.reader.readUint32(),j=d.reader.readUint32();d=d.reader.readBytes(d.reader.getLength()-d.reader.getPosition()),a=a.startTime+b.startTime+h/g,c.includes(e)&&("urn:mpeg:dash:event:2012"==e?this.playerInterface_.onManifestUpdate():(c=new shaka.util.FakeEvent("emsg",{detail:{startTime:a,endTime:a+i/g,schemeIdUri:e,value:f,timescale:g,presentationTimeDelta:h,eventDuration:i,id:j,messageData:d}}),this.playerInterface_.onEvent(c)))},shaka.media.StreamingEngine.prototype.evict_=function(a,b){var c=shaka.media.StreamingEngine.logPrefix_(a);shaka.log.v2(c,"checking buffer length");var d=Math.max(this.config_.bufferBehind,this.manifest_.presentationTimeline.getMaxSegmentDuration()),e=this.playerInterface_.mediaSourceEngine.bufferStart(a.type);if(null==e)return shaka.log.v2(c,"buffer behind okay because nothing buffered:","presentationTime="+b,"bufferBehind="+d),Promise.resolve();var f=b-e,g=f-d;return 0>=g?(shaka.log.v2(c,"buffer behind okay:","presentationTime="+b,"bufferedBehind="+f,"bufferBehind="+d,"underflow="+-g),Promise.resolve()):(shaka.log.v1(c,"buffer behind too large:","presentationTime="+b,"bufferedBehind="+f,"bufferBehind="+d,"overflow="+g),this.playerInterface_.mediaSourceEngine.remove(a.type,e,e+g).then(function(){this.destroyed_||shaka.log.v1(c,"evicted "+g+" seconds")}.bind(this)))},shaka.media.StreamingEngine.prototype.handleStartup_=function(a,b){var c=shaka.util.Functional,d=shaka.util.ManifestParserUtils.ContentType;if(!this.startupComplete_){var e=shaka.media.StreamingEngine.logPrefix_(a),f=Array.from(this.mediaStates_.values());if(1==f.length&&f[0].type==d.TEXT||(this.startupComplete_=f.every(function(a){return a.type==d.TEXT||!a.waitingToClearBuffer&&!a.clearingBuffer&&a.lastSegmentReference})),this.startupComplete_){shaka.log.debug(e,"startup complete");var g=this.findPeriodContainingStream_(b);for(goog.asserts.assert(f.every(function(a){return a.needPeriodIndex==g||a.needPeriodIndex==g+1}),e+" expected all MediaStates to need same Period"),this.canSwitchPeriod_[g]||this.setupPeriod_(g).then(function(){this.destroyed_||(shaka.log.v1(e,"calling onCanSwitch()..."),this.playerInterface_.onCanSwitch())}.bind(this))["catch"](c.noop),f=0;f<this.manifest_.periods.length;++f)this.setupPeriod_(f)["catch"](c.noop);this.playerInterface_.onStartupComplete&&(shaka.log.v1(e,"calling onStartupComplete()..."),this.playerInterface_.onStartupComplete())}}},shaka.media.StreamingEngine.prototype.handlePeriodTransition_=function(a){var b=shaka.util.Functional,c=shaka.media.StreamingEngine.logPrefix_(a),d=shaka.util.ManifestParserUtils.ContentType,e=this.findPeriodContainingStream_(a.stream);if(a.needPeriodIndex!=e){var f=a.needPeriodIndex,g=Array.from(this.mediaStates_.values());goog.asserts.assert(g.every(function(a){return a.needPeriodIndex==f||a.hasError||!shaka.media.StreamingEngine.isIdle_(a)||shaka.media.StreamingEngine.isEmbeddedText_(a)}),"All MediaStates should need the same Period or be performing updates."),g.every(function(a){return a.needPeriodIndex==f||shaka.media.StreamingEngine.isEmbeddedText_(a)})?g.every(shaka.media.StreamingEngine.isIdle_)?(shaka.log.debug(c,"all need Period "+f),this.setupPeriod_(f).then(function(){if(!this.destroyed_)if(g.every(function(a){var b=shaka.media.StreamingEngine.isIdle_(a),c=this.findPeriodContainingStream_(a.stream);return!!shaka.media.StreamingEngine.isEmbeddedText_(a)||b&&a.needPeriodIndex==f&&c!=f}.bind(this))){var a=this.manifest_.periods[f];shaka.log.v1(c,"calling onChooseStreams()...");var b=this.playerInterface_.onChooseStreams(a),e=new Map;b.variant&&b.variant.video&&e.set(d.VIDEO,b.variant.video),b.variant&&b.variant.audio&&e.set(d.AUDIO,b.variant.audio),b.text&&e.set(d.TEXT,b.text);var h=$jscomp.makeIterator(this.mediaStates_.keys());for(b=h.next();!b.done;b=h.next())if(b=b.value,!e.has(b)&&b!=d.TEXT)return shaka.log.error(c,"invalid Streams chosen: missing "+b+" Stream"),void this.playerInterface_.onError(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STREAMING,shaka.util.Error.Code.INVALID_STREAMS_CHOSEN));for(h=$jscomp.makeIterator(Array.from(e.keys())),b=h.next();!b.done;b=h.next())if(b=b.value,!this.mediaStates_.has(b)){if(b!=d.TEXT)return shaka.log.error(c,"invalid Streams chosen: unusable "+b+" Stream"),void this.playerInterface_.onError(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STREAMING,shaka.util.Error.Code.INVALID_STREAMS_CHOSEN));this.initStreams_(null,null,e.get(d.TEXT),a.startTime),e["delete"](b)}for(a=$jscomp.makeIterator(Array.from(this.mediaStates_.keys())),b=a.next();!b.done;b=a.next())b=b.value,(h=e.get(b))?(this.switchInternal_(h,!1,0,!1),this.scheduleUpdate_(this.mediaStates_.get(b),0)):(goog.asserts.assert(b==d.TEXT,"Invalid streams chosen"),this.mediaStates_["delete"](b));shaka.log.v1(c,"calling onCanSwitch()..."),this.playerInterface_.onCanSwitch()}else shaka.log.debug(c,"ignoring transition to Period",f,"since another is happening")}.bind(this))["catch"](b.noop)):shaka.log.debug(c,"all MediaStates need Period "+f+", but not all MediaStates are idle"):shaka.log.debug(c,"not all MediaStates need Period "+f)}},shaka.media.StreamingEngine.isEmbeddedText_=function(a){var b=shaka.util.MimeUtils;return a.type==shaka.util.ManifestParserUtils.ContentType.TEXT&&a.stream.mimeType==b.CLOSED_CAPTION_MIMETYPE},shaka.media.StreamingEngine.isIdle_=function(a){return!a.performingUpdate&&null==a.updateTimer&&!a.waitingToClearBuffer&&!a.clearingBuffer},shaka.media.StreamingEngine.prototype.findPeriodForTime_=function(a){return(a=shaka.util.Periods.findPeriodForTime(this.manifest_.periods,a+shaka.util.ManifestParserUtils.GAP_OVERLAP_TOLERANCE_SECONDS))?this.manifest_.periods.indexOf(a):0},shaka.media.StreamingEngine.prototype.findPeriodContainingStream_=function(a){goog.asserts.assert(this.manifest_,"Must have a manifest to find a stream.");for(var b=this.manifest_.periods,c=0;c<b.length;c++){for(var d=b[c],e=new Set,f=$jscomp.makeIterator(d.variants),g=f.next();!g.done;g=f.next())g=g.value,g.audio&&e.add(g.audio),g.video&&e.add(g.video),g.video&&g.video.trickModeVideo&&e.add(g.video.trickModeVideo);for(d=$jscomp.makeIterator(d.textStreams),f=d.next();!f.done;f=d.next())e.add(f.value);if(e.has(a))return c}return-1},shaka.media.StreamingEngine.prototype.fetch_=function(a,b){var c=shaka.net.NetworkingEngine.RequestType.SEGMENT,d=shaka.util.Networking.createSegmentRequest(b.getUris(),b.startByte,b.endByte,this.config_.retryParameters);return shaka.log.v2("fetching: reference=",b),c=this.playerInterface_.netEngine.request(c,d),a.operation=c,c.promise.then(function(b){return a.operation=null,b.data})},shaka.media.StreamingEngine.prototype.clearBuffer_=function(a,b,c){var d=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function e(){var f,g,h,i;return $jscomp.generator.createGenerator(e,function(e){switch(e.nextAddress){case 1:return f=shaka.media.StreamingEngine.logPrefix_(a),goog.asserts.assert(!a.performingUpdate&&null==a.updateTimer,f+" unexpected call to clearBuffer_()"),a.waitingToClearBuffer=!1,a.waitingToFlushBuffer=!1,a.clearBufferSafeMargin=0,a.clearingBuffer=!0,shaka.log.debug(f,"clearing buffer"),c?(h=d.playerInterface_.getPresentationTime(),i=d.playerInterface_.mediaSourceEngine.getDuration(),g=d.playerInterface_.mediaSourceEngine.remove(a.type,h+c,i)):g=d.playerInterface_.mediaSourceEngine.clear(a.type).then(function(){if(!this.destroyed_&&b)return this.playerInterface_.mediaSourceEngine.flush(a.type)}.bind(d)),e["yield"](g,2);case 2:if(d.destroyed_)return e["return"]();shaka.log.debug(f,"cleared buffer"),a.lastStream=null,a.lastSegmentReference=null,a.clearingBuffer=!1,a.endOfStream=!1,d.scheduleUpdate_(a,0),e.jumpToEnd()}})})},shaka.media.StreamingEngine.prototype.scheduleUpdate_=function(a,b){var c=this,d=shaka.media.StreamingEngine.logPrefix_(a);shaka.log.v2(d,"updating in "+b+" seconds"),goog.asserts.assert(null==a.updateTimer,d+" did not expect update to be scheduled"),a.updateTimer=new shaka.util.DelayedTick(function(){return $jscomp.asyncExecutePromiseGeneratorFunction(function b(){var d;return $jscomp.generator.createGenerator(b,function(b){switch(b.nextAddress){case 1:return b.setCatchFinallyBlocks(2),b["yield"](c.onUpdate_(a),4);case 4:b.leaveTryBlock(0);break;case 2:d=b.enterCatchBlock(),c.playerInterface_&&c.playerInterface_.onError(d),b.jumpToEnd()}})})}).tickAfter(b)},shaka.media.StreamingEngine.prototype.cancelUpdate_=function(a){null!=a.updateTimer&&(a.updateTimer.stop(),a.updateTimer=null)},shaka.media.StreamingEngine.prototype.handleStreamingError_=function(a){this.failureCallbackBackoff_.attempt().then(function(){this.destroyed_||(this.playerInterface_.onError(a),a.handled||this.config_.failureCallback(a))}.bind(this))},shaka.media.StreamingEngine.logPrefix_=function(a){return"("+a.type+":"+a.stream.id+")"},shaka.media.StreamingEngine.prototype.getActiveAudio=function(){return this.getStream_(shaka.util.ManifestParserUtils.ContentType.AUDIO)},shaka.media.StreamingEngine.prototype.getActiveVideo=function(){return this.getStream_(shaka.util.ManifestParserUtils.ContentType.VIDEO)},shaka.net.HttpPluginUtils={},shaka.net.HttpPluginUtils.makeResponse=function(a,b,c,d,e,f){if(200<=c&&299>=c&&202!=c)return{uri:e||d,originalUri:d,data:b,headers:a,fromCache:!!a["x-shaka-from-cache"]};e=null;try{e=shaka.util.StringUtils.fromBytesAutoDetect(b)}catch(g){}throw shaka.log.debug("HTTP error text:",e),new shaka.util.Error(401==c||403==c?shaka.util.Error.Severity.CRITICAL:shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.BAD_HTTP_STATUS,d,c,e,a,f)},shaka.net.HttpFetchPlugin=function(a,b,c,d){var e=new shaka.net.HttpFetchPlugin.Headers_;shaka.util.MapUtils.asMap(b.headers).forEach(function(a,b){e.append(b,a)});var f=new shaka.net.HttpFetchPlugin.AbortController_,g={canceled:!1,timedOut:!1};if(a=shaka.net.HttpFetchPlugin.request_(a,c,{body:b.body||void 0,headers:e,method:b.method,signal:f.signal,credentials:b.allowCrossSiteCredentials?"include":void 0},g,d),a=new shaka.util.AbortableOperation(a,function(){return g.canceled=!0,f.abort(),Promise.resolve()}),b=b.retryParameters.timeout){var h=new shaka.util.Timer(function(){g.timedOut=!0,f.abort()});h.tickAfter(b/1e3),a["finally"](function(){h.stop()})}return a},goog.exportSymbol("shaka.net.HttpFetchPlugin",shaka.net.HttpFetchPlugin),shaka.net.HttpFetchPlugin.request_=function(a,b,c,d,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function f(){var g,h,i,j,k,l,m,n,o,p,q,r,s,t;return $jscomp.generator.createGenerator(f,function(f){switch(f.nextAddress){case 1:return g=shaka.net.HttpFetchPlugin.fetch_,h=shaka.net.HttpFetchPlugin.ReadableStream_,l=k=0,m=Date.now(),f.setCatchFinallyBlocks(2),f["yield"](g(a,c),4);case 4:return i=f.yieldResult,n=i.clone().body.getReader(),p=(o=i.headers.get("Content-Length"))?parseInt(o,10):0,q=function(a){var b=function(){return $jscomp.asyncExecutePromiseGeneratorFunction(function c(){var d,f,g;return $jscomp.generator.createGenerator(c,function(c){switch(c.nextAddress){case 1:return c.setCatchFinallyBlocks(2),c["yield"](n.read(),4);case 4:d=c.yieldResult,c.leaveTryBlock(3);break;case 2:return f=c.enterCatchBlock(),shaka.log.v1("error reading from stream",f.message),c["return"]();case 3:d.done||(k+=d.value.byteLength),g=Date.now(),(100<g-m||d.done)&&(e(g-m,k-l,p-k),l=k,m=g),d.done?(goog.asserts.assert(!d.value,'readObj should be unset when "done" is true.'),a.close()):(a.enqueue(d.value),b()),c.jumpToEnd()}})})};b()},new h({start:q}),f["yield"](i.arrayBuffer(),5);case 5:j=f.yieldResult,f.leaveTryBlock(3);break;case 2:if(r=f.enterCatchBlock(),d.canceled)throw new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.OPERATION_ABORTED,a,b);if(d.timedOut)throw new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.TIMEOUT,a,b);throw new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.HTTP_ERROR,a,r,b);case 3:return s={},t=i.headers,t.forEach(function(a,b){s[b.trim()]=a}),f["return"](shaka.net.HttpPluginUtils.makeResponse(s,j,i.status,a,i.url,b))}})})},shaka.net.HttpFetchPlugin.isSupported=function(){if(!window.ReadableStream)return!1;try{new ReadableStream({})}catch(a){return!1}return!(!window.fetch||!window.AbortController)},goog.exportProperty(shaka.net.HttpFetchPlugin,"isSupported",shaka.net.HttpFetchPlugin.isSupported),shaka.net.HttpFetchPlugin.fetch_=window.fetch,shaka.net.HttpFetchPlugin.AbortController_=window.AbortController,shaka.net.HttpFetchPlugin.ReadableStream_=window.ReadableStream,shaka.net.HttpFetchPlugin.Headers_=window.Headers,shaka.net.HttpFetchPlugin.isSupported()&&(shaka.net.NetworkingEngine.registerScheme("http",shaka.net.HttpFetchPlugin,shaka.net.NetworkingEngine.PluginPriority.PREFERRED),shaka.net.NetworkingEngine.registerScheme("https",shaka.net.HttpFetchPlugin,shaka.net.NetworkingEngine.PluginPriority.PREFERRED)),shaka.net.HttpXHRPlugin=function(a,b,c,d){var e=new shaka.net.HttpXHRPlugin.Xhr_,f=Date.now(),g=0,h=null,i=b.retryParameters.stallTimeout,j=new Promise(function(j,k){e.open(b.method,a,!0),e.responseType="arraybuffer",e.timeout=b.retryParameters.timeout,e.withCredentials=b.allowCrossSiteCredentials,e.stallTimer=null,0<i&&(shaka.log.info("Creating network stall timer: with timeout:"+i),h=new shaka.util.Timer(function(){shaka.log.info("Network stallTimeout"),e.abort(),k(new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.TIMEOUT,a,c))})),e.onabort=function(){h&&(h.stop(),h=null),k(new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.OPERATION_ABORTED,a,c))},e.onload=function(b){h&&h.stop(),b=b.target,goog.asserts.assert(b,"XHR onload has no target!");var d=b.getAllResponseHeaders().trim().split("\r\n"),e={};d=$jscomp.makeIterator(d);for(var f=d.next();!f.done;f=d.next())f=f.value.split(": "),e[f[0].toLowerCase()]=f.slice(1).join(": ");try{var g=shaka.net.HttpPluginUtils.makeResponse(e,b.response,b.status,a,b.responseURL,c);j(g)}catch(i){goog.asserts.assert(i instanceof shaka.util.Error,"Wrong error type!"),k(i)}},e.onerror=function(b){h&&(h.stop(),h=null),k(new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.HTTP_ERROR,a,b,c))},e.ontimeout=function(b){h&&(h.stop(),h=null),k(new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.TIMEOUT,a,c))},e.onprogress=function(a){h&&h.tickAfter(i);var b=Date.now();(100<b-f||a.lengthComputable&&a.loaded==a.total)&&(d(b-f,a.loaded-g,a.total-a.loaded),g=a.loaded,f=b)};for(var l in b.headers){var m=l.toLowerCase();e.setRequestHeader(m,b.headers[l])}e.send(b.body),h&&h.tickAfter(i)});return new shaka.util.AbortableOperation(j,function(){return e.abort(),Promise.resolve()})},goog.exportSymbol("shaka.net.HttpXHRPlugin",shaka.net.HttpXHRPlugin),shaka.net.HttpXHRPlugin.Xhr_=window.XMLHttpRequest,shaka.net.NetworkingEngine.registerScheme("http",shaka.net.HttpXHRPlugin,shaka.net.NetworkingEngine.PluginPriority.FALLBACK),shaka.net.NetworkingEngine.registerScheme("https",shaka.net.HttpXHRPlugin,shaka.net.NetworkingEngine.PluginPriority.FALLBACK),shaka.offline={},shaka.offline.DownloadProgressEstimator=function(){this.actualDownloaded_=this.estimatedDownloaded_=this.estimatedTotal_=0,this.pending_=new Map,this.nextId_=0},shaka.offline.DownloadProgressEstimator.prototype.open=function(a){this.estimatedTotal_+=a;var b=this.nextId_;return this.nextId_++,this.pending_.set(b,a),b},shaka.offline.DownloadProgressEstimator.prototype.close=function(a,b){if(this.pending_.has(a)){var c=this.pending_.get(a);this.pending_["delete"](a),this.estimatedDownloaded_+=c,this.actualDownloaded_+=b}},shaka.offline.DownloadProgressEstimator.prototype.getEstimatedProgress=function(){return 0==this.estimatedTotal_?0:this.estimatedDownloaded_/this.estimatedTotal_},shaka.offline.DownloadProgressEstimator.prototype.getTotalDownloaded=function(){return this.actualDownloaded_},shaka.offline.DownloadManager=function(a,b){this.networkingEngine_=a,this.groups_=new Map,this.destroyed_=!1,this.onProgress_=b,this.estimator_=new shaka.offline.DownloadProgressEstimator},shaka.offline.DownloadManager.prototype.destroy=function(){return this.destroyed_=!0,Promise.all(this.groups_.values()).then(function(){},function(){})},shaka.offline.DownloadManager.prototype.queue=function(a,b,c,d){var e=this;goog.asserts.assert(!this.destroyed_,"Do not call |queue| after |destroy|");var f=this.estimator_.open(c);c=this.groups_.get(a)||Promise.resolve(),this.groups_.set(a,c.then(function(){return $jscomp.asyncExecutePromiseGeneratorFunction(function a(){var c;return $jscomp.generator.createGenerator(a,function(a){switch(a.nextAddress){case 1:return a["yield"](e.fetchSegment_(b),2);case 2:if(c=a.yieldResult,e.destroyed_)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.OPERATION_ABORTED);return e.estimator_.close(f,c.byteLength),e.onProgress_(e.estimator_.getEstimatedProgress(),e.estimator_.getTotalDownloaded()),a["return"](d(c))}})})}))},shaka.offline.DownloadManager.prototype.waitToFinish=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function b(){return $jscomp.generator.createGenerator(b,function(b){switch(b.nextAddress){case 1:return b["yield"](Promise.all(a.groups_.values()),2);case 2:return b["return"](a.estimator_.getTotalDownloaded())}})})},shaka.offline.DownloadManager.prototype.fetchSegment_=function(a){var b=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function c(){var d,e,f;return $jscomp.generator.createGenerator(c,function(c){switch(c.nextAddress){case 1:return d=shaka.net.NetworkingEngine.RequestType.SEGMENT,e=b.networkingEngine_.request(d,a),c["yield"](e.promise,2);case 2:return f=c.yieldResult,goog.asserts.assert(f.data,"Response data should be non-null!"),c["return"](f.data)}})})},shaka.offline.indexeddb={},shaka.offline.indexeddb.DBOperation=function(a,b){var c=this;this.transaction_=a,this.store_=a.objectStore(b),this.promise_=new shaka.util.PublicPromise,a.onabort=function(a){a.preventDefault(),c.promise_.reject()},a.onerror=function(a){a.preventDefault(),c.promise_.reject()},a.oncomplete=function(a){c.promise_.resolve()}},shaka.offline.indexeddb.DBOperation.prototype.abort=function(){try{this.transaction_.abort()}catch(a){}return this.promise_["catch"](function(){})},shaka.offline.indexeddb.DBOperation.prototype.forEachEntry=function(a){var b=this;return new Promise(function(c,d){var e=b.store_.openCursor();e.onerror=d,e.onsuccess=function(b){return(b=b.target.result)?(a(b.key,b.value,b),void b["continue"]()):c()}})},shaka.offline.indexeddb.DBOperation.prototype.store=function(){return this.store_},shaka.offline.indexeddb.DBOperation.prototype.promise=function(){return this.promise_},shaka.offline.indexeddb.DBConnection=function(a){this.connection_=a,this.pending_=[]},shaka.offline.indexeddb.DBConnection.prototype.destroy=function(){return Promise.all(this.pending_.map(function(a){return a.abort()}))},shaka.offline.indexeddb.DBConnection.prototype.startReadOnlyOperation=function(a){return this.startOperation_(a,"readonly")},shaka.offline.indexeddb.DBConnection.prototype.startReadWriteOperation=function(a){return this.startOperation_(a,"readwrite")},shaka.offline.indexeddb.DBConnection.prototype.startOperation_=function(a,b){var c=this,d=this.connection_.transaction([a],b),e=new shaka.offline.indexeddb.DBOperation(d,a);return this.pending_.push(e),e.promise().then(function(){return c.stopTracking_(e)},function(){return c.stopTracking_(e)}),e},shaka.offline.indexeddb.DBConnection.prototype.stopTracking_=function(a){shaka.util.ArrayUtils.remove(this.pending_,a)},shaka.offline.indexeddb.EmeSessionStorageCell=function(a,b){this.connection_=new shaka.offline.indexeddb.DBConnection(a),this.store_=b},shaka.offline.indexeddb.EmeSessionStorageCell.prototype.destroy=function(){return this.connection_.destroy()},shaka.offline.indexeddb.EmeSessionStorageCell.prototype.getAll=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function b(){var c,d;return $jscomp.generator.createGenerator(b,function(b){switch(b.nextAddress){case 1:return c=a.connection_.startReadOnlyOperation(a.store_),d=[],b["yield"](c.forEachEntry(function(a,b){d.push(b)}),2);case 2:return b["yield"](c.promise(),3);case 3:return b["return"](d)}})})},shaka.offline.indexeddb.EmeSessionStorageCell.prototype.add=function(a){var b=this.connection_.startReadWriteOperation(this.store_),c=b.store();a=$jscomp.makeIterator(a);for(var d=a.next();!d.done;d=a.next())c.add(d.value);return b.promise()},shaka.offline.indexeddb.EmeSessionStorageCell.prototype.remove=function(a){var b=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function c(){var d;return $jscomp.generator.createGenerator(c,function(c){switch(c.nextAddress){case 1:return d=b.connection_.startReadWriteOperation(b.store_),c["yield"](d.forEachEntry(function(b,c,d){0<=a.indexOf(c.sessionId)&&d["delete"]()}),2);case 2:return c["yield"](d.promise(),0)}})})},shaka.offline.StorageMuxer=function(){this.mechanisms_=new Map},shaka.offline.StorageMuxer.prototype.destroy=function(){for(var a=[],b=$jscomp.makeIterator(this.mechanisms_.values()),c=b.next();!c.done;c=b.next())a.push(c.value.destroy());return this.mechanisms_.clear(),Promise.all(a)},shaka.offline.StorageMuxer.prototype.init=function(){var a=this;shaka.offline.StorageMuxer.getRegistry_().forEach(function(b,c){var d=b();d?a.mechanisms_.set(c,d):shaka.log.info("Skipping "+c+" as it is not supported on this platform")});for(var b=[],c=$jscomp.makeIterator(this.mechanisms_.values()),d=c.next();!d.done;d=c.next())b.push(d.value.init());return Promise.all(b)},shaka.offline.StorageMuxer.prototype.getActive=function(){var a=null;if(this.mechanisms_.forEach(function(b,c){b.getCells().forEach(function(b,d){b.hasFixedKeySpace()||a||(a={path:{mechanism:c,cell:d},cell:b})})}),a)return a;throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.MISSING_STORAGE_CELL,"Could not find a cell that supports add-operations")},shaka.offline.StorageMuxer.prototype.forEachCell=function(a){this.mechanisms_.forEach(function(b,c){b.getCells().forEach(function(b,d){a({mechanism:c,cell:d},b)})})},shaka.offline.StorageMuxer.prototype.getCell=function(a,b){var c=this.mechanisms_.get(a);if(!c)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.MISSING_STORAGE_CELL,"Could not find mechanism with name "+a);if(c=c.getCells().get(b),!c)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.MISSING_STORAGE_CELL,"Could not find cell with name "+b);return c},shaka.offline.StorageMuxer.prototype.forEachEmeSessionCell=function(a){this.mechanisms_.forEach(function(b){a(b.getEmeSessionCell())})},shaka.offline.StorageMuxer.prototype.getEmeSessionCell=function(){var a=Array.from(this.mechanisms_.keys());if(!a.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.STORAGE_NOT_SUPPORTED,"No supported storage mechanisms found");return this.mechanisms_.get(a[0]).getEmeSessionCell()},shaka.offline.StorageMuxer.prototype.resolvePath=function(a){var b=this.mechanisms_.get(a.mechanism);return b?b.getCells().get(a.cell):null},shaka.offline.StorageMuxer.prototype.erase=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function b(){var c,d,e;return $jscomp.generator.createGenerator(b,function(b){switch(b.nextAddress){case 1:return c=Array.from(a.mechanisms_.values()),d=0<c.length,d||(e=shaka.offline.StorageMuxer.getRegistry_(),e.forEach(function(a,b){var d=a();d&&c.push(d)})),b["yield"](Promise.all(c.map(function(a){return a.erase()})),2);case 2:if(!d)return b["yield"](Promise.all(c.map(function(a){return a.destroy()})),0);b.jumpTo(0)}})})},shaka.offline.StorageMuxer.register=function(a,b){shaka.offline.StorageMuxer.registry_.set(a,b)},goog.exportSymbol("shaka.offline.StorageMuxer.register",shaka.offline.StorageMuxer.register),shaka.offline.StorageMuxer.unregister=function(a){shaka.offline.StorageMuxer.registry_["delete"](a)},goog.exportSymbol("shaka.offline.StorageMuxer.unregister",shaka.offline.StorageMuxer.unregister),shaka.offline.StorageMuxer.support=function(){var a=shaka.offline.StorageMuxer.getRegistry_();a=$jscomp.makeIterator(a.values());for(var b=a.next();!b.done;b=a.next())if(b=b.value,b=b())return b.destroy(),!0;return!1},shaka.offline.StorageMuxer.overrideSupport=function(a){shaka.offline.StorageMuxer.override_=a},shaka.offline.StorageMuxer.clearOverride=function(){shaka.offline.StorageMuxer.override_=null},shaka.offline.StorageMuxer.getRegistry_=function(){var a=shaka.offline.StorageMuxer.override_,b=shaka.offline.StorageMuxer.registry_;return COMPILED?b:a||b},shaka.offline.StorageMuxer.override_=null,shaka.offline.StorageMuxer.registry_=new Map,shaka.offline.indexeddb.V1StorageCell=function(a,b,c){this.connection_=new shaka.offline.indexeddb.DBConnection(a),this.segmentStore_=b,this.manifestStore_=c},shaka.offline.indexeddb.V1StorageCell.prototype.destroy=function(){return this.connection_.destroy()},shaka.offline.indexeddb.V1StorageCell.prototype.hasFixedKeySpace=function(){return!0},shaka.offline.indexeddb.V1StorageCell.prototype.addSegments=function(a){return this.rejectAdd_(this.segmentStore_)},shaka.offline.indexeddb.V1StorageCell.prototype.removeSegments=function(a,b){return this.remove_(this.segmentStore_,a,b)},shaka.offline.indexeddb.V1StorageCell.prototype.getSegments=function(a){var b=shaka.offline.indexeddb.V1StorageCell.convertSegmentData_;return this.get_(this.segmentStore_,a).then(function(a){return a.map(b)})},shaka.offline.indexeddb.V1StorageCell.prototype.addManifests=function(a){return this.rejectAdd_(this.manifestStore_)},shaka.offline.indexeddb.V1StorageCell.prototype.updateManifestExpiration=function(a,b){var c=this.connection_.startReadWriteOperation(this.manifestStore_),d=c.store(),e=new shaka.util.PublicPromise;return d.get(a).onsuccess=function(c){(c=c.target.result)?(goog.asserts.assert(c.key==a,"With in-line keys, the keys should match"),c.expiration=b,d.put(c),e.resolve()):e.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.KEY_NOT_FOUND,"Could not find values for "+a))},c.promise().then(function(){return e})},shaka.offline.indexeddb.V1StorageCell.prototype.removeManifests=function(a,b){return this.remove_(this.manifestStore_,a,b)},shaka.offline.indexeddb.V1StorageCell.prototype.getManifests=function(a){var b=shaka.offline.indexeddb.V1StorageCell;return this.get_(this.manifestStore_,a).then(function(a){return a.map(b.convertManifest_)})},shaka.offline.indexeddb.V1StorageCell.prototype.getAllManifests=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function b(){var c,d,e;return $jscomp.generator.createGenerator(b,function(b){switch(b.nextAddress){case 1:return c=shaka.offline.indexeddb.V1StorageCell,d=a.connection_.startReadOnlyOperation(a.manifestStore_),e=new Map,b["yield"](d.forEachEntry(function(a,b){e.set(a,c.convertManifest_(b))}),2);case 2:return b["yield"](d.promise(),3);case 3:return b["return"](e)}})})},shaka.offline.indexeddb.V1StorageCell.prototype.rejectAdd_=function(a){return Promise.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.NEW_KEY_OPERATION_NOT_SUPPORTED,"Cannot add new value to "+a))},shaka.offline.indexeddb.V1StorageCell.prototype.remove_=function(a,b,c){a=this.connection_.startReadWriteOperation(a);var d=a.store();return b.forEach(function(a){d["delete"](a).onsuccess=function(){return c(a);
}}),a.promise()},shaka.offline.indexeddb.V1StorageCell.prototype.get_=function(a,b){var c=this.connection_.startReadOnlyOperation(a),d=c.store(),e={},f=[];return b.forEach(function(a){d.get(a).onsuccess=function(b){b=b.target.result,void 0==b&&f.push(a),e[a]=b}}),c.promise().then(function(){return f.length?Promise.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.KEY_NOT_FOUND,"Could not find values for "+f)):b.map(function(a){return e[a]})})},shaka.offline.indexeddb.V1StorageCell.convertManifest_=function(a){var b=shaka.offline.indexeddb.V1StorageCell;return goog.asserts.assert(null!=a.originalManifestUri,"Old manifest format should have an originalManifestUri field"),goog.asserts.assert(null!=a.duration,"Old manifest format should have a duration field"),goog.asserts.assert(null!=a.size,"Old manifest format should have a size field"),goog.asserts.assert(null!=a.periods,"Old manifest format should have a periods field"),goog.asserts.assert(null!=a.sessionIds,"Old manifest format should have a session ids field"),goog.asserts.assert(null!=a.appMetadata,"Old manifest format should have an app metadata field"),{originalManifestUri:a.originalManifestUri,duration:a.duration,size:a.size,expiration:null==a.expiration?1/0:a.expiration,periods:a.periods.map(b.convertPeriod_),sessionIds:a.sessionIds,drmInfo:a.drmInfo,appMetadata:a.appMetadata}},shaka.offline.indexeddb.V1StorageCell.convertPeriod_=function(a){var b=shaka.offline.indexeddb.V1StorageCell;return goog.asserts.assert(null!=a.startTime,"Old period format should have a start time field"),goog.asserts.assert(null!=a.streams,"Old period format should have a streams field"),b.fillMissingVariants_(a),a.streams.forEach(function(a){goog.asserts.assert(a.variantIds,"After filling in missing variants, each stream should have variant ids")}),{startTime:a.startTime,streams:a.streams.map(b.convertStream_)}},shaka.offline.indexeddb.V1StorageCell.convertStream_=function(a){var b=shaka.offline.indexeddb.V1StorageCell;goog.asserts.assert(null!=a.id,"Old stream format should have an id field"),goog.asserts.assert(null!=a.primary,"Old stream format should have a primary field"),goog.asserts.assert(null!=a.presentationTimeOffset,"Old stream format should have a presentation time offset field"),goog.asserts.assert(null!=a.contentType,"Old stream format should have a content type field"),goog.asserts.assert(null!=a.mimeType,"Old stream format should have a mime type field"),goog.asserts.assert(null!=a.codecs,"Old stream format should have a codecs field"),goog.asserts.assert(null!=a.language,"Old stream format should have a language field"),goog.asserts.assert(null!=a.encrypted,"Old stream format should have an encrypted field"),goog.asserts.assert(null!=a.segments,"Old stream format should have a segments field");var c=a.initSegmentUri?b.getKeyFromSegmentUri_(a.initSegmentUri):null;return{id:a.id,originalId:null,primary:a.primary,presentationTimeOffset:a.presentationTimeOffset,contentType:a.contentType,mimeType:a.mimeType,codecs:a.codecs,frameRate:a.frameRate,kind:a.kind,language:a.language,label:a.label,width:a.width,height:a.height,initSegmentKey:c,encrypted:a.encrypted,keyId:a.keyId,segments:a.segments.map(b.convertSegment_),variantIds:a.variantIds}},shaka.offline.indexeddb.V1StorageCell.convertSegment_=function(a){var b=shaka.offline.indexeddb.V1StorageCell;return goog.asserts.assert(null!=a.startTime,"The old segment format should have a start time field"),goog.asserts.assert(null!=a.endTime,"The old segment format should have an end time field"),goog.asserts.assert(null!=a.uri,"The old segment format should have a uri field"),b=b.getKeyFromSegmentUri_(a.uri),{startTime:a.startTime,endTime:a.endTime,dataKey:b}},shaka.offline.indexeddb.V1StorageCell.convertSegmentData_=function(a){return goog.asserts.assert(null!=a.key,"The old segment data format should have a key field"),goog.asserts.assert(null!=a.data,"The old segment data format should have a data field"),{data:a.data}},shaka.offline.indexeddb.V1StorageCell.getKeyFromSegmentUri_=function(a){var b;if((b=/^offline:[0-9]+\/[0-9]+\/([0-9]+)$/.exec(a))||(b=/^offline:segment\/([0-9]+)$/.exec(a)))return Number(b[1]);throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.MALFORMED_OFFLINE_URI,"Could not parse uri "+a)},shaka.offline.indexeddb.V1StorageCell.fillMissingVariants_=function(a){var b=shaka.util.ManifestParserUtils.ContentType.AUDIO,c=shaka.util.ManifestParserUtils.ContentType.VIDEO,d=a.streams.filter(function(a){return a.contentType==b}),e=a.streams.filter(function(a){return a.contentType==c});if(!d.every(function(a){return a.variantIds})||!e.every(function(a){return a.variantIds})){goog.asserts.assert(d.every(function(a){return!a.variantIds}),"Some audio streams have variant ids and some do not."),goog.asserts.assert(e.every(function(a){return!a.variantIds}),"Some video streams have variant ids and some do not."),d.forEach(function(a){a.variantIds=[]}),e.forEach(function(a){a.variantIds=[]});var f=0;if(e.length&&!d.length){shaka.log.debug("Found video-only content. Creating variants for video.");var g=f++;e.forEach(function(a){a.variantIds.push(g)})}if(!e.length&&d.length){shaka.log.debug("Found audio-only content. Creating variants for audio.");var h=f++;d.forEach(function(a){a.variantIds.push(h)})}e.length&&d.length&&(shaka.log.debug("Found audio-video content. Creating variants."),d.forEach(function(a){e.forEach(function(b){var c=f++;a.variantIds.push(c),b.variantIds.push(c)})}))}},shaka.offline.indexeddb.V2StorageCell=function(a,b,c,d){this.connection_=new shaka.offline.indexeddb.DBConnection(a),this.segmentStore_=b,this.manifestStore_=c,this.isFixedKey_=d},shaka.offline.indexeddb.V2StorageCell.prototype.destroy=function(){return this.connection_.destroy()},shaka.offline.indexeddb.V2StorageCell.prototype.hasFixedKeySpace=function(){return this.isFixedKey_},shaka.offline.indexeddb.V2StorageCell.prototype.addSegments=function(a){return this.add_(this.segmentStore_,a)},shaka.offline.indexeddb.V2StorageCell.prototype.removeSegments=function(a,b){return this.remove_(this.segmentStore_,a,b)},shaka.offline.indexeddb.V2StorageCell.prototype.getSegments=function(a){return this.get_(this.segmentStore_,a)},shaka.offline.indexeddb.V2StorageCell.prototype.addManifests=function(a){return this.add_(this.manifestStore_,a)},shaka.offline.indexeddb.V2StorageCell.prototype.updateManifestExpiration=function(a,b){var c=this.connection_.startReadWriteOperation(this.manifestStore_),d=c.store();return d.get(a).onsuccess=function(c){(c=c.target.result)&&(c.expiration=b,d.put(c,a))},c.promise()},shaka.offline.indexeddb.V2StorageCell.prototype.removeManifests=function(a,b){return this.remove_(this.manifestStore_,a,b)},shaka.offline.indexeddb.V2StorageCell.prototype.getManifests=function(a){return this.get_(this.manifestStore_,a)},shaka.offline.indexeddb.V2StorageCell.prototype.getAllManifests=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function b(){var c,d;return $jscomp.generator.createGenerator(b,function(b){switch(b.nextAddress){case 1:return c=a.connection_.startReadOnlyOperation(a.manifestStore_),d=new Map,b["yield"](c.forEachEntry(function(a,b){d.set(a,b)}),2);case 2:return b["yield"](c.promise(),3);case 3:return b["return"](d)}})})},shaka.offline.indexeddb.V2StorageCell.prototype.add_=function(a,b){if(this.isFixedKey_)return Promise.reject(new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.NEW_KEY_OPERATION_NOT_SUPPORTED,"Cannot add new value to "+a));var c=this.connection_.startReadWriteOperation(a),d=c.store(),e=[];return b.forEach(function(a){d.add(a).onsuccess=function(a){e.push(a.target.result)}}),c.promise().then(function(){return e})},shaka.offline.indexeddb.V2StorageCell.prototype.remove_=function(a,b,c){a=this.connection_.startReadWriteOperation(a);var d=a.store();return b.forEach(function(a){d["delete"](a).onsuccess=function(){return c(a)}}),a.promise()},shaka.offline.indexeddb.V2StorageCell.prototype.get_=function(a,b){var c=this.connection_.startReadOnlyOperation(a),d=c.store(),e={},f=[];return b.forEach(function(a){var b=d.get(a);b.onsuccess=function(){void 0==b.result&&f.push(a),e[a]=b.result}}),c.promise().then(function(){return f.length?Promise.reject(new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.KEY_NOT_FOUND,"Could not find values for "+f)):b.map(function(a){return e[a]})})},shaka.offline.indexeddb.StorageMechanism=function(){this.sessions_=this.v3_=this.v2_=this.v1_=this.db_=null},shaka.offline.indexeddb.StorageMechanism.prototype.init=function(){var a=this,b=shaka.offline.indexeddb.StorageMechanism.DB_NAME,c=shaka.offline.indexeddb.StorageMechanism.VERSION,d=new shaka.util.PublicPromise,e=window.indexedDB.open(b,c);return e.onsuccess=function(b){b=b.target.result,a.db_=b,a.v1_=shaka.offline.indexeddb.StorageMechanism.createV1_(b),a.v2_=shaka.offline.indexeddb.StorageMechanism.createV2_(b),a.v3_=shaka.offline.indexeddb.StorageMechanism.createV3_(b),a.sessions_=shaka.offline.indexeddb.StorageMechanism.createEmeSession_(b),d.resolve()},e.onupgradeneeded=function(b){a.createStores_(b.target.result)},e.onerror=function(a){d.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.INDEXED_DB_ERROR,e.error)),a.preventDefault()},d},shaka.offline.indexeddb.StorageMechanism.prototype.destroy=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function b(){return $jscomp.generator.createGenerator(b,function(b){switch(b.nextAddress){case 1:if(!a.v1_){b.jumpTo(2);break}return b["yield"](a.v1_.destroy(),2);case 2:if(!a.v2_){b.jumpTo(4);break}return b["yield"](a.v2_.destroy(),4);case 4:if(!a.v3_){b.jumpTo(6);break}return b["yield"](a.v3_.destroy(),6);case 6:if(!a.sessions_){b.jumpTo(8);break}return b["yield"](a.sessions_.destroy(),8);case 8:a.db_&&a.db_.close(),b.jumpToEnd()}})})},shaka.offline.indexeddb.StorageMechanism.prototype.getCells=function(){var a=new Map;return this.v1_&&a.set("v1",this.v1_),this.v2_&&a.set("v2",this.v2_),this.v3_&&a.set("v3",this.v3_),a},shaka.offline.indexeddb.StorageMechanism.prototype.getEmeSessionCell=function(){return goog.asserts.assert(this.sessions_,"Cannot be destroyed."),this.sessions_},shaka.offline.indexeddb.StorageMechanism.prototype.erase=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function b(){return $jscomp.generator.createGenerator(b,function(b){switch(b.nextAddress){case 1:if(!a.v1_){b.jumpTo(2);break}return b["yield"](a.v1_.destroy(),2);case 2:if(!a.v2_){b.jumpTo(4);break}return b["yield"](a.v2_.destroy(),4);case 4:if(!a.v3_){b.jumpTo(6);break}return b["yield"](a.v3_.destroy(),6);case 6:return a.db_&&a.db_.close(),b["yield"](shaka.offline.indexeddb.StorageMechanism.deleteAll_(),8);case 8:return a.db_=null,a.v1_=null,a.v2_=null,a.v3_=null,b["yield"](a.init(),0)}})})},shaka.offline.indexeddb.StorageMechanism.createV1_=function(a){var b=shaka.offline.indexeddb.StorageMechanism,c=b.V1_SEGMENT_STORE;b=b.V1_MANIFEST_STORE;var d=a.objectStoreNames;return d.contains(b)&&d.contains(c)?(shaka.log.debug("Mounting v1 idb storage cell"),new shaka.offline.indexeddb.V1StorageCell(a,c,b)):null},shaka.offline.indexeddb.StorageMechanism.createV2_=function(a){var b=shaka.offline.indexeddb.StorageMechanism,c=b.V2_SEGMENT_STORE;b=b.V2_MANIFEST_STORE;var d=a.objectStoreNames;return d.contains(b)&&d.contains(c)?(shaka.log.debug("Mounting v2 idb storage cell"),new shaka.offline.indexeddb.V2StorageCell(a,c,b,(!0))):null},shaka.offline.indexeddb.StorageMechanism.createV3_=function(a){var b=shaka.offline.indexeddb.StorageMechanism,c=b.V3_SEGMENT_STORE;b=b.V3_MANIFEST_STORE;var d=a.objectStoreNames;return d.contains(b)&&d.contains(c)?(shaka.log.debug("Mounting v3 idb storage cell"),new shaka.offline.indexeddb.V2StorageCell(a,c,b,(!1))):null},shaka.offline.indexeddb.StorageMechanism.createEmeSession_=function(a){var b=shaka.offline.indexeddb.StorageMechanism.SESSION_ID_STORE;return a.objectStoreNames.contains(b)?(shaka.log.debug("Mounting session ID idb storage cell"),new shaka.offline.indexeddb.EmeSessionStorageCell(a,b)):null},shaka.offline.indexeddb.StorageMechanism.prototype.createStores_=function(a){for(var b=$jscomp.makeIterator([shaka.offline.indexeddb.StorageMechanism.V3_SEGMENT_STORE,shaka.offline.indexeddb.StorageMechanism.V3_MANIFEST_STORE,shaka.offline.indexeddb.StorageMechanism.SESSION_ID_STORE]),c=b.next();!c.done;c=b.next())c=c.value,a.objectStoreNames.contains(c)||a.createObjectStore(c,{autoIncrement:!0})},shaka.offline.indexeddb.StorageMechanism.deleteAll_=function(){var a=shaka.offline.indexeddb.StorageMechanism.DB_NAME,b=new shaka.util.PublicPromise,c=window.indexedDB.deleteDatabase(a);return c.onblocked=function(b){shaka.log.warning("Deleting",a,"is being blocked")},c.onsuccess=function(a){b.resolve()},c.onerror=function(a){b.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.INDEXED_DB_ERROR,c.error)),a.preventDefault()},b},shaka.offline.indexeddb.StorageMechanism.DB_NAME="shaka_offline_db",shaka.offline.indexeddb.StorageMechanism.VERSION=4,shaka.offline.indexeddb.StorageMechanism.V1_SEGMENT_STORE="segment",shaka.offline.indexeddb.StorageMechanism.V2_SEGMENT_STORE="segment-v2",shaka.offline.indexeddb.StorageMechanism.V3_SEGMENT_STORE="segment-v3",shaka.offline.indexeddb.StorageMechanism.V1_MANIFEST_STORE="manifest",shaka.offline.indexeddb.StorageMechanism.V2_MANIFEST_STORE="manifest-v2",shaka.offline.indexeddb.StorageMechanism.V3_MANIFEST_STORE="manifest-v3",shaka.offline.indexeddb.StorageMechanism.SESSION_ID_STORE="session-ids",shaka.offline.StorageMuxer.register("idb",function(){return window.indexedDB?new shaka.offline.indexeddb.StorageMechanism:null}),shaka.offline.OfflineUri=function(a,b,c,d){this.type_=a,this.mechanism_=b,this.cell_=c,this.key_=d,this.asString_=["offline:",a,"/",b,"/",c,"/",d].join("")},shaka.offline.OfflineUri.prototype.isManifest=function(){return"manifest"==this.type_},shaka.offline.OfflineUri.prototype.isSegment=function(){return"segment"==this.type_},shaka.offline.OfflineUri.prototype.mechanism=function(){return this.mechanism_},shaka.offline.OfflineUri.prototype.cell=function(){return this.cell_},shaka.offline.OfflineUri.prototype.key=function(){return this.key_},shaka.offline.OfflineUri.prototype.toString=function(){return this.asString_},shaka.offline.OfflineUri.parse=function(a){if(a=/^offline:([a-z]+)\/([^\/]+)\/([^\/]+)\/([0-9]+)$/.exec(a),null==a)return null;var b=a[1];if("manifest"!=b&&"segment"!=b)return null;var c=a[2];if(!c)return null;var d=a[3];return d&&null!=b?new shaka.offline.OfflineUri(b,c,d,Number(a[4])):null},shaka.offline.OfflineUri.manifest=function(a,b,c){return new shaka.offline.OfflineUri("manifest",a,b,c)},shaka.offline.OfflineUri.segment=function(a,b,c){return new shaka.offline.OfflineUri("segment",a,b,c)},shaka.offline.ManifestConverter=function(a,b){this.mechanism_=a,this.cell_=b},shaka.offline.ManifestConverter.prototype.fromManifestDB=function(a){var b=this,c=new shaka.media.PresentationTimeline(null,0);c.setDuration(a.duration);var d=a.periods.map(function(a){return b.fromPeriodDB(a,c)}),e=a.drmInfo?[a.drmInfo]:[];return a.drmInfo&&d.forEach(function(a){a.variants.forEach(function(a){a.drmInfos=e})}),{presentationTimeline:c,minBufferTime:2,offlineSessionIds:a.sessionIds,periods:d}},shaka.offline.ManifestConverter.prototype.fromPeriodDB=function(a,b){var c=this,d=a.streams.filter(function(a){return c.isAudio_(a)}),e=a.streams.filter(function(a){return c.isVideo_(a)});return d=this.createVariants(d,e),e=a.streams.filter(function(a){return c.isText_(a)}).map(function(a){return c.fromStreamDB_(a)}),a.streams.forEach(function(d,e){var f=d.segments.map(function(a,b){return c.fromSegmentDB_(b,a)});b.notifySegments(f,a.startTime)}),{startTime:a.startTime,variants:Array.from(d.values()),textStreams:e}},shaka.offline.ManifestConverter.prototype.createVariants=function(a,b){for(var c=new Set,d=$jscomp.makeIterator(a),e=d.next();!e.done;e=d.next()){var f=$jscomp.makeIterator(e.value.variantIds);for(e=f.next();!e.done;e=f.next())c.add(e.value)}for(d=$jscomp.makeIterator(b),e=d.next();!e.done;e=d.next())for(f=$jscomp.makeIterator(e.value.variantIds),e=f.next();!e.done;e=f.next())c.add(e.value);for(d=new Map,c=$jscomp.makeIterator(c),e=c.next();!e.done;e=c.next())e=e.value,d.set(e,this.createEmptyVariant_(e));for(c=$jscomp.makeIterator(a),e=c.next();!e.done;e=c.next()){e=e.value,f=this.fromStreamDB_(e);var g=$jscomp.makeIterator(e.variantIds);for(e=g.next();!e.done;e=g.next())e=d.get(e.value),goog.asserts.assert(!e.audio,"A variant should only have one audio stream"),e.language=f.language,e.primary=e.primary||f.primary,e.audio=f}for(c=$jscomp.makeIterator(b),e=c.next();!e.done;e=c.next())for(e=e.value,f=this.fromStreamDB_(e),g=$jscomp.makeIterator(e.variantIds),e=g.next();!e.done;e=g.next())e=d.get(e.value),goog.asserts.assert(!e.video,"A variant should only have one video stream"),e.primary=e.primary||f.primary,e.video=f;return d},shaka.offline.ManifestConverter.prototype.fromStreamDB_=function(a){var b=this,c=a.segments.map(function(a,c){return b.fromSegmentDB_(c,a)}),d=new shaka.media.SegmentIndex(c);return c={id:a.id,originalId:a.originalId,createSegmentIndex:function(){return Promise.resolve()},findSegmentPosition:function(a){return d.find(a)},getSegmentReference:function(a){return d.get(a)},initSegmentReference:null,presentationTimeOffset:a.presentationTimeOffset,mimeType:a.mimeType,codecs:a.codecs,width:a.width||void 0,height:a.height||void 0,frameRate:a.frameRate||void 0,kind:a.kind,encrypted:a.encrypted,keyId:a.keyId,language:a.language,label:a.label||null,type:a.contentType,primary:a.primary,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,closedCaptions:null},null!=a.initSegmentKey&&(c.initSegmentReference=this.fromInitSegmentDB_(a.initSegmentKey)),c},shaka.offline.ManifestConverter.prototype.fromSegmentDB_=function(a,b){var c=shaka.offline.OfflineUri.segment(this.mechanism_,this.cell_,b.dataKey);return new shaka.media.SegmentReference(a,b.startTime,b.endTime,function(){return[c.toString()]},0,null)},shaka.offline.ManifestConverter.prototype.fromInitSegmentDB_=function(a){var b=shaka.offline.OfflineUri.segment(this.mechanism_,this.cell_,a);return new shaka.media.InitSegmentReference(function(){return[b.toString()]},0,null)},shaka.offline.ManifestConverter.prototype.isAudio_=function(a){return a.contentType==shaka.util.ManifestParserUtils.ContentType.AUDIO},shaka.offline.ManifestConverter.prototype.isVideo_=function(a){return a.contentType==shaka.util.ManifestParserUtils.ContentType.VIDEO},shaka.offline.ManifestConverter.prototype.isText_=function(a){return a.contentType==shaka.util.ManifestParserUtils.ContentType.TEXT},shaka.offline.ManifestConverter.prototype.createEmptyVariant_=function(a){return{id:a,language:"",primary:!1,audio:null,video:null,bandwidth:0,drmInfos:[],allowedByApplication:!0,allowedByKeySystem:!0}},shaka.offline.OfflineManifestParser=function(){this.uri_=null},shaka.offline.OfflineManifestParser.prototype.configure=function(a){},shaka.offline.OfflineManifestParser.prototype.start=function(a,b){var c=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function d(){var b,e,f,g,h,i;return $jscomp.generator.createGenerator(d,function(d){switch(d.nextAddress){case 1:return b=shaka.offline.OfflineUri.parse(a),c.uri_=b,null!=b&&b.isManifest()?(e=new shaka.offline.StorageMuxer,d.setFinallyBlock(2),d["yield"](e.init(),4)):d["return"](Promise.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.MALFORMED_OFFLINE_URI,b)));case 4:return d["yield"](e.getCell(b.mechanism(),b.cell()),5);case 5:return f=d.yieldResult,d["yield"](f.getManifests([b.key()]),6);case 6:return g=d.yieldResult,h=g[0],i=new shaka.offline.ManifestConverter(b.mechanism(),b.cell()),d["return"](i.fromManifestDB(h));case 2:return d.enterFinallyBlock(),d["yield"](e.destroy(),7);case 7:d.leaveFinallyBlock(0)}})})},shaka.offline.OfflineManifestParser.prototype.stop=function(){return Promise.resolve()},shaka.offline.OfflineManifestParser.prototype.update=function(){},shaka.offline.OfflineManifestParser.prototype.onExpirationUpdated=function(a,b){var c=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function d(){var e,f,g,h,i,j,k,l;return $jscomp.generator.createGenerator(d,function(d){switch(d.nextAddress){case 1:return goog.asserts.assert(c.uri_,"Should not get update event before start has been called"),e=c.uri_,f=new shaka.offline.StorageMuxer,d.setCatchFinallyBlocks(2,3),d["yield"](f.init(),5);case 5:return d["yield"](f.getCell(e.mechanism(),e.cell()),6);case 6:return g=d.yieldResult,d["yield"](g.getManifests([e.key()]),7);case 7:if(h=d.yieldResult,i=h[0],j=i.sessionIds.includes(a),k=void 0==i.expiration||i.expiration>b,!j||!k){d.jumpTo(3);break}return shaka.log.debug("Updating expiration for stored content"),d["yield"](g.updateManifestExpiration(e.key(),b),3);case 3:return d.enterFinallyBlock(),d["yield"](f.destroy(),10);case 10:d.leaveFinallyBlock(0);break;case 2:l=d.enterCatchBlock(),shaka.log.error("There was an error updating",e,l),d.jumpTo(3)}})})},shaka.media.ManifestParser.registerParserByMime("application/x-offline-manifest",shaka.offline.OfflineManifestParser),shaka.offline.OfflineScheme=function(a,b,c,d){return(b=shaka.offline.OfflineUri.parse(a))&&b.isManifest()?shaka.offline.OfflineScheme.getManifest_(a):b&&b.isSegment()?shaka.offline.OfflineScheme.getSegment_(b.key(),b):shaka.util.AbortableOperation.failed(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.MALFORMED_OFFLINE_URI,a))},goog.exportSymbol("shaka.offline.OfflineScheme",shaka.offline.OfflineScheme),shaka.offline.OfflineScheme.getManifest_=function(a){return a={uri:a,originalUri:a,data:new ArrayBuffer(0),headers:{"content-type":"application/x-offline-manifest"}},shaka.util.AbortableOperation.completed(a)},shaka.offline.OfflineScheme.getSegment_=function(a,b){goog.asserts.assert(b.isSegment(),"Only segment uri's should be given to getSegment");var c=new shaka.offline.StorageMuxer;return shaka.util.AbortableOperation.completed(void 0).chain(function(){return c.init()}).chain(function(){return c.getCell(b.mechanism(),b.cell())}).chain(function(a){return a.getSegments([b.key()])}).chain(function(a){return{uri:b,originalUri:b,data:a[0].data,headers:{}}})["finally"](function(){return c.destroy()})},shaka.net.NetworkingEngine.registerScheme("offline",shaka.offline.OfflineScheme),shaka.offline.SessionDeleter=function(){},shaka.offline.SessionDeleter.prototype["delete"]=function(a,b,c){var d=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function e(){var f,g,h,i,j,k,l;return $jscomp.generator.createGenerator(e,function(e){switch(e.nextAddress){case 1:f=shaka.offline.SessionDeleter,g=[],h=$jscomp.makeIterator(f.createBuckets_(c)),i=h.next();case 2:if(i.done){e.jumpTo(4);break}return j=i.value,k=d.doDelete_(a,b,j),e["yield"](k,5);case 5:l=e.yieldResult,g=g.concat(l),i=h.next(),e.jumpTo(2);break;case 4:return e["return"](g)}})})},shaka.offline.SessionDeleter.prototype.doDelete_=function(a,b,c){return $jscomp.asyncExecutePromiseGeneratorFunction(function d(){var e,f,g,h;return $jscomp.generator.createGenerator(d,function(d){switch(d.nextAddress){case 1:return e=new shaka.media.DrmEngine({netEngine:b,onError:function(){},onKeyStatus:function(){},onExpirationUpdated:function(){},onEvent:function(){}}),d.setCatchFinallyBlocks(2),e.configure(a),d["yield"](e.initForRemoval(c.info.keySystem,c.info.licenseUri,c.info.serverCertificate,c.info.audioCapabilities,c.info.videoCapabilities),4);case 4:d.leaveTryBlock(3);break;case 2:return f=d.enterCatchBlock(),shaka.log.warning("Error initializing EME",f),d["yield"](e.destroy(),5);case 5:return d["return"]([]);case 3:return d.setCatchFinallyBlocks(6),d["yield"](e.setServerCertificate(),8);case 8:d.leaveTryBlock(7);break;case 6:return g=d.enterCatchBlock(),shaka.log.warning("Error setting server certificate",g),d["yield"](e.destroy(),9);case 9:return d["return"]([]);case 7:return h=[],d["yield"](Promise.all(c.sessionIds.map(function(a){return $jscomp.asyncExecutePromiseGeneratorFunction(function b(){var c;return $jscomp.generator.createGenerator(b,function(b){switch(b.nextAddress){case 1:return b.setCatchFinallyBlocks(2),b["yield"](e.removeSession(a),4);case 4:h.push(a),b.leaveTryBlock(0);break;case 2:c=b.enterCatchBlock(),shaka.log.warning("Error deleting offline session",c),b.jumpToEnd()}})})})),10);case 10:return d["yield"](e.destroy(),11);case 11:return d["return"](h)}})})},shaka.offline.SessionDeleter.createBuckets_=function(a){var b=shaka.offline.SessionDeleter,c=[];a=$jscomp.makeIterator(a);for(var d=a.next();!d.done;d=a.next()){d=d.value;for(var e=!1,f=$jscomp.makeIterator(c),g=f.next();!g.done;g=f.next())if(g=g.value,b.isCompatible_(g.info,d)){g.sessionIds.push(d.sessionId),e=!0;break}e||c.push({info:d,sessionIds:[d.sessionId]})}return c},shaka.offline.SessionDeleter.isCompatible_=function(a,b){var c=shaka.util.ArrayUtils,d=function(a,b){return a.robustness==b.robustness&&a.contentType==b.contentType};return a.keySystem==b.keySystem&&a.licenseUri==b.licenseUri&&c.hasSameElements(a.audioCapabilities,b.audioCapabilities,d)&&c.hasSameElements(a.videoCapabilities,b.videoCapabilities,d)},shaka.routing={},shaka.routing.Walker=function(a,b,c){var d=this;this.implementation_=c,this.currentlyAt_=a,this.currentlyWith_=b,this.waitForWork_=null,this.requests_=[],this.currentStep_=this.currentRoute_=null,this.isAlive_=!0,this.mainLoopPromise_=Promise.resolve().then(function(){return d.mainLoop_()})},shaka.routing.Walker.prototype.destroy=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function b(){var c;return $jscomp.generator.createGenerator(b,function(b){switch(b.nextAddress){case 1:return a.isAlive_=!1,a.currentStep_&&a.currentStep_.abort(),a.unblockMainLoop_(),b["yield"](a.mainLoopPromise_,2);case 2:a.currentRoute_&&a.currentRoute_.listeners.onCancel();for(var d=$jscomp.makeIterator(a.requests_),e=d.next();!e.done;e=d.next())c=e.value,c.listeners.onCancel();a.currentRoute_=null,a.requests_=[],a.implementation_=null,b.jumpToEnd()}})})},shaka.routing.Walker.prototype.startNewRoute=function(a){var b={onStart:function(){},onEnd:function(){},onCancel:function(){},onError:function(a){},onSkip:function(){},onEnter:function(){}};return this.requests_.push({create:a,listeners:b}),this.currentStep_&&this.currentStep_.abort(),this.unblockMainLoop_(),b},shaka.routing.Walker.prototype.mainLoop_=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function b(){return $jscomp.generator.createGenerator(b,function(b){switch(b.nextAddress){case 1:if(a.isAlive_)return b["yield"](a.doOneThing_(),1);b.jumpTo(0)}})})},shaka.routing.Walker.prototype.doOneThing_=function(){return this.tryNewRoute_()?Promise.resolve():this.currentRoute_?this.takeNextStep_():(goog.asserts.assert(null==this.waitForWork_,"We should not have a promise yet."),this.implementation_.onIdle(this.currentlyAt_),this.waitForWork_=new shaka.util.PublicPromise)},shaka.routing.Walker.prototype.tryNewRoute_=function(){if(goog.asserts.assert(null==this.currentStep_,"We should never have a current step between taking steps."),0==this.requests_.length||this.currentRoute_&&!this.currentRoute_.interruptible)return!1;this.currentRoute_&&(this.currentRoute_.listeners.onCancel(),this.currentRoute_=null);var a=this.requests_.shift(),b=a.create(this.currentlyWith_);return b?(a.listeners.onStart(),this.currentRoute_={node:b.node,payload:b.payload,interruptible:b.interruptible,listeners:a.listeners}):a.listeners.onSkip(),!0},shaka.routing.Walker.prototype.takeNextStep_=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function b(){var c,d;return $jscomp.generator.createGenerator(b,function(b){switch(b.nextAddress){case 1:return goog.asserts.assert(a.currentRoute_,"We need a current route to take the next step."),a.currentlyAt_=a.implementation_.getNext(a.currentlyAt_,a.currentlyWith_,a.currentRoute_.node,a.currentRoute_.payload),a.currentRoute_.listeners.onEnter(a.currentlyAt_),b.setCatchFinallyBlocks(2),a.currentStep_=a.implementation_.enterNode(a.currentlyAt_,a.currentlyWith_,a.currentRoute_.payload),b["yield"](a.currentStep_.promise,4);case 4:a.currentStep_=null,a.currentlyAt_==a.currentRoute_.node&&(a.currentRoute_.listeners.onEnd(),a.currentRoute_=null),b.leaveTryBlock(0);break;case 2:return c=b.enterCatchBlock(),c.code==shaka.util.Error.Code.OPERATION_ABORTED?(goog.asserts.assert(a.currentRoute_.interruptible,"Do not put abortable steps in non-interruptible routes!"),a.currentRoute_.listeners.onCancel()):a.currentRoute_.listeners.onError(c),a.currentRoute_=null,a.currentStep_=null,d=a,b["yield"](a.implementation_.handleError(a.currentlyWith_,c),5);case 5:d.currentlyAt_=b.yieldResult,b.jumpToEnd()}})})},shaka.routing.Walker.prototype.unblockMainLoop_=function(){this.waitForWork_&&(this.waitForWork_.resolve(),this.waitForWork_=null)},shaka.text.SimpleTextDisplayer=function(a){this.textTrack_=null;for(var b=0;b<a.textTracks.length;++b){var c=a.textTracks[b];c.mode="disabled",c.label==shaka.text.SimpleTextDisplayer.TextTrackLabel_&&(this.textTrack_=c)}this.textTrack_||(this.textTrack_=a.addTextTrack("subtitles",shaka.text.SimpleTextDisplayer.TextTrackLabel_)),this.textTrack_.mode="hidden"},goog.exportSymbol("shaka.text.SimpleTextDisplayer",shaka.text.SimpleTextDisplayer),shaka.text.SimpleTextDisplayer.prototype.remove=function(a,b){return!!this.textTrack_&&(shaka.text.SimpleTextDisplayer.removeWhere_(this.textTrack_,function(c){return c.startTime<b&&c.endTime>a}),!0)},goog.exportProperty(shaka.text.SimpleTextDisplayer.prototype,"remove",shaka.text.SimpleTextDisplayer.prototype.remove),shaka.text.SimpleTextDisplayer.prototype.append=function(a){for(var b=shaka.text.SimpleTextDisplayer.convertToTextTrackCue_,c=[],d=0;d<a.length;d++){var e=b(a[d]);e&&c.push(e)}c.slice().sort(function(a,b){return a.startTime!=b.startTime?a.startTime-b.startTime:a.endTime!=b.endTime?a.endTime-b.startTime:c.indexOf(b)-c.indexOf(a)}).forEach(function(a){this.textTrack_.addCue(a)}.bind(this))},goog.exportProperty(shaka.text.SimpleTextDisplayer.prototype,"append",shaka.text.SimpleTextDisplayer.prototype.append),shaka.text.SimpleTextDisplayer.prototype.destroy=function(){return this.textTrack_&&shaka.text.SimpleTextDisplayer.removeWhere_(this.textTrack_,function(a){return!0}),this.textTrack_=null,Promise.resolve()},goog.exportProperty(shaka.text.SimpleTextDisplayer.prototype,"destroy",shaka.text.SimpleTextDisplayer.prototype.destroy),shaka.text.SimpleTextDisplayer.prototype.isTextVisible=function(){return"showing"==this.textTrack_.mode},goog.exportProperty(shaka.text.SimpleTextDisplayer.prototype,"isTextVisible",shaka.text.SimpleTextDisplayer.prototype.isTextVisible),shaka.text.SimpleTextDisplayer.prototype.setTextVisibility=function(a){this.textTrack_.mode=a?"showing":"hidden"},goog.exportProperty(shaka.text.SimpleTextDisplayer.prototype,"setTextVisibility",shaka.text.SimpleTextDisplayer.prototype.setTextVisibility),shaka.text.SimpleTextDisplayer.convertToTextTrackCue_=function(a){if(a.startTime>=a.endTime)return shaka.log.warning("Invalid cue times: "+a.startTime+" - "+a.endTime),null;var b=shaka.text.Cue,c=new VTTCue(a.startTime,a.endTime,a.payload);c.lineAlign=a.lineAlign,c.positionAlign=a.positionAlign,c.size=a.size;try{c.align=a.textAlign}catch(d){}return"center"==a.textAlign&&"center"!=c.align&&(c.align="middle"),a.writingMode==b.writingMode.VERTICAL_LEFT_TO_RIGHT?c.vertical="lr":a.writingMode==b.writingMode.VERTICAL_RIGHT_TO_LEFT&&(c.vertical="rl"),
a.lineInterpretation==b.lineInterpretation.PERCENTAGE&&(c.snapToLines=!1),null!=a.line&&(c.line=a.line),null!=a.position&&(c.position=a.position),c},shaka.text.SimpleTextDisplayer.removeWhere_=function(a,b){var c=a.mode,d="showing"==c?"showing":"hidden";a.mode=d,goog.asserts.assert(a.cues,'Cues should be accessible when mode is set to "'+d+'".'),d=a.cues;for(var e=d.length-1;0<=e;e--){var f=d[e];f&&b(f)&&a.removeCue(f)}a.mode=c},shaka.text.SimpleTextDisplayer.TextTrackLabel_="Shaka Player TextTrack",shaka.util.ConfigUtils={},shaka.util.ConfigUtils.mergeConfigObjects=function(a,b,c,d,e){goog.asserts.assert(a,"Destination config must not be null!");var f,g=e in d,h=!0;for(f in b){var i=e+"."+f,j=g?d[e]:c[f];g||f in c?void 0===b[f]?void 0===j||g?delete a[f]:a[f]=shaka.util.ObjectUtils.cloneObject(j):j.constructor==Object&&b[f]&&b[f].constructor==Object?(a[f]||(a[f]=shaka.util.ObjectUtils.cloneObject(j)),i=shaka.util.ConfigUtils.mergeConfigObjects(a[f],b[f],j,d,i),h=h&&i):typeof b[f]!=typeof j||null==b[f]||b[f].constructor!=j.constructor?(shaka.log.error("Invalid config, wrong type for "+i),h=!1):("function"==typeof c[f]&&c[f].length!=b[f].length&&shaka.log.warning("Invalid config, wrong number of arguments for "+i),a[f]=b[f]):(shaka.log.error("Invalid config, unrecognized key "+i),h=!1)}return h},goog.exportSymbol("shaka.util.ConfigUtils.mergeConfigObjects",shaka.util.ConfigUtils.mergeConfigObjects),shaka.util.ConfigUtils.convertToConfigObject=function(a,b){for(var c={},d=c,e=0,f=0;e=a.indexOf(".",e),!(0>e);)0!=e&&"\\"==a[e-1]||(f=a.substring(f,e).replace(/\\\./g,"."),d[f]={},d=d[f],f=e+1),e+=1;return d[a.substring(f).replace(/\\\./g,".")]=b,c},goog.exportSymbol("shaka.util.ConfigUtils.convertToConfigObject",shaka.util.ConfigUtils.convertToConfigObject),shaka.util.PlayerConfiguration=function(){},goog.exportSymbol("shaka.util.PlayerConfiguration",shaka.util.PlayerConfiguration),shaka.util.PlayerConfiguration.createDefault=function(){var a=5e5,b=1/0;navigator.connection&&(a=1e6*navigator.connection.downlink,navigator.connection.saveData&&(b=360));var c={retryParameters:shaka.net.NetworkingEngine.defaultRetryParameters(),servers:{},clearKeys:{},advanced:{},delayLicenseRequestUntilPlayed:!1,initDataTransform:function(a){return a},fairPlayTransform:!0},d={retryParameters:shaka.net.NetworkingEngine.defaultRetryParameters(),availabilityWindowOverride:NaN,dash:{customScheme:function(a){if(a)return null},clockSyncUri:"",ignoreDrmInfo:!1,xlinkFailGracefully:!1,defaultPresentationDelay:10,ignoreMinBufferTime:!1,autoCorrectDrift:!0},hls:{ignoreTextStreamFailures:!1}},e={retryParameters:shaka.net.NetworkingEngine.defaultRetryParameters(),failureCallback:function(a){shaka.log.error("Unhandled streaming error",a)},rebufferingGoal:2,bufferingGoal:10,bufferBehind:30,ignoreTextStreamFailures:!1,alwaysStreamText:!1,startAtSegmentBoundary:!1,smallGapLimit:.5,jumpLargeGaps:!1,durationBackoff:1,forceTransmuxTS:!1,safeSeekOffset:5,stallEnabled:!0,stallThreshold:1,stallSkip:.1};shaka.util.Platform.isWebOS()&&(e.stallEnabled=!1);var f={trackSelectionCallback:function(a){return a},progressCallback:function(a,b){shaka.log.v2("Offline operation on",a.originalManifestUri,"progress at",b)},usePersistentLicense:!0},g={drm:c,manifest:d,streaming:e,offline:f,abrFactory:shaka.abr.SimpleAbrManager,abr:{enabled:!0,defaultBandwidthEstimate:a,switchInterval:8,bandwidthUpgradeTarget:.85,bandwidthDowngradeTarget:.95,restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:b,minPixels:0,maxPixels:1/0,minBandwidth:0,maxBandwidth:1/0}},preferredAudioLanguage:"",preferredTextLanguage:"",preferredVariantRole:"",preferredTextRole:"",preferredAudioChannelCount:2,restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:1/0,minPixels:0,maxPixels:1/0,minBandwidth:0,maxBandwidth:1/0},playRangeStart:0,playRangeEnd:1/0,textDisplayFactory:function(){return null}};return f.trackSelectionCallback=function(a){return shaka.util.PlayerConfiguration.defaultTrackSelect(a,g.preferredAudioLanguage)},g},shaka.util.PlayerConfiguration.mergeConfigObjects=function(a,b,c){var d={".drm.servers":"",".drm.clearKeys":"",".drm.advanced":{distinctiveIdentifierRequired:!1,persistentStateRequired:!1,videoRobustness:"",audioRobustness:"",serverCertificate:new Uint8Array(0),individualizationServer:""}};return shaka.util.ConfigUtils.mergeConfigObjects(a,b,c||shaka.util.PlayerConfiguration.createDefault(),d,"")},goog.exportProperty(shaka.util.PlayerConfiguration,"mergeConfigObjects",shaka.util.PlayerConfiguration.mergeConfigObjects),shaka.util.PlayerConfiguration.defaultTrackSelect=function(a,b){var c=shaka.util.ManifestParserUtils.ContentType,d=shaka.util.LanguageUtils,e=a.filter(function(a){return"variant"==a.type}),f=[],g=d.findClosestLocale(b,e.map(function(a){return a.language}));g&&(f=e.filter(function(a){return d.normalize(a.language)==g})),0==f.length&&(f=e.filter(function(a){return a.primary})),0==f.length&&(1<new Set(e.map(function(a){return a.language})).size&&shaka.log.warning("Could not choose a good audio track based on language preferences or primary tracks.  An arbitrary language will be stored!"),f=e);var h=f.filter(function(a){return a.height&&480>=a.height});if(h.length&&(h.sort(function(a,b){return b.height-a.height}),f=h.filter(function(a){return a.height==h[0].height})),e=[],f.length){var i=Math.floor(f.length/2);f.sort(function(a,b){return a.bandwidth-b.bandwidth}),e.push(f[i])}for(f=$jscomp.makeIterator(a),i=f.next();!i.done;i=f.next())i=i.value,i.type==c.TEXT&&e.push(i);return e},shaka.util.StateHistory=function(){this.open_=null,this.closed_=[]},shaka.util.StateHistory.prototype.update=function(a){null==this.open_?this.start_(a):this.update_(a)},shaka.util.StateHistory.prototype.getTimeSpentIn=function(a){var b=0;this.open_&&this.open_.state==a&&(b+=this.open_.duration);for(var c=$jscomp.makeIterator(this.closed_),d=c.next();!d.done;d=c.next())d=d.value,b+=d.state==a?d.duration:0;return b},shaka.util.StateHistory.prototype.getCopy=function(){for(var a=function(a){return{timestamp:a.timestamp,state:a.state,duration:a.duration}},b=[],c=$jscomp.makeIterator(this.closed_),d=c.next();!d.done;d=c.next())b.push(a(d.value));return this.open_&&b.push(a(this.open_)),b},shaka.util.StateHistory.prototype.start_=function(a){goog.asserts.assert(null==this.open_,"There must be no open entry in order when we start"),this.open_={timestamp:this.getNowInSeconds_(),state:a,duration:0}},shaka.util.StateHistory.prototype.update_=function(a){goog.asserts.assert(this.open_,"There must be an open entry in order to update it");var b=this.getNowInSeconds_();this.open_.duration=b-this.open_.timestamp,this.open_.state!=a&&(this.closed_.push(this.open_),this.open_={timestamp:b,state:a,duration:0})},shaka.util.StateHistory.prototype.getNowInSeconds_=function(){return Date.now()/1e3},shaka.util.SwitchHistory=function(){this.currentText_=this.currentVariant_=null,this.history_=[]},shaka.util.SwitchHistory.prototype.updateCurrentVariant=function(a,b){this.currentVariant_!=a&&(this.currentVariant_=a,this.history_.push({timestamp:this.getNowInSeconds_(),id:a.id,type:"variant",fromAdaptation:b,bandwidth:a.bandwidth}))},shaka.util.SwitchHistory.prototype.updateCurrentText=function(a,b){this.currentText_!=a&&(this.currentText_=a,this.history_.push({timestamp:this.getNowInSeconds_(),id:a.id,type:"text",fromAdaptation:b,bandwidth:null}))},shaka.util.SwitchHistory.prototype.getCopy=function(){for(var a=[],b=$jscomp.makeIterator(this.history_),c=b.next();!c.done;c=b.next())a.push(this.clone_(c.value));return a},shaka.util.SwitchHistory.prototype.getNowInSeconds_=function(){return Date.now()/1e3},shaka.util.SwitchHistory.prototype.clone_=function(a){return{timestamp:a.timestamp,id:a.id,type:a.type,fromAdaptation:a.fromAdaptation,bandwidth:a.bandwidth}},shaka.util.Stats=function(){this.bandwidthEstimate_=this.variantBandwidth_=this.loadLatencySeconds_=this.totalDecodedFrames_=this.totalDroppedFrames_=this.height_=this.width_=NaN,this.stateHistory_=new shaka.util.StateHistory,this.switchHistory_=new shaka.util.SwitchHistory},shaka.util.Stats.prototype.setDroppedFrames=function(a,b){this.totalDroppedFrames_=a,this.totalDecodedFrames_=b},shaka.util.Stats.prototype.setResolution=function(a,b){this.width_=a,this.height_=b},shaka.util.Stats.prototype.setLoadLatency=function(a){this.loadLatencySeconds_=a},shaka.util.Stats.prototype.setVariantBandwidth=function(a){this.variantBandwidth_=a},shaka.util.Stats.prototype.setBandwidthEstimate=function(a){this.bandwidthEstimate_=a},shaka.util.Stats.prototype.getStateHistory=function(){return this.stateHistory_},shaka.util.Stats.prototype.getSwitchHistory=function(){return this.switchHistory_},shaka.util.Stats.prototype.getBlob=function(){return{width:this.width_,height:this.height_,streamBandwidth:this.variantBandwidth_,decodedFrames:this.totalDecodedFrames_,droppedFrames:this.totalDroppedFrames_,estimatedBandwidth:this.bandwidthEstimate_,loadLatency:this.loadLatencySeconds_,playTime:this.stateHistory_.getTimeSpentIn("playing"),pauseTime:this.stateHistory_.getTimeSpentIn("paused"),bufferingTime:this.stateHistory_.getTimeSpentIn("buffering"),stateHistory:this.stateHistory_.getCopy(),switchHistory:this.switchHistory_.getCopy()}},shaka.util.Stats.getEmptyBlob=function(){return{width:NaN,height:NaN,streamBandwidth:NaN,decodedFrames:NaN,droppedFrames:NaN,estimatedBandwidth:NaN,loadLatency:NaN,playTime:NaN,pauseTime:NaN,bufferingTime:NaN,switchHistory:[],stateHistory:[]}},shaka.Player=function(a,b){var c=this;shaka.util.FakeEventTarget.call(this),this.loadMode_=shaka.Player.LoadMode.NOT_LOADED,this.video_=null,this.isTextVisible_=!1,this.eventManager_=new shaka.util.EventManager,this.abrManagerFactory_=this.abrManager_=this.assetUri_=this.manifest_=this.parser_=this.streamingEngine_=this.regionTimeline_=this.bufferObserver_=this.bufferPoller_=this.playRateController_=this.playheadObservers_=this.playhead_=this.mediaSourceEngine_=this.drmEngine_=this.networkingEngine_=null,this.nextExternalStreamId_=1e9,this.loadingTextStreams_=new Set,this.switchingPeriods_=!0,this.deferredVariant_=null,this.deferredVariantClearBuffer_=!1,this.deferredVariantClearBufferSafeMargin_=0,this.deferredTextStream_=null,this.activeStreams_=new shaka.media.ActiveStreamMap,this.config_=this.defaultConfig_(),this.maxHwRes_={width:1/0,height:1/0},this.stats_=null,this.currentAdaptationSetCriteria_=new shaka.media.PreferenceBasedCriteria(this.config_.preferredAudioLanguage,this.config_.preferredVariantRole,this.config_.preferredAudioChannelCount),this.currentTextLanguage_=this.config_.preferredTextLanguage,this.currentTextRole_=this.config_.preferredTextRole,b&&b(this),this.networkingEngine_=this.createNetworkingEngine(),this.eventManager_.listen(window,"online",function(){c.retryStreaming()}),this.detachNode_={name:"detach"},this.attachNode_={name:"attach"},this.unloadNode_={name:"unload"},this.parserNode_={name:"manifest-parser"},this.manifestNode_={name:"manifest"},this.mediaSourceNode_={name:"media-source"},this.drmNode_={name:"drm-engine"},this.loadNode_={name:"load"},this.srcEqualsDrmNode_={name:"src-equals-drm-engine"},this.srcEqualsNode_={name:"src-equals"};var d=shaka.util.AbortableOperation,e=new Map;e.set(this.attachNode_,function(a,b){return d.notAbortable(c.onAttach_(a,b))}),e.set(this.detachNode_,function(a,b){return d.notAbortable(c.onDetach_(a,b))}),e.set(this.unloadNode_,function(a,b){return d.notAbortable(c.onUnload_(a,b))}),e.set(this.mediaSourceNode_,function(a,b){var e=c.onInitializeMediaSourceEngine_(a,b);return d.notAbortable(e)}),e.set(this.parserNode_,function(a,b){var e=c.onInitializeParser_(a,b);return d.notAbortable(e)}),e.set(this.manifestNode_,function(a,b){return c.onParseManifest_(a,b)}),e.set(this.drmNode_,function(a,b){var e=c.onInitializeDrm_(a,b);return d.notAbortable(e)}),e.set(this.loadNode_,function(a,b){return d.notAbortable(c.onLoad_(a,b))}),e.set(this.srcEqualsDrmNode_,function(a,b){var e=c.onInitializeSrcEqualsDrm_(a,b);return d.notAbortable(e)}),e.set(this.srcEqualsNode_,function(a,b){return c.onSrcEquals_(a,b)}),this.walker_=new shaka.routing.Walker(this.detachNode_,this.createEmptyPayload_(),{getNext:function(a,b,d,e){return c.getNextStep_(a,b,d,e)},enterNode:function(a,b,d){return c.dispatchEvent(new shaka.util.FakeEvent("onstatechange",{state:a.name})),e.get(a)(b,d)},handleError:function(a,b){return $jscomp.asyncExecutePromiseGeneratorFunction(function d(){return $jscomp.generator.createGenerator(d,function(d){switch(d.nextAddress){case 1:return shaka.log.warning("The walker saw an error:"),b instanceof shaka.util.Error?shaka.log.warning("Error Code:",b.code):(shaka.log.warning("Error Message:",b.message),shaka.log.warning("Error Stack:",b.stack)),d["yield"](c.onUnload_(a,c.createEmptyPayload_()),2);case 2:return d["return"](a.mediaElement?c.attachNode_:c.detachNode_)}})})},onIdle:function(a){c.dispatchEvent(new shaka.util.FakeEvent("onstateidle",{state:a.name}))}}),a&&this.attach(a,!0)},goog.inherits(shaka.Player,shaka.util.FakeEventTarget),goog.exportSymbol("shaka.Player",shaka.Player),shaka.Player.prototype.destroy=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function b(){var c;return $jscomp.generator.createGenerator(b,function(b){switch(b.nextAddress){case 1:return a.loadMode_==shaka.Player.LoadMode.DESTROYED?b["return"]():(a.loadMode_=shaka.Player.LoadMode.DESTROYED,c=a.walker_.startNewRoute(function(b){return{node:a.detachNode_,payload:a.createEmptyPayload_(),interruptible:!1}}),b["yield"](new Promise(function(a){c.onStart=function(){shaka.log.info("Preparing to destroy walker...")},c.onEnd=function(){a()},c.onCancel=function(){goog.asserts.assert(!1,"Our final detach call should never be cancelled."),a()},c.onError=function(){goog.asserts.assert(!1,"Our final detach call should never see an error"),a()},c.onSkip=function(){goog.asserts.assert(!1,"Our final detach call should never be skipped"),a()}}),2));case 2:return b["yield"](a.walker_.destroy(),3);case 3:if(a.eventManager_&&(a.eventManager_.release(),a.eventManager_=null),a.abrManagerFactory_=null,a.abrManager_=null,a.config_=null,!a.networkingEngine_){b.jumpTo(0);break}return b["yield"](a.networkingEngine_.destroy(),5);case 5:a.networkingEngine_=null,b.jumpToEnd()}})})},goog.exportProperty(shaka.Player.prototype,"destroy",shaka.Player.prototype.destroy),shaka.Player.version="2.5.5-npm-dirty-debug",goog.exportProperty(shaka.Player,"version",shaka.Player.version),shaka.Deprecate.init(shaka.Player.version),shaka.Player.restrictedStatuses_=["output-restricted","internal-error"],shaka.Player.supportPlugins_={},shaka.Player.registerSupportPlugin=function(a,b){shaka.Player.supportPlugins_[a]=b},goog.exportProperty(shaka.Player,"registerSupportPlugin",shaka.Player.registerSupportPlugin),shaka.Player.isBrowserSupported=function(){return!!(window.Promise&&window.Uint8Array&&Array.prototype.forEach&&shaka.media.DrmEngine.isBrowserSupported())&&(!!shaka.util.Platform.supportsMediaSource()||shaka.util.Platform.supportsMediaType("application/x-mpegurl"))},goog.exportProperty(shaka.Player,"isBrowserSupported",shaka.Player.isBrowserSupported),shaka.Player.probeSupport=function(){return goog.asserts.assert(shaka.Player.isBrowserSupported(),"Must have basic support"),shaka.media.DrmEngine.probeSupport().then(function(a){var b=shaka.media.ManifestParser.probeSupport(),c=shaka.media.MediaSourceEngine.probeSupport();a={manifest:b,media:c,drm:a},b=shaka.Player.supportPlugins_;for(var d in b)a[d]=b[d]();return a})},goog.exportProperty(shaka.Player,"probeSupport",shaka.Player.probeSupport),shaka.Player.prototype.attach=function(a,b){if(b=void 0===b||b,this.loadMode_==shaka.Player.LoadMode.DESTROYED)return Promise.reject(this.createAbortLoadError_());var c=this.createEmptyPayload_();c.mediaElement=a,shaka.util.Platform.supportsMediaSource()||(b=!1);var d=b?this.mediaSourceNode_:this.attachNode_,e=this.walker_.startNewRoute(function(a){return{node:d,payload:c,interruptible:!1}});return e.onStart=function(){return shaka.log.info("Starting attach...")},this.wrapWalkerListenersWithPromise_(e)},goog.exportProperty(shaka.Player.prototype,"attach",shaka.Player.prototype.attach),shaka.Player.prototype.detach=function(){var a=this;if(this.loadMode_==shaka.Player.LoadMode.DESTROYED)return Promise.reject(this.createAbortLoadError_());var b=this.walker_.startNewRoute(function(b){return{node:a.detachNode_,payload:a.createEmptyPayload_(),interruptible:!1}});return b.onStart=function(){return shaka.log.info("Starting detach...")},this.wrapWalkerListenersWithPromise_(b)},goog.exportProperty(shaka.Player.prototype,"detach",shaka.Player.prototype.detach),shaka.Player.prototype.unload=function(a){var b=this;if(a=void 0===a||a,this.loadMode_==shaka.Player.LoadMode.DESTROYED)return Promise.reject(this.createAbortLoadError_());shaka.util.Platform.supportsMediaSource()||(a=!1);var c=this.createEmptyPayload_(),d=this.walker_.startNewRoute(function(d){var e=d.mediaElement&&a?b.mediaSourceNode_:d.mediaElement?b.attachNode_:b.detachNode_;return goog.asserts.assert(e,"We should have picked a destination."),c.mediaElement=d.mediaElement,{node:e,payload:c,interruptible:!1}});return d.onStart=function(){return shaka.log.info("Starting unload...")},this.wrapWalkerListenersWithPromise_(d)},goog.exportProperty(shaka.Player.prototype,"unload",shaka.Player.prototype.unload),shaka.Player.prototype.load=function(a,b,c){var d=this;if(this.loadMode_==shaka.Player.LoadMode.DESTROYED)return Promise.reject(this.createAbortLoadError_());this.dispatchEvent(new shaka.util.FakeEvent("loading"));var e=this.createEmptyPayload_();e.uri=a,e.startTimeOfLoad=Date.now()/1e3,c&&"string"!=typeof c&&(shaka.Deprecate.deprecateFeature(2,6,"Loading with a manifest parser factory","Please register a manifest parser and for the mime-type."),e.factory=function(){return new c}),c&&"string"==typeof c&&(e.mimeType=c),void 0!==b&&(e.startTime=b);var f=this.shouldUseSrcEquals_(e)?this.srcEqualsNode_:this.loadNode_,g=this.walker_.startNewRoute(function(a){return null==a.mediaElement?null:(e.mediaElement=a.mediaElement,{node:f,payload:e,interruptible:!0})});return g.onStart=function(){return shaka.log.info("Starting load of "+a+"...")},new Promise(function(a,b){g.onSkip=function(){return b(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.NO_VIDEO_ELEMENT))},g.onEnd=function(){return a()},g.onCancel=function(){return b(d.createAbortLoadError_())},g.onError=function(a){return b(a)}})},goog.exportProperty(shaka.Player.prototype,"load",shaka.Player.prototype.load),shaka.Player.prototype.shouldUseSrcEquals_=function(a){var b=shaka.util.Platform;if(a.factory)return!1;if(!b.supportsMediaSource())return!0;var c=a.mimeType,d=a.uri||"";return c||(c={mp4:"video/mp4",m4v:"video/mp4",m4a:"audio/mp4",webm:"video/webm",ts:"video/mp2t",m3u8:"application/x-mpegurl",mp3:"audio/mpeg",aac:"audio/aac",flac:"audio/flac"}[shaka.media.ManifestParser.getExtension(d)]),!!c&&(!!(a=b.supportsMediaType(c))&&(!(c=shaka.media.ManifestParser.isSupported(d,c))||(goog.asserts.assert(a&&c,"Both native and MSE playback should be possible!"),b.isApple())))},shaka.Player.prototype.onAttach_=function(a,b){var c=this;return goog.asserts.assert(null==a.mediaElement||a.mediaElement==b.mediaElement,"The routing logic failed. MediaElement requirement failed."),null==a.mediaElement&&(a.mediaElement=b.mediaElement,this.eventManager_.listen(a.mediaElement,"error",function(a){return c.onVideoError_(a)})),this.video_=a.mediaElement,Promise.resolve()},shaka.Player.prototype.onDetach_=function(a,b){return a.mediaElement&&(this.eventManager_.unlisten(a.mediaElement,"error"),a.mediaElement=null),this.video_=null,Promise.resolve()},shaka.Player.prototype.onUnload_=function(a,b){var c=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function d(){return $jscomp.generator.createGenerator(d,function(b){switch(b.nextAddress){case 1:if(c.loadMode_!=shaka.Player.LoadMode.DESTROYED&&(c.loadMode_=shaka.Player.LoadMode.NOT_LOADED),c.dispatchEvent(new shaka.util.FakeEvent("unloading")),a.factory=null,a.mimeType=null,a.startTime=null,a.uri=null,a.mediaElement&&(c.eventManager_.unlisten(a.mediaElement,"loadeddata"),c.eventManager_.unlisten(a.mediaElement,"playing"),c.eventManager_.unlisten(a.mediaElement,"pause"),c.eventManager_.unlisten(a.mediaElement,"ended"),c.eventManager_.unlisten(a.mediaElement,"ratechange")),c.playheadObservers_&&(c.playheadObservers_.release(),c.playheadObservers_=null),c.bufferPoller_&&(c.bufferPoller_.stop(),c.bufferPoller_=null),!c.parser_){b.jumpTo(2);break}return b["yield"](c.parser_.stop(),3);case 3:c.parser_=null;case 2:if(!c.abrManager_){b.jumpTo(4);break}return b["yield"](c.abrManager_.stop(),4);case 4:if(!c.streamingEngine_){b.jumpTo(6);break}return b["yield"](c.streamingEngine_.destroy(),7);case 7:c.streamingEngine_=null;case 6:if(c.playhead_&&(c.playhead_.release(),c.playhead_=null),!c.mediaSourceEngine_){b.jumpTo(8);break}return b["yield"](c.mediaSourceEngine_.destroy(),9);case 9:c.mediaSourceEngine_=null;case 8:if(a.mediaElement&&a.mediaElement.src&&!shaka.util.Platform.isWebOS()&&(a.mediaElement.removeAttribute("src"),a.mediaElement.load()),!c.drmEngine_){b.jumpTo(10);break}return b["yield"](c.drmEngine_.destroy(),11);case 11:c.drmEngine_=null;case 10:c.activeStreams_.clear(),c.assetUri_=null,c.bufferObserver_=null,c.loadingTextStreams_.clear(),c.manifest_=null,c.stats_=null,c.lastTextFactory_=null,c.switchingPeriods_=!0,c.updateBufferState_(),b.jumpToEnd()}})})},shaka.Player.prototype.onInitializeMediaSourceEngine_=function(a,b){var c=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function d(){var e,f,g,h;return $jscomp.generator.createGenerator(d,function(d){switch(d.nextAddress){case 1:return goog.asserts.assert(shaka.util.Platform.supportsMediaSource(),"We should not be initializing media source on a platform that does not support media source."),goog.asserts.assert(a.mediaElement,"We should have a media element when initializing media source."),goog.asserts.assert(a.mediaElement==b.mediaElement,"|has| and |wants| should have the same media element when initializing media source."),goog.asserts.assert(null==c.mediaSourceEngine_,"We should not have a media source engine yet."),e=shaka.media.MuxJSClosedCaptionParser.isSupported()?new shaka.media.MuxJSClosedCaptionParser:new shaka.media.NoopCaptionParser,f=c.config_.textDisplayFactory,g=new f,c.lastTextFactory_=f,h=c.createMediaSourceEngine(a.mediaElement,e,g),d["yield"](h.open(),2);case 2:c.mediaSourceEngine_=h,d.jumpToEnd()}})})},shaka.Player.prototype.onInitializeParser_=function(a,b){var c=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function d(){var e,f,g;return $jscomp.generator.createGenerator(d,function(d){switch(d.nextAddress){case 1:if(goog.asserts.assert(a.mediaElement,"We should have a media element when initializing the parser."),goog.asserts.assert(a.mediaElement==b.mediaElement,"|has| and |wants| should have the same media element when initializing the parser."),goog.asserts.assert(c.networkingEngine_,"Need networking engine when initializing the parser."),goog.asserts.assert(c.config_,"Need player config when initializing the parser."),a.factory=b.factory,a.mimeType=b.mimeType,a.uri=b.uri,goog.asserts.assert(a.uri,"We should have an asset uri when initializing the parsing."),e=a.uri,f=c.networkingEngine_,c.assetUri_=e,a.factory){c.parser_=a.factory(),d.jumpTo(2);break}return g=c,d["yield"](shaka.media.ManifestParser.create(e,f,c.config_.manifest.retryParameters,a.mimeType),3);case 3:g.parser_=d.yieldResult;case 2:c.parser_.configure(c.config_.manifest),d.jumpToEnd()}})})},shaka.Player.prototype.onParseManifest_=function(a,b){var c=this;goog.asserts.assert(a.factory==b.factory,"|has| and |wants| should have the same factory when parsing."),goog.asserts.assert(a.mimeType==b.mimeType,"|has| and |wants| should have the same mime type when parsing."),goog.asserts.assert(a.uri==b.uri,"|has| and |wants| should have the same uri when parsing."),goog.asserts.assert(a.uri,"|has| should have a valid uri when parsing."),goog.asserts.assert(a.uri==this.assetUri_,"|has.uri| should match the cached asset uri."),goog.asserts.assert(this.networkingEngine_,"Need networking engine to parse manifest."),goog.asserts.assert(this.config_,"Need player config to parse manifest."),goog.asserts.assert(this.parser_,"|this.parser_| should have been set in an earlier step.");var d=a.uri,e=this.networkingEngine_;this.regionTimeline_=new shaka.media.RegionTimeline,this.regionTimeline_.setListeners(function(a){c.onRegionEvent_("timelineregionadded",a)});var f={networkingEngine:e,filterNewPeriod:function(a){return c.filterNewPeriod_(a)},filterAllPeriods:function(a){return c.filterAllPeriods_(a)},onTimelineRegionAdded:function(a){return c.regionTimeline_.addRegion(a)},onEvent:function(a){return c.dispatchEvent(a)},onError:function(a){return c.onError_(a)}};return new shaka.util.AbortableOperation(Promise.resolve().then(function(){return $jscomp.asyncExecutePromiseGeneratorFunction(function a(){var b;return $jscomp.generator.createGenerator(a,function(a){switch(a.nextAddress){case 1:return b=c,a["yield"](c.parser_.start(d,f),2);case 2:if(b.manifest_=a.yieldResult,c.dispatchEvent(new shaka.util.FakeEvent("manifestparsed")),0==c.manifest_.periods.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.NO_PERIODS);shaka.Player.filterForAVVariants_(c.manifest_.periods),a.jumpToEnd()}})})}),function(){return shaka.log.info("Aborting parser step..."),c.parser_.stop()})},shaka.Player.prototype.onInitializeDrm_=function(a,b){var c=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function d(){return $jscomp.generator.createGenerator(d,function(d){switch(d.nextAddress){case 1:return goog.asserts.assert(a.factory==b.factory,"The load graph should have ensured the factories matched."),goog.asserts.assert(a.mimeType==b.mimeType,"The load graph should have ensured the mime types matched."),goog.asserts.assert(a.uri==b.uri,"The load graph should have ensured the uris matched"),goog.asserts.assert(c.networkingEngine_,"|onInitializeDrm_| should never be called after |destroy|"),goog.asserts.assert(c.config_,"|onInitializeDrm_| should never be called after |destroy|"),goog.asserts.assert(c.manifest_,"|this.manifest_| should have been set in an earlier step."),c.drmEngine_=c.createDrmEngine({netEngine:c.networkingEngine_,onError:function(a){c.onError_(a)},onKeyStatus:function(a){c.onKeyStatus_(a)},onExpirationUpdated:function(a,b){c.onExpirationUpdated_(a,b)},onEvent:function(a){c.dispatchEvent(a)}}),c.drmEngine_.configure(c.config_.drm),d["yield"](c.drmEngine_.initForPlayback(shaka.util.Periods.getAllVariantsFrom(c.manifest_.periods),c.manifest_.offlineSessionIds),2);case 2:c.filterAllPeriods_(c.manifest_.periods),d.jumpToEnd()}})})},shaka.Player.prototype.onLoad_=function(a,b){var c=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function d(){var e,f,g,h,i,j,k,l,m,n;return $jscomp.generator.createGenerator(d,function(d){switch(d.nextAddress){case 1:return goog.asserts.assert(a.factory==b.factory,"|has| and |wants| should have the same factory when loading."),goog.asserts.assert(a.mimeType==b.mimeType,"|has| and |wants| should have the same mime type when loading."),goog.asserts.assert(a.uri==b.uri,"|has| and |wants| should have the same uri when loading."),goog.asserts.assert(a.mediaElement,"We should have a media element when loading."),goog.asserts.assert(b.startTimeOfLoad,"|wants| should tell us when the load was originally requested"),a.startTime=b.startTime,e=a.mediaElement,f=a.uri,c.assetUri_=f,c.stats_=new shaka.util.Stats,g=function(){return c.updateStateHistory_()},h=function(){return c.onRateChange_()},c.eventManager_.listen(e,"playing",g),c.eventManager_.listen(e,"pause",g),c.eventManager_.listen(e,"ended",g),c.eventManager_.listen(e,"ratechange",h),i=c.config_.abrFactory,c.abrManager_&&c.abrManagerFactory_==i||(c.abrManagerFactory_=i,c.abrManager_=new i,c.abrManager_.configure(c.config_.abr)),c.createTextStreamsForClosedCaptions_(c.manifest_.periods),c.currentAdaptationSetCriteria_=new shaka.media.PreferenceBasedCriteria(c.config_.preferredAudioLanguage,c.config_.preferredVariantRole,c.config_.preferredAudioChannelCount),c.currentTextLanguage_=c.config_.preferredTextLanguage,shaka.Player.applyPlayRange_(c.manifest_.presentationTimeline,c.config_.playRangeStart,c.config_.playRangeEnd),d["yield"](c.drmEngine_.attach(e),2);case 2:return c.abrManager_.init(function(a,b,d){return c.switch_(a,b,d)}),c.playhead_=c.createPlayhead(a.startTime),c.playheadObservers_=c.createPlayheadObserversForMSE_(),c.playRateController_=new shaka.media.PlayRateController({getRate:function(){return a.mediaElement.playbackRate},setRate:function(b){a.mediaElement.playbackRate=b},movePlayhead:function(b){a.mediaElement.currentTime+=b}}),j=Math.max(c.manifest_.minBufferTime,c.config_.streaming.rebufferingGoal),c.startBufferManagement_(j),c.streamingEngine_=c.createStreamingEngine(),c.streamingEngine_.configure(c.config_.streaming),c.chooseCodecsAndFilterManifest_(),c.loadMode_=shaka.Player.LoadMode.MEDIA_SOURCE,c.dispatchEvent(new shaka.util.FakeEvent("streaming")),d["yield"](c.streamingEngine_.start(),3);case 3:c.config_.streaming.startAtSegmentBoundary&&(k=c.playhead_.getTime(),l=c.adjustStartTime_(k),c.playhead_.setStartTime(l)),c.manifest_.periods.forEach(c.filterNewPeriod_.bind(c)),c.onTracksChanged_(),c.onAdaptation_(),m=c.getPresentationPeriod_()||c.manifest_.periods[0],n=m.variants.some(function(a){return a.primary}),c.config_.preferredAudioLanguage||n||shaka.log.warning("No preferred audio language set.  We will choose an arbitrary language initially"),c.chooseVariant_(m.variants),c.eventManager_.listenOnce(e,"loadeddata",function(){var a=Date.now()/1e3-b.startTimeOfLoad;c.stats_.setLoadLatency(a)}),d.jumpToEnd()}})})},shaka.Player.prototype.onInitializeSrcEqualsDrm_=function(a,b){var c=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function d(){var b,e;return $jscomp.generator.createGenerator(d,function(d){switch(d.nextAddress){case 1:return b=shaka.util.ManifestParserUtils.ContentType,goog.asserts.assert(c.networkingEngine_,"|onInitializeSrcEqualsDrm_| should never be called after |destroy|"),goog.asserts.assert(c.config_,"|onInitializeSrcEqualsDrm_| should never be called after |destroy|"),c.drmEngine_=c.createDrmEngine({netEngine:c.networkingEngine_,onError:function(a){c.onError_(a)},onKeyStatus:function(a){c.onKeyStatus_(a)},onExpirationUpdated:function(a,b){c.onExpirationUpdated_(a,b)},onEvent:function(a){c.dispatchEvent(a)}}),c.drmEngine_.configure(c.config_.drm),e={id:0,language:"und",primary:!1,audio:null,video:{id:0,originalId:null,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(a){return null},getSegmentReference:function(a){return null},initSegmentReference:null,presentationTimeOffset:0,mimeType:"video/mp4",codecs:"",encrypted:!0,keyId:null,language:"und",label:null,type:b.VIDEO,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,closedCaptions:null},bandwidth:100,drmInfos:[],allowedByApplication:!0,allowedByKeySystem:!0},d["yield"](c.drmEngine_.initForPlayback([e],[]),2);case 2:return d["yield"](c.drmEngine_.attach(a.mediaElement),0)}})})},shaka.Player.prototype.onSrcEquals_=function(a,b){var c=this;goog.asserts.assert(a.mediaElement,"We should have a media element when loading."),goog.asserts.assert(b.uri,"|has| should have a valid uri when loading."),goog.asserts.assert(b.startTimeOfLoad,"|wants| should tell us when the load was originally requested"),goog.asserts.assert(this.video_==a.mediaElement,"The video element should match our media element"),a.uri=b.uri,a.startTime=b.startTime,this.assetUri_=a.uri,this.stats_=new shaka.util.Stats,this.playhead_=new shaka.media.SrcEqualsPlayhead(a.mediaElement),
null!=a.startTime&&this.playhead_.setStartTime(a.startTime),this.playRateController_=new shaka.media.PlayRateController({getRate:function(){return a.mediaElement.playbackRate},setRate:function(b){a.mediaElement.playbackRate=b},movePlayhead:function(b){a.mediaElement.currentTime+=b}}),this.startBufferManagement_(this.config_.streaming.rebufferingGoal);var d=function(){return c.updateStateHistory_()};this.eventManager_.listen(a.mediaElement,"playing",d),this.eventManager_.listen(a.mediaElement,"pause",d),this.eventManager_.listen(a.mediaElement,"ended",d),this.eventManager_.listenOnce(a.mediaElement,"loadeddata",function(){var a=Date.now()/1e3-b.startTimeOfLoad;c.stats_.setLoadLatency(a)}),this.video_.audioTracks&&(this.eventManager_.listen(this.video_.audioTracks,"addtrack",function(){return c.onTracksChanged_()}),this.eventManager_.listen(this.video_.audioTracks,"removetrack",function(){return c.onTracksChanged_()})),this.video_.textTracks&&(d=this.video_.textTracks,this.eventManager_.listen(d,"addtrack",function(){return c.onTracksChanged_()}),this.eventManager_.listen(d,"removetrack",function(){return c.onTracksChanged_()})),a.mediaElement.src=a.uri,this.loadMode_=shaka.Player.LoadMode.SRC_EQUALS,this.dispatchEvent(new shaka.util.FakeEvent("streaming"));var e=new shaka.util.PublicPromise;return this.video_.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA?e.resolve():this.video_.error?e.reject(this.videoErrorToShakaError_()):(this.eventManager_.listenOnce(this.video_,"loadeddata",function(){e.resolve()}),this.eventManager_.listenOnce(this.video_,"error",function(){e.reject(c.videoErrorToShakaError_())})),new shaka.util.AbortableOperation(e,function(){var a=new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.OPERATION_ABORTED);return e.reject(a),Promise.resolve()})},shaka.Player.filterForAVVariants_=function(a){var b=function(a){return a.video&&a.audio||a.video&&a.video.codecs.includes(",")};a.some(function(a){return a.variants.some(b)})&&(shaka.log.debug("Found variant with audio and video content, so filtering out audio-only content in all periods."),a.forEach(function(a){a.variants=a.variants.filter(b)}))},shaka.Player.prototype.chooseCodecsAndFilterManifest_=function(){function a(a){var b="";a.video&&(b=shaka.util.MimeUtils.getCodecBase(a.video.codecs));var c="";return a.audio&&(c=shaka.util.MimeUtils.getCodecBase(a.audio.codecs)),b+"-"+c}var b=this.manifest_.periods.reduce(function(a,b){return a.concat(b.variants)},[]);b=shaka.util.StreamUtils.filterVariantsByAudioChannelCount(b,this.config_.preferredAudioChannelCount);var c=new shaka.util.MultiMap;b.forEach(function(b){var d=a(b);c.push(d,b)});var d=null,e=1/0;c.forEach(function(a,b){var c=0,f=0;b.forEach(function(a){c+=a.bandwidth||0,++f});var g=c/f;shaka.log.debug("codecs",a,"avg bandwidth",g),g<e&&(d=a,e=g)}),goog.asserts.assert(null!=d,"Should have chosen codecs!"),goog.asserts.assert(!isNaN(e),"Bandwidth should be a number!"),this.manifest_.periods.forEach(function(b){b.variants=b.variants.filter(function(b){return a(b)==d||(shaka.log.debug("Dropping Variant (better codec available)",b),!1)})})},shaka.Player.prototype.createDrmEngine=function(a){return new shaka.media.DrmEngine(a)},shaka.Player.prototype.createNetworkingEngine=function(){var a=this;return new shaka.net.NetworkingEngine(function(b,c){a.abrManager_&&a.abrManager_.segmentDownloaded(b,c)})},shaka.Player.prototype.createPlayhead=function(a){var b=this;return goog.asserts.assert(this.manifest_,"Must have manifest"),goog.asserts.assert(this.video_,"Must have video"),new shaka.media.MediaSourcePlayhead(this.video_,this.manifest_,this.config_.streaming,a,function(){return b.onSeek_()},function(a){return b.dispatchEvent(a)})},shaka.Player.prototype.createPlayheadObserversForMSE_=function(){var a=this;goog.asserts.assert(this.manifest_,"Must have manifest"),goog.asserts.assert(this.regionTimeline_,"Must have region timeline"),goog.asserts.assert(this.video_,"Must have video element");var b=new shaka.media.PeriodObserver(this.manifest_);b.setListeners(function(b){return a.onChangePeriod_()});var c=new shaka.media.RegionObserver(this.regionTimeline_);c.setListeners(function(b,c){a.onRegionEvent_("timelineregionenter",b)},function(b,c){a.onRegionEvent_("timelineregionexit",b)},function(b,c){c||(a.onRegionEvent_("timelineregionenter",b),a.onRegionEvent_("timelineregionexit",b))});var d=new shaka.media.PlayheadObserverManager(this.video_);return d.manage(b),d.manage(c),d},shaka.Player.prototype.startBufferManagement_=function(a){var b=this;goog.asserts.assert(!this.bufferObserver_,"No buffering observer should exist before initialization."),goog.asserts.assert(!this.bufferPoller_,"No buffer timer should exist before initialization."),this.bufferObserver_=new shaka.media.BufferingObserver(a,Math.min(shaka.Player.TYPICAL_BUFFERING_THRESHOLD_,a/2)),this.bufferObserver_.setState(shaka.media.BufferingObserver.State.STARVING),this.updateBufferState_(),this.bufferPoller_=new shaka.util.Timer(function(){b.pollBufferState_()}).tickEvery(.25)},shaka.Player.prototype.pollBufferState_=function(){switch(goog.asserts.assert(this.video_,"Need a media element to update the buffering observer"),goog.asserts.assert(this.bufferObserver_,"Need a buffering observer to update"),this.loadMode_){case shaka.Player.LoadMode.SRC_EQUALS:var a=this.isBufferedToEndSrc_();break;case shaka.Player.LoadMode.MEDIA_SOURCE:a=this.isBufferedToEndMS_();break;default:a=!1}var b=shaka.media.TimeRangesUtils.bufferedAheadOf(this.video_.buffered,this.video_.currentTime);this.bufferObserver_.update(b,a)&&this.updateBufferState_()},shaka.Player.prototype.createMediaSourceEngine=function(a,b,c){return new shaka.media.MediaSourceEngine(a,b,c)},shaka.Player.prototype.createStreamingEngine=function(){var a=this;goog.asserts.assert(this.playhead_&&this.abrManager_&&this.mediaSourceEngine_&&this.manifest_,"Must not be destroyed");var b={getPresentationTime:function(){return a.playhead_.getTime()},getBandwidthEstimate:function(){return a.abrManager_.getBandwidthEstimate()},mediaSourceEngine:this.mediaSourceEngine_,netEngine:this.networkingEngine_,onChooseStreams:this.onChooseStreams_.bind(this),onCanSwitch:this.canSwitch_.bind(this),onError:this.onError_.bind(this),onEvent:function(b){return a.dispatchEvent(b)},onManifestUpdate:this.onManifestUpdate_.bind(this),onSegmentAppended:this.onSegmentAppended_.bind(this)};return new shaka.media.StreamingEngine(this.manifest_,b)},shaka.Player.prototype.configure=function(a,b){goog.asserts.assert(this.config_,"Config must not be null!"),goog.asserts.assert("object"==typeof a||2==arguments.length,"String configs should have values!"),2==arguments.length&&"string"==typeof a&&(a=shaka.util.ConfigUtils.convertToConfigObject(a,b)),goog.asserts.assert("object"==typeof a,"Should be an object!");var c=shaka.util.PlayerConfiguration.mergeConfigObjects(this.config_,a,this.defaultConfig_());return this.applyConfig_(),c},goog.exportProperty(shaka.Player.prototype,"configure",shaka.Player.prototype.configure),shaka.Player.prototype.applyConfig_=function(){if(this.parser_&&this.parser_.configure(this.config_.manifest),this.drmEngine_&&this.drmEngine_.configure(this.config_.drm),this.streamingEngine_){this.streamingEngine_.configure(this.config_.streaming);try{this.manifest_.periods.forEach(this.filterNewPeriod_.bind(this))}catch(a){this.onError_(a)}var b=this.streamingEngine_.getBufferingAudio(),c=this.streamingEngine_.getBufferingVideo(),d=this.getPresentationPeriod_();b=shaka.util.StreamUtils.getVariantByStreams(b,c,d.variants),this.abrManager_&&b&&b.allowedByApplication&&b.allowedByKeySystem?this.chooseVariant_(d.variants):(shaka.log.debug("Choosing new streams after changing configuration"),this.chooseStreamsAndSwitch_(d))}this.mediaSourceEngine_&&(d=this.config_.textDisplayFactory,this.lastTextFactory_!=d&&(b=new d,this.mediaSourceEngine_.setTextDisplayer(b),this.lastTextFactory_=d,this.streamingEngine_&&this.streamingEngine_.reloadTextStream())),this.abrManager_&&(this.abrManager_.configure(this.config_.abr),this.config_.abr.enabled&&!this.switchingPeriods_?this.abrManager_.enable():this.abrManager_.disable(),this.onAbrStatusChanged_())},shaka.Player.prototype.getConfiguration=function(){goog.asserts.assert(this.config_,"Config must not be null!");var a=this.defaultConfig_();return shaka.util.PlayerConfiguration.mergeConfigObjects(a,this.config_,this.defaultConfig_()),a},goog.exportProperty(shaka.Player.prototype,"getConfiguration",shaka.Player.prototype.getConfiguration),shaka.Player.prototype.getSharedConfiguration=function(){return goog.asserts.assert(this.config_,"Cannot call getSharedConfiguration after call destroy!"),this.config_},shaka.Player.prototype.resetConfiguration=function(){goog.asserts.assert(this.config_,"Cannot be destroyed");for(var a in this.config_)delete this.config_[a];shaka.util.PlayerConfiguration.mergeConfigObjects(this.config_,this.defaultConfig_(),this.defaultConfig_()),this.applyConfig_()},goog.exportProperty(shaka.Player.prototype,"resetConfiguration",shaka.Player.prototype.resetConfiguration),shaka.Player.prototype.getLoadMode=function(){return this.loadMode_},goog.exportProperty(shaka.Player.prototype,"getLoadMode",shaka.Player.prototype.getLoadMode),shaka.Player.prototype.getMediaElement=function(){return this.video_},goog.exportProperty(shaka.Player.prototype,"getMediaElement",shaka.Player.prototype.getMediaElement),shaka.Player.prototype.getNetworkingEngine=function(){return this.networkingEngine_},goog.exportProperty(shaka.Player.prototype,"getNetworkingEngine",shaka.Player.prototype.getNetworkingEngine),shaka.Player.prototype.getAssetUri=function(){return this.assetUri_},goog.exportProperty(shaka.Player.prototype,"getAssetUri",shaka.Player.prototype.getAssetUri),shaka.Player.prototype.getManifestUri=function(){return shaka.Deprecate.deprecateFeature(2,6,"getManifestUri",'Please use "getAssetUri" instead.'),this.getAssetUri()},goog.exportProperty(shaka.Player.prototype,"getManifestUri",shaka.Player.prototype.getManifestUri),shaka.Player.prototype.isLive=function(){return this.manifest_?this.manifest_.presentationTimeline.isLive():!(!this.video_||!this.video_.src)&&1/0==this.video_.duration},goog.exportProperty(shaka.Player.prototype,"isLive",shaka.Player.prototype.isLive),shaka.Player.prototype.isInProgress=function(){return!!this.manifest_&&this.manifest_.presentationTimeline.isInProgress()},goog.exportProperty(shaka.Player.prototype,"isInProgress",shaka.Player.prototype.isInProgress),shaka.Player.prototype.isAudioOnly=function(){if(this.manifest_){if(!this.manifest_.periods.length)return!1;var a=this.manifest_.periods[0].variants;return!!a.length&&!a[0].video}return!(!this.video_||!this.video_.src)&&(this.video_.videoTracks?0==this.video_.videoTracks.length:0==this.video_.videoHeight)},goog.exportProperty(shaka.Player.prototype,"isAudioOnly",shaka.Player.prototype.isAudioOnly),shaka.Player.prototype.seekRange=function(){if(this.manifest_){var a=this.manifest_.presentationTimeline;return{start:a.getSeekRangeStart(),end:a.getSeekRangeEnd()}}return this.video_&&this.video_.src&&(a=this.video_.seekable,a.length)?{start:a.start(0),end:a.end(a.length-1)}:{start:0,end:0}},goog.exportProperty(shaka.Player.prototype,"seekRange",shaka.Player.prototype.seekRange),shaka.Player.prototype.keySystem=function(){return this.drmEngine_?this.drmEngine_.keySystem():""},goog.exportProperty(shaka.Player.prototype,"keySystem",shaka.Player.prototype.keySystem),shaka.Player.prototype.drmInfo=function(){return this.drmEngine_?this.drmEngine_.getDrmInfo():null},goog.exportProperty(shaka.Player.prototype,"drmInfo",shaka.Player.prototype.drmInfo),shaka.Player.prototype.getExpiration=function(){return this.drmEngine_?this.drmEngine_.getExpiration():1/0},goog.exportProperty(shaka.Player.prototype,"getExpiration",shaka.Player.prototype.getExpiration),shaka.Player.prototype.isBuffering=function(){var a=shaka.media.BufferingObserver.State;return!!this.bufferObserver_&&this.bufferObserver_.getState()==a.STARVING},goog.exportProperty(shaka.Player.prototype,"isBuffering",shaka.Player.prototype.isBuffering),shaka.Player.prototype.getPlaybackRate=function(){return this.playRateController_?this.playRateController_.getActiveRate():0},goog.exportProperty(shaka.Player.prototype,"getPlaybackRate",shaka.Player.prototype.getPlaybackRate),shaka.Player.prototype.trickPlay=function(a){goog.asserts.assert(0!=a,"Should never set a trick play rate of 0!"),0==a?shaka.log.alwaysWarn("A trick play rate of 0 is unsupported!"):(this.video_.paused&&this.video_.play(),this.playRateController_.set(a),this.loadMode_==shaka.Player.LoadMode.MEDIA_SOURCE&&this.streamingEngine_.setTrickPlay(1<Math.abs(a)))},goog.exportProperty(shaka.Player.prototype,"trickPlay",shaka.Player.prototype.trickPlay),shaka.Player.prototype.cancelTrickPlay=function(){this.loadMode_==shaka.Player.LoadMode.SRC_EQUALS&&this.playRateController_.set(1),this.loadMode_==shaka.Player.LoadMode.MEDIA_SOURCE&&(this.playRateController_.set(1),this.streamingEngine_.setTrickPlay(!1))},goog.exportProperty(shaka.Player.prototype,"cancelTrickPlay",shaka.Player.prototype.cancelTrickPlay),shaka.Player.prototype.getVariantTracks=function(){if(this.manifest_&&this.playhead_){for(var a=this.getPresentationVariant_(),b=[],c=$jscomp.makeIterator(this.getSelectableVariants_()),d=c.next();!d.done;d=c.next()){d=d.value;var e=shaka.util.StreamUtils.variantToTrack(d);e.active=d==a,b.push(e)}return b}return this.video_&&this.video_.audioTracks?Array.from(this.video_.audioTracks).map(function(a){return shaka.util.StreamUtils.html5AudioTrackToTrack(a)}):[]},goog.exportProperty(shaka.Player.prototype,"getVariantTracks",shaka.Player.prototype.getVariantTracks),shaka.Player.prototype.getTextTracks=function(){if(this.manifest_&&this.playhead_){for(var a=this.getPresentationText_(),b=[],c=$jscomp.makeIterator(this.getSelectableText_()),d=c.next();!d.done;d=c.next()){d=d.value;var e=shaka.util.StreamUtils.textStreamToTrack(d);e.active=d==a,b.push(e)}return b}if(this.video_&&this.video_.src&&this.video_.textTracks){a=Array.from(this.video_.textTracks);var f=shaka.util.StreamUtils;return a.map(function(a){return f.html5TextTrackToTrack(a)})}return[]},goog.exportProperty(shaka.Player.prototype,"getTextTracks",shaka.Player.prototype.getTextTracks),shaka.Player.prototype.selectTextTrack=function(a){if(this.manifest_&&this.streamingEngine_){var b=this.getPresentationPeriod_(),c=b.textStreams.find(function(b){return b.id==a.id});c?(this.addTextStreamToSwitchHistory_(b,c,!1),this.switchTextStream_(c),this.currentTextLanguage_=c.language):shaka.log.error("No stream with id",a.id)}else if(this.video_&&this.video_.src&&this.video_.textTracks){for(b=Array.from(this.video_.textTracks),b=$jscomp.makeIterator(b),c=b.next();!c.done;c=b.next())c=c.value,shaka.util.StreamUtils.html5TrackId(c)==a.id?c.mode=this.isTextVisible_?"showing":"hidden":c.mode="disabled";this.onTextChanged_()}},goog.exportProperty(shaka.Player.prototype,"selectTextTrack",shaka.Player.prototype.selectTextTrack),shaka.Player.prototype.selectEmbeddedTextTrack=function(){shaka.Deprecate.deprecateFeature(2,6,"selectEmbeddedTextTrack","If closed captions are signaled in the manifest, a text stream will be created to represent them. Please use SelectTextTrack.");var a=this.getTextTracks().filter(function(a){return a.mimeType==shaka.util.MimeUtils.CLOSED_CAPTION_MIMETYPE});0<a.length?this.selectTextTrack(a[0]):shaka.log.warning("Unable to find the text track embedded in the video.")},goog.exportProperty(shaka.Player.prototype,"selectEmbeddedTextTrack",shaka.Player.prototype.selectEmbeddedTextTrack),shaka.Player.prototype.usingEmbeddedTextTrack=function(){shaka.Deprecate.deprecateFeature(2,6,"usingEmbeddedTextTrack","If closed captions are signaled in the manifest, a text stream will be created to represent them. There should be no reason to know if the player is playing embedded text.");var a=this.getTextTracks().filter(function(a){return a.active})[0];return!!a&&a.mimeType==shaka.util.MimeUtils.CLOSED_CAPTION_MIMETYPE},goog.exportProperty(shaka.Player.prototype,"usingEmbeddedTextTrack",shaka.Player.prototype.usingEmbeddedTextTrack),shaka.Player.prototype.selectVariantTrack=function(a,b,c){if(c=void 0===c?0:c,this.manifest_&&this.streamingEngine_){var d=this.getPresentationPeriod_();this.config_.abr.enabled&&shaka.log.alwaysWarn("Changing tracks while abr manager is enabled will likely result in the selected track being overriden. Consider disabling abr before calling selectVariantTrack().");var e=d.variants.find(function(b){return b.id==a.id});e?shaka.util.StreamUtils.isPlayable(e)?(this.addVariantToSwitchHistory_(d,e,!1),this.switchVariant_(e,b,c),this.currentAdaptationSetCriteria_=new shaka.media.ExampleBasedCriteria(e),this.chooseVariant_(d.variants)):shaka.log.error("Unable to switch to restricted track",a.id):shaka.log.error("No variant with id",a.id)}else if(this.video_&&this.video_.audioTracks){for(b=Array.from(this.video_.audioTracks),b=$jscomp.makeIterator(b),c=b.next();!c.done;c=b.next())c=c.value,shaka.util.StreamUtils.html5TrackId(c)==a.id&&(c.enabled=!0);this.onVariantChanged_()}},goog.exportProperty(shaka.Player.prototype,"selectVariantTrack",shaka.Player.prototype.selectVariantTrack),shaka.Player.prototype.getAudioLanguagesAndRoles=function(){return shaka.Player.getLanguageAndRolesFrom_(this.getVariantTracks())},goog.exportProperty(shaka.Player.prototype,"getAudioLanguagesAndRoles",shaka.Player.prototype.getAudioLanguagesAndRoles),shaka.Player.prototype.getTextLanguagesAndRoles=function(){return shaka.Player.getLanguageAndRolesFrom_(this.getTextTracks())},goog.exportProperty(shaka.Player.prototype,"getTextLanguagesAndRoles",shaka.Player.prototype.getTextLanguagesAndRoles),shaka.Player.prototype.getAudioLanguages=function(){return Array.from(shaka.Player.getLanguagesFrom_(this.getVariantTracks()))},goog.exportProperty(shaka.Player.prototype,"getAudioLanguages",shaka.Player.prototype.getAudioLanguages),shaka.Player.prototype.getTextLanguages=function(){return Array.from(shaka.Player.getLanguagesFrom_(this.getTextTracks()))},goog.exportProperty(shaka.Player.prototype,"getTextLanguages",shaka.Player.prototype.getTextLanguages),shaka.Player.prototype.selectAudioLanguage=function(a,b){if(this.manifest_&&this.playhead_){var c=this.getPresentationPeriod_();this.currentAdaptationSetCriteria_=new shaka.media.PreferenceBasedCriteria(a,b||"",0),this.chooseStreamsAndSwitch_(c)}else if(this.video_&&this.video_.audioTracks){c=Array.from(this.video_.audioTracks),c=$jscomp.makeIterator(c);for(var d=c.next();!d.done;d=c.next())d=d.value,d.language==a&&(d.enabled=!0);this.onVariantChanged_()}},goog.exportProperty(shaka.Player.prototype,"selectAudioLanguage",shaka.Player.prototype.selectAudioLanguage),shaka.Player.prototype.selectTextLanguage=function(a,b){if(this.manifest_&&this.playhead_){var c=this.getPresentationPeriod_();this.currentTextLanguage_=a,this.currentTextRole_=b||"";var d=this.chooseTextStream_(c.textStreams);d&&(this.addTextStreamToSwitchHistory_(c,d,!1),this.shouldStreamText_()&&this.switchTextStream_(d))}else(c=this.getTextTracks().filter(function(b){return b.language==a})[0])&&this.selectTextTrack(c)},goog.exportProperty(shaka.Player.prototype,"selectTextLanguage",shaka.Player.prototype.selectTextLanguage),shaka.Player.prototype.isTextTrackVisible=function(){var a=this.isTextVisible_;if(this.manifest_){var b=this.mediaSourceEngine_.getTextDisplayer().isTextVisible();return goog.asserts.assert(b==a,"text visibility has fallen out of sync"),b}return this.video_&&this.video_.src&&this.video_.textTracks?Array.from(this.video_.textTracks).some(function(a){return"showing"==a.mode}):a},goog.exportProperty(shaka.Player.prototype,"isTextTrackVisible",shaka.Player.prototype.isTextTrackVisible),shaka.Player.prototype.setTextTrackVisibility=function(a){var b=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function c(){var d,e,f,g,h,i;return $jscomp.generator.createGenerator(c,function(c){switch(c.nextAddress){case 1:if(d=b.isTextVisible_,e=a,d==e)return c["return"]();if(b.isTextVisible_=e,b.loadMode_!=shaka.Player.LoadMode.MEDIA_SOURCE){if(b.video_&&b.video_.src&&b.video_.textTracks){f=Array.from(b.video_.textTracks);for(var j=$jscomp.makeIterator(f),k=j.next();!k.done;k=j.next())g=k.value,"disabled"!=g.mode&&(g.mode=a?"showing":"hidden")}c.jumpTo(2);break}if(b.mediaSourceEngine_.getTextDisplayer().setTextVisibility(a),b.config_.streaming.alwaysStreamText){c.jumpTo(2);break}if(!a){b.streamingEngine_.unloadTextStream(),c.jumpTo(2);break}if(h=b.getPresentationPeriod_(),i=shaka.util.StreamUtils.filterStreamsByLanguageAndRole(h.textStreams,b.currentTextLanguage_,b.currentTextRole_),!(0<i.length)){c.jumpTo(2);break}return c["yield"](b.streamingEngine_.loadNewTextStream(i[0]),2);case 2:b.onTextTrackVisibility_(),c.jumpToEnd()}})})},goog.exportProperty(shaka.Player.prototype,"setTextTrackVisibility",shaka.Player.prototype.setTextTrackVisibility),shaka.Player.prototype.getPlayheadTimeAsDate=function(){if(!this.isLive())return shaka.log.warning("getPlayheadTimeAsDate is for live streams!"),null;if(this.manifest_){var a=this.manifest_.presentationTimeline.getPresentationStartTime();return new Date(1e3*(a+this.video_.currentTime))}return this.video_&&this.video_.getStartDate?(a=this.video_.getStartDate(),isNaN(a.getTime())?(shaka.log.warning("EXT-X-PROGRAM-DATETIME required to get playhead time as Date!"),null):new Date(a.getTime()+1e3*this.video_.currentTime)):(shaka.log.warning("No way to get playhead time as Date!"),null)},goog.exportProperty(shaka.Player.prototype,"getPlayheadTimeAsDate",shaka.Player.prototype.getPlayheadTimeAsDate),shaka.Player.prototype.getPresentationStartTimeAsDate=function(){if(!this.isLive())return shaka.log.warning("getPresentationStartTimeAsDate is for live streams!"),null;if(this.manifest_){var a=this.manifest_.presentationTimeline.getPresentationStartTime();return new Date(1e3*a)}return this.video_&&this.video_.getStartDate?(a=this.video_.getStartDate(),isNaN(a.getTime())?(shaka.log.warning("EXT-X-PROGRAM-DATETIME required to get presentation start time as Date!"),null):a):(shaka.log.warning("No way to get presentation start time as Date!"),null)},goog.exportProperty(shaka.Player.prototype,"getPresentationStartTimeAsDate",shaka.Player.prototype.getPresentationStartTimeAsDate),shaka.Player.prototype.getBufferedInfo=function(){var a={total:[],audio:[],video:[],text:[]};return this.loadMode_==shaka.Player.LoadMode.SRC_EQUALS&&(a.total=shaka.media.TimeRangesUtils.getBufferedInfo(this.video_.buffered)),this.loadMode_==shaka.Player.LoadMode.MEDIA_SOURCE&&this.mediaSourceEngine_.getBufferedInfo(a),a},goog.exportProperty(shaka.Player.prototype,"getBufferedInfo",shaka.Player.prototype.getBufferedInfo),shaka.Player.prototype.getStats=function(){if(this.loadMode_!=shaka.Player.LoadMode.MEDIA_SOURCE&&this.loadMode_!=shaka.Player.LoadMode.SRC_EQUALS)return shaka.util.Stats.getEmptyBlob();this.updateStateHistory_(),goog.asserts.assert(this.video_,"If we have stats, we should have video_");var a=this.video_;return a.getVideoPlaybackQuality&&(a=a.getVideoPlaybackQuality(),this.stats_.setDroppedFrames(Number(a.droppedVideoFrames),Number(a.totalVideoFrames))),this.loadMode_==shaka.Player.LoadMode.MEDIA_SOURCE&&((a=this.getPresentationVariant_())&&this.stats_.setVariantBandwidth(a.bandwidth),a&&a.video&&this.stats_.setResolution(a.video.width||NaN,a.video.height||NaN),a=this.abrManager_.getBandwidthEstimate(),this.stats_.setBandwidthEstimate(a)),this.stats_.getBlob()},goog.exportProperty(shaka.Player.prototype,"getStats",shaka.Player.prototype.getStats),shaka.Player.prototype.addTextTrack=function(a,b,c,d,e,f){var g=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function h(){var i,j,k,l,m,n,o,p,q;return $jscomp.generator.createGenerator(h,function(h){switch(h.nextAddress){case 1:if(g.loadMode_==shaka.Player.LoadMode.SRC_EQUALS)throw shaka.log.error("Cannot add text when loaded with src="),Error("State error!");if(g.loadMode_!=shaka.Player.LoadMode.MEDIA_SOURCE)throw shaka.log.error("Must call load() and wait for it to resolve before adding text tracks."),Error("State error!");if(i=g.getPresentationPeriod_(),j=shaka.util.ManifestParserUtils.ContentType,k=g.manifest_.periods.indexOf(i),l=k+1,m=l>=g.manifest_.periods.length?g.manifest_.presentationTimeline.getDuration():g.manifest_.periods[l].startTime,n=m-i.startTime,1/0==n)throw new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.CANNOT_ADD_EXTERNAL_TEXT_TO_LIVE_STREAM);return o=new shaka.media.SegmentReference(1,0,n,function(){return[a]},0,null),p={id:g.nextExternalStreamId_++,originalId:null,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(a){return 1},getSegmentReference:function(a){return 1==a?o:null},initSegmentReference:null,presentationTimeOffset:0,mimeType:d,codecs:e||"",kind:c,encrypted:!1,keyId:null,language:b,label:f||null,type:j.TEXT,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,closedCaptions:null},g.loadingTextStreams_.add(p),i.textStreams.push(p),h["yield"](g.streamingEngine_.loadNewTextStream(p),2);case 2:return goog.asserts.assert(i,"The period should still be non-null here."),(q=g.streamingEngine_.getBufferingText())&&g.activeStreams_.useText(i,q),g.loadingTextStreams_["delete"](p),shaka.log.debug("Choosing new streams after adding a text stream"),g.chooseStreamsAndSwitch_(i),g.onTracksChanged_(),h["return"](shaka.util.StreamUtils.textStreamToTrack(p))}})})},goog.exportProperty(shaka.Player.prototype,"addTextTrack",shaka.Player.prototype.addTextTrack),shaka.Player.prototype.setMaxHardwareResolution=function(a,b){this.maxHwRes_.width=a,this.maxHwRes_.height=b},goog.exportProperty(shaka.Player.prototype,"setMaxHardwareResolution",shaka.Player.prototype.setMaxHardwareResolution),shaka.Player.prototype.retryStreaming=function(){return this.loadMode_==shaka.Player.LoadMode.MEDIA_SOURCE&&this.streamingEngine_.retry()},goog.exportProperty(shaka.Player.prototype,"retryStreaming",shaka.Player.prototype.retryStreaming),shaka.Player.prototype.getManifest=function(){return this.manifest_},goog.exportProperty(shaka.Player.prototype,"getManifest",shaka.Player.prototype.getManifest),shaka.Player.prototype.getManifestParserFactory=function(){return this.parser_?this.parser_.constructor:null},goog.exportProperty(shaka.Player.prototype,"getManifestParserFactory",shaka.Player.prototype.getManifestParserFactory),shaka.Player.prototype.addVariantToSwitchHistory_=function(a,b,c){this.activeStreams_.useVariant(a,b),this.stats_.getSwitchHistory().updateCurrentVariant(b,c)},shaka.Player.prototype.addTextStreamToSwitchHistory_=function(a,b,c){this.activeStreams_.useText(a,b),this.stats_.getSwitchHistory().updateCurrentText(b,c)},shaka.Player.prototype.defaultConfig_=function(){var a=this,b=shaka.util.PlayerConfiguration.createDefault();b.streaming.failureCallback=function(b){a.defaultStreamingFailureCallback_(b)};var c=this;return b.textDisplayFactory=function(){return new shaka.text.SimpleTextDisplayer(c.video_)},b},shaka.Player.prototype.defaultStreamingFailureCallback_=function(a){var b=[shaka.util.Error.Code.BAD_HTTP_STATUS,shaka.util.Error.Code.HTTP_ERROR,shaka.util.Error.Code.TIMEOUT];this.isLive()&&b.includes(a.code)&&(a.severity=shaka.util.Error.Severity.RECOVERABLE,shaka.log.warning("Live streaming error.  Retrying automatically..."),this.retryStreaming())},shaka.Player.prototype.createTextStreamsForClosedCaptions_=function(a){for(var b=shaka.util.ManifestParserUtils.ContentType,c=0;c<a.length;c++){for(var d=a[c],e=new Map,f=$jscomp.makeIterator(d.variants),g=f.next();!g.done;g=f.next())if(g=g.value,g.video&&g.video.closedCaptions){g=g.video;for(var h=$jscomp.makeIterator(g.closedCaptions.keys()),i=h.next();!i.done;i=h.next())if(i=i.value,!e.has(i)){var j={id:this.nextExternalStreamId_++,originalId:i,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(a){return null},getSegmentReference:function(a){return null},initSegmentReference:null,presentationTimeOffset:0,mimeType:shaka.util.MimeUtils.CLOSED_CAPTION_MIMETYPE,codecs:"",kind:shaka.util.ManifestParserUtils.TextStreamKind.CLOSED_CAPTION,encrypted:!1,keyId:null,language:g.closedCaptions.get(i),label:null,type:b.TEXT,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:g.roles,channelsCount:null,closedCaptions:null};e.set(i,j)}}for(e=$jscomp.makeIterator(e.values()),f=e.next();!f.done;f=e.next())d.textStreams.push(f.value)}},shaka.Player.prototype.filterAllPeriods_=function(a){goog.asserts.assert(this.video_,"Must not be destroyed");var b=shaka.util.ArrayUtils,c=shaka.util.StreamUtils,d=this.streamingEngine_?this.streamingEngine_.getBufferingAudio():null,e=this.streamingEngine_?this.streamingEngine_.getBufferingVideo():null;if(d=c.filterNewPeriod.bind(null,this.drmEngine_,d,e),a.forEach(d),b=b.count(a,function(a){return a.variants.some(c.isPlayable)}),0==b)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.CONTENT_UNSUPPORTED_BY_BROWSER);if(b<a.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.UNPLAYABLE_PERIOD);a.forEach(function(a){shaka.util.StreamUtils.applyRestrictions(a.variants,this.config_.restrictions,this.maxHwRes_)&&this.streamingEngine_&&this.getPresentationPeriod_()==a&&this.onTracksChanged_(),this.checkRestrictedVariants_(a.variants)}.bind(this))},shaka.Player.prototype.filterNewPeriod_=function(a){goog.asserts.assert(this.video_,"Must not be destroyed");var b=shaka.util.StreamUtils,c=this.streamingEngine_?this.streamingEngine_.getBufferingAudio():null,d=this.streamingEngine_?this.streamingEngine_.getBufferingVideo():null;if(b.filterNewPeriod(this.drmEngine_,c,d,a),c=a.variants,!c.some(b.isPlayable))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.UNPLAYABLE_PERIOD);if(this.checkRestrictedVariants_(a.variants),shaka.util.StreamUtils.applyRestrictions(c,this.config_.restrictions,this.maxHwRes_)&&this.streamingEngine_&&this.getPresentationPeriod_()==a&&this.onTracksChanged_(),a=this.drmEngine_?this.drmEngine_.getDrmInfo():null)for(b=$jscomp.makeIterator(c),c=b.next();!c.done;c=b.next())for(c=$jscomp.makeIterator(c.value.drmInfos),d=c.next();!d.done;d=c.next())if(d=d.value,d.keySystem==a.keySystem){d=$jscomp.makeIterator(d.initData||[]);for(var e=d.next();!e.done;e=d.next())e=e.value,this.drmEngine_.newInitData(e.initDataType,e.initData)}},shaka.Player.prototype.switchVariant_=function(a,b,c){b=void 0!==b&&b,c=void 0===c?0:c,this.switchingPeriods_?(this.deferredVariant_=a,this.deferredVariantClearBuffer_=b,this.deferredVariantClearBufferSafeMargin_=c):(this.streamingEngine_.switchVariant(a,b,c),this.onVariantChanged_())},shaka.Player.prototype.switchTextStream_=function(a){this.switchingPeriods_?this.deferredTextStream_=a:(this.streamingEngine_.switchTextStream(a),this.onTextChanged_())},shaka.Player.prototype.assertCorrectActiveStreams_=function(){if(this.streamingEngine_&&this.manifest_&&goog.DEBUG){var a=this.streamingEngine_.getBufferingPeriod(),b=this.getPresentationPeriod_();if(null!=a&&a==b){a=this.streamingEngine_.getBufferingAudio();var c=this.streamingEngine_.getBufferingVideo(),d=this.streamingEngine_.getBufferingText();a=this.deferredVariant_?this.deferredVariant_.audio:a,c=this.deferredVariant_?this.deferredVariant_.video:c,d=this.deferredTextStream_||d;var e=this.activeStreams_.getVariant(b);b=this.activeStreams_.getText(b),goog.asserts.assert(e.audio==a,"Inconsistent active audio stream"),goog.asserts.assert(e.video==c,"Inconsistent active video stream"),goog.asserts.assert(null==d||b==d,"Inconsistent active text stream")}}},shaka.Player.prototype.adjustStartTime_=function(a){
function b(a,b){if(!a)return null;var c=a.findSegmentPosition(b-e.startTime);return null==c?null:(c=a.getSegmentReference(c))?(c=c.startTime+e.startTime,goog.asserts.assert(c<=b,"Segment should start before time"),c):null}var c=this.streamingEngine_.getBufferingAudio(),d=this.streamingEngine_.getBufferingVideo(),e=this.getPresentationPeriod_();return c=b(c,a),d=b(d,a),null!=d&&null!=c?Math.max(d,c):null!=d?d:null!=c?c:a},shaka.Player.prototype.updateBufferState_=function(){var a=this.isBuffering();this.stats_&&this.bufferObserver_&&this.playhead_&&(this.playRateController_.setBuffering(a),this.updateStateHistory_()),a=new shaka.util.FakeEvent("buffering",{buffering:a}),this.dispatchEvent(a)},shaka.Player.prototype.onChangePeriod_=function(){this.onTracksChanged_()},shaka.Player.prototype.onRateChange_=function(){var a=this.video_.playbackRate;0!=a&&this.playRateController_.set(a)},shaka.Player.prototype.updateStateHistory_=function(){if(this.stats_&&this.bufferObserver_){var a=shaka.media.BufferingObserver.State,b=this.stats_.getStateHistory();this.bufferObserver_.getState()==a.STARVING?b.update("buffering"):this.video_.paused?b.update("paused"):this.video_.ended?b.update("ended"):b.update("playing")}},shaka.Player.prototype.onSeek_=function(){this.playheadObservers_&&this.playheadObservers_.notifyOfSeek(),this.streamingEngine_&&this.streamingEngine_.seeked()},shaka.Player.prototype.chooseVariant_=function(a){goog.asserts.assert(this.config_,"Must not be destroyed");try{this.checkRestrictedVariants_(a)}catch(b){return this.onError_(b),null}return goog.asserts.assert(a.length,"Should have thrown for no Variants."),a=a.filter(function(a){return shaka.util.StreamUtils.isPlayable(a)}),a=this.currentAdaptationSetCriteria_.create(a),this.abrManager_.setVariants(Array.from(a.values())),this.abrManager_.chooseVariant()},shaka.Player.prototype.chooseTextStream_=function(a){return shaka.util.StreamUtils.filterStreamsByLanguageAndRole(a,this.currentTextLanguage_,this.currentTextRole_)[0]||null},shaka.Player.prototype.chooseStreamsAndSwitch_=function(a){goog.asserts.assert(this.config_,"Must not be destroyed");var b=this.chooseVariant_(a.variants);b&&(this.addVariantToSwitchHistory_(a,b,!0),this.switchVariant_(b,!0)),(b=this.chooseTextStream_(a.textStreams))&&this.shouldStreamText_()&&(this.addTextStreamToSwitchHistory_(a,b,!0),this.switchTextStream_(b)),this.onAdaptation_()},shaka.Player.prototype.onChooseStreams_=function(a){shaka.log.debug("onChooseStreams_",a),goog.asserts.assert(this.config_,"Must not be destroyed");try{shaka.log.v2("onChooseStreams_, choosing variant from ",a.variants),shaka.log.v2("onChooseStreams_, choosing text from ",a.textStreams);var b=this.chooseStreams_(a);return shaka.log.v2("onChooseStreams_, chose variant ",b.variant),shaka.log.v2("onChooseStreams_, chose text ",b.text),b}catch(c){return this.onError_(c),{variant:null,text:null}}},shaka.Player.prototype.chooseStreams_=function(a){this.switchingPeriods_=!0,this.abrManager_.disable(),this.onAbrStatusChanged_(),shaka.log.debug("Choosing new streams after period changed");var b=this.chooseVariant_(a.variants),c=this.chooseTextStream_(a.textStreams);this.deferredVariant_&&(a.variants.includes(this.deferredVariant_)&&(b=this.deferredVariant_),this.deferredVariant_=null),this.deferredTextStream_&&(a.textStreams.includes(this.deferredTextStream_)&&(c=this.deferredTextStream_),this.deferredTextStream_=null),b&&this.addVariantToSwitchHistory_(a,b,!0),c&&this.addTextStreamToSwitchHistory_(a,c,!0),a=!this.streamingEngine_.getBufferingPeriod();var d=b?b.audio:null;return a&&c&&(d&&this.shouldShowText_(d,c)&&(this.isTextVisible_=!0),this.isTextVisible_&&(this.mediaSourceEngine_.getTextDisplayer().setTextVisibility(!0),goog.asserts.assert(this.shouldStreamText_(),"Should be streaming text")),this.onTextTrackVisibility_()),this.shouldStreamText_()?{variant:b,text:c}:{variant:b,text:null}},shaka.Player.prototype.shouldShowText_=function(a,b){var c=shaka.util.LanguageUtils,d=c.normalize(this.config_.preferredTextLanguage),e=c.normalize(a.language),f=c.normalize(b.language);return c.areLanguageCompatible(f,d)&&!c.areLanguageCompatible(e,f)},shaka.Player.prototype.canSwitch_=function(){shaka.log.debug("canSwitch_"),goog.asserts.assert(this.config_,"Must not be destroyed"),this.switchingPeriods_=!1,this.config_.abr.enabled&&(this.abrManager_.enable(),this.onAbrStatusChanged_()),this.deferredVariant_&&(this.streamingEngine_.switchVariant(this.deferredVariant_,this.deferredVariantClearBuffer_,this.deferredVariantClearBufferSafeMargin_),this.onVariantChanged_(),this.deferredVariant_=null),this.deferredTextStream_&&(this.streamingEngine_.switchTextStream(this.deferredTextStream_),this.onTextChanged_(),this.deferredTextStream_=null)},shaka.Player.prototype.onManifestUpdate_=function(){this.parser_&&this.parser_.update&&this.parser_.update()},shaka.Player.prototype.onSegmentAppended_=function(){this.playhead_&&this.playhead_.notifyOfBufferingChange()},shaka.Player.prototype.switch_=function(a,b,c){b=void 0!==b&&b,c=void 0===c?0:c,shaka.log.debug("switch_"),goog.asserts.assert(this.config_.abr.enabled,"AbrManager should not call switch while disabled!"),goog.asserts.assert(!this.switchingPeriods_,"AbrManager should not call switch while transitioning between Periods!"),goog.asserts.assert(this.manifest_,"We need a manifest to switch variants.");var d=this.findPeriodWithVariant_(a);goog.asserts.assert(d,"A period should contain the variant."),this.addVariantToSwitchHistory_(d,a,!0),this.streamingEngine_&&(this.streamingEngine_.switchVariant(a,b,c),this.onAdaptation_())},shaka.Player.prototype.onAdaptation_=function(){this.delayDispatchEvent_(new shaka.util.FakeEvent("adaptation"))},shaka.Player.prototype.onTracksChanged_=function(){this.delayDispatchEvent_(new shaka.util.FakeEvent("trackschanged"))},shaka.Player.prototype.onVariantChanged_=function(){this.delayDispatchEvent_(new shaka.util.FakeEvent("variantchanged"))},shaka.Player.prototype.onTextChanged_=function(){this.delayDispatchEvent_(new shaka.util.FakeEvent("textchanged"))},shaka.Player.prototype.onTextTrackVisibility_=function(){this.delayDispatchEvent_(new shaka.util.FakeEvent("texttrackvisibility"))},shaka.Player.prototype.onAbrStatusChanged_=function(){this.delayDispatchEvent_(new shaka.util.FakeEvent("abrstatuschanged",{newStatus:this.config_.abr.enabled}))},shaka.Player.prototype.onError_=function(a){if(goog.asserts.assert(a instanceof shaka.util.Error,"Wrong error type!"),this.loadMode_!=shaka.Player.LoadMode.DESTROYED){var b=new shaka.util.FakeEvent("error",{detail:a});this.dispatchEvent(b),b.defaultPrevented&&(a.handled=!0)}},shaka.Player.prototype.onRegionEvent_=function(a,b){this.dispatchEvent(new shaka.util.FakeEvent(a,{detail:{schemeIdUri:b.schemeIdUri,value:b.value,startTime:b.startTime,endTime:b.endTime,id:b.id,eventElement:b.eventElement}}))},shaka.Player.prototype.videoErrorToShakaError_=function(){if(goog.asserts.assert(this.video_.error,"Video error expected, but missing!"),!this.video_.error)return null;var a=this.video_.error.code;if(1==a)return null;var b=this.video_.error.msExtendedCode;return b&&(0>b&&(b+=Math.pow(2,32)),b=b.toString(16)),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.VIDEO_ERROR,a,b,this.video_.error.message)},shaka.Player.prototype.onVideoError_=function(a){(a=this.videoErrorToShakaError_())&&this.onError_(a)},shaka.Player.prototype.onKeyStatus_=function(a){if(this.streamingEngine_){var b=shaka.Player.restrictedStatuses_,c=this.getPresentationPeriod_(),d=!1,e=Object.keys(a);0==e.length&&shaka.log.warning("Got a key status event without any key statuses, so we don't know the real key statuses. If we don't have all the keys, you'll need to set restrictions so we don't select those tracks.");var f=1==e.length&&"00"==e[0];f&&shaka.log.warning("Got a synthetic key status event, so we don't know the real key statuses. If we don't have all the keys, you'll need to set restrictions so we don't select those tracks."),e.length&&c.variants.forEach(function(c){shaka.util.StreamUtils.getVariantStreams(c).forEach(function(e){var g=c.allowedByKeySystem;e.keyId&&(e=a[f?"00":e.keyId],c.allowedByKeySystem=!!e&&!b.includes(e)),g!=c.allowedByKeySystem&&(d=!0)})}),e=this.streamingEngine_.getBufferingAudio();var g=this.streamingEngine_.getBufferingVideo();(e=shaka.util.StreamUtils.getVariantByStreams(e,g,c.variants))&&!e.allowedByKeySystem&&(shaka.log.debug("Choosing new streams after key status changed"),this.chooseStreamsAndSwitch_(c)),d&&(this.onTracksChanged_(),this.chooseVariant_(c.variants))}},shaka.Player.prototype.onExpirationUpdated_=function(a,b){this.parser_&&this.parser_.onExpirationUpdated&&this.parser_.onExpirationUpdated(a,b);var c=new shaka.util.FakeEvent("expirationupdated");this.dispatchEvent(c)},shaka.Player.prototype.shouldStreamText_=function(){return this.config_.streaming.alwaysStreamText||this.isTextTrackVisible()},shaka.Player.applyPlayRange_=function(a,b,c){0<b&&(a.isLive()?shaka.log.warning("|playRangeStart| has been configured for live content. Ignoring the setting."):a.setUserSeekStart(b)),b=a.getDuration(),c<b&&(a.isLive()?shaka.log.warning("|playRangeEnd| has been configured for live content. Ignoring the setting."):a.setDuration(c))},shaka.Player.prototype.checkRestrictedVariants_=function(a){var b=shaka.Player.restrictedStatuses_,c=this.drmEngine_?this.drmEngine_.getKeyStatuses():{},d=Object.keys(c);d=d.length&&"00"==d[0];var e=!1,f=!1,g=[],h=[];a=$jscomp.makeIterator(a);for(var i=a.next();!i.done;i=a.next()){i=i.value;var j=[];i.audio&&j.push(i.audio),i.video&&j.push(i.video),j=$jscomp.makeIterator(j);for(var k=j.next();!k.done;k=j.next())if(k=k.value,k.keyId){var l=c[d?"00":k.keyId];l?b.includes(l)&&(h.includes(l)||h.push(l)):g.includes(k.keyId)||g.push(k.keyId)}i.allowedByApplication?i.allowedByKeySystem&&(e=!0):f=!0}if(!e)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.RESTRICTIONS_CANNOT_BE_MET,{hasAppRestrictions:f,missingKeys:g,restrictedKeyStatuses:h})},shaka.Player.prototype.delayDispatchEvent_=function(a){var b=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function c(){return $jscomp.generator.createGenerator(c,function(c){switch(c.nextAddress){case 1:return c["yield"](Promise.resolve(),2);case 2:b.loadMode_!=shaka.Player.LoadMode.DESTROYED&&b.dispatchEvent(a),c.jumpToEnd()}})})},shaka.Player.getLanguagesFrom_=function(a){var b=new Set;a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next())c=c.value,c.language?b.add(shaka.util.LanguageUtils.normalize(c.language)):b.add("und");return b},shaka.Player.getLanguageAndRolesFrom_=function(a){var b=new Map;a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next()){var d=c.value;c="und";var e=[];for(d.language&&(c=shaka.util.LanguageUtils.normalize(d.language)),(e="variant"==d.type?d.audioRoles:d.roles)&&e.length||(e=[""]),b.has(c)||b.set(c,new Set),d=$jscomp.makeIterator(e),e=d.next();!e.done;e=d.next())e=e.value,b.get(c).add(e)}var f=[];return b.forEach(function(a,b){for(var c=$jscomp.makeIterator(a),d=c.next();!d.done;d=c.next())f.push({language:b,role:d.value})}),f},shaka.Player.prototype.getSelectableVariants_=function(){var a=this.getPresentationPeriod_();return null==a?[]:(this.assertCorrectActiveStreams_(),a.variants.filter(function(a){return shaka.util.StreamUtils.isPlayable(a)}))},shaka.Player.prototype.getSelectableText_=function(){var a=this,b=this.getPresentationPeriod_();return null==b?[]:(this.assertCorrectActiveStreams_(),b.textStreams.filter(function(b){return!a.loadingTextStreams_.has(b)}))},shaka.Player.prototype.getPresentationPeriod_=function(){goog.asserts.assert(this.manifest_&&this.playhead_,"Only ask for the presentation period when loaded with media source.");for(var a=this.playhead_.getTime(),b=null,c=$jscomp.makeIterator(this.manifest_.periods),d=c.next();!d.done;d=c.next())d=d.value,d.startTime<=a&&(b=d);return goog.asserts.assert(b,"Should have found a period."),b},shaka.Player.prototype.getPresentationVariant_=function(){var a=this.getPresentationPeriod_();return this.activeStreams_.getVariant(a)},shaka.Player.prototype.getPresentationText_=function(){var a=this.getPresentationPeriod_();if(null==a)return null;if(!this.activeStreams_.getText(a)){var b=shaka.util.StreamUtils.filterStreamsByLanguageAndRole(a.textStreams,this.currentTextLanguage_,this.currentTextRole_);b.length&&this.activeStreams_.useText(a,b[0])}return this.activeStreams_.getText(a)},shaka.Player.prototype.isBufferedToEndMS_=function(){if(goog.asserts.assert(this.video_,"We need a video element to get buffering information"),goog.asserts.assert(this.mediaSourceEngine_,"We need a media source engine to get buffering information"),goog.asserts.assert(this.manifest_,"We need a manifest to get buffering information"),this.video_.ended||this.mediaSourceEngine_.ended())return!0;if(this.manifest_.presentationTimeline.isLive()){var a=this.manifest_.presentationTimeline.getSegmentAvailabilityEnd();if(shaka.media.TimeRangesUtils.bufferEnd(this.video_.buffered)>=a)return!0}return!1},shaka.Player.prototype.isBufferedToEndSrc_=function(){return goog.asserts.assert(this.video_,"We need a video element to get buffering information"),!!this.video_.ended||shaka.media.TimeRangesUtils.bufferEnd(this.video_.buffered)>=this.video_.duration-.1},shaka.Player.prototype.findPeriodWithVariant_=function(a){for(var b=$jscomp.makeIterator(this.manifest_.periods),c=b.next();!c.done;c=b.next())if(c=c.value,c.variants.includes(a))return c;return null},shaka.Player.prototype.createAbortLoadError_=function(){return new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.LOAD_INTERRUPTED)},shaka.Player.prototype.getNextStep_=function(a,b,c,d){var e=null;return a==this.detachNode_&&(e=c==this.detachNode_?this.detachNode_:this.attachNode_),a==this.attachNode_&&(e=this.getNextAfterAttach_(c,b,d)),a==this.mediaSourceNode_&&(e=this.getNextAfterMediaSource_(c,b,d)),a==this.parserNode_&&(e=this.getNextMatchingAllDependencies_(this.loadNode_,this.manifestNode_,this.unloadNode_,c,b,d)),a==this.manifestNode_&&(e=this.getNextMatchingAllDependencies_(this.loadNode_,this.drmNode_,this.unloadNode_,c,b,d)),a==this.drmNode_&&(e=this.getNextMatchingAllDependencies_(this.loadNode_,this.loadNode_,this.unloadNode_,c,b,d)),a==this.srcEqualsDrmNode_&&(e=c==this.srcEqualsNode_&&b.mediaElement==d.mediaElement?this.srcEqualsNode_:this.unloadNode_),a!=this.loadNode_&&a!=this.srcEqualsNode_||(e=this.unloadNode_),a==this.unloadNode_&&(e=this.getNextAfterUnload_(c,b,d)),goog.asserts.assert(e,"Missing next step!"),e},shaka.Player.prototype.getNextAfterAttach_=function(a,b,c){return a==this.detachNode_||b.mediaElement!=c.mediaElement?this.detachNode_:a==this.attachNode_?this.attachNode_:a==this.mediaSourceNode_||a==this.loadNode_?this.mediaSourceNode_:a==this.srcEqualsNode_?this.srcEqualsDrmNode_:null},shaka.Player.prototype.getNextAfterMediaSource_=function(a,b,c){return a==this.loadNode_&&b.mediaElement==c.mediaElement?this.parserNode_:this.unloadNode_},shaka.Player.prototype.getNextAfterUnload_=function(a,b,c){return c.mediaElement&&b.mediaElement==c.mediaElement?this.attachNode_:this.detachNode_},shaka.Player.prototype.getNextMatchingAllDependencies_=function(a,b,c,d,e,f){return d==a&&e.mediaElement==f.mediaElement&&e.uri==f.uri&&e.mimeType==f.mimeType&&e.factory==f.factory?b:c},shaka.Player.prototype.createEmptyPayload_=function(){return{factory:null,mediaElement:null,mimeType:null,startTime:null,startTimeOfLoad:null,uri:null}},shaka.Player.prototype.wrapWalkerListenersWithPromise_=function(a){var b=this;return new Promise(function(c,d){a.onCancel=function(){return d(b.createAbortLoadError_())},a.onEnd=function(){return c()},a.onError=function(a){return d(a)},a.onSkip=function(){return d(b.createAbortLoadError_())}})},shaka.Player.LoadMode={DESTROYED:0,NOT_LOADED:1,MEDIA_SOURCE:2,SRC_EQUALS:3},goog.exportProperty(shaka.Player,"LoadMode",shaka.Player.LoadMode),shaka.Player.TYPICAL_BUFFERING_THRESHOLD_=.5,shaka.offline.StoredContentUtils=function(){},shaka.offline.StoredContentUtils.fromManifest=function(a,b,c,d){goog.asserts.assert(b.periods.length,"Cannot create stored content from manifest with no periods.");var e=void 0==b.expiration?1/0:b.expiration,f=b.presentationTimeline.getDuration();return b=shaka.offline.StoredContentUtils.getTracks_(b.periods[0]),{offlineUri:null,originalManifestUri:a,duration:f,size:c,expiration:e,tracks:b,appMetadata:d}},shaka.offline.StoredContentUtils.fromManifestDB=function(a,b){goog.asserts.assert(b.periods.length,"Cannot create stored content from manifestDB with no periods.");var c=new shaka.offline.ManifestConverter(a.mechanism(),a.cell()),d=b.periods[0],e=new shaka.media.PresentationTimeline(null,0);return d=c.fromPeriodDB(d,e),c=b.appMetadata||{},d=shaka.offline.StoredContentUtils.getTracks_(d),{offlineUri:a.toString(),originalManifestUri:b.originalManifestUri,duration:b.duration,size:b.size,expiration:b.expiration,tracks:d,appMetadata:c}},shaka.offline.StoredContentUtils.getTracks_=function(a){var b=shaka.util.StreamUtils,c=[],d=b.getPlayableVariants(a.variants);d=$jscomp.makeIterator(d);for(var e=d.next();!e.done;e=d.next())c.push(b.variantToTrack(e.value));for(a=$jscomp.makeIterator(a.textStreams),d=a.next();!d.done;d=a.next())c.push(b.textStreamToTrack(d.value));return c},shaka.offline.StreamBandwidthEstimator=function(){this.estimateByStreamId_={}},shaka.offline.StreamBandwidthEstimator.prototype.addVariant=function(a){var b=a.audio,c=a.video;if(b&&!c&&this.setBitrate_(b.id,b.bandwidth||a.bandwidth),!b&&c&&this.setBitrate_(c.id,c.bandwidth||a.bandwidth),b&&c){var d=b.bandwidth||shaka.offline.StreamBandwidthEstimator.DEFAULT_AUDIO_BITRATE_,e=c.bandwidth||a.bandwidth-d;0>=e&&(shaka.log.warning("Audio bit rate consumes variants bandwidth. Setting video bandwidth to match variant's bandwidth."),e=a.bandwidth),this.setBitrate_(b.id,d),this.setBitrate_(c.id,e)}},shaka.offline.StreamBandwidthEstimator.prototype.setBitrate_=function(a,b){this.estimateByStreamId_[a]=b},shaka.offline.StreamBandwidthEstimator.prototype.addText=function(a){this.estimateByStreamId_[a.id]=shaka.offline.StreamBandwidthEstimator.DEFAULT_TEXT_BITRATE_},shaka.offline.StreamBandwidthEstimator.prototype.getSegmentEstimate=function(a,b){var c=b.endTime-b.startTime;return this.getEstimate_(a)*c},shaka.offline.StreamBandwidthEstimator.prototype.getInitSegmentEstimate=function(a){return.5*this.getEstimate_(a)},shaka.offline.StreamBandwidthEstimator.prototype.getEstimate_=function(a){return a=this.estimateByStreamId_[a],null==a&&(a=0,shaka.log.error("Asking for bitrate of stream not given to the estimator")),0==a&&shaka.log.warning("Using bitrate of 0, this stream won't affect progress"),a},shaka.offline.StreamBandwidthEstimator.DEFAULT_AUDIO_BITRATE_=393216,shaka.offline.StreamBandwidthEstimator.DEFAULT_TEXT_BITRATE_=52,shaka.util.Destroyer=function(a){this.destroyed_=!1,this.waitOnDestroy_=new shaka.util.PublicPromise,this.onDestroy_=a},shaka.util.Destroyer.prototype.destroyed=function(){return this.destroyed_},shaka.util.Destroyer.prototype.destroy=function(){var a=this;return this.destroyed_?this.waitOnDestroy_:(this.destroyed_=!0,this.onDestroy_().then(function(){a.waitOnDestroy_.resolve()},function(){a.waitOnDestroy_.resolve()}))},shaka.util.ManifestFilter=function(){},shaka.util.ManifestFilter.filterByRestrictions=function(a,b,c){a=$jscomp.makeIterator(a.periods);for(var d=a.next();!d.done;d=a.next())d=d.value,d.variants=d.variants.filter(function(a){return shaka.util.StreamUtils.meetsRestrictions(a,b,c)})},shaka.util.ManifestFilter.filterByMediaSourceSupport=function(a){var b=shaka.media.MediaSourceEngine;a=$jscomp.makeIterator(a.periods);for(var c=a.next();!c.done;c=a.next())c=c.value,c.variants=c.variants.filter(function(a){var c=!0;return a.audio&&(c=c&&b.isStreamSupported(a.audio)),a.video&&(c=c&&b.isStreamSupported(a.video)),c})},shaka.util.ManifestFilter.filterByDrmSupport=function(a,b){for(var c=$jscomp.makeIterator(a.periods),d=c.next();!d.done;d=c.next())d=d.value,d.variants=d.variants.filter(function(a){return b.supportsVariant(a)})},shaka.util.ManifestFilter.filterByCommonCodecs=function(a){goog.asserts.assert(0<a.periods.length,"There should be at least be one period");var b=shaka.util.ManifestFilter,c=new shaka.util.ManifestFilter.VariantCodecSummarySet;a.periods.forEach(function(a,d){var e=b.VariantCodecSummarySet.fromVariants(a.variants);0==d?c.includeAll(e):c.onlyKeep(e)}),a=$jscomp.makeIterator(a.periods);for(var d=a.next();!d.done;d=a.next())d=d.value,d.variants=d.variants.filter(function(a){return a=new b.VariantCodecSummary(a),c.contains(a)})},shaka.util.ManifestFilter.rollingFilter=function(a,b){var c=shaka.util.ManifestFilter,d=new c.VariantCodecSummarySet;a.periods.forEach(function(a,e){0<e&&(a.variants=a.variants.filter(function(a){return a=new c.VariantCodecSummary(a),d.contains(a)})),b(a),d=c.VariantCodecSummarySet.fromVariants(a.variants)})},shaka.util.ManifestFilter.VariantCodecSummary=function(a){var b=a.audio;a=a.video,this.audioMime_=b?b.mimeType:null,this.audioCodec_=b?b.codecs.split(".")[0]:null,this.videoMime_=a?a.mimeType:null,this.videoCodec_=a?a.codecs.split(".")[0]:null},shaka.util.ManifestFilter.VariantCodecSummary.prototype.equals=function(a){return this.audioMime_==a.audioMime_&&this.audioCodec_==a.audioCodec_&&this.videoMime_==a.videoMime_&&this.videoCodec_==a.videoCodec_},shaka.util.ManifestFilter.VariantCodecSummarySet=function(){this.all_=[]},shaka.util.ManifestFilter.VariantCodecSummarySet.prototype.add=function(a){this.contains(a)||this.all_.push(a)},shaka.util.ManifestFilter.VariantCodecSummarySet.prototype.includeAll=function(a){a=$jscomp.makeIterator(a.all_);for(var b=a.next();!b.done;b=a.next())this.add(b.value)},shaka.util.ManifestFilter.VariantCodecSummarySet.prototype.onlyKeep=function(a){this.all_=this.all_.filter(function(b){return a.contains(b)})},shaka.util.ManifestFilter.VariantCodecSummarySet.prototype.contains=function(a){return this.all_.some(function(b){return a.equals(b)})},shaka.util.ManifestFilter.VariantCodecSummarySet.fromVariants=function(a){var b=new shaka.util.ManifestFilter.VariantCodecSummarySet;a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next())b.add(new shaka.util.ManifestFilter.VariantCodecSummary(c.value));return b},shaka.offline.Storage=function(a){var b=this;if(a&&a.constructor!=shaka.Player)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.LOCAL_PLAYER_INSTANCE_REQUIRED);this.networkingEngine_=this.config_=null,a?(this.config_=a.getSharedConfiguration(),this.networkingEngine_=a.getNetworkingEngine(),goog.asserts.assert(this.networkingEngine_,"Storage should not be initialized with a player that had |destroy| called on it.")):(this.config_=shaka.util.PlayerConfiguration.createDefault(),this.networkingEngine_=new shaka.net.NetworkingEngine),this.storeInProgress_=!1,this.segmentsFromStore_=[],this.openOperations_=[];var c=!a;this.destroyer_=new shaka.util.Destroyer(function(){return $jscomp.asyncExecutePromiseGeneratorFunction(function a(){var d;return $jscomp.generator.createGenerator(a,function(a){switch(a.nextAddress){case 1:return d=function(){},a["yield"](Promise.all(b.openOperations_.map(function(a){return a.then(d,d)})),2);case 2:if(!c){a.jumpTo(3);break}return a["yield"](b.networkingEngine_.destroy(),3);case 3:b.config_=null,b.networkingEngine_=null,a.jumpToEnd()}})})})},goog.exportSymbol("shaka.offline.Storage",shaka.offline.Storage),shaka.offline.Storage.support=function(){return!!shaka.util.Platform.supportsMediaSource()&&shaka.offline.StorageMuxer.support()},goog.exportProperty(shaka.offline.Storage,"support",shaka.offline.Storage.support),shaka.offline.Storage.prototype.destroy=function(){return this.destroyer_.destroy()},goog.exportProperty(shaka.offline.Storage.prototype,"destroy",shaka.offline.Storage.prototype.destroy),shaka.offline.Storage.prototype.configure=function(a,b){return goog.asserts.assert("object"==typeof a||2==arguments.length,"String configs should have values!"),2==arguments.length&&"string"==typeof a&&(a=shaka.util.ConfigUtils.convertToConfigObject(a,b)),goog.asserts.assert("object"==typeof a,"Should be an object!"),shaka.offline.Storage.verifyConfig_(a),goog.asserts.assert(this.config_,"Cannot reconfigure stroage after calling destroy."),shaka.util.PlayerConfiguration.mergeConfigObjects(this.config_,a)},goog.exportProperty(shaka.offline.Storage.prototype,"configure",shaka.offline.Storage.prototype.configure),shaka.offline.Storage.prototype.getConfiguration=function(){goog.asserts.assert(this.config_,"Config must not be null!");var a=shaka.util.PlayerConfiguration.createDefault();return shaka.util.PlayerConfiguration.mergeConfigObjects(a,this.config_,shaka.util.PlayerConfiguration.createDefault()),a},goog.exportProperty(shaka.offline.Storage.prototype,"getConfiguration",shaka.offline.Storage.prototype.getConfiguration),shaka.offline.Storage.prototype.getNetworkingEngine=function(){return this.networkingEngine_},goog.exportProperty(shaka.offline.Storage.prototype,"getNetworkingEngine",shaka.offline.Storage.prototype.getNetworkingEngine),shaka.offline.Storage.prototype.store=function(a,b,c){var d=this;return this.startOperation_(this.store_(a,b||{},function(){return $jscomp.asyncExecutePromiseGeneratorFunction(function b(){var e,f;return $jscomp.generator.createGenerator(b,function(b){switch(b.nextAddress){case 1:return c&&"string"!=typeof c?(shaka.Deprecate.deprecateFeature(2,6,"Storing with a manifest parser factory","Please register a manifest parser and for the mime-type."),e=c,b["return"](new e)):(goog.asserts.assert(d.networkingEngine_,"Should not call |store| after |destroy|"),b["yield"](shaka.media.ManifestParser.create(a,d.networkingEngine_,d.config_.manifest.retryParameters,c),2));case 2:return f=b.yieldResult,b["return"](f)}})})}))},goog.exportProperty(shaka.offline.Storage.prototype,"store",shaka.offline.Storage.prototype.store),shaka.offline.Storage.prototype.getStoreInProgress=function(){return this.storeInProgress_},goog.exportProperty(shaka.offline.Storage.prototype,"getStoreInProgress",shaka.offline.Storage.prototype.getStoreInProgress),shaka.offline.Storage.prototype.store_=function(a,b,c){var d=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function e(){var f,g,h,i,j,k,l,m,n,o;return $jscomp.generator.createGenerator(e,function(e){switch(e.nextAddress){case 1:return d.requireSupport_(),d.storeInProgress_?e["return"](Promise.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.STORE_ALREADY_IN_PROGRESS))):(d.storeInProgress_=!0,e["yield"](d.parseManifest(a,c),2));case 2:if(f=e.yieldResult,d.checkDestroyed_(),g=!f.presentationTimeline.isLive()&&!f.presentationTimeline.isInProgress(),!g)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.CANNOT_STORE_LIVE_OFFLINE,a);return h=null,i=new shaka.offline.StorageMuxer,k=j=null,e.setCatchFinallyBlocks(3,4),e["yield"](d.createDrmEngine(f,function(a){k=k||a}),6);case 6:if(h=e.yieldResult,d.checkDestroyed_(),k)throw k;return d.filterManifest_(f,h),e["yield"](i.init(),7);case 7:return d.checkDestroyed_(),e["yield"](i.getActive(),8);case 8:return j=e.yieldResult,d.checkDestroyed_(),goog.asserts.assert(h,"drmEngine should be non-null here."),e["yield"](d.downloadManifest_(j.cell,h,f,a,b),9);case 9:if(l=e.yieldResult,d.checkDestroyed_(),k)throw k;return e["yield"](j.cell.addManifests([l]),10);case 10:return m=e.yieldResult,d.checkDestroyed_(),n=shaka.offline.OfflineUri.manifest(j.path.mechanism,j.path.cell,m[0]),e["return"](shaka.offline.StoredContentUtils.fromManifestDB(n,l));case 4:return e.enterFinallyBlock(),d.storeInProgress_=!1,d.segmentsFromStore_=[],e["yield"](i.destroy(),11);case 11:if(!h){e.jumpTo(12);break}return e["yield"](h.destroy(),12);case 12:e.leaveFinallyBlock(0);break;case 3:if(o=e.enterCatchBlock(),!j){e.jumpTo(14);break}return e["yield"](j.cell.removeSegments(d.segmentsFromStore_,function(){}),14);case 14:throw k||o}})})},shaka.offline.Storage.prototype.filterManifest_=function(a,b){var c=this;shaka.util.ManifestFilter.filterByRestrictions(a,this.config_.restrictions,{width:1/0,height:1/0}),shaka.util.ManifestFilter.filterByMediaSourceSupport(a),shaka.util.ManifestFilter.filterByDrmSupport(a,b),shaka.util.ManifestFilter.filterByCommonCodecs(a),shaka.util.ManifestFilter.rollingFilter(a,function(a){for(var b=shaka.util.StreamUtils,d=[],e=$jscomp.makeIterator(a.variants),f=e.next();!f.done;f=e.next())f=f.value,goog.asserts.assert(b.isPlayable(f),'We should have already filtered by "is playable"'),d.push(b.variantToTrack(f));for(e=$jscomp.makeIterator(a.textStreams),f=e.next();!f.done;f=e.next())d.push(b.textStreamToTrack(f.value));b=c.config_.offline.trackSelectionCallback(d);var g=new Set,h=new Set;for(b=$jscomp.makeIterator(b),d=b.next();!d.done;d=b.next())d=d.value,"variant"==d.type&&g.add(d.id),"text"==d.type&&h.add(d.id);a.variants=a.variants.filter(function(a){return g.has(a.id)}),a.textStreams=a.textStreams.filter(function(a){return h.has(a.id)})}),shaka.offline.Storage.validateManifest_(a)},shaka.offline.Storage.prototype.downloadManifest_=function(a,b,c,d,e){var f=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function g(){var h,i,j,k;return $jscomp.generator.createGenerator(g,function(g){switch(g.nextAddress){case 1:return goog.asserts.assert(f.networkingEngine_,"Cannot call |downloadManifest_| after calling |destroy|."),h=shaka.offline.StoredContentUtils.fromManifest(d,c,0,e),i=new shaka.offline.DownloadManager(f.networkingEngine_,function(a,b){h.size=b,f.config_.offline.progressCallback(h,a)}),g.setFinallyBlock(2),k=j=f.createOfflineManifest_(i,a,b,c,d,e),g["yield"](i.waitToFinish(),4);case 4:return k.size=g.yieldResult,g["return"](j);case 2:return g.enterFinallyBlock(),g["yield"](i.destroy(),5);case 5:g.leaveFinallyBlock(0)}})})},shaka.offline.Storage.prototype.remove=function(a){return this.startOperation_(this.remove_(a))},goog.exportProperty(shaka.offline.Storage.prototype,"remove",shaka.offline.Storage.prototype.remove),shaka.offline.Storage.prototype.remove_=function(a){var b=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function c(){var d,e,f,g,h,i;return $jscomp.generator.createGenerator(c,function(c){switch(c.nextAddress){case 1:return b.requireSupport_(),d=shaka.offline.OfflineUri.parse(a),null!=d&&d.isManifest()?(e=d,f=new shaka.offline.StorageMuxer,c.setFinallyBlock(2),c["yield"](f.init(),4)):c["return"](Promise.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.MALFORMED_OFFLINE_URI,a)));case 4:return c["yield"](f.getCell(e.mechanism(),e.cell()),5);case 5:return g=c.yieldResult,c["yield"](g.getManifests([e.key()]),6);case 6:return h=c.yieldResult,i=h[0],c["yield"](Promise.all([b.removeFromDRM_(e,i,f),b.removeFromStorage_(g,e,i)]),2);case 2:return c.enterFinallyBlock(),c["yield"](f.destroy(),8);case 8:c.leaveFinallyBlock(0)}})})},shaka.offline.Storage.getCapabilities_=function(a,b){for(var c=shaka.util.MimeUtils,d=[],e=$jscomp.makeIterator(a.periods),f=e.next();!f.done;f=e.next()){f=$jscomp.makeIterator(f.value.streams);for(var g=f.next();!g.done;g=f.next())g=g.value,b&&"video"==g.contentType?d.push({contentType:c.getFullType(g.mimeType,g.codecs),robustness:a.drmInfo.videoRobustness}):b||"audio"!=g.contentType||d.push({contentType:c.getFullType(g.mimeType,g.codecs),robustness:a.drmInfo.audioRobustness})}return d},shaka.offline.Storage.prototype.removeFromDRM_=function(a,b,c){var d=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function e(){return $jscomp.generator.createGenerator(e,function(a){switch(a.nextAddress){
case 1:return goog.asserts.assert(d.networkingEngine_,"Cannot be destroyed"),a["yield"](shaka.offline.Storage.deleteLicenseFor_(d.networkingEngine_,d.config_.drm,c,b),0)}})})},shaka.offline.Storage.prototype.removeFromStorage_=function(a,b,c){var d=this,e=shaka.offline.Storage.getAllSegmentIds_(c),f=e.length+1,g=0,h=shaka.offline.StoredContentUtils.fromManifestDB(b,c);return c=function(a){g+=1,d.config_.offline.progressCallback(h,g/f)},Promise.all([a.removeSegments(e,c),a.removeManifests([b.key()],c)])},shaka.offline.Storage.prototype.removeEmeSessions=function(){return this.startOperation_(this.removeEmeSessions_())},goog.exportProperty(shaka.offline.Storage.prototype,"removeEmeSessions",shaka.offline.Storage.prototype.removeEmeSessions),shaka.offline.Storage.prototype.removeEmeSessions_=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function b(){var c,d,e,f,g,h,i,j,k,l;return $jscomp.generator.createGenerator(b,function(b){switch(b.nextAddress){case 1:return a.requireSupport_(),goog.asserts.assert(a.networkingEngine_,"Cannot be destroyed"),c=a.networkingEngine_,d=a.config_.drm,e=new shaka.offline.StorageMuxer,f=new shaka.offline.SessionDeleter,g=!1,b.setFinallyBlock(2),b["yield"](e.init(),4);case 4:for(h=[],e.forEachEmeSessionCell(function(a){return h.push(a)}),i=Promise.resolve(),j={},k=$jscomp.makeIterator(h),l=k.next();!l.done;j={sessionIdCell:j.sessionIdCell},l=k.next())j.sessionIdCell=l.value,i=i.then(function(a){return function(){return $jscomp.asyncExecutePromiseGeneratorFunction(function b(){var e,h;return $jscomp.generator.createGenerator(b,function(b){switch(b.nextAddress){case 1:return b["yield"](a.sessionIdCell.getAll(),2);case 2:return e=b.yieldResult,b["yield"](f["delete"](d,c,e),3);case 3:return h=b.yieldResult,b["yield"](a.sessionIdCell.remove(h),4);case 4:h.length!=e.length&&(g=!0),b.jumpToEnd()}})})}}(j));return b["yield"](i,2);case 2:return b.enterFinallyBlock(),b["yield"](e.destroy(),6);case 6:b.leaveFinallyBlock(3);break;case 3:return b["return"](!g)}})})},shaka.offline.Storage.prototype.list=function(){return this.startOperation_(this.list_())},goog.exportProperty(shaka.offline.Storage.prototype,"list",shaka.offline.Storage.prototype.list),shaka.offline.Storage.prototype.list_=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function b(){var c,d,e;return $jscomp.generator.createGenerator(b,function(b){switch(b.nextAddress){case 1:return a.requireSupport_(),c=[],d=new shaka.offline.StorageMuxer,b.setFinallyBlock(2),b["yield"](d.init(),4);case 4:return e=Promise.resolve(),d.forEachCell(function(a,b){e=e.then(function(){return $jscomp.asyncExecutePromiseGeneratorFunction(function d(){var e;return $jscomp.generator.createGenerator(d,function(d){switch(d.nextAddress){case 1:return d["yield"](b.getAllManifests(),2);case 2:e=d.yieldResult,e.forEach(function(b,d){var e=shaka.offline.OfflineUri.manifest(a.mechanism,a.cell,d);e=shaka.offline.StoredContentUtils.fromManifestDB(e,b),c.push(e)}),d.jumpToEnd()}})})})}),b["yield"](e,2);case 2:return b.enterFinallyBlock(),b["yield"](d.destroy(),6);case 6:b.leaveFinallyBlock(3);break;case 3:return b["return"](c)}})})},shaka.offline.Storage.prototype.parseManifest=function(a,b){var c=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function d(){var e,f,g,h,i,j;return $jscomp.generator.createGenerator(d,function(d){switch(d.nextAddress){case 1:return e=null,f=c.networkingEngine_,goog.asserts.assert(f,"Should be initialized!"),g={networkingEngine:f,filterAllPeriods:function(){},filterNewPeriod:function(){},onTimelineRegionAdded:function(){},onEvent:function(){},onError:function(a){e=a}},d["yield"](b(),2);case 2:return h=d.yieldResult,h.configure(c.config_.manifest),c.checkDestroyed_(),d.setFinallyBlock(3),d["yield"](h.start(a,g),5);case 5:return i=d.yieldResult,c.checkDestroyed_(),j=shaka.offline.Storage.getStreamSet_(i),d["yield"](Promise.all(Array.from(j).map(function(a){return a.createSegmentIndex()})),6);case 6:if(c.checkDestroyed_(),e)throw e;return d["return"](i);case 3:return d.enterFinallyBlock(),d["yield"](h.stop(),7);case 7:d.leaveFinallyBlock(0)}})})},shaka.offline.Storage.prototype.createDrmEngine=function(a,b){var c=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function d(){var e,f,g;return $jscomp.generator.createGenerator(d,function(d){switch(d.nextAddress){case 1:return goog.asserts.assert(c.networkingEngine_,"Cannot call |createDrmEngine| after |destroy|"),e=new shaka.media.DrmEngine({netEngine:c.networkingEngine_,onError:b,onKeyStatus:function(){},onExpirationUpdated:function(){},onEvent:function(){}}),f=shaka.util.Periods.getAllVariantsFrom(a.periods),g=c.config_,e.configure(g.drm),d["yield"](e.initForStorage(f,g.offline.usePersistentLicense),2);case 2:return d["yield"](e.setServerCertificate(),3);case 3:return d["yield"](e.createOrLoad(),4);case 4:return d["return"](e)}})})},shaka.offline.Storage.prototype.createOfflineManifest_=function(a,b,c,d,e,f){var g=this,h=new shaka.offline.StreamBandwidthEstimator,i=d.periods.map(function(e){return g.createPeriod_(a,b,h,c,d,e)}),j=c.getDrmInfo(),k=c.getSessionIds();if(j&&this.config_.offline.usePersistentLicense){if(!k.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.NO_INIT_DATA_FOR_OFFLINE,e);j.initData=[]}return{originalManifestUri:e,duration:d.presentationTimeline.getDuration(),size:0,expiration:c.getExpiration(),periods:i,sessionIds:this.config_.offline.usePersistentLicense?k:[],drmInfo:j,appMetadata:f}},shaka.offline.Storage.prototype.createPeriod_=function(a,b,c,d,e,f){e.periods.forEach(function(a){a.variants.forEach(function(a){c.addVariant(a)}),a.textStreams.forEach(function(a){c.addText(a)})}),d=shaka.offline.Storage.getStreamSet_(e);var g=new Map;d=$jscomp.makeIterator(d);for(var h=d.next();!h.done;h=d.next()){h=h.value;var i=this.createStream_(a,b,c,e,f,h);g.set(h.id,i)}return f.variants.forEach(function(a){a.audio&&g.get(a.audio.id).variantIds.push(a.id),a.video&&g.get(a.video.id).variantIds.push(a.id)}),{startTime:f.startTime,streams:Array.from(g.values())}},shaka.offline.Storage.prototype.createStream_=function(a,b,c,d,e,f){var g=this,h={id:f.id,originalId:f.originalId,primary:f.primary,presentationTimeOffset:f.presentationTimeOffset||0,contentType:f.type,mimeType:f.mimeType,codecs:f.codecs,frameRate:f.frameRate,kind:f.kind,language:f.language,label:f.label,width:f.width||null,height:f.height||null,initSegmentKey:null,encrypted:f.encrypted,keyId:f.keyId,segments:[],variantIds:[]};d=d.presentationTimeline.getSegmentAvailabilityStart();var i=f.id;return shaka.offline.Storage.forEachSegment_(f,d,function(d){var e=shaka.util.Networking.createSegmentRequest(d.getUris(),d.startByte,d.endByte,g.config_.streaming.retryParameters);a.queue(i,e,c.getSegmentEstimate(f.id,d),function(a){return b.addSegments([{data:a}]).then(function(a){g.segmentsFromStore_.push(a[0]),h.segments.push({startTime:d.startTime,endTime:d.endTime,dataKey:a[0]})})})}),(d=f.initSegmentReference)&&(d=shaka.util.Networking.createSegmentRequest(d.getUris(),d.startByte,d.endByte,this.config_.streaming.retryParameters),a.queue(i,d,c.getInitSegmentEstimate(f.id),function(a){return b.addSegments([{data:a}]).then(function(a){g.segmentsFromStore_.push(a[0]),h.initSegmentKey=a[0]})})),h},shaka.offline.Storage.forEachSegment_=function(a,b,c){b=a.findSegmentPosition(b);for(var d=null==b?null:a.getSegmentReference(b);d;)c(d),d=a.getSegmentReference(++b)},shaka.offline.Storage.prototype.checkDestroyed_=function(){if(this.destroyer_.destroyed())throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.OPERATION_ABORTED)},shaka.offline.Storage.prototype.requireSupport_=function(){if(!shaka.offline.Storage.support())throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.STORAGE_NOT_SUPPORTED)},shaka.offline.Storage.prototype.startOperation_=function(a){var b=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function c(){return $jscomp.generator.createGenerator(c,function(c){switch(c.nextAddress){case 1:return b.openOperations_.push(a),c.setFinallyBlock(2),c["yield"](a,4);case 4:return c["return"](c.yieldResult);case 2:c.enterFinallyBlock(),shaka.util.ArrayUtils.remove(b.openOperations_,a),c.leaveFinallyBlock(0)}})})},shaka.offline.Storage.getAllSegmentIds_=function(a){var b=[];return a.periods.forEach(function(a){a.streams.forEach(function(a){null!=a.initSegmentKey&&b.push(a.initSegmentKey),a.segments.forEach(function(a){b.push(a.dataKey)})})}),b},shaka.offline.Storage.deleteAll=function(){return $jscomp.asyncExecutePromiseGeneratorFunction(function a(){var b;return $jscomp.generator.createGenerator(a,function(a){switch(a.nextAddress){case 1:return b=new shaka.offline.StorageMuxer,a.setFinallyBlock(2),a["yield"](b.erase(),2);case 2:return a.enterFinallyBlock(),a["yield"](b.destroy(),5);case 5:a.leaveFinallyBlock(0)}})})},goog.exportProperty(shaka.offline.Storage,"deleteAll",shaka.offline.Storage.deleteAll),shaka.offline.Storage.deleteLicenseFor_=function(a,b,c,d){return $jscomp.asyncExecutePromiseGeneratorFunction(function e(){var f,g,h,i;return $jscomp.generator.createGenerator(e,function(e){switch(e.nextAddress){case 1:return d.drmInfo?(f=c.getEmeSessionCell(),g=d.sessionIds.map(function(a){return{sessionId:a,keySystem:d.drmInfo.keySystem,licenseUri:d.drmInfo.licenseServerUri,serverCertificate:d.drmInfo.serverCertificate,audioCapabilities:shaka.offline.Storage.getCapabilities_(d,!1),videoCapabilities:shaka.offline.Storage.getCapabilities_(d,!0)}}),h=new shaka.offline.SessionDeleter,e["yield"](h["delete"](b,a,g),2)):e["return"]();case 2:return i=e.yieldResult,e["yield"](f.remove(i),3);case 3:return e["yield"](f.add(g.filter(function(a){return-1==i.indexOf(a.sessionId)})),0)}})})},shaka.offline.Storage.getStreamSet_=function(a){var b=new Set;a=$jscomp.makeIterator(a.periods);for(var c=a.next();!c.done;c=a.next()){c=c.value;for(var d=$jscomp.makeIterator(c.textStreams),e=d.next();!e.done;e=d.next())b.add(e.value);for(c=$jscomp.makeIterator(c.variants),d=c.next();!d.done;d=c.next())d=d.value,d.audio&&b.add(d.audio),d.video&&b.add(d.video)}return b},shaka.offline.Storage.verifyConfig_=function(a){var b=!1;null!=a.trackSelectionCallback&&(b=!0,a.offline=a.offline||{},a.offline.trackSelectionCallback=a.trackSelectionCallback,delete a.trackSelectionCallback),null!=a.progressCallback&&(b=!0,a.offline=a.offline||{},a.offline.progressCallback=a.progressCallback,delete a.progressCallback),null!=a.usePersistentLicense&&(b=!0,a.offline=a.offline||{},a.offline.usePersistentLicense=a.usePersistentLicense,delete a.usePersistentLicense),b&&shaka.Deprecate.deprecateFeature(2,6,"Storage.configure with OfflineConfig","Please configure storage with a player configuration.")},shaka.offline.Storage.validateManifest_=function(a){if(0==a.periods.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.NO_PERIODS);a=$jscomp.makeIterator(a.periods);for(var b=a.next();!b.done;b=a.next())shaka.offline.Storage.validatePeriod_(b.value)},shaka.offline.Storage.validatePeriod_=function(a){var b=new Set(a.variants.map(function(a){return a.video})),c=new Set(a.variants.map(function(a){return a.audio}));a=a.textStreams,1<b.size&&shaka.log.warning("Multiple video tracks selected to be stored"),b=$jscomp.makeIterator(c);for(var d=b.next();!d.done;d=b.next()){d=d.value;for(var e=$jscomp.makeIterator(c),f=e.next();!f.done;f=e.next())f=f.value,d!=f&&d.language==f.language&&shaka.log.warning("Similar audio tracks were selected to be stored",d.id,f.id)}for(c=$jscomp.makeIterator(a),b=c.next();!b.done;b=c.next())for(b=b.value,d=$jscomp.makeIterator(a),e=d.next();!e.done;e=d.next())e=e.value,b!=e&&b.language==e.language&&shaka.log.warning("Similar text tracks were selected to be stored",b.id,e.id)},shaka.Player.registerSupportPlugin("offline",shaka.offline.Storage.support),shaka.polyfill={},shaka.polyfill.installAll=function(){for(var a=0;a<shaka.polyfill.polyfills_.length;++a)shaka.polyfill.polyfills_[a].callback()},goog.exportSymbol("shaka.polyfill.installAll",shaka.polyfill.installAll),shaka.polyfill.polyfills_=[],shaka.polyfill.register=function(a,b){b=b||0;for(var c={priority:b,callback:a},d=0;d<shaka.polyfill.polyfills_.length;d++)if(shaka.polyfill.polyfills_[d].priority<b)return void shaka.polyfill.polyfills_.splice(d,0,c);shaka.polyfill.polyfills_.push(c)},goog.exportSymbol("shaka.polyfill.register",shaka.polyfill.register),shaka.polyfill.Fullscreen={},shaka.polyfill.Fullscreen.install=function(){if(window.Document){var a=Element.prototype;a.requestFullscreen=a.requestFullscreen||a.mozRequestFullScreen||a.msRequestFullscreen||a.webkitRequestFullscreen,a=Document.prototype,a.exitFullscreen=a.exitFullscreen||a.mozCancelFullScreen||a.msExitFullscreen||a.webkitExitFullscreen,"fullscreenElement"in document||(Object.defineProperty(document,"fullscreenElement",{get:function(){return document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement}}),Object.defineProperty(document,"fullscreenEnabled",{get:function(){return document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitSupportsFullscreen||document.webkitFullscreenEnabled}})),a=shaka.polyfill.Fullscreen.proxyEvent_,document.addEventListener("webkitfullscreenchange",a),document.addEventListener("webkitfullscreenerror",a),document.addEventListener("mozfullscreenchange",a),document.addEventListener("mozfullscreenerror",a),document.addEventListener("MSFullscreenChange",a),document.addEventListener("MSFullscreenError",a)}},shaka.polyfill.Fullscreen.proxyEvent_=function(a){var b=a.type.replace(/^(webkit|moz|MS)/,"").toLowerCase();if("function"==typeof Event)var c=new Event(b,a);else c=document.createEvent("Event"),c.initEvent(b,a.bubbles,a.cancelable);a.target.dispatchEvent(c)},shaka.polyfill.register(shaka.polyfill.Fullscreen.install),shaka.polyfill.IndexedDB={},shaka.polyfill.IndexedDB.install=function(){shaka.log.debug("IndexedDB.install"),shaka.util.Platform.isChromecast()&&(shaka.log.debug("Removing IndexedDB from ChromeCast"),delete window.indexedDB,goog.asserts.assert(!window.indexedDB,"Failed to override window.indexedDB"))},shaka.polyfill.register(shaka.polyfill.IndexedDB.install),shaka.polyfill.InputEvent={},shaka.polyfill.InputEvent.install=function(){shaka.log.debug("InputEvent.install"),shaka.util.Platform.isIE()&&!HTMLInputElement.prototype.originalAddEventListener&&(shaka.log.info("Patching input event support on IE."),HTMLInputElement.prototype.originalAddEventListener=HTMLInputElement.prototype.addEventListener,HTMLInputElement.prototype.addEventListener=shaka.polyfill.InputEvent.addEventListener_)},shaka.polyfill.InputEvent.addEventListener_=function(a,b,c){if("input"==a)switch(this.type){case"range":a="change"}HTMLInputElement.prototype.originalAddEventListener.call(this,a,b,c)},shaka.polyfill.register(shaka.polyfill.InputEvent.install),shaka.polyfill.Languages={},shaka.polyfill.Languages.install=function(){navigator.languages||Object.defineProperty(navigator,"languages",{get:function(){return navigator.language?[navigator.language]:["en"]}})},shaka.polyfill.register(shaka.polyfill.Languages.install),shaka.polyfill.MathRound={},shaka.polyfill.MathRound.MAX_ACCURATE_INPUT_=4503599627370496,shaka.polyfill.MathRound.install=function(){shaka.log.debug("mathRound.install");var a=shaka.polyfill.MathRound.MAX_ACCURATE_INPUT_+1;if(Math.round(a)!=a){shaka.log.debug("polyfill Math.round");var b=Math.round;Math.round=function(a){var c=a;return a<=shaka.polyfill.MathRound.MAX_ACCURATE_INPUT_&&(c=b(a)),c}}},shaka.polyfill.register(shaka.polyfill.MathRound.install),shaka.polyfill.MediaSource={},shaka.polyfill.MediaSource.install=function(){if(shaka.log.debug("MediaSource.install"),window.MediaSource)if(window.cast&&cast.__platform__&&cast.__platform__.canDisplayType)shaka.log.info("Patching Chromecast MSE bugs."),shaka.polyfill.MediaSource.patchCastIsTypeSupported_();else if(shaka.util.Platform.isApple()){var a=navigator.appVersion;shaka.polyfill.MediaSource.rejectTsContent_(),a.includes("Version/8")?(shaka.log.info("Blacklisting Safari 8 MSE."),shaka.polyfill.MediaSource.blacklist_()):a.includes("Version/9")?(shaka.log.info("Patching Safari 9 MSE bugs."),shaka.polyfill.MediaSource.stubAbort_()):a.includes("Version/10")?(shaka.log.info("Patching Safari 10 MSE bugs."),shaka.polyfill.MediaSource.stubAbort_(),shaka.polyfill.MediaSource.patchEndOfStreamEvents_()):(a.includes("Version/11")||a.includes("Version/12"))&&(shaka.log.info("Patching Safari 11/12 MSE bugs."),shaka.polyfill.MediaSource.stubAbort_(),shaka.polyfill.MediaSource.patchRemovalRange_())}else shaka.util.Platform.isTizen()?shaka.polyfill.MediaSource.rejectCodec_("opus"):shaka.log.info("Using native MSE as-is.");else shaka.log.info("No MSE implementation available.")},shaka.polyfill.MediaSource.blacklist_=function(){window.MediaSource=null},shaka.polyfill.MediaSource.stubAbort_=function(){var a=MediaSource.prototype.addSourceBuffer;MediaSource.prototype.addSourceBuffer=function(b){for(var c=[],d=0;d<arguments.length;++d)c[d-0]=arguments[d];return c=a.apply(this,c),c.abort=function(){},c}},shaka.polyfill.MediaSource.patchRemovalRange_=function(){var a=SourceBuffer.prototype.remove;SourceBuffer.prototype.remove=function(b,c){return a.call(this,b,c-.001)}},shaka.polyfill.MediaSource.patchEndOfStreamEvents_=function(){var a=MediaSource.prototype.endOfStream;MediaSource.prototype.endOfStream=function(b){for(var c=[],d=0;d<arguments.length;++d)c[d-0]=arguments[d];for(var e=d=0;e<this.sourceBuffers.length;++e){var f=this.sourceBuffers[e];f=f.buffered.end(f.buffered.length-1),d=Math.max(d,f)}if(!isNaN(this.duration)&&d<this.duration)for(this.ignoreUpdateEnd_=!0,d=0;d<this.sourceBuffers.length;++d)this.sourceBuffers[d].eventSuppressed_=!1;return a.apply(this,c)};var b=!1,c=MediaSource.prototype.addSourceBuffer;MediaSource.prototype.addSourceBuffer=function(a){for(var d=[],e=0;e<arguments.length;++e)d[e-0]=arguments[e];return d=c.apply(this,d),d.mediaSource_=this,d.addEventListener("updateend",shaka.polyfill.MediaSource.ignoreUpdateEnd_,!1),b||(this.addEventListener("sourceclose",shaka.polyfill.MediaSource.cleanUpListeners_,!1),b=!0),d}},shaka.polyfill.MediaSource.ignoreUpdateEnd_=function(a){var b=a.target,c=b.mediaSource_;if(c.ignoreUpdateEnd_){for(a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),b.eventSuppressed_=!0,a=0;a<c.sourceBuffers.length;++a)if(0==c.sourceBuffers[a].eventSuppressed_)return;c.ignoreUpdateEnd_=!1}},shaka.polyfill.MediaSource.cleanUpListeners_=function(a){a=a.target;for(var b=0;b<a.sourceBuffers.length;++b)a.sourceBuffers[b].removeEventListener("updateend",shaka.polyfill.MediaSource.ignoreUpdateEnd_,!1);a.removeEventListener("sourceclose",shaka.polyfill.MediaSource.cleanUpListeners_,!1)},shaka.polyfill.MediaSource.rejectTsContent_=function(){var a=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(b){return"mp2t"!=b.split(/ *; */)[0].split("/")[1].toLowerCase()&&a(b)}},shaka.polyfill.MediaSource.rejectCodec_=function(a){var b=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(c){return shaka.util.MimeUtils.getCodecBase(c)!=a&&b(c)}},shaka.polyfill.MediaSource.patchCastIsTypeSupported_=function(){var a=MediaSource.isTypeSupported,b=/^dv(?:h[e1]|a[v1])\./;MediaSource.isTypeSupported=function(c){for(var d=c.split(/ *; */),e=d[0],f={},g=1;g<d.length;++g){var h=d[g].split("="),i=h[0];h=h[1].replace(/"(.*)"/,"$1"),f[i]=h}if(d=f.codecs,!d)return a(c);var j=!1,k=!1;c=d.split(",").filter(function(a){return b.test(a)&&(k=!0),/^(hev|hvc)1\.2/.test(a)&&(j=!0),!0}),k&&(j=!1),f.codecs=c.join(","),j&&(f.eotf="smpte2084");for(var l in f)e+="; "+l+'="'+f[l]+'"';return cast.__platform__.canDisplayType(e)}},shaka.polyfill.register(shaka.polyfill.MediaSource.install),shaka.polyfill.PatchedMediaKeysApple={},shaka.polyfill.PatchedMediaKeysApple.install=function(){if(window.HTMLVideoElement&&window.WebKitMediaKeys){shaka.log.info("Using Apple-prefixed EME");var a=shaka.polyfill.PatchedMediaKeysApple;a.MediaKeyStatusMap.KEY_ID_=new Uint8Array([0]).buffer,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=a.setMediaKeys,window.MediaKeys=a.MediaKeys,window.MediaKeySystemAccess=a.MediaKeySystemAccess,navigator.requestMediaKeySystemAccess=a.requestMediaKeySystemAccess}},shaka.polyfill.PatchedMediaKeysApple.requestMediaKeySystemAccess=function(a,b){shaka.log.debug("PatchedMediaKeysApple.requestMediaKeySystemAccess"),goog.asserts.assert(this==navigator,'bad "this" for requestMediaKeySystemAccess');var c=shaka.polyfill.PatchedMediaKeysApple;try{var d=new c.MediaKeySystemAccess(a,b);return Promise.resolve(d)}catch(e){return Promise.reject(e)}},shaka.polyfill.PatchedMediaKeysApple.MediaKeySystemAccess=function(a,b){if(shaka.log.debug("PatchedMediaKeysApple.MediaKeySystemAccess"),this.keySystem=a,a.startsWith("com.apple.fps"))for(var c=$jscomp.makeIterator(b),d=c.next();!d.done;d=c.next())if(d=this.checkConfig_(d.value))return void(this.configuration_=d);throw c=Error("Unsupported keySystem"),c.name="NotSupportedError",c.code=DOMException.NOT_SUPPORTED_ERR,c},shaka.polyfill.PatchedMediaKeysApple.MediaKeySystemAccess.prototype.checkConfig_=function(a){if("required"==a.persistentState)return null;var b={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:a.initDataTypes,sessionTypes:["temporary"],label:a.label},c=!1,d=!1;if(a.audioCapabilities)for(var e=$jscomp.makeIterator(a.audioCapabilities),f=e.next();!f.done;f=e.next())if(f=f.value,f.contentType){c=!0;var g=f.contentType.split(";")[0];WebKitMediaKeys.isTypeSupported(this.keySystem,g)&&(b.audioCapabilities.push(f),d=!0)}if(a.videoCapabilities)for(a=$jscomp.makeIterator(a.videoCapabilities),f=a.next();!f.done;f=a.next())e=f.value,e.contentType&&(c=!0,f=e.contentType.split(";")[0],WebKitMediaKeys.isTypeSupported(this.keySystem,f)&&(b.videoCapabilities.push(e),d=!0));return c||(d=WebKitMediaKeys.isTypeSupported(this.keySystem,"video/mp4")),d?b:null},shaka.polyfill.PatchedMediaKeysApple.MediaKeySystemAccess.prototype.createMediaKeys=function(){shaka.log.debug("PatchedMediaKeysApple.MediaKeySystemAccess.createMediaKeys");var a=new shaka.polyfill.PatchedMediaKeysApple.MediaKeys(this.keySystem);return Promise.resolve(a)},shaka.polyfill.PatchedMediaKeysApple.MediaKeySystemAccess.prototype.getConfiguration=function(){return shaka.log.debug("PatchedMediaKeysApple.MediaKeySystemAccess.getConfiguration"),this.configuration_},shaka.polyfill.PatchedMediaKeysApple.setMediaKeys=function(a){shaka.log.debug("PatchedMediaKeysApple.setMediaKeys"),goog.asserts.assert(this instanceof HTMLMediaElement,'bad "this" for setMediaKeys');var b=shaka.polyfill.PatchedMediaKeysApple,c=this.mediaKeys;return c&&c!=a&&(goog.asserts.assert(c instanceof b.MediaKeys,"non-polyfill instance of oldMediaKeys"),c.setMedia(null)),delete this.mediaKeys,(this.mediaKeys=a)?(goog.asserts.assert(a instanceof b.MediaKeys,"non-polyfill instance of newMediaKeys"),a.setMedia(this)):Promise.resolve()},shaka.polyfill.PatchedMediaKeysApple.MediaKeys=function(a){shaka.log.debug("PatchedMediaKeysApple.MediaKeys"),this.nativeMediaKeys_=new WebKitMediaKeys(a),this.eventManager_=new shaka.util.EventManager,this.certificate=null},shaka.polyfill.PatchedMediaKeysApple.MediaKeys.prototype.createSession=function(a){if(shaka.log.debug("PatchedMediaKeysApple.MediaKeys.createSession"),a=a||"temporary","temporary"!=a)throw new TypeError("Session type "+a+" is unsupported on this platform.");return new shaka.polyfill.PatchedMediaKeysApple.MediaKeySession(this.nativeMediaKeys_,a)},shaka.polyfill.PatchedMediaKeysApple.MediaKeys.prototype.setServerCertificate=function(a){return shaka.log.debug("PatchedMediaKeysApple.MediaKeys.setServerCertificate"),this.certificate=a?new Uint8Array(a):null,Promise.resolve(!0)},shaka.polyfill.PatchedMediaKeysApple.MediaKeys.prototype.setMedia=function(a){var b=this,c=shaka.polyfill.PatchedMediaKeysApple;if(this.eventManager_.removeAll(),!a)return Promise.resolve();this.eventManager_.listen(a,"webkitneedkey",c.onWebkitNeedKey_);try{return 1<=a.readyState?a.webkitSetMediaKeys(this.nativeMediaKeys_):this.eventManager_.listenOnce(a,"loadedmetadata",function(){a.webkitSetMediaKeys(b.nativeMediaKeys_)}),Promise.resolve()}catch(d){return Promise.reject(d)}},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession=function(a,b){shaka.log.debug("PatchedMediaKeysApple.MediaKeySession"),shaka.util.FakeEventTarget.call(this),this.nativeMediaKeySession_=null,this.nativeMediaKeys_=a,this.updatePromise_=this.generateRequestPromise_=null,this.eventManager_=new shaka.util.EventManager,this.sessionId="",this.expiration=NaN,this.closed=new shaka.util.PublicPromise,this.keyStatuses=new shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap},goog.inherits(shaka.polyfill.PatchedMediaKeysApple.MediaKeySession,shaka.util.FakeEventTarget),shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.generateRequest=function(a,b){shaka.log.debug("PatchedMediaKeysApple.MediaKeySession.generateRequest"),this.generateRequestPromise_=new shaka.util.PublicPromise;try{this.nativeMediaKeySession_=this.nativeMediaKeys_.createSession("video/mp4",new Uint8Array(b)),this.sessionId=this.nativeMediaKeySession_.sessionId||"",this.eventManager_.listen(this.nativeMediaKeySession_,"webkitkeymessage",this.onWebkitKeyMessage_.bind(this)),this.eventManager_.listen(this.nativeMediaKeySession_,"webkitkeyadded",this.onWebkitKeyAdded_.bind(this)),this.eventManager_.listen(this.nativeMediaKeySession_,"webkitkeyerror",this.onWebkitKeyError_.bind(this)),this.updateKeyStatus_("status-pending")}catch(c){this.generateRequestPromise_.reject(c)}return this.generateRequestPromise_},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.load=function(){return shaka.log.debug("PatchedMediaKeysApple.MediaKeySession.load"),Promise.reject(Error("MediaKeySession.load not yet supported"))},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.update=function(a){shaka.log.debug("PatchedMediaKeysApple.MediaKeySession.update"),this.updatePromise_=new shaka.util.PublicPromise;try{this.nativeMediaKeySession_.update(new Uint8Array(a))}catch(b){this.updatePromise_.reject(b)}return this.updatePromise_},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.close=function(){shaka.log.debug("PatchedMediaKeysApple.MediaKeySession.close");try{this.nativeMediaKeySession_.close(),this.closed.resolve(),this.eventManager_.removeAll()}catch(a){this.closed.reject(a)}return this.closed},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.remove=function(){return shaka.log.debug("PatchedMediaKeysApple.MediaKeySession.remove"),Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))},shaka.polyfill.PatchedMediaKeysApple.onWebkitNeedKey_=function(a){shaka.log.debug("PatchedMediaKeysApple.onWebkitNeedKey_",a),goog.asserts.assert(this.mediaKeys instanceof shaka.polyfill.PatchedMediaKeysApple.MediaKeys,"non-polyfill instance of newMediaKeys"),goog.asserts.assert(null!=a.initData,"missing init data!");var b=new Event("encrypted");b.initDataType="cenc",b.initData=a.initData,this.dispatchEvent(b)},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.onWebkitKeyMessage_=function(a){shaka.log.debug("PatchedMediaKeysApple.onWebkitKeyMessage_",a),goog.asserts.assert(this.generateRequestPromise_,"generateRequestPromise_ should be set before now!"),this.generateRequestPromise_&&(this.generateRequestPromise_.resolve(),this.generateRequestPromise_=null);var b=void 0==this.keyStatuses.getStatus();a=new shaka.util.FakeEvent("message",{messageType:b?"license-request":"license-renewal",message:a.message.buffer}),this.dispatchEvent(a)},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.onWebkitKeyAdded_=function(a){shaka.log.debug("PatchedMediaKeysApple.onWebkitKeyAdded_",a),goog.asserts.assert(!this.generateRequestPromise_,"Key added during generate!"),goog.asserts.assert(this.updatePromise_,"updatePromise_ should be set before now!"),this.updatePromise_&&(this.updateKeyStatus_("usable"),this.updatePromise_.resolve(),this.updatePromise_=null)},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.onWebkitKeyError_=function(a){if(shaka.log.debug("PatchedMediaKeysApple.onWebkitKeyError_",a),a=Error("EME PatchedMediaKeysApple key error"),a.errorCode=this.nativeMediaKeySession_.error,null!=this.generateRequestPromise_)this.generateRequestPromise_.reject(a),this.generateRequestPromise_=null;else if(null!=this.updatePromise_)this.updatePromise_.reject(a),this.updatePromise_=null;else switch(this.nativeMediaKeySession_.error.code){case WebKitMediaKeyError.MEDIA_KEYERR_OUTPUT:case WebKitMediaKeyError.MEDIA_KEYERR_HARDWARECHANGE:this.updateKeyStatus_("output-not-allowed");break;default:this.updateKeyStatus_("internal-error")}},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.updateKeyStatus_=function(a){this.keyStatuses.setStatus(a),a=new shaka.util.FakeEvent("keystatuseschange"),this.dispatchEvent(a)},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap=function(){this.size=0,this.status_=void 0},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.setStatus=function(a){this.size=void 0==a?0:1,this.status_=a},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.getStatus=function(){return this.status_},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.forEach=function(a){this.status_&&a(this.status_,shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.KEY_ID_)},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.get=function(a){if(this.has(a))return this.status_},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.has=function(a){var b=shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.KEY_ID_;return!(!this.status_||!shaka.util.Uint8ArrayUtils.equal(new Uint8Array(a),new Uint8Array(b)))},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.entries=function(){goog.asserts.assert(!1,"Not used!  Provided only for the compiler.")},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.keys=function(){goog.asserts.assert(!1,"Not used!  Provided only for the compiler.")},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.values=function(){goog.asserts.assert(!1,"Not used!  Provided only for the compiler.")},shaka.polyfill.register(shaka.polyfill.PatchedMediaKeysApple.install),shaka.polyfill.PatchedMediaKeysMs={},shaka.polyfill.PatchedMediaKeysMs.install=function(){if(window.HTMLVideoElement&&window.MSMediaKeys&&(!navigator.requestMediaKeySystemAccess||!MediaKeySystemAccess.prototype.getConfiguration)){shaka.log.info("Using ms-prefixed EME v20140218");var a=shaka.polyfill.PatchedMediaKeysMs;a.MediaKeyStatusMap.KEY_ID_=new Uint8Array([0]).buffer,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=a.setMediaKeys,window.MediaKeys=a.MediaKeys,window.MediaKeySystemAccess=a.MediaKeySystemAccess,navigator.requestMediaKeySystemAccess=a.requestMediaKeySystemAccess}},shaka.polyfill.PatchedMediaKeysMs.requestMediaKeySystemAccess=function(a,b){shaka.log.debug("PatchedMediaKeysMs.requestMediaKeySystemAccess"),goog.asserts.assert(this==navigator,'bad "this" for requestMediaKeySystemAccess');var c=shaka.polyfill.PatchedMediaKeysMs;try{var d=new c.MediaKeySystemAccess(a,b);return Promise.resolve(d)}catch(e){return Promise.reject(e)}},shaka.polyfill.PatchedMediaKeysMs.MediaKeySystemAccess=function(a,b){shaka.log.debug("PatchedMediaKeysMs.MediaKeySystemAccess"),this.keySystem=a;
for(var c=!1,d=0;d<b.length;++d){var e=b[d],f={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:e.initDataTypes,sessionTypes:["temporary"],label:e.label},g=!1;if(e.audioCapabilities)for(var h=0;h<e.audioCapabilities.length;++h){var i=e.audioCapabilities[h];if(i.contentType){g=!0;var j=i.contentType.split(";")[0];MSMediaKeys.isTypeSupported(this.keySystem,j)&&(f.audioCapabilities.push(i),c=!0)}}if(e.videoCapabilities)for(h=0;h<e.videoCapabilities.length;++h)i=e.videoCapabilities[h],i.contentType&&(g=!0,j=i.contentType.split(";")[0],MSMediaKeys.isTypeSupported(this.keySystem,j)&&(f.videoCapabilities.push(i),c=!0));if(g||(c=MSMediaKeys.isTypeSupported(this.keySystem,"video/mp4")),"required"==e.persistentState&&(c=!1),c)return void(this.configuration_=f)}throw c=Error("Unsupported keySystem"),c.name="NotSupportedError",c.code=DOMException.NOT_SUPPORTED_ERR,c},shaka.polyfill.PatchedMediaKeysMs.MediaKeySystemAccess.prototype.createMediaKeys=function(){shaka.log.debug("PatchedMediaKeysMs.MediaKeySystemAccess.createMediaKeys");var a=new shaka.polyfill.PatchedMediaKeysMs.MediaKeys(this.keySystem);return Promise.resolve(a)},shaka.polyfill.PatchedMediaKeysMs.MediaKeySystemAccess.prototype.getConfiguration=function(){return shaka.log.debug("PatchedMediaKeysMs.MediaKeySystemAccess.getConfiguration"),this.configuration_},shaka.polyfill.PatchedMediaKeysMs.setMediaKeys=function(a){shaka.log.debug("PatchedMediaKeysMs.setMediaKeys"),goog.asserts.assert(this instanceof HTMLMediaElement,'bad "this" for setMediaKeys');var b=shaka.polyfill.PatchedMediaKeysMs,c=this.mediaKeys;return c&&c!=a&&(goog.asserts.assert(c instanceof b.MediaKeys,"non-polyfill instance of oldMediaKeys"),c.setMedia(null)),delete this.mediaKeys,(this.mediaKeys=a)?(goog.asserts.assert(a instanceof b.MediaKeys,"non-polyfill instance of newMediaKeys"),a.setMedia(this)):Promise.resolve()},shaka.polyfill.PatchedMediaKeysMs.MediaKeys=function(a){shaka.log.debug("PatchedMediaKeysMs.MediaKeys"),this.nativeMediaKeys_=new MSMediaKeys(a),this.eventManager_=new shaka.util.EventManager},shaka.polyfill.PatchedMediaKeysMs.MediaKeys.prototype.createSession=function(a){if(shaka.log.debug("PatchedMediaKeysMs.MediaKeys.createSession"),a=a||"temporary","temporary"!=a)throw new TypeError("Session type "+a+" is unsupported on this platform.");return new shaka.polyfill.PatchedMediaKeysMs.MediaKeySession(this.nativeMediaKeys_,a)},shaka.polyfill.PatchedMediaKeysMs.MediaKeys.prototype.setServerCertificate=function(a){return shaka.log.debug("PatchedMediaKeysMs.MediaKeys.setServerCertificate"),Promise.resolve(!1)},shaka.polyfill.PatchedMediaKeysMs.MediaKeys.prototype.setMedia=function(a){function b(){a.msSetMediaKeys(d.nativeMediaKeys_),a.removeEventListener("loadedmetadata",b)}var c=shaka.polyfill.PatchedMediaKeysMs;if(this.eventManager_.removeAll(),!a)return Promise.resolve();this.eventManager_.listen(a,"msneedkey",c.onMsNeedKey_);var d=this;try{return 1<=a.readyState?a.msSetMediaKeys(this.nativeMediaKeys_):a.addEventListener("loadedmetadata",b),Promise.resolve()}catch(e){return Promise.reject(e)}},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession=function(a,b){shaka.log.debug("PatchedMediaKeysMs.MediaKeySession"),shaka.util.FakeEventTarget.call(this),this.nativeMediaKeySession_=null,this.nativeMediaKeys_=a,this.updatePromise_=this.generateRequestPromise_=null,this.eventManager_=new shaka.util.EventManager,this.sessionId="",this.expiration=NaN,this.closed=new shaka.util.PublicPromise,this.keyStatuses=new shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap},goog.inherits(shaka.polyfill.PatchedMediaKeysMs.MediaKeySession,shaka.util.FakeEventTarget),shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.generateRequest=function(a,b){shaka.log.debug("PatchedMediaKeysMs.MediaKeySession.generateRequest"),this.generateRequestPromise_=new shaka.util.PublicPromise;try{this.nativeMediaKeySession_=this.nativeMediaKeys_.createSession("video/mp4",new Uint8Array(b),null),this.eventManager_.listen(this.nativeMediaKeySession_,"mskeymessage",this.onMsKeyMessage_.bind(this)),this.eventManager_.listen(this.nativeMediaKeySession_,"mskeyadded",this.onMsKeyAdded_.bind(this)),this.eventManager_.listen(this.nativeMediaKeySession_,"mskeyerror",this.onMsKeyError_.bind(this)),this.updateKeyStatus_("status-pending")}catch(c){this.generateRequestPromise_.reject(c)}return this.generateRequestPromise_},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.load=function(){return shaka.log.debug("PatchedMediaKeysMs.MediaKeySession.load"),Promise.reject(Error("MediaKeySession.load not yet supported"))},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.update=function(a){shaka.log.debug("PatchedMediaKeysMs.MediaKeySession.update"),this.updatePromise_=new shaka.util.PublicPromise;try{this.nativeMediaKeySession_.update(new Uint8Array(a))}catch(b){this.updatePromise_.reject(b)}return this.updatePromise_},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.close=function(){shaka.log.debug("PatchedMediaKeysMs.MediaKeySession.close");try{this.nativeMediaKeySession_.close(),this.closed.resolve(),this.eventManager_.removeAll()}catch(a){this.closed.reject(a)}return this.closed},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.remove=function(){return shaka.log.debug("PatchedMediaKeysMs.MediaKeySession.remove"),Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))},shaka.polyfill.PatchedMediaKeysMs.onMsNeedKey_=function(a){if(shaka.log.debug("PatchedMediaKeysMs.onMsNeedKey_",a),a.initData){var b=shaka.polyfill.PatchedMediaKeysMs,c=document.createEvent("CustomEvent");c.initCustomEvent("encrypted",!1,!1,null),c.initDataType="cenc",c.initData=b.normaliseInitData_(a.initData),this.dispatchEvent(c)}},shaka.polyfill.PatchedMediaKeysMs.normaliseInitData_=function(a){if(!a)return a;var b=new shaka.util.Pssh(a);if(1>=b.dataBoundaries.length)return a;for(var c=[],d=0;d<b.dataBoundaries.length;d++){var e=a.subarray(b.dataBoundaries[d].start,b.dataBoundaries[d].end+1);c.push(e)}for(a=[],b={},d=$jscomp.makeIterator(c),c=d.next();!c.done;b={initData$248:b.initData$248},c=d.next())b.initData$248=c.value,a.some(function(a){return function(b){return shaka.util.Uint8ArrayUtils.equal(b,a.initData$248)}}(b))||a.push(b.initData$248);for(b=0,d=$jscomp.makeIterator(a),c=d.next();!c.done;c=d.next())b+=c.value.length;for(b=new Uint8Array(b),d=0,a=$jscomp.makeIterator(a),c=a.next();!c.done;c=a.next())c=c.value,b.set(c,d),d+=c.length;return b},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.onMsKeyMessage_=function(a){shaka.log.debug("PatchedMediaKeysMs.onMsKeyMessage_",a),goog.asserts.assert(this.generateRequestPromise_,"generateRequestPromise_ not set in onMsKeyMessage_"),this.generateRequestPromise_&&(this.generateRequestPromise_.resolve(),this.generateRequestPromise_=null);var b=void 0==this.keyStatuses.getStatus();a=new shaka.util.FakeEvent("message",{messageType:b?"licenserequest":"licenserenewal",message:a.message.buffer}),this.dispatchEvent(a)},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.onMsKeyAdded_=function(a){shaka.log.debug("PatchedMediaKeysMs.onMsKeyAdded_",a),this.generateRequestPromise_?(shaka.log.debug("Simulating completion for a PR persistent license."),goog.asserts.assert(!this.updatePromise_,"updatePromise_ and generateRequestPromise_ set in onMsKeyAdded_"),this.updateKeyStatus_("usable"),this.generateRequestPromise_.resolve(),this.generateRequestPromise_=null):(goog.asserts.assert(this.updatePromise_,"updatePromise_ not set in onMsKeyAdded_"),this.updatePromise_&&(this.updateKeyStatus_("usable"),this.updatePromise_.resolve(),this.updatePromise_=null))},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.onMsKeyError_=function(a){if(shaka.log.debug("PatchedMediaKeysMs.onMsKeyError_",a),a=Error("EME PatchedMediaKeysMs key error"),a.errorCode=this.nativeMediaKeySession_.error,null!=this.generateRequestPromise_)this.generateRequestPromise_.reject(a),this.generateRequestPromise_=null;else if(null!=this.updatePromise_)this.updatePromise_.reject(a),this.updatePromise_=null;else switch(this.nativeMediaKeySession_.error.code){case MSMediaKeyError.MS_MEDIA_KEYERR_OUTPUT:case MSMediaKeyError.MS_MEDIA_KEYERR_HARDWARECHANGE:this.updateKeyStatus_("output-not-allowed");break;default:this.updateKeyStatus_("internal-error")}},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.updateKeyStatus_=function(a){this.keyStatuses.setStatus(a),a=new shaka.util.FakeEvent("keystatuseschange"),this.dispatchEvent(a)},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap=function(){this.size=0,this.status_=void 0},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.setStatus=function(a){this.size=void 0==a?0:1,this.status_=a},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.getStatus=function(){return this.status_},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.forEach=function(a){this.status_&&a(this.status_,shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.KEY_ID_)},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.get=function(a){if(this.has(a))return this.status_},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.has=function(a){var b=shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.KEY_ID_;return!(!this.status_||!shaka.util.Uint8ArrayUtils.equal(new Uint8Array(a),new Uint8Array(b)))},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.entries=function(){goog.asserts.assert(!1,"Not used!  Provided only for the compiler.")},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.keys=function(){goog.asserts.assert(!1,"Not used!  Provided only for the compiler.")},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.values=function(){goog.asserts.assert(!1,"Not used!  Provided only for the compiler.")},shaka.polyfill.register(shaka.polyfill.PatchedMediaKeysMs.install),shaka.polyfill.PatchedMediaKeysNop={},shaka.polyfill.PatchedMediaKeysNop.install=function(){if(!(!window.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration)){shaka.log.info("EME not available.");var a=shaka.polyfill.PatchedMediaKeysNop;navigator.requestMediaKeySystemAccess=a.requestMediaKeySystemAccess,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=a.setMediaKeys,window.MediaKeys=a.MediaKeys,window.MediaKeySystemAccess=a.MediaKeySystemAccess}},shaka.polyfill.PatchedMediaKeysNop.requestMediaKeySystemAccess=function(a,b){return shaka.log.debug("PatchedMediaKeysNop.requestMediaKeySystemAccess"),goog.asserts.assert(this==navigator,'bad "this" for requestMediaKeySystemAccess'),Promise.reject(Error("The key system specified is not supported."))},shaka.polyfill.PatchedMediaKeysNop.setMediaKeys=function(a){return shaka.log.debug("PatchedMediaKeysNop.setMediaKeys"),goog.asserts.assert(this instanceof HTMLMediaElement,'bad "this" for setMediaKeys'),null==a?Promise.resolve():Promise.reject(Error("MediaKeys not supported."))},shaka.polyfill.PatchedMediaKeysNop.MediaKeys=function(){throw new TypeError("Illegal constructor.")},shaka.polyfill.PatchedMediaKeysNop.MediaKeys.prototype.createSession=function(){},shaka.polyfill.PatchedMediaKeysNop.MediaKeys.prototype.setServerCertificate=function(){},shaka.polyfill.PatchedMediaKeysNop.MediaKeySystemAccess=function(){throw new TypeError("Illegal constructor.")},shaka.polyfill.PatchedMediaKeysNop.MediaKeySystemAccess.prototype.getConfiguration=function(){},shaka.polyfill.PatchedMediaKeysNop.MediaKeySystemAccess.prototype.createMediaKeys=function(){},shaka.polyfill.register(shaka.polyfill.PatchedMediaKeysNop.install,-10),shaka.polyfill.PatchedMediaKeysWebkit={},shaka.polyfill.PatchedMediaKeysWebkit.prefix_="",shaka.polyfill.PatchedMediaKeysWebkit.install=function(){var a=shaka.polyfill.PatchedMediaKeysWebkit,b=a.prefixApi_;if(!(!window.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration)){if(HTMLMediaElement.prototype.webkitGenerateKeyRequest)shaka.log.info("Using webkit-prefixed EME v0.1b"),a.prefix_="webkit";else{if(!HTMLMediaElement.prototype.generateKeyRequest)return;shaka.log.info("Using nonprefixed EME v0.1b")}goog.asserts.assert(HTMLMediaElement.prototype[b("generateKeyRequest")],"PatchedMediaKeysWebkit APIs not available!"),a.MediaKeyStatusMap.KEY_ID_=new Uint8Array([0]).buffer,navigator.requestMediaKeySystemAccess=a.requestMediaKeySystemAccess,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=a.setMediaKeys,window.MediaKeys=a.MediaKeys,window.MediaKeySystemAccess=a.MediaKeySystemAccess}},shaka.polyfill.PatchedMediaKeysWebkit.prefixApi_=function(a){var b=shaka.polyfill.PatchedMediaKeysWebkit.prefix_;return b?b+a.charAt(0).toUpperCase()+a.slice(1):a},shaka.polyfill.PatchedMediaKeysWebkit.requestMediaKeySystemAccess=function(a,b){shaka.log.debug("PatchedMediaKeysWebkit.requestMediaKeySystemAccess"),goog.asserts.assert(this==navigator,'bad "this" for requestMediaKeySystemAccess');var c=shaka.polyfill.PatchedMediaKeysWebkit;try{var d=new c.MediaKeySystemAccess(a,b);return Promise.resolve(d)}catch(e){return Promise.reject(e)}},shaka.polyfill.PatchedMediaKeysWebkit.setMediaKeys=function(a){shaka.log.debug("PatchedMediaKeysWebkit.setMediaKeys"),goog.asserts.assert(this instanceof HTMLMediaElement,'bad "this" for setMediaKeys');var b=shaka.polyfill.PatchedMediaKeysWebkit,c=this.mediaKeys;return c&&c!=a&&(goog.asserts.assert(c instanceof b.MediaKeys,"non-polyfill instance of oldMediaKeys"),c.setMedia(null)),delete this.mediaKeys,(this.mediaKeys=a)&&(goog.asserts.assert(a instanceof b.MediaKeys,"non-polyfill instance of newMediaKeys"),a.setMedia(this)),Promise.resolve()},shaka.polyfill.PatchedMediaKeysWebkit.getVideoElement_=function(){var a=document.getElementsByTagName("video");return a.length?a[0]:document.createElement("video")},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySystemAccess=function(a,b){shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySystemAccess"),this.internalKeySystem_=this.keySystem=a;var c=!1;"org.w3.clearkey"==a&&(this.internalKeySystem_="webkit-org.w3.clearkey",c=!1);for(var d=!1,e=shaka.polyfill.PatchedMediaKeysWebkit.getVideoElement_(),f=0;f<b.length;++f){var g=b[f],h={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:g.initDataTypes,sessionTypes:["temporary"],label:g.label},i=!1;if(g.audioCapabilities)for(var j=0;j<g.audioCapabilities.length;++j){var k=g.audioCapabilities[j];if(k.contentType){i=!0;var l=k.contentType.split(";")[0];e.canPlayType(l,this.internalKeySystem_)&&(h.audioCapabilities.push(k),d=!0)}}if(g.videoCapabilities)for(j=0;j<g.videoCapabilities.length;++j)k=g.videoCapabilities[j],k.contentType&&(i=!0,e.canPlayType(k.contentType,this.internalKeySystem_)&&(h.videoCapabilities.push(k),d=!0));if(i||(d=e.canPlayType("video/mp4",this.internalKeySystem_)||e.canPlayType("video/webm",this.internalKeySystem_)),"required"==g.persistentState&&(c?(h.persistentState="required",h.sessionTypes=["persistent-license"]):d=!1),d)return void(this.configuration_=h)}throw c="Unsupported keySystem","org.w3.clearkey"!=a&&"com.widevine.alpha"!=a||(c="None of the requested configurations were supported."),c=Error(c),c.name="NotSupportedError",c.code=DOMException.NOT_SUPPORTED_ERR,c},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySystemAccess.prototype.createMediaKeys=function(){shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySystemAccess.createMediaKeys");var a=new shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys(this.internalKeySystem_);return Promise.resolve(a)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySystemAccess.prototype.getConfiguration=function(){return shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySystemAccess.getConfiguration"),this.configuration_},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys=function(a){shaka.log.debug("PatchedMediaKeysWebkit.MediaKeys"),this.keySystem_=a,this.media_=null,this.eventManager_=new shaka.util.EventManager,this.newSessions_=[],this.sessionMap_={}},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.setMedia=function(a){this.media_=a,this.eventManager_.removeAll();var b=shaka.polyfill.PatchedMediaKeysWebkit.prefix_;a&&(this.eventManager_.listen(a,b+"needkey",this.onWebkitNeedKey_.bind(this)),this.eventManager_.listen(a,b+"keymessage",this.onWebkitKeyMessage_.bind(this)),this.eventManager_.listen(a,b+"keyadded",this.onWebkitKeyAdded_.bind(this)),this.eventManager_.listen(a,b+"keyerror",this.onWebkitKeyError_.bind(this)))},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.createSession=function(a){if(shaka.log.debug("PatchedMediaKeysWebkit.MediaKeys.createSession"),a=a||"temporary","temporary"!=a&&"persistent-license"!=a)throw new TypeError("Session type "+a+" is unsupported on this platform.");var b=shaka.polyfill.PatchedMediaKeysWebkit,c=this.media_||document.createElement("video");return c.src||(c.src="about:blank"),a=new b.MediaKeySession(c,this.keySystem_,a),this.newSessions_.push(a),a},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.setServerCertificate=function(a){return shaka.log.debug("PatchedMediaKeysWebkit.MediaKeys.setServerCertificate"),Promise.resolve(!1)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.onWebkitNeedKey_=function(a){shaka.log.debug("PatchedMediaKeysWebkit.onWebkitNeedKey_",a),goog.asserts.assert(this.media_,"media_ not set in onWebkitNeedKey_");var b=document.createEvent("CustomEvent");b.initCustomEvent("encrypted",!1,!1,null),b.initDataType="webm",b.initData=a.initData,this.media_.dispatchEvent(b)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.onWebkitKeyMessage_=function(a){shaka.log.debug("PatchedMediaKeysWebkit.onWebkitKeyMessage_",a);var b=this.findSession_(a.sessionId);if(b){var c=void 0==b.keyStatuses.getStatus();a=new shaka.util.FakeEvent("message",{messageType:c?"licenserequest":"licenserenewal",message:a.message}),b.generated(),b.dispatchEvent(a)}else shaka.log.error("Session not found",a.sessionId)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.onWebkitKeyAdded_=function(a){shaka.log.debug("PatchedMediaKeysWebkit.onWebkitKeyAdded_",a),a=this.findSession_(a.sessionId),goog.asserts.assert(a,"unable to find session in onWebkitKeyAdded_"),a&&a.ready()},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.onWebkitKeyError_=function(a){shaka.log.debug("PatchedMediaKeysWebkit.onWebkitKeyError_",a);var b=this.findSession_(a.sessionId);goog.asserts.assert(b,"unable to find session in onWebkitKeyError_"),b&&b.handleError(a)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.findSession_=function(a){var b=this.sessionMap_[a];return b?(shaka.log.debug("PatchedMediaKeysWebkit.MediaKeys.findSession_",b),b):(b=this.newSessions_.shift())?(b.sessionId=a,this.sessionMap_[a]=b,shaka.log.debug("PatchedMediaKeysWebkit.MediaKeys.findSession_",b),b):null},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession=function(a,b,c){shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession"),shaka.util.FakeEventTarget.call(this),this.media_=a,this.initialized_=!1,this.updatePromise_=this.generatePromise_=null,this.keySystem_=b,this.type_=c,this.sessionId="",this.expiration=NaN,this.closed=new shaka.util.PublicPromise,this.keyStatuses=new shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap},goog.inherits(shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession,shaka.util.FakeEventTarget),shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.generated=function(){shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession.generated"),this.generatePromise_&&(this.generatePromise_.resolve(),this.generatePromise_=null)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.ready=function(){shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession.ready"),this.updateKeyStatus_("usable"),this.updatePromise_&&this.updatePromise_.resolve(),this.updatePromise_=null},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.handleError=function(a){shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession.handleError",a);var b=Error("EME v0.1b key error");b.errorCode=a.errorCode,b.errorCode.systemCode=a.systemCode,!a.sessionId&&this.generatePromise_?(b.method="generateRequest",45==a.systemCode&&(b.message="Unsupported session type."),this.generatePromise_.reject(b),this.generatePromise_=null):a.sessionId&&this.updatePromise_?(b.method="update",this.updatePromise_.reject(b),this.updatePromise_=null):(b=a.systemCode,a.errorCode.code==MediaKeyError.MEDIA_KEYERR_OUTPUT?this.updateKeyStatus_("output-restricted"):1==b?this.updateKeyStatus_("expired"):this.updateKeyStatus_("internal-error"))},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.generate_=function(a,b){var c=this;if(this.initialized_)return Promise.reject(Error("The session is already initialized."));this.initialized_=!0;try{if("persistent-license"==this.type_){var d=shaka.util.StringUtils;if(b)var e=new Uint8Array(d.toUTF8("LOAD_SESSION|"+b));else{var f=d.toUTF8("PERSISTENT|"),g=new Uint8Array(f.byteLength+a.byteLength);g.set(new Uint8Array(f),0),g.set(new Uint8Array(a),f.byteLength),e=g}}else goog.asserts.assert("temporary"==this.type_,"expected temporary session"),goog.asserts.assert(!b,"unexpected offline session ID"),e=new Uint8Array(a);goog.asserts.assert(e,"init data not set!")}catch(h){return Promise.reject(h)}goog.asserts.assert(null==this.generatePromise_,"generatePromise_ should be null"),this.generatePromise_=new shaka.util.PublicPromise,d=shaka.polyfill.PatchedMediaKeysWebkit.prefixApi_;var i=d("generateKeyRequest");try{this.media_[i](this.keySystem_,e)}catch(h){if("InvalidStateError"!=h.name)return this.generatePromise_=null,Promise.reject(h);new shaka.util.Timer(function(){try{c.media_[i](c.keySystem_,e)}catch(a){c.generatePromise_.reject(a),c.generatePromise_=null}}).tickAfter(.01)}return this.generatePromise_},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.update_=function(a,b){if(this.updatePromise_)this.updatePromise_.then(this.update_.bind(this,a,b))["catch"](this.update_.bind(this,a,b));else{if(this.updatePromise_=a,"webkit-org.w3.clearkey"==this.keySystem_){var c=shaka.util.Uint8ArrayUtils,d=shaka.util.StringUtils.fromUTF8(b),e=JSON.parse(d);"oct"!=e.keys[0].kty&&(this.updatePromise_.reject(Error("Response is not a valid JSON Web Key Set.")),this.updatePromise_=null),d=c.fromBase64(e.keys[0].k),c=c.fromBase64(e.keys[0].kid)}else d=new Uint8Array(b),c=null;e=shaka.polyfill.PatchedMediaKeysWebkit.prefixApi_,e=e("addKey");try{this.media_[e](this.keySystem_,d,c,this.sessionId)}catch(f){this.updatePromise_.reject(f),this.updatePromise_=null}}},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.updateKeyStatus_=function(a){this.keyStatuses.setStatus(a),a=new shaka.util.FakeEvent("keystatuseschange"),this.dispatchEvent(a)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.generateRequest=function(a,b){return shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession.generateRequest"),this.generate_(b,null)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.load=function(a){return shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession.load"),"persistent-license"==this.type_?this.generate_(null,a):Promise.reject(Error("Not a persistent session."))},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.update=function(a){shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession.update",a),goog.asserts.assert(this.sessionId,"update without session ID");var b=new shaka.util.PublicPromise;return this.update_(b,a),b},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.close=function(){if(shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession.close"),"persistent-license"!=this.type_){if(!this.sessionId)return this.closed.reject(Error("The session is not callable.")),this.closed;var a=shaka.polyfill.PatchedMediaKeysWebkit.prefixApi_;a=a("cancelKeyRequest");try{this.media_[a](this.keySystem_,this.sessionId)}catch(b){}}return this.closed.resolve(),this.closed},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.remove=function(){return shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession.remove"),"persistent-license"!=this.type_?Promise.reject(Error("Not a persistent session.")):this.close()},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap=function(){this.size=0,this.status_=void 0},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.setStatus=function(a){this.size=void 0==a?0:1,this.status_=a},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.getStatus=function(){return this.status_},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.forEach=function(a){this.status_&&a(this.status_,shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.KEY_ID_)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.get=function(a){if(this.has(a))return this.status_},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.has=function(a){var b=shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.KEY_ID_;return!(!this.status_||!shaka.util.Uint8ArrayUtils.equal(new Uint8Array(a),new Uint8Array(b)))},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.entries=function(){goog.asserts.assert(!1,"Not used!  Provided only for compiler.")},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.keys=function(){goog.asserts.assert(!1,"Not used!  Provided only for compiler.")},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.values=function(){goog.asserts.assert(!1,"Not used!  Provided only for compiler.")},shaka.polyfill.register(shaka.polyfill.PatchedMediaKeysWebkit.install),shaka.polyfill.PiPWebkit={},shaka.polyfill.PiPWebkit.install=function(){if(window.HTMLVideoElement){var a=HTMLVideoElement.prototype;if((!a.requestPictureInPicture||!document.exitPictureInPicture)&&a.webkitSupportsPresentationMode){var b=shaka.polyfill.PiPWebkit;shaka.log.debug("PiPWebkit.install"),document.pictureInPictureEnabled=!0,document.pictureInPictureElement=null,a.requestPictureInPicture=b.requestPictureInPicture_,document.exitPictureInPicture=b.exitPictureInPicture_,document.addEventListener("webkitpresentationmodechanged",b.proxyEvent_,!0)}}},shaka.polyfill.PiPWebkit.proxyEvent_=function(a){if(a=a.target,a.webkitPresentationMode==shaka.polyfill.PiPWebkit.PIP_MODE_){document.pictureInPictureElement=a;var b=new Event("enterpictureinpicture");a.dispatchEvent(b)}else document.pictureInPictureElement==a&&(document.pictureInPictureElement=null),b=new Event("leavepictureinpicture"),a.dispatchEvent(b)},shaka.polyfill.PiPWebkit.requestPictureInPicture_=function(){var a=shaka.polyfill.PiPWebkit;return this.webkitSupportsPresentationMode(a.PIP_MODE_)?(this.webkitSetPresentationMode(a.PIP_MODE_),document.pictureInPictureElement=this,Promise.resolve()):Promise.reject(Error("PiP not allowed by video element"))},shaka.polyfill.PiPWebkit.exitPictureInPicture_=function(){var a=shaka.polyfill.PiPWebkit,b=document.pictureInPictureElement;return b?(b.webkitSetPresentationMode(a.INLINE_MODE_),document.pictureInPictureElement=null,Promise.resolve()):Promise.reject(Error("No picture in picture element found"))},shaka.polyfill.PiPWebkit.PIP_MODE_="picture-in-picture",shaka.polyfill.PiPWebkit.INLINE_MODE_="inline",shaka.polyfill.register(shaka.polyfill.PiPWebkit.install),shaka.polyfill.VideoPlayPromise={},shaka.polyfill.VideoPlayPromise.install=function(){if(shaka.log.debug("VideoPlayPromise.install"),window.HTMLMediaElement){var a=HTMLMediaElement.prototype.play;HTMLMediaElement.prototype.play=function(){var b=a.apply(this);return b&&b["catch"](function(){}),b}}},shaka.polyfill.register(shaka.polyfill.VideoPlayPromise.install),shaka.polyfill.VideoPlaybackQuality={},shaka.polyfill.VideoPlaybackQuality.install=function(){if(window.HTMLVideoElement){var a=HTMLVideoElement.prototype;!a.getVideoPlaybackQuality&&"webkitDroppedFrameCount"in a&&(a.getVideoPlaybackQuality=shaka.polyfill.VideoPlaybackQuality.webkit_)}},shaka.polyfill.VideoPlaybackQuality.webkit_=function(){return{droppedVideoFrames:this.webkitDroppedFrameCount,totalVideoFrames:this.webkitDecodedFrameCount,corruptedVideoFrames:0,creationTime:NaN,totalFrameDelay:0}},shaka.polyfill.register(shaka.polyfill.VideoPlaybackQuality.install),shaka.polyfill.VTTCue={},shaka.polyfill.VTTCue.install=function(){if(window.VTTCue)shaka.log.info("Using native VTTCue.");else if(window.TextTrackCue){var a=TextTrackCue.length;3==a?(shaka.log.info("Using VTTCue polyfill from 3 argument TextTrackCue."),window.VTTCue=shaka.polyfill.VTTCue.from3ArgsTextTrackCue_):6==a?(shaka.log.info("Using VTTCue polyfill from 6 argument TextTrackCue."),window.VTTCue=shaka.polyfill.VTTCue.from6ArgsTextTrackCue_):shaka.polyfill.VTTCue.canUse3ArgsTextTrackCue_()&&(shaka.log.info("Using VTTCue polyfill from 3 argument TextTrackCue."),window.VTTCue=shaka.polyfill.VTTCue.from3ArgsTextTrackCue_)}else shaka.log.error("VTTCue not available.")},shaka.polyfill.VTTCue.from3ArgsTextTrackCue_=function(a,b,c){return new window.TextTrackCue(a,b,c)},shaka.polyfill.VTTCue.from6ArgsTextTrackCue_=function(a,b,c){return new window.TextTrackCue(a+"-"+b+"-"+c,a,b,c)},shaka.polyfill.VTTCue.canUse3ArgsTextTrackCue_=function(){try{return!!shaka.polyfill.VTTCue.from3ArgsTextTrackCue_(1,2,"")}catch(a){return!1}},shaka.polyfill.register(shaka.polyfill.VTTCue.install),shaka.text.TtmlTextParser=function(){},shaka.text.TtmlTextParser.parameterNs_="http://www.w3.org/ns/ttml#parameter",shaka.text.TtmlTextParser.styleNs_="http://www.w3.org/ns/ttml#styling",shaka.text.TtmlTextParser.prototype.parseInit=function(a){goog.asserts.assert(!1,"TTML does not have init segments")},shaka.text.TtmlTextParser.prototype.parseMedia=function(a,b){var c=shaka.text.TtmlTextParser,d=shaka.util.XmlUtils,e=c.parameterNs_,f=shaka.util.StringUtils.fromUTF8(a),g=[],h=new DOMParser,i=null;try{i=h.parseFromString(f,"text/xml")}catch(j){throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_XML)}if(i){if(!(f=i.getElementsByTagName("tt")[0]))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_XML);h=d.getAttributeNS(f,e,"frameRate"),i=d.getAttributeNS(f,e,"subFrameRate");var k=d.getAttributeNS(f,e,"frameRateMultiplier"),l=d.getAttributeNS(f,e,"tickRate");if(d=f.getAttribute("xml:space")||"default",e=f.getAttribute("tts:extent"),"default"!=d&&"preserve"!=d)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_XML);d="default"==d,h=new c.RateInfo_(h,i,k,l),i=c.getLeafNodes_(f.getElementsByTagName("metadata")[0]),k=c.getLeafNodes_(f.getElementsByTagName("styling")[0]),l=c.getLeafNodes_(f.getElementsByTagName("layout")[0]);for(var m=[],n=0;n<l.length;n++){var o=c.parseCueRegion_(l[n],k,e);o&&m.push(o)}for(f=c.getLeafNodes_(f.getElementsByTagName("body")[0]),e=0;e<f.length;e++)(n=c.parseCue_(f[e],b.periodStart,h,i,k,l,m,d))&&g.push(n)}return g},shaka.text.TtmlTextParser.percentValues_=/^(\d{1,2}|100)% (\d{1,2}|100)%$/,shaka.text.TtmlTextParser.unitValues_=/^(\d+px|\d+em)$/,shaka.text.TtmlTextParser.pixelValues_=/^(\d+)px (\d+)px$/,shaka.text.TtmlTextParser.timeColonFormatFrames_=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,shaka.text.TtmlTextParser.timeColonFormat_=/^(?:(\d{2,}):)?(\d{2}):(\d{2})$/,shaka.text.TtmlTextParser.timeColonFormatMilliseconds_=/^(?:(\d{2,}):)?(\d{2}):(\d{2}\.\d{2,})$/,shaka.text.TtmlTextParser.timeFramesFormat_=/^(\d*(?:\.\d*)?)f$/,shaka.text.TtmlTextParser.timeTickFormat_=/^(\d*(?:\.\d*)?)t$/,shaka.text.TtmlTextParser.timeHMSFormat_=/^(?:(\d*(?:\.\d*)?)h)?(?:(\d*(?:\.\d*)?)m)?(?:(\d*(?:\.\d*)?)s)?(?:(\d*(?:\.\d*)?)ms)?$/,
shaka.text.TtmlTextParser.textAlignToLineAlign_={left:shaka.text.Cue.lineAlign.START,center:shaka.text.Cue.lineAlign.CENTER,right:shaka.text.Cue.lineAlign.END,start:shaka.text.Cue.lineAlign.START,end:shaka.text.Cue.lineAlign.END},shaka.text.TtmlTextParser.textAlignToPositionAlign_={left:shaka.text.Cue.positionAlign.LEFT,center:shaka.text.Cue.positionAlign.CENTER,right:shaka.text.Cue.positionAlign.RIGHT},shaka.text.TtmlTextParser.getLeafNodes_=function(a){var b=[];if(!a)return b;for(var c=a.childNodes,d=0;d<c.length;d++){var e="span"==c[d].nodeName&&"p"==a.nodeName;c[d].nodeType!=Node.ELEMENT_NODE||"br"==c[d].nodeName||e||(goog.asserts.assert(c[d]instanceof Element,"Node should be Element!"),e=shaka.text.TtmlTextParser.getLeafNodes_(c[d]),goog.asserts.assert(0<e.length,"Only a null Element should return no leaves!"),b=b.concat(e))}return b.length||b.push(a),b},shaka.text.TtmlTextParser.addNewLines_=function(a,b){for(var c=a.childNodes,d=0;d<c.length;d++)if("br"==c[d].nodeName&&0<d)c[d-1].textContent+="\n";else if(0<c[d].childNodes.length)shaka.text.TtmlTextParser.addNewLines_(c[d],b);else if(b){var e=c[d].textContent.trim();e=e.replace(/\s+/g," "),c[d].textContent=e}},shaka.text.TtmlTextParser.parseCue_=function(a,b,c,d,e,f,g,h){if(!a.hasAttribute("begin")&&!a.hasAttribute("end")&&/^\s*$/.test(a.textContent))return null;shaka.text.TtmlTextParser.addNewLines_(a,h),h=shaka.text.TtmlTextParser.parseTime_(a.getAttribute("begin"),c);var i=shaka.text.TtmlTextParser.parseTime_(a.getAttribute("end"),c);c=shaka.text.TtmlTextParser.parseTime_(a.getAttribute("dur"),c);var j=a.textContent;if(null==i&&null!=c&&(i=h+c),null==h||null==i)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_TEXT_CUE);if(b=new shaka.text.Cue(h+b,i+b,j),(f=shaka.text.TtmlTextParser.getElementFromCollection_(a,"region",f,""))&&f.getAttribute("xml:id")){var k=f.getAttribute("xml:id");g=g.filter(function(a){return a.id==k}),b.region=g[0]}return d=shaka.text.TtmlTextParser.getElementFromCollection_(a,"smpte:backgroundImage",d,"#"),shaka.text.TtmlTextParser.addStyle_(b,a,f,d,e),b},shaka.text.TtmlTextParser.parseCueRegion_=function(a,b,c){var d=shaka.text.TtmlTextParser,e=new shaka.text.CueRegion,f=a.getAttribute("xml:id");if(!f)return shaka.log.warning("TtmlTextParser parser encountered a region with no id. Region will be ignored."),null;e.id=f,f=null,c&&(f=d.percentValues_.exec(c)||d.pixelValues_.exec(c)),c=f?Number(f[1]):null,f=f?Number(f[2]):null;var g,h;return(g=d.getStyleAttributeFromRegion_(a,b,"extent"))&&(g=(h=d.percentValues_.exec(g))||d.pixelValues_.exec(g),null!=g&&(e.width=null!=c?100*Number(g[1])/c:Number(g[1]),e.height=null!=f?100*Number(g[2])/f:Number(g[2]),e.widthUnits=h||null!=c?shaka.text.CueRegion.units.PERCENTAGE:shaka.text.CueRegion.units.PX,e.heightUnits=h||null!=f?shaka.text.CueRegion.units.PERCENTAGE:shaka.text.CueRegion.units.PX)),(a=d.getStyleAttributeFromRegion_(a,b,"origin"))&&(g=(h=d.percentValues_.exec(a))||d.pixelValues_.exec(a),null!=g&&(e.viewportAnchorX=null!=f?100*Number(g[1])/f:Number(g[1]),e.viewportAnchorY=null!=c?100*Number(g[2])/c:Number(g[2]),e.viewportAnchorUnits=h||null!=c?shaka.text.CueRegion.units.PERCENTAGE:shaka.text.CueRegion.units.PX)),e},shaka.text.TtmlTextParser.addStyle_=function(a,b,c,d,e){var f=shaka.text.TtmlTextParser,g=shaka.text.Cue;"rtl"==f.getStyleAttribute_(b,c,e,"direction")&&(a.direction=g.direction.HORIZONTAL_RIGHT_TO_LEFT);var h=f.getStyleAttribute_(b,c,e,"writingMode");"tb"==h||"tblr"==h?a.writingMode=g.writingMode.VERTICAL_LEFT_TO_RIGHT:"tbrl"==h?a.writingMode=g.writingMode.VERTICAL_RIGHT_TO_LEFT:"rltb"==h||"rl"==h?a.direction=g.direction.HORIZONTAL_RIGHT_TO_LEFT:h&&(a.direction=g.direction.HORIZONTAL_LEFT_TO_RIGHT),(h=f.getStyleAttribute_(b,c,e,"textAlign"))&&(a.positionAlign=f.textAlignToPositionAlign_[h],a.lineAlign=f.textAlignToLineAlign_[h],goog.asserts.assert(h.toUpperCase()in g.textAlign,h.toUpperCase()+" Should be in Cue.textAlign values!"),a.textAlign=g.textAlign[h.toUpperCase()]),(h=f.getStyleAttribute_(b,c,e,"displayAlign"))&&(goog.asserts.assert(h.toUpperCase()in g.displayAlign,h.toUpperCase()+" Should be in Cue.displayAlign values!"),a.displayAlign=g.displayAlign[h.toUpperCase()]),(h=f.getStyleAttribute_(b,c,e,"color"))&&(a.color=h),(h=f.getStyleAttribute_(b,c,e,"backgroundColor"))&&(a.backgroundColor=h),(h=f.getStyleAttribute_(b,c,e,"fontFamily"))&&(a.fontFamily=h),(h=f.getStyleAttribute_(b,c,e,"fontWeight"))&&"bold"==h&&(a.fontWeight=g.fontWeight.BOLD),(h=f.getStyleAttribute_(b,c,e,"wrapOption"))&&"noWrap"==h&&(a.wrapLine=!1),(h=f.getStyleAttribute_(b,c,e,"lineHeight"))&&h.match(f.unitValues_)&&(a.lineHeight=h),(h=f.getStyleAttribute_(b,c,e,"fontSize"))&&h.match(f.unitValues_)&&(a.fontSize=h),(h=f.getStyleAttribute_(b,c,e,"fontStyle"))&&(goog.asserts.assert(h.toUpperCase()in g.fontStyle,h.toUpperCase()+" Should be in Cue.fontStyle values!"),a.fontStyle=g.fontStyle[h.toUpperCase()]),d&&(g=d.getAttribute("imagetype"),h=d.getAttribute("encoding"),d=d.textContent.trim(),"PNG"==g&&"Base64"==h&&d&&(a.backgroundImage="data:image/png;base64,"+d)),(c=f.getStyleAttributeFromRegion_(c,e,"textDecoration"))&&f.addTextDecoration_(a,c),(b=f.getStyleAttributeFromElement_(b,e,"textDecoration"))&&f.addTextDecoration_(a,b)},shaka.text.TtmlTextParser.addTextDecoration_=function(a,b){for(var c=shaka.text.Cue,d=b.split(" "),e=0;e<d.length;e++)switch(d[e]){case"underline":a.textDecoration.includes(c.textDecoration.UNDERLINE)||a.textDecoration.push(c.textDecoration.UNDERLINE);break;case"noUnderline":a.textDecoration.includes(c.textDecoration.UNDERLINE)&&shaka.util.ArrayUtils.remove(a.textDecoration,c.textDecoration.UNDERLINE);break;case"lineThrough":a.textDecoration.includes(c.textDecoration.LINE_THROUGH)||a.textDecoration.push(c.textDecoration.LINE_THROUGH);break;case"noLineThrough":a.textDecoration.includes(c.textDecoration.LINE_THROUGH)&&shaka.util.ArrayUtils.remove(a.textDecoration,c.textDecoration.LINE_THROUGH);break;case"overline":a.textDecoration.includes(c.textDecoration.OVERLINE)||a.textDecoration.push(c.textDecoration.OVERLINE);break;case"noOverline":a.textDecoration.includes(c.textDecoration.OVERLINE)&&shaka.util.ArrayUtils.remove(a.textDecoration,c.textDecoration.OVERLINE)}},shaka.text.TtmlTextParser.getStyleAttribute_=function(a,b,c,d){var e=shaka.text.TtmlTextParser;return(a=e.getStyleAttributeFromElement_(a,c,d))?a:e.getStyleAttributeFromRegion_(b,c,d)},shaka.text.TtmlTextParser.getStyleAttributeFromRegion_=function(a,b,c){for(var d=shaka.util.XmlUtils,e=shaka.text.TtmlTextParser.styleNs_,f=shaka.text.TtmlTextParser.getLeafNodes_(a),g=0;g<f.length;g++){var h=d.getAttributeNS(f[g],e,c);if(h)return h}return(a=shaka.text.TtmlTextParser.getElementFromCollection_(a,"style",b,""))?d.getAttributeNS(a,e,c):null},shaka.text.TtmlTextParser.getStyleAttributeFromElement_=function(a,b,c){var d=shaka.util.XmlUtils,e=shaka.text.TtmlTextParser.styleNs_,f=shaka.text.TtmlTextParser.getElementFromCollection_;return(a=f(a,"style",b,""))?d.getAttributeNS(a,e,c):null},shaka.text.TtmlTextParser.getElementFromCollection_=function(a,b,c,d){if(!a||1>c.length)return null;var e=null;if(a=shaka.text.TtmlTextParser.getInheritedAttribute_(a,b))for(b=0;b<c.length;b++)if(d+c[b].getAttribute("xml:id")==a){e=c[b];break}return e},shaka.text.TtmlTextParser.getInheritedAttribute_=function(a,b){for(var c=null;a&&!(c=a.getAttribute(b));){var d=a.parentNode;if(!(d instanceof Element))break;a=d}return c},shaka.text.TtmlTextParser.parseTime_=function(a,b){var c=null,d=shaka.text.TtmlTextParser;return d.timeColonFormatFrames_.test(a)?c=d.parseColonTimeWithFrames_(b,a):d.timeColonFormat_.test(a)?c=d.parseTimeFromRegex_(d.timeColonFormat_,a):d.timeColonFormatMilliseconds_.test(a)?c=d.parseTimeFromRegex_(d.timeColonFormatMilliseconds_,a):d.timeFramesFormat_.test(a)?c=d.parseFramesTime_(b,a):d.timeTickFormat_.test(a)?c=d.parseTickTime_(b,a):d.timeHMSFormat_.test(a)&&(c=d.parseTimeFromRegex_(d.timeHMSFormat_,a)),c},shaka.text.TtmlTextParser.parseFramesTime_=function(a,b){var c=shaka.text.TtmlTextParser.timeFramesFormat_.exec(b);return Number(c[1])/a.frameRate},shaka.text.TtmlTextParser.parseTickTime_=function(a,b){var c=shaka.text.TtmlTextParser.timeTickFormat_.exec(b);return Number(c[1])/a.tickRate},shaka.text.TtmlTextParser.parseColonTimeWithFrames_=function(a,b){var c=shaka.text.TtmlTextParser.timeColonFormatFrames_.exec(b),d=Number(c[1]),e=Number(c[2]),f=Number(c[3]),g=Number(c[4]);return g+=(Number(c[5])||0)/a.subFrameRate,f+=g/a.frameRate,f+60*e+3600*d},shaka.text.TtmlTextParser.parseTimeFromRegex_=function(a,b){var c=a.exec(b);return null==c||""==c[0]?null:(Number(c[4])||0)/1e3+(Number(c[3])||0)+60*(Number(c[2])||0)+3600*(Number(c[1])||0)},shaka.text.TtmlTextParser.RateInfo_=function(a,b,c,d){this.frameRate=Number(a)||30,this.subFrameRate=Number(b)||1,this.tickRate=Number(d),0==this.tickRate&&(this.tickRate=a?this.frameRate*this.subFrameRate:1),c&&(a=/^(\d+) (\d+)$/g.exec(c))&&(this.frameRate*=Number(a[1])/Number(a[2]))},shaka.text.TextEngine.registerParser("application/ttml+xml",shaka.text.TtmlTextParser),shaka.text.Mp4TtmlParser=function(){this.parser_=new shaka.text.TtmlTextParser},shaka.text.Mp4TtmlParser.prototype.parseInit=function(a){var b=shaka.util.Mp4Parser,c=!1;if((new b).box("moov",b.children).box("trak",b.children).box("mdia",b.children).box("minf",b.children).box("stbl",b.children).fullBox("stsd",b.sampleDescription).box("stpp",function(a){c=!0,a.parser.stop()}).parse(a),!c)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_MP4_TTML)},shaka.text.Mp4TtmlParser.prototype.parseMedia=function(a,b){var c=shaka.util.Mp4Parser,d=!1,e=[];if((new c).box("mdat",c.allData(function(a){d=!0,e=e.concat(this.parser_.parseMedia(a,b))}.bind(this))).parse(a),!d)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_MP4_TTML);return e},shaka.text.TextEngine.registerParser('application/mp4; codecs="stpp"',shaka.text.Mp4TtmlParser),shaka.text.TextEngine.registerParser('application/mp4; codecs="stpp.TTML.im1t"',shaka.text.Mp4TtmlParser),shaka.text.VttTextParser=function(){},shaka.text.VttTextParser.prototype.parseInit=function(a){goog.asserts.assert(!1,"VTT does not have init segments")},shaka.text.VttTextParser.prototype.parseMedia=function(a,b){var c=shaka.text.VttTextParser,d=shaka.util.StringUtils.fromUTF8(a);if(d=d.replace(/\r\n|\r(?=[^\n]|$)/gm,"\n"),d=d.split(/\n{2,}/m),!/^WEBVTT($|[ \t\n])/m.test(d[0]))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_TEXT_HEADER);var e=b.segmentStart;if(null==e&&(e=0,d[0].includes("X-TIMESTAMP-MAP"))){var f=d[0].match(/LOCAL:((?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3}))/m),g=d[0].match(/MPEGTS:(\d+)/m);if(f&&g){if(e=new shaka.util.TextParser(f[1]),e=shaka.text.VttTextParser.parseTime_(e),null==e)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_TEXT_HEADER);e=b.periodStart+(Number(g[1])/shaka.text.VttTextParser.MPEG_TIMESCALE_-e)}}g=[],f=d[0].split("\n");for(var h=1;h<f.length;h++)if(/^Region:/.test(f[h])){var i=c.parseRegion_(f[h]);g.push(i)}for(h=[],i=1;i<d.length;i++)f=d[i].split("\n"),(f=c.parseCue_(f,e,g))&&h.push(f);return h},shaka.text.VttTextParser.parseRegion_=function(a){var b=shaka.text.VttTextParser;a=new shaka.util.TextParser(a);var c=new shaka.text.CueRegion;a.readWord(),a.skipWhitespace();for(var d=a.readWord();d;)b.parseRegionSetting_(c,d)||shaka.log.warning("VTT parser encountered an invalid VTTRegion setting: ",d," The setting will be ignored."),a.skipWhitespace(),d=a.readWord();return c},shaka.text.VttTextParser.parseCue_=function(a,b,c){var d=shaka.text.VttTextParser;if(1==a.length&&!a[0]||/^NOTE($|[ \t])/.test(a[0])||"STYLE"==a[0])return null;var e=null;a[0].includes("-->")||(e=a[0],a.splice(0,1));var f=new shaka.util.TextParser(a[0]),g=d.parseTime_(f),h=f.readRegex(/[ \t]+--\x3e[ \t]+/g),i=d.parseTime_(f);if(null==g||null==h||null==i)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_TEXT_CUE);for(g+=b,i+=b,a=a.slice(1).join("\n").trim(),g=new shaka.text.Cue(g,i,a),f.skipWhitespace(),i=f.readWord();i;)d.parseCueSetting(g,i,c)||shaka.log.warning("VTT parser encountered an invalid VTT setting: ",i," The setting will be ignored."),f.skipWhitespace(),i=f.readWord();return null!=e&&(g.id=e),g},shaka.text.VttTextParser.parseCueSetting=function(a,b,c){var d,e=shaka.text.VttTextParser;if(d=/^align:(start|middle|center|end|left|right)$/.exec(b))e.setTextAlign_(a,d[1]);else if(d=/^vertical:(lr|rl)$/.exec(b))e.setVerticalWritingMode_(a,d[1]);else if(d=/^size:([\d.]+)%$/.exec(b))a.size=Number(d[1]);else if(d=/^position:([\d.]+)%(?:,(line-left|line-right|center|start|end))?$/.exec(b))a.position=Number(d[1]),d[2]&&e.setPositionAlign_(a,d[2]);else{if(!(d=/^region:(.*)$/.exec(b)))return e.parsedLineValueAndInterpretation_(a,b);(b=e.getRegionById_(c,d[1]))&&(a.region=b)}return!0},shaka.text.VttTextParser.getRegionById_=function(a,b){var c=a.filter(function(a){return a.id==b});return c.length?(goog.asserts.assert(1==c.length,"VTTRegion ids should be unique!"),c[0]):(shaka.log.warning("VTT parser could not find a region with id: ",b," The region will be ignored."),null)},shaka.text.VttTextParser.parseRegionSetting_=function(a,b){var c;if(c=/^id=(.*)$/.exec(b))a.id=c[1];else if(c=/^width=(\d{1,2}|100)%$/.exec(b))a.width=Number(c[1]);else if(c=/^lines=(\d+)$/.exec(b))a.height=Number(c[1]),a.heightUnits=shaka.text.CueRegion.units.LINES;else if(c=/^regionanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(b))a.regionAnchorX=Number(c[1]),a.regionAnchorY=Number(c[2]);else if(c=/^viewportanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(b))a.viewportAnchorX=Number(c[1]),a.viewportAnchorY=Number(c[2]);else{if(!/^scroll=up$/.exec(b))return!1;a.scroll=shaka.text.CueRegion.scrollMode.UP}return!0},shaka.text.VttTextParser.setTextAlign_=function(a,b){var c=shaka.text.Cue;"middle"==b?a.textAlign=c.textAlign.CENTER:(goog.asserts.assert(b.toUpperCase()in c.textAlign,b.toUpperCase()+" Should be in Cue.textAlign values!"),a.textAlign=c.textAlign[b.toUpperCase()])},shaka.text.VttTextParser.setPositionAlign_=function(a,b){var c=shaka.text.Cue;a.positionAlign="line-left"==b||"start"==b?c.positionAlign.LEFT:"line-right"==b||"end"==b?c.positionAlign.RIGHT:c.positionAlign.CENTER},shaka.text.VttTextParser.setVerticalWritingMode_=function(a,b){var c=shaka.text.Cue;a.writingMode="lr"==b?c.writingMode.VERTICAL_LEFT_TO_RIGHT:c.writingMode.VERTICAL_RIGHT_TO_LEFT},shaka.text.VttTextParser.parsedLineValueAndInterpretation_=function(a,b){var c,d=shaka.text.Cue;if(c=/^line:([\d.]+)%(?:,(start|end|center))?$/.exec(b))a.lineInterpretation=d.lineInterpretation.PERCENTAGE,a.line=Number(c[1]),c[2]&&(goog.asserts.assert(c[2].toUpperCase()in d.lineAlign,c[2].toUpperCase()+" Should be in Cue.lineAlign values!"),a.lineAlign=d.lineAlign[c[2].toUpperCase()]);else{if(!(c=/^line:(-?\d+)(?:,(start|end|center))?$/.exec(b)))return!1;a.lineInterpretation=d.lineInterpretation.LINE_NUMBER,a.line=Number(c[1]),c[2]&&(goog.asserts.assert(c[2].toUpperCase()in d.lineAlign,c[2].toUpperCase()+" Should be in Cue.lineAlign values!"),a.lineAlign=d.lineAlign[c[2].toUpperCase()])}return!0},shaka.text.VttTextParser.parseTime_=function(a){if(a=a.readRegex(/(?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3})/g),null==a)return null;var b=Number(a[2]),c=Number(a[3]);return 59<b||59<c?null:Number(a[4])/1e3+c+60*b+3600*(Number(a[1])||0)},shaka.text.VttTextParser.MPEG_TIMESCALE_=9e4,shaka.text.TextEngine.registerParser("text/vtt",shaka.text.VttTextParser),shaka.text.TextEngine.registerParser('text/vtt; codecs="vtt"',shaka.text.VttTextParser),shaka.text.Mp4VttParser=function(){this.timescale_=null},shaka.text.Mp4VttParser.prototype.parseInit=function(a){var b=shaka.util.Mp4Parser,c=!1;if((new b).box("moov",b.children).box("trak",b.children).box("mdia",b.children).fullBox("mdhd",function(a){goog.asserts.assert(0==a.version||1==a.version,"MDHD version can only be 0 or 1"),0==a.version?(a.reader.skip(4),a.reader.skip(4),this.timescale_=a.reader.readUint32(),a.reader.skip(4)):(a.reader.skip(8),a.reader.skip(8),this.timescale_=a.reader.readUint32(),a.reader.skip(8)),a.reader.skip(4)}.bind(this)).box("minf",b.children).box("stbl",b.children).fullBox("stsd",b.sampleDescription).box("wvtt",function(a){c=!0}).parse(a),!this.timescale_)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_MP4_VTT);if(!c)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_MP4_VTT)},shaka.text.Mp4VttParser.prototype.parseMedia=function(a,b){var c=this;if(!this.timescale_)throw shaka.log.error("No init segment for MP4+VTT!"),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_MP4_VTT);var d,e=shaka.text.Mp4VttParser,f=shaka.util.Mp4Parser,g=0,h=[],i=[],j=!1,k=!1,l=!1,m=null;if((new f).box("moof",f.children).box("traf",f.children).fullBox("tfdt",function(a){j=!0,goog.asserts.assert(0==a.version||1==a.version,"TFDT version can only be 0 or 1"),g=0==a.version?a.reader.readUint32():a.reader.readUint64()}).fullBox("tfhd",function(a){goog.asserts.assert(null!=a.flags,"A TFHD box should have a valid flags value"),m=e.parseTFHD_(a.flags,a.reader)}).fullBox("trun",function(a){k=!0,goog.asserts.assert(null!=a.version,"A TRUN box should have a valid version value"),goog.asserts.assert(null!=a.flags,"A TRUN box should have a valid flags value"),h=e.parseTRUN_(a.version,a.flags,a.reader)}).box("mdat",f.allData(function(a){goog.asserts.assert(!l,"VTT cues in mp4 with multiple MDAT are not currently supported!"),l=!0,d=a})).parse(a),!l&&!j&&!k)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_MP4_VTT);var n=g;f=new DataView(d.buffer,d.byteOffset,d.byteLength);var o=new shaka.util.DataViewReader(f,shaka.util.DataViewReader.Endianness.BIG_ENDIAN);return h.forEach(function(a){var d=a.duration||m,e=a.timeOffset?g+a.timeOffset:n;n=e+(d||0);var f=0;do{var h=o.readUint32();f+=h;var j=o.readUint32();j=shaka.util.Mp4Parser.typeToString(j);var k=null;"vttc"==j?8<h&&(k=o.readBytes(h-8)):("vtte"!=j&&shaka.log.error("Unknown box "+j+"! Skipping!"),o.skip(h-8)),d?k&&(goog.asserts.assert(null!=c.timescale_,"Timescale should not be null!"),i.push(shaka.text.Mp4VttParser.parseVTTC_(k,b.periodStart+e/c.timescale_,b.periodStart+n/c.timescale_))):shaka.log.error("WVTT sample duration unknown, and no default found!"),goog.asserts.assert(!a.sampleSize||f<=a.sampleSize,"The samples do not fit evenly into the sample sizes given in the TRUN box!")}while(a.sampleSize&&f<a.sampleSize)}),goog.asserts.assert(!o.hasMoreData(),"MDAT which contain VTT cues and non-VTT data are not currently supported!"),i.filter(shaka.util.Functional.isNotNull)},shaka.text.Mp4VttParser.parseTFHD_=function(a,b){return b.skip(4),1&a&&b.skip(8),2&a&&b.skip(4),8&a?b.readUint32():null},shaka.text.Mp4VttParser.parseTRUN_=function(a,b,c){var d=c.readUint32();1&b&&c.skip(4),4&b&&c.skip(4);for(var e=[],f=0;f<d;f++){var g={duration:null,sampleSize:null,timeOffset:null};256&b&&(g.duration=c.readUint32()),512&b&&(g.sampleSize=c.readUint32()),1024&b&&c.skip(4),2048&b&&(g.timeOffset=0==a?c.readUint32():c.readInt32()),e.push(g)}return e},shaka.text.Mp4VttParser.parseVTTC_=function(a,b,c){var d,e,f;return(new shaka.util.Mp4Parser).box("payl",shaka.util.Mp4Parser.allData(function(a){d=shaka.util.StringUtils.fromUTF8(a)})).box("iden",shaka.util.Mp4Parser.allData(function(a){e=shaka.util.StringUtils.fromUTF8(a)})).box("sttg",shaka.util.Mp4Parser.allData(function(a){f=shaka.util.StringUtils.fromUTF8(a)})).parse(a),d?shaka.text.Mp4VttParser.assembleCue_(d,e,f,b,c):null},shaka.text.Mp4VttParser.assembleCue_=function(a,b,c,d,e){if(a=new shaka.text.Cue(d,e,a),b&&(a.id=b),c)for(b=new shaka.util.TextParser(c),c=b.readWord();c;)shaka.text.VttTextParser.parseCueSetting(a,c,[])||shaka.log.warning("VTT parser encountered an invalid VTT setting: ",c," The setting will be ignored."),b.skipWhitespace(),c=b.readWord();return a},shaka.text.TextEngine.registerParser('application/mp4; codecs="wvtt"',shaka.text.Mp4VttParser),shaka.util.Dom=function(){},shaka.util.Dom.createHTMLElement=function(a){return document.createElement(a)},goog.exportSymbol("shaka.util.Dom.createHTMLElement",shaka.util.Dom.createHTMLElement),shaka.util.Dom.createVideoElement=function(){var a=document.createElement("video");return a.muted=!0,a.width=600,a.height=400,a},goog.exportSymbol("shaka.util.Dom.createVideoElement",shaka.util.Dom.createVideoElement),shaka.util.Dom.asHTMLElement=function(a){return a},goog.exportSymbol("shaka.util.Dom.asHTMLElement",shaka.util.Dom.asHTMLElement),shaka.util.Dom.asHTMLMediaElement=function(a){return a},goog.exportSymbol("shaka.util.Dom.asHTMLMediaElement",shaka.util.Dom.asHTMLMediaElement),shaka.util.Dom.getElementByClassName=function(a,b){var c=b.getElementsByClassName(a);return goog.asserts.assert(1==c.length,"Should only be one element with class name "+a),shaka.util.Dom.asHTMLElement(c[0])},shaka.util.Dom.removeAllChildren=function(a){for(;a.firstChild;)a.removeChild(a.firstChild)},goog.exportSymbol("shaka.util.Dom.removeAllChildren",shaka.util.Dom.removeAllChildren),shaka.Player.prototype.getActiveAudio=function(){return this.streamingEngine_.getBufferingAudio()},shaka.Player.prototype.onKeyStatus_org_=shaka.Player.prototype.onKeyStatus_,shaka.Player.prototype.onKeyStatus_=function(a){this.onKeyStatus_org_(a);var b=[];for(var c in a)a[c]&&b.push(a[c]);this.dispatchEvent(new shaka.util.FakeEvent("vudukeystatuseschanged",{keyStatusMap:b}))},shaka.Player.prototype.updateState_org_=shaka.Player.prototype.updateStateHistory_,shaka.Player.prototype.updateStateHistory_=function(){this.updateState_org_();var a=this.stats_.getStateHistory().getCopy(),b=a[a.length-1];this.dispatchEvent(new shaka.util.FakeEvent("updatestate",b))},shaka.Player.prototype.getActiveVideo=function(){return this.streamingEngine_.getBufferingVideo()},shaka.Player.prototype.chooseCodecsAndFilterManifest_=function(){function a(a){return a.audio?a.audio.codecs.split(".")[0]:""}this.manifest_.periods.forEach(function(b){var c,d={};b.variants.forEach(function(b){var e=a(b);c=e,e in d||(d[e]=1)}),c="mp4a",b.variants=b.variants.filter(function(b){var d=a(b);return d===c||(shaka.log.debug("Dropping Variant (better codec available)",b),!1)})})},shaka.VuduPlayer=function(a,b,c){shaka.Player.call(this,b,c),shaka.net.NetworkingEngine.registerScheme("drm",function(b,c){var d=null,e=new Promise(function(e,f){d=f;var g="widevine";b.indexOf("playready",0)!==-1&&(g="playready");var h=function(a){var d=c.headers,f={uri:b,data:a,headers:d,fromCache:!!d["x-shaka-from-cache"]};e(f)},i=function(a){f(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.LICENSE_REQUEST_FAILED,b,a))};a(g,c.body,h,i)}),f=function(){d(new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.NETWORK,shaka.uti.Error.Code.OPERATION_ABORTED))};return new shaka.util.AbortableOperation(e,f)})},goog.inherits(shaka.VuduPlayer,shaka.Player);var requirejs,require,define;!function(global){function isFunction(a){return"[object Function]"===ostring.call(a)}function isArray(a){return"[object Array]"===ostring.call(a)}function each(a,b){if(a){var c;for(c=0;c<a.length&&(!a[c]||!b(a[c],c,a));c+=1);}}function eachReverse(a,b){if(a){var c;for(c=a.length-1;c>-1&&(!a[c]||!b(a[c],c,a));c-=1);}}function hasProp(a,b){return hasOwn.call(a,b)}function getOwn(a,b){return hasProp(a,b)&&a[b]}function eachProp(a,b){var c;for(c in a)if(hasProp(a,c)&&b(a[c],c))break}function mixin(a,b,c,d){return b&&eachProp(b,function(b,e){!c&&hasProp(a,e)||(!d||"object"!=typeof b||!b||isArray(b)||isFunction(b)||b instanceof RegExp?a[e]=b:(a[e]||(a[e]={}),mixin(a[e],b,c,d)))}),a}function bind(a,b){return function(){return b.apply(a,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(a){throw a}function getGlobal(a){if(!a)return a;var b=global;return each(a.split("."),function(a){b=b[a]}),b}function makeError(a,b,c,d){var e=new Error(b+"\nhttp://requirejs.org/docs/errors.html#"+a);return e.requireType=a,e.requireModules=d,c&&(e.originalError=c),e}function newContext(a){function b(a){var b,c;for(b=0;b<a.length;b++)if(c=a[b],"."===c)a.splice(b,1),b-=1;else if(".."===c){if(0===b||1===b&&".."===a[2]||".."===a[b-1])continue;b>0&&(a.splice(b-1,2),b-=2)}}function c(a,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q=c&&c.split("/"),r=x.map,s=r&&r["*"];if(a&&(a=a.split("/"),k=a.length-1,x.nodeIdCompat&&jsSuffixRegExp.test(a[k])&&(a[k]=a[k].replace(jsSuffixRegExp,"")),"."===a[0].charAt(0)&&q&&(p=q.slice(0,q.length-1),a=p.concat(a)),b(a),a=a.join("/")),d&&r&&(q||s)){g=a.split("/");a:for(h=g.length;h>0;h-=1){if(j=g.slice(0,h).join("/"),q)for(i=q.length;i>0;i-=1)if(f=getOwn(r,q.slice(0,i).join("/")),f&&(f=getOwn(f,j))){l=f,m=h;break a}!n&&s&&getOwn(s,j)&&(n=getOwn(s,j),o=h)}!l&&n&&(l=n,m=o),l&&(g.splice(0,m,l),a=g.join("/"))}return e=getOwn(x.pkgs,a),e?e:a}function d(a){isBrowser&&each(scripts(),function(b){if(b.getAttribute("data-requiremodule")===a&&b.getAttribute("data-requirecontext")===u.contextName)return b.parentNode.removeChild(b),!0})}function e(a){var b=getOwn(x.paths,a);if(b&&isArray(b)&&b.length>1)return b.shift(),u.require.undef(a),u.makeRequire(null,{skipMap:!0})([a]),!0}function f(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function g(a,b,d,e){var g,h,i,j,k=null,l=b?b.name:null,m=a,n=!0,o="";return a||(n=!1,a="_@r"+(F+=1)),j=f(a),k=j[0],a=j[1],k&&(k=c(k,l,e),h=getOwn(C,k)),a&&(k?o=h&&h.normalize?h.normalize(a,function(a){return c(a,l,e)}):a.indexOf("!")===-1?c(a,l,e):a:(o=c(a,l,e),j=f(o),k=j[0],o=j[1],d=!0,g=u.nameToUrl(o))),i=!k||h||d?"":"_unnormalized"+(G+=1),{prefix:k,name:o,parentMap:b,unnormalized:!!i,url:g,originalName:m,isDefine:n,id:(k?k+"!"+o:o)+i}}function h(a){var b=a.id,c=getOwn(y,b);return c||(c=y[b]=new u.Module(a)),c}function i(a,b,c){var d=a.id,e=getOwn(y,d);!hasProp(C,d)||e&&!e.defineEmitComplete?(e=h(a),e.error&&"error"===b?c(e.error):e.on(b,c)):"defined"===b&&c(C[d])}function j(a,b){var c=a.requireModules,d=!1;b?b(a):(each(c,function(b){var c=getOwn(y,b);c&&(c.error=a,c.events.error&&(d=!0,c.emit("error",a)))}),d||req.onError(a))}function k(){globalDefQueue.length&&(each(globalDefQueue,function(a){var b=a[0];"string"==typeof b&&(u.defQueueMap[b]=!0),B.push(a)}),globalDefQueue=[])}function l(a){delete y[a],delete z[a]}function m(a,b,c){var d=a.map.id;a.error?a.emit("error",a.error):(b[d]=!0,each(a.depMaps,function(d,e){var f=d.id,g=getOwn(y,f);!g||a.depMatched[e]||c[f]||(getOwn(b,f)?(a.defineDep(e,C[f]),a.check()):m(g,b,c))}),c[d]=!0)}function n(){var a,b,c=1e3*x.waitSeconds,f=c&&u.startTime+c<(new Date).getTime(),g=[],h=[],i=!1,k=!0;if(!s){if(s=!0,eachProp(z,function(a){var c=a.map,j=c.id;if(a.enabled&&(c.isDefine||h.push(a),!a.error))if(!a.inited&&f)e(j)?(b=!0,i=!0):(g.push(j),d(j));else if(!a.inited&&a.fetched&&c.isDefine&&(i=!0,!c.prefix))return k=!1}),f&&g.length)return a=makeError("timeout","Load timeout for modules: "+g,null,g),a.contextName=u.contextName,j(a);k&&each(h,function(a){m(a,{},{})}),f&&!b||!i||!isBrowser&&!isWebWorker||w||(w=setTimeout(function(){w=0,n()},50)),s=!1}}function o(a){hasProp(C,a[0])||h(g(a[0],null,!0)).init(a[1],a[2])}function p(a,b,c,d){a.detachEvent&&!isOpera?d&&a.detachEvent(d,b):a.removeEventListener(c,b,!1)}function q(a){var b=a.currentTarget||a.srcElement;return p(b,u.onScriptLoad,"load","onreadystatechange"),p(b,u.onScriptError,"error"),{node:b,id:b&&b.getAttribute("data-requiremodule")}}function r(){var a;for(k();B.length;){if(a=B.shift(),null===a[0])return j(makeError("mismatch","Mismatched anonymous define() module: "+a[a.length-1]));o(a)}u.defQueueMap={}}var s,t,u,v,w,x={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},y={},z={},A={},B=[],C={},D={},E={},F=1,G=1;return v={require:function(a){return a.require?a.require:a.require=u.makeRequire(a.map)},exports:function(a){if(a.usingExports=!0,a.map.isDefine)return a.exports?C[a.map.id]=a.exports:a.exports=C[a.map.id]={}},module:function(a){return a.module?a.module:a.module={id:a.map.id,uri:a.map.url,config:function(){return getOwn(x.config,a.map.id)||{}},exports:a.exports||(a.exports={})}}},t=function(a){this.events=getOwn(A,a.id)||{},this.map=a,this.shim=getOwn(x.shim,a.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},t.prototype={init:function(a,b,c,d){d=d||{},this.inited||(this.factory=b,c?this.on("error",c):this.events.error&&(c=bind(this,function(a){this.emit("error",a)})),this.depMaps=a&&a.slice(0),this.errback=c,this.inited=!0,this.ignore=d.ignore,d.enabled||this.enabled?this.enable():this.check())},defineDep:function(a,b){this.depMatched[a]||(this.depMatched[a]=!0,this.depCount-=1,this.depExports[a]=b)},fetch:function(){if(!this.fetched){this.fetched=!0,u.startTime=(new Date).getTime();var a=this.map;return this.shim?void u.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return a.prefix?this.callPlugin():this.load()})):a.prefix?this.callPlugin():this.load()}},load:function(){var a=this.map.url;D[a]||(D[a]=!0,u.load(this.map.id,a))},check:function(){if(this.enabled&&!this.enabling){var a,b,c=this.map.id,d=this.depExports,e=this.exports,f=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(f)){try{e=u.execCb(c,f,d,e)}catch(g){a=g}if(this.map.isDefine&&void 0===e&&(b=this.module,b?e=b.exports:this.usingExports&&(e=this.exports)),a){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)return a.requireMap=this.map,a.requireModules=this.map.isDefine?[this.map.id]:null,a.requireType=this.map.isDefine?"define":"require",j(this.error=a);"undefined"!=typeof console&&console.error?console.error(a):req.onError(a)}}else e=f;if(this.exports=e,this.map.isDefine&&!this.ignore&&(C[c]=e,req.onResourceLoad)){var h=[];each(this.depMaps,function(a){h.push(a.normalizedMap||a)}),req.onResourceLoad(u,this.map,h)}l(c),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else hasProp(u.defQueueMap,c)||this.fetch()}},callPlugin:function(){var a=this.map,b=a.id,d=g(a.prefix);this.depMaps.push(d),i(d,"defined",bind(this,function(d){var e,f,k,m=getOwn(E,this.map.id),n=this.map.name,o=this.map.parentMap?this.map.parentMap.name:null,p=u.makeRequire(a.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(d.normalize&&(n=d.normalize(n,function(a){return c(a,o,!0)})||""),f=g(a.prefix+"!"+n,this.map.parentMap),i(f,"defined",bind(this,function(a){this.map.normalizedMap=f,this.init([],function(){return a},null,{enabled:!0,ignore:!0})})),k=getOwn(y,f.id),void(k&&(this.depMaps.push(f),this.events.error&&k.on("error",bind(this,function(a){this.emit("error",a)})),k.enable()))):m?(this.map.url=u.nameToUrl(m),void this.load()):(e=bind(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),e.error=bind(this,function(a){this.inited=!0,this.error=a,a.requireModules=[b],eachProp(y,function(a){0===a.map.id.indexOf(b+"_unnormalized")&&l(a.map.id)}),j(a)}),e.fromText=bind(this,function(c,d){var f=a.name,i=g(f),k=useInteractive;d&&(c=d),k&&(useInteractive=!1),h(i),hasProp(x.config,b)&&(x.config[f]=x.config[b]);try{req.exec(c)}catch(l){return j(makeError("fromtexteval","fromText eval for "+b+" failed: "+l,l,[b]));
}k&&(useInteractive=!0),this.depMaps.push(i),u.completeLoad(f),p([f],e)}),void d.load(a.name,p,e,x))})),u.enable(d,this),this.pluginMaps[d.id]=d},enable:function(){z[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(a,b){var c,d,e;if("string"==typeof a){if(a=g(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[b]=a,e=getOwn(v,a.id))return void(this.depExports[b]=e(this));this.depCount+=1,i(a,"defined",bind(this,function(a){this.undefed||(this.defineDep(b,a),this.check())})),this.errback?i(a,"error",bind(this,this.errback)):this.events.error&&i(a,"error",bind(this,function(a){this.emit("error",a)}))}c=a.id,d=y[c],hasProp(v,c)||!d||d.enabled||u.enable(a,this)})),eachProp(this.pluginMaps,bind(this,function(a){var b=getOwn(y,a.id);b&&!b.enabled&&u.enable(a,this)})),this.enabling=!1,this.check()},on:function(a,b){var c=this.events[a];c||(c=this.events[a]=[]),c.push(b)},emit:function(a,b){each(this.events[a],function(a){a(b)}),"error"===a&&delete this.events[a]}},u={config:x,contextName:a,registry:y,defined:C,urlFetched:D,defQueue:B,defQueueMap:{},Module:t,makeModuleMap:g,nextTick:req.nextTick,onError:j,configure:function(a){a.baseUrl&&"/"!==a.baseUrl.charAt(a.baseUrl.length-1)&&(a.baseUrl+="/");var b=x.shim,c={paths:!0,bundles:!0,config:!0,map:!0};eachProp(a,function(a,b){c[b]?(x[b]||(x[b]={}),mixin(x[b],a,!0,!0)):x[b]=a}),a.bundles&&eachProp(a.bundles,function(a,b){each(a,function(a){a!==b&&(E[a]=b)})}),a.shim&&(eachProp(a.shim,function(a,c){isArray(a)&&(a={deps:a}),!a.exports&&!a.init||a.exportsFn||(a.exportsFn=u.makeShimExports(a)),b[c]=a}),x.shim=b),a.packages&&each(a.packages,function(a){var b,c;a="string"==typeof a?{name:a}:a,c=a.name,b=a.location,b&&(x.paths[c]=a.location),x.pkgs[c]=a.name+"/"+(a.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(y,function(a,b){a.inited||a.map.unnormalized||(a.map=g(b,null,!0))}),(a.deps||a.callback)&&u.require(a.deps||[],a.callback)},makeShimExports:function(a){function b(){var b;return a.init&&(b=a.init.apply(global,arguments)),b||a.exports&&getGlobal(a.exports)}return b},makeRequire:function(b,e){function f(c,d,i){var k,l,m;return e.enableBuildCallback&&d&&isFunction(d)&&(d.__requireJsBuild=!0),"string"==typeof c?isFunction(d)?j(makeError("requireargs","Invalid require call"),i):b&&hasProp(v,c)?v[c](y[b.id]):req.get?req.get(u,c,b,f):(l=g(c,b,!1,!0),k=l.id,hasProp(C,k)?C[k]:j(makeError("notloaded",'Module name "'+k+'" has not been loaded yet for context: '+a+(b?"":". Use require([])")))):(r(),u.nextTick(function(){r(),m=h(g(null,b)),m.skipMap=e.skipMap,m.init(c,d,i,{enabled:!0}),n()}),f)}return e=e||{},mixin(f,{isBrowser:isBrowser,toUrl:function(a){var d,e=a.lastIndexOf("."),f=a.split("/")[0],g="."===f||".."===f;return e!==-1&&(!g||e>1)&&(d=a.substring(e,a.length),a=a.substring(0,e)),u.nameToUrl(c(a,b&&b.id,!0),d,!0)},defined:function(a){return hasProp(C,g(a,b,!1,!0).id)},specified:function(a){return a=g(a,b,!1,!0).id,hasProp(C,a)||hasProp(y,a)}}),b||(f.undef=function(a){k();var c=g(a,b,!0),e=getOwn(y,a);e.undefed=!0,d(a),delete C[a],delete D[c.url],delete A[a],eachReverse(B,function(b,c){b[0]===a&&B.splice(c,1)}),delete u.defQueueMap[a],e&&(e.events.defined&&(A[a]=e.events),l(a))}),f},enable:function(a){var b=getOwn(y,a.id);b&&h(a).enable()},completeLoad:function(a){var b,c,d,f=getOwn(x.shim,a)||{},g=f.exports;for(k();B.length;){if(c=B.shift(),null===c[0]){if(c[0]=a,b)break;b=!0}else c[0]===a&&(b=!0);o(c)}if(u.defQueueMap={},d=getOwn(y,a),!b&&!hasProp(C,a)&&d&&!d.inited){if(!(!x.enforceDefine||g&&getGlobal(g)))return e(a)?void 0:j(makeError("nodefine","No define call for "+a,null,[a]));o([a,f.deps||[],f.exportsFn])}n()},nameToUrl:function(a,b,c){var d,e,f,g,h,i,j,k=getOwn(x.pkgs,a);if(k&&(a=k),j=getOwn(E,a))return u.nameToUrl(j,b,c);if(req.jsExtRegExp.test(a))h=a+(b||"");else{for(d=x.paths,e=a.split("/"),f=e.length;f>0;f-=1)if(g=e.slice(0,f).join("/"),i=getOwn(d,g)){isArray(i)&&(i=i[0]),e.splice(0,f,i);break}h=e.join("/"),h+=b||(/^data\:|\?/.test(h)||c?"":".js"),h=("/"===h.charAt(0)||h.match(/^[\w\+\.\-]+:/)?"":x.baseUrl)+h}return x.urlArgs?h+((h.indexOf("?")===-1?"?":"&")+x.urlArgs):h},load:function(a,b){req.load(u,a,b)},execCb:function(a,b,c,d){return b.apply(d,c)},onScriptLoad:function(a){if("load"===a.type||readyRegExp.test((a.currentTarget||a.srcElement).readyState)){interactiveScript=null;var b=q(a);u.completeLoad(b.id)}},onScriptError:function(a){var b=q(a);if(!e(b.id)){var c=[];return eachProp(y,function(a,d){0!==d.indexOf("_@r")&&each(a.depMaps,function(a){return a.id===b.id&&c.push(d),!0})}),j(makeError("scripterror",'Script error for "'+b.id+(c.length?'", needed by: '+c.join(", "):'"'),a,[b.id]))}}},u.require=u.makeRequire(),u}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(a){if("interactive"===a.readyState)return interactiveScript=a}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.22",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}"undefined"==typeof require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(a,b,c,d){var e,f,g=defContextName;return isArray(a)||"string"==typeof a||(f=a,isArray(b)?(a=b,b=c,c=d):a=[]),f&&f.context&&(g=f.context),e=getOwn(contexts,g),e||(e=contexts[g]=req.s.newContext(g)),f&&e.configure(f),e.require(a,b,c)},req.config=function(a){return req(a)},req.nextTick="undefined"!=typeof setTimeout?function(a){setTimeout(a,4)}:function(a){a()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(a){req[a]=function(){var b=contexts[defContextName];return b.require[a].apply(b,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(a,b,c){var d=a.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return d.type=a.scriptType||"text/javascript",d.charset="utf-8",d.async=!0,d},req.load=function(a,b,c){var d,e=a&&a.config||{};if(isBrowser)return d=req.createNode(e,b,c),e.onNodeCreated&&e.onNodeCreated(d,e,b,c),d.setAttribute("data-requirecontext",a.contextName),d.setAttribute("data-requiremodule",b),!d.attachEvent||d.attachEvent.toString&&d.attachEvent.toString().indexOf("[native code")<0||isOpera?(d.addEventListener("load",a.onScriptLoad,!1),d.addEventListener("error",a.onScriptError,!1)):(useInteractive=!0,d.attachEvent("onreadystatechange",a.onScriptLoad)),d.src=c,currentlyAddingScript=d,baseElement?head.insertBefore(d,baseElement):head.appendChild(d),currentlyAddingScript=null,d;if(isWebWorker)try{importScripts(c),a.completeLoad(b)}catch(f){a.onError(makeError("importscripts","importScripts failed for "+b+" at "+c,f,[b]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(a){if(head||(head=a.parentNode),dataMain=a.getAttribute("data-main"))return mainScript=dataMain,cfg.baseUrl||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(a,b,c){var d,e;"string"!=typeof a&&(c=b,b=a,a=null),isArray(b)||(c=b,b=null),!b&&isFunction(c)&&(b=[],c.length&&(c.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(a,c){b.push(c)}),b=(1===c.length?["require"]:["require","exports","module"]).concat(b))),useInteractive&&(d=currentlyAddingScript||getInteractiveScript(),d&&(a||(a=d.getAttribute("data-requiremodule")),e=contexts[d.getAttribute("data-requirecontext")])),e?(e.defQueue.push([a,b,c]),e.defQueueMap[a]=!0):globalDefQueue.push([a,b,c])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this),define("ensis/data/format",[],function(){function a(a){var b=a/3600|0,c=(a-3600*b)/60|0,d=a-60*(60*b+c)|0,e=""+b;return e+=":",c<10&&(e+="0"),e+=c,e+=":",d<10&&(e+="0"),e+=d}function b(a){if(0==a)return"0x";if(a<0)return"-"+b(~a+1);var c=15&a;return c<10?c=""+c:(c-=10,c+="A".charCodeAt(0),c=String.fromCharCode(c)),b(a/16|0)+c}function c(a){return"number"!=typeof a||0==a?"0x0":b(a)}function d(a){if("string"!=typeof a)return!1;var b=a[0];return b>="a"&&b<="f"||(b>="A"&&b<="F"||b>="0"&&b<="9")}function e(){return{timeToString:a,toHex:c,isHexChar:d}}return e()}),define("ensis/logger/logclient",["module","ensis/data/format"],function(a,b){"use strict";function c(){function a(a,b){throw new Error("report function must be overridden in LogClient")}return{report:a}}function d(){return{report:function(){},isNullClient:function(){return!0}}}function e(){function c(a,c){var d=m[a];if("function"!=typeof d&&(d=m.log),j){var e=Date.now();e/=1e3,e|=0,e!==l&&(i=b.timeToString(e-k),l=e),e=i,d.call(console,["[",e,"] ",c].join(""))}else d.call(console,c)}var d=console.error,e=console.warn,f=console.log,g=console.debug,h=a.config();h&&h.console&&h.console.timestamp&&(j=h.console.timestamp);var i,k=Date.now()/1e3|0,l=0,m={error:d,warn:e,log:f,trace:g};return{report:c}}function f(a){function b(b){a.report(k.error,b)}function c(b){a.report(k.warn,b)}function d(b){a.report(k.log,b)}function e(b){a.report(k.trace,b)}return{error:b,warn:c,log:d,trace:e}}function g(){return h=d(),i=e(),{Level:k,createAbstractClient:c,getConsoleClient:function(){return i},getNullClient:function(){return h},createLogMapper:f}}var h,i,j=!1,k={error:"error",warn:"warn",log:"log",trace:"trace"};return g()}),define("ensis/logger/logger",["module","ensis/logger/logclient"],function(a,b){"use strict";function c(a){var b;return b=m[a]?m[a]:k}function d(a){var b={},d=0,e=null;return b.getName=function(){return a},b.setClient=function(a){e=a},b.getClient=function(){return e},b.getConfigTime=function(){return d},b.configureLoggerLevels=function(){function e(a,b,c){return function(){a.call(b,c,Array.apply(null,arguments))}}var f=c(a),i=n[f];for(var j in i)i[j]?b[j]=e(g,b,j):b[j]=e(h,b,j);d=Date.now()},b.configureLoggerLevels(),b}function e(a){o=a}function f(a){k=a,l=Date.now()}function g(a,b){var c=this,d=c.getName();if(i(c.getConfigTime()))return c.configureLoggerLevels(),void c[a].apply(c,b);var e=c.getClient();if("undefined"==typeof e||null===e)e=o;else if("function"==typeof e.isNullClient&&e.isNullClient())return;var f=b.map(function(a){if("undefined"==typeof a)return"<undefined>";if(null===a)return"<null>";if("object"==typeof a){var b;try{b=JSON.stringify(a)}catch(c){try{b="[Object] (E): "+Object.keys(a).join()}catch(d){b="[Object] (E): "+d.message}}return b}return a});f.unshift(d,": "),e.report(a,f.join(""))}function h(a,b){var c=this;if(i(c.getConfigTime()))return c.configureLoggerLevels(),void c[a].apply(c,b)}function i(a){return a<l}function j(){return{create:d,setDefaultClient:e,setDefaultLogLevel:f}}var k,l=0,m=a.config();m||(m={}),k=m["default"]?m["default"]:"log";var n={error:{trace:!1,log:!1,warn:!1,error:!0},warn:{trace:!1,log:!1,warn:!0,error:!0},log:{trace:!1,log:!0,warn:!0,error:!0},trace:{trace:!0,log:!0,warn:!0,error:!0}},o=b.getConsoleClient();return j()}),define("ensis/media/types",[],function(){"use strict";var a={AUDIO:"audio",VIDEO:"video"},b={SD:"sd",HD:"hd",HDX:"hdx",UHD:"uhd",SDR:"uhd-sdr",HDR10:"uhd-hdr10",DOVI:"uhd-dolbyvision",DOVI4:"uhd-dovi-4",DOVI5:"uhd-dovi-5"},c={AAC:"aac",DD:"dd",DDP:"ddp",ATMOS:"atmos",PCM_STEREO:"pcm_stereo",PCM_SURROUND:"pcm_surround"},d={Audio:c,Video:b},e={widevine:"EDEF8BA9-79D6-4ACE-A3C8-27DCD51D21ED",playready:"9A04F079-9840-4286-AB92-E65BE0885F95",dash:"mp4protection:2011",dash2011:"mp4protection:2011"},f=function(){function a(a){var b=c.unknown;return a&&(b=0===a.indexOf("audio/")?c.audio:0===a.indexOf("video/")?c.video:c.other),b}function b(a){return a>c._media}var c={unknown:0,other:1,_media:256,audio:257,video:258};return{unknown:c.unknown,other:c.other,audio:c.audio,video:c.video,getType:a,isMedia:b}}(),g=function(){function a(a){return a==h.AUDIO||(a==h.VIDEO||a==h.TEXT)}function b(b){var c=b&i,d=b&j;if(!a(d))throw new Error("Type must be non-zero: "+b+" ("+d+")");return{index:c,type:d}}function c(b,c){if(!a(b))throw new Error("Type must be one of type: "+JSON.stringify(h));if(c>i)throw new Error("Can't have more than "+i+" tracks per type");return b|c}function d(a){var c=b(a);return c.index}function e(a){var c=b(a);return c.type}function f(a,b){var d=0;switch(a){case cast.receiver.media.TrackType.VIDEO:d=h.VIDEO;break;case cast.receiver.media.TrackType.AUDIO:d=h.AUDIO;break;case cast.receiver.media.TrackType.TEXT:d=h.TEXT}return c(d,b)}function g(a){var c=b(a),d=0;switch(c.type){case h.VIDEO:d=cast.receiver.media.TrackType.VIDEO;break;case h.AUDIO:d=cast.receiver.media.TrackType.AUDIO;break;case h.TEXT:d=cast.receiver.media.TrackType.TEXT}return{type:d,index:c.index}}var h={AUDIO:16,VIDEO:32,TEXT:64},i=15,j=h.AUDIO|h.VIDEO|h.TEXT;if(0!==(i&j))throw new Error("Masks overlap");return{Type:h,toIndex:d,toType:e,toTuple:b,makeCastId:f,makeCastTuple:g}}();return{MediaType:a,MediaFormat:d,Track:g,AdaptationType:f,DrmSchemeUUID:e}}),define("ensis/lang/function",["ensis/logger/logger"],function(a){function b(){}function c(a){return function(){e.trace("Call to NOP: ",a,": ",arguments)}}function d(a){function b(b){try{var c=[].splice.call(arguments,1);if("function"==typeof b)return b.apply(this,c);"function"==typeof a.missing&&a.missing(b,c)}catch(d){"function"==typeof a["catch"]&&a["catch"](d)}}return a=a||{},b}var e=a.create("lang/fn"),f=d();return{NOP:b,namedNOP:c,checked:f,makeChecked:d}}),define("ensis/lang/arguments",[],function(){"use strict";function a(a){return[].splice.call(a,0)}return{toArray:a}}),define("ensis/lang/error",[],function(){"use strict";function a(a,b){this.message=a,this.code=b}function b(){return{Error:a}}return a.prototype=new Error,a.create=function(){var b,c,d=[].splice.call(arguments,0);return b="string"==typeof d[0]?d.shift():"Generic Error based on ensis library","number"==typeof d[0]&&(c=d.shift()),new a(b,c)},b()}),define("ensis/vudu/player/DashPlayerInterface",["ensis/lang/function","ensis/media/types","ensis/logger/logclient","ensis/lang/error"],function(a,b,c,d){"use strict";function e(a,b,c){return{level:a,allowConsole:b,useTimestamps:c}}function f(a,b,c,d,e,f){return{mediaElement:a,mpdUrl:b,uriSuffix:c,eventListener:d,bookmarkTime:e,algorithm:f}}function g(a,b,c){return{type:a,reason:b,extra:c}}function h(a,b,c,d,e,f,g){return{type:a,durationMs:c,index:b,representation:d,byteCount:e,downloadStartTimeMs:f,downloadEndTimeMs:g}}function i(a){return{streamingAlgorithm:a}}function j(a,b,c){return{type:a,representationIndex:b,sidx:c}}function k(a,b,c){return{id:a,name:b,build:c,streamingAlgorithm:void 0}}function l(){return{createPlayer:null,getVersionInfo:null,getInterfaceVersion:null}}function m(){return{play:null,pause:null,seek:null,getCurrentTime:null,getDuration:null,getPlayerSettings:null,getVolume:null,getMute:null,setVolume:null,setMute:null,getBitratesFor:null,getCurrentAdaptationFor:null,getCurrentRepresentationFor:null,setMaxBitrateFor:null,setMaxVideoResolution:null,setCurrentRepresentationFor:null,setInitialBitrateFor:null,initialize:null,setLogging:null,reset:null}}function n(){var a={onAdaptationSelected:null,onBufferLoaded:null,onBufferLevel:null,onBufferUnderrun:null,onError:null,onFragmentLoaded:null,onLicenseRequest:null,onManifestLoaded:null,onManifestParsed:null,onRepresentationSelected:null,onSidxParsed:null,onCanPlay:null,onEnded:null,onKeySystemsChanged:null,onMetadataLoaded:null,onPause:null,onPlay:null,onPlaybackRateChanged:null,onPositionUpdate:null,onProgress:null,onSeeked:null,onSeeking:null,onVolumeChanged:null,onWaiting:null,onLogMessage:null,onMetricsData:null};return a}function o(){return{createPlayer:a.namedNOP("AbstractPlayerFactoryImpl::createPlayer"),getVersionInfo:a.namedNOP("AbstractPlayerFactoryImpl::getVersionInfo"),getInterfaceVersion:a.namedNOP("AbstractPlayerFactoryImpl::getInterfaceVersion")}}function p(){return{play:a.namedNOP("AbstractDashPlayer::play"),pause:a.namedNOP("AbstractDashPlayer::pause"),seek:a.namedNOP("AbstractDashPlayer::seek"),getCurrentTime:a.namedNOP("AbstractDashPlayer::getCurrentTime"),getDuration:a.namedNOP("AbstractDashPlayer::getDuration"),getVolume:a.namedNOP("AbstractDashPlayer::getVolume"),getMute:a.namedNOP("AbstractDashPlayer::getMute"),setVolume:a.namedNOP("AbstractDashPlayer::setVolume"),setMute:a.namedNOP("AbstractDashPlayer::setMute"),getBitratesFor:a.namedNOP("AbstractDashPlayer::getBitratesFor"),getCurrentAdaptationFor:a.namedNOP("AbstractDashPlayer::getCurrentAdaptationFor"),getCurrentRepresentationFor:a.namedNOP("AbstractDashPlayer::getCurrentRepresentationFor"),setMaxBitrateFor:a.namedNOP("AbstractDashPlayer::setMaxBitrateFor"),setMaxVideoResolution:a.namedNOP("AbstractDashPlayer::setMaxVideoResolution"),setCurrentRepresentationFor:a.namedNOP("AbstractDashPlayer::setCurrentRepresentationFor"),setInitialBitrateFor:a.namedNOP("AbstractDashPlayer::setInitialBitrateFor"),getPlayerSettings:a.namedNOP("AbstractDashPlayer::getPlayerSettings"),initialize:a.namedNOP("AbstractDashPlayer::initialize"),setLogging:a.namedNOP("AbstractDashPlayer::setLogging"),reset:a.namedNOP("AbstractDashPlayer::reset")}}function q(){return{onAdaptationSelected:a.namedNOP("AbstractDashListener::onAdaptationSelected"),onBufferLoaded:a.namedNOP("AbstractDashListener::onBufferLoaded"),onBufferLevel:a.namedNOP("AbstractDashListener::onBufferLevel"),onBufferUnderrun:a.namedNOP("AbstractDashListener::onBufferUnderrun"),onError:a.namedNOP("AbstractDashListener::onError"),onFragmentLoaded:a.namedNOP("AbstractDashListener::onFragmentLoaded"),onLicenseRequest:a.namedNOP("AbstractDashListener::onLicenseRequest"),onManifestLoaded:a.namedNOP("AbstractDashListener::onManifestLoaded"),onManifestParsed:a.namedNOP("AbstractDashListener::onManifestParsed"),onRepresentationSelected:a.namedNOP("AbstractDashListener::onRepresentationSelected"),onSidxParsed:a.namedNOP("AbstractDashListener::onSidxParsed"),onCanPlay:a.namedNOP("AbstractDashListener::onCanPlay"),onEnded:a.namedNOP("AbstractDashListener::onEnded"),onKeySystemsChanged:a.namedNOP("AbstractDashListener::onKeySystemsChanged"),onMetadataLoaded:a.namedNOP("AbstractDashListener::onMetadataLoaded"),onPause:a.namedNOP("AbstractDashListener::onPause"),onPlay:a.namedNOP("AbstractDashListener::onPlay"),onPlaybackRateChanged:a.namedNOP("AbstractDashListener::onPlaybackRateChanged"),onPositionUpdate:a.namedNOP("AbstractDashListener::onPositionUpdate"),onProgress:a.namedNOP("AbstractDashListener::onProgress"),onSeeked:a.namedNOP("AbstractDashListener::onSeeked"),onSeeking:a.namedNOP("AbstractDashListener::onSeeking"),onVolumeChanged:a.namedNOP("AbstractDashListener::onVolumeChanged"),onWaiting:a.namedNOP("AbstractDashListener::onWaiting"),onLogMessage:a.namedNOP("AbstractDashListener::onLogMessage"),onMetricsData:a.namedNOP("AbstractDashListener::onMetricsData")}}var r=2;return{VERSION:r,DashPlayerFactory:l,DashPlayerInterface:m,DashPlayerListenerInterface:n,ErrorDetails:g,FragDownloadDetails:h,LoggingParams:e,InitParams:f,PlayerSettingDetails:i,SegmentIndexDetails:j,VersionDetails:k,createPlayerInterface:m,createPlayerFactory:l,createListenerInterface:n,createAbstractPlayer:p,createAbstractPlayerFactory:o,createAbstractListener:q}}),define("ensis/dash/trackinfo",[],function(){"use strict";function a(a,b,c,d,e){return{type:a,bandwidth:b,mime:c,codecs:d,url:e}}function b(){function b(a,b,c,d,e){return{adaptationType:a,adaptationIndex:b,mime:c,codecs:d,info:e}}function c(){return{audio:[],video:[]}}return{makeTrack:b,createRepresentationInfo:a,create:c}}return b()}),define("ensis/dash/manifestutil",["ensis/media/types","ensis/logger/logger","ensis/dash/trackinfo"],function(a,b,c){"use strict";function d(a){for(var b=c.create(),d=a.getElementsByTagName("AdaptationSet"),h=0;h!=d.length;++h){var i=d[h],j={mimeType:i.getAttribute("mimeType"),codecs:i.getAttribute("codecs")},k=g.getType(j.mimeType),l=[],m=i.getElementsByTagName("Representation"),n=e(j,m,l);g.isMedia(k)&&g.isMedia(n)&&k!==n&&f.error("Mismatch between mimeType values in AdaptationSet and Representation: ",k,"/",n);var o=null,p=null;if(g.isMedia(n)?k=n:g.unknown!=n&&f.error("Representation contains a mediatype that is non-media: ",n),g.isMedia(k)){if(l.length>0){var q=!1;l.forEach(function(a){o?o!==a.mime&&(q=!0):o=a.mime,p||(p=a.codecs)}),q&&f.error("All representations in an adaptation set are expected to be same mime type: ",JSON.stringify(l))}p||(p=j.codecs?j.codecs:""),o||(o=j.mimeType?j.mimeType:"")}switch(k){case g.audio:var r=c.makeTrack(k,h,o,p,l);b.audio.push(r);break;case g.video:var s=c.makeTrack(k,h,o,p,l);b.video.push(s);break;default:f.warn("Don't do anything currently with AdaptationType: ",k)}}return b}function e(a,b,c){var d=g.unknown;if(0===b.length)f.warn("No representations in the AdaptationSet");else{for(var e=g.unknown,h=!1,i=0;i!=b.length;++i){var j=b[i],k=j.getAttribute("mimeType"),l=g.getType(k);g.unknown!==l&&(g.unknown!==e?e!==l&&(h=!0):e=l);var m=j.getElementsByTagName("BaseURL");1!==m.length&&f.log("Wasn't expecting more than one BaseURL per Representation: ",JSON.stringify(m));for(var n=m[0],o="",p=n.firstChild;p;)3===p.nodeType&&(o+=p.nodeValue),p=p.nextSibling;if(o&&o.length>0){k||(k=a.mimeType);var q=j.getAttribute("codecs");q||(q=a.codecs),o=o.trim(),c.push({type:l,bandwidth:j.getAttribute("bandwidth"),mime:k,codecs:q,url:o})}}h||(d=e)}return d}var f=b.create("ManifestUtil"),g=a.AdaptationType;return{parseManifest:d}}),define("player/Logger",["ensis/logger/logger"],function(a){function b(){return c}var c=a.create("PlayerWrapper");return{create:b}}),define("player/ShakaSidxAdapter",["ensis/lang/error","player/Logger"],function(a,b){"use strict";function c(a,b){var c={type:a,referenceCount:0,stream:b};if(f.trace("getSidxInfoFromStream: ",b),b)for(;b.getSegmentReference(c.referenceCount);)++c.referenceCount;return f.trace("ShakaRepresentationSidx: sidx list length: ",c.referenceCount),c}function d(b){function c(b){return function(){throw a.Error.create("Not implemented: "+b)}}function d(){return g}function e(){return b.referenceCount}function f(c){if(c>=h.getReferenceCount())throw a.Error.create("Index Out Of Range");var d=b.stream.getSegmentReference(c);return{ref_info:{type:"moof",size:d.endByte-d.startByte+1},subsegment_duration:parseInt(g*(d.endTime-d.startTime)),sap_info:{}}}var g=9e4,h={getReferenceId:c("getReferenceId"),getTimescale:d,getEarliestPresentationTime:c("getEarliestPresentationTime"),getFirstOffset:c("getFirstOffset"),getReferenceCount:e,getReference:f,asStream:c("asStream")};return h}function e(){return{createRepresentationSidx:c,createAdapter:d}}var f=b.create();return e()}),define("ensis/media/codec",["ensis/media/types","ensis/logger/logger"],function(a,b){function c(a,b){var c=!1,d=a.split(";");if(2!==d.length)e.error("Codec string must have a ';': ",a);else{var f=d[1];d=f.split("="),2!==d.length?e.error("Codec string must have a '=': ",a):(f=d[1],-1!==f.indexOf(b)&&(c=!0))}return e.trace("codec ",b,c?" is":" not"," present in ",a),c}function d(a,b){var c,d=null,f=a.split(","),g=f.length;Array.isArray(b)?c=b:"string"==typeof b&&(c=[b]);var h={};f.forEach(function(a){a=a.trim(),h[a]=!0}),c.forEach(function(a){a=a.trim(),delete h[a]}),f=[];for(var i in h)f.push(i);d=0===f.length?"":f.join(",");var j=f.length;return g!==j&&e.log("Codec string modified: ",a," -> ",d),d}var e=b.create("Codec"),f={type:a.Track.Type.AUDIO,name:"AAC-LC","class":a.MediaFormat.Audio.AAC,codecs:"mp4a.40.2",priority:1},g={type:a.Track.Type.AUDIO,name:"AAC-HE","class":a.MediaFormat.Audio.AAC,codecs:"mp4a.40.5",priority:1},h={type:a.Track.Type.AUDIO,name:"Dolby Digital","class":a.MediaFormat.Audio.DD,codecs:"ac-3",priority:2},i={type:a.Track.Type.AUDIO,name:"Dolby Digital Plus","class":a.MediaFormat.Audio.DDP,codecs:"ec-3",priority:3},j={type:a.Track.Type.VIDEO,name:"AVC(1)","class":[a.MediaFormat.Video.SD,a.MediaFormat.Video.HD,a.MediaFormat.Video.HDX],codecs:"avc1.640029",priority:1},k={type:a.Track.Type.VIDEO,name:"AVC(3)","class":[a.MediaFormat.Video.SD,a.MediaFormat.Video.HD,a.MediaFormat.Video.HDX],codecs:"avc3.640029",priority:1},l={type:a.Track.Type.VIDEO,name:"UHD/H265","class":a.MediaFormat.Video.SDR,codecs:"hev1.2.4.L150.B0",priority:2},m=({type:a.Track.Type.VIDEO,name:"HDR10 2K","class":a.MediaFormat.Video.HDR10,codecs:"hev1.2.4.L120.B0",eotf:"smpte2084",priority:3},{type:a.Track.Type.VIDEO,name:"HDR10 4K","class":a.MediaFormat.Video.HDR10,codecs:"hev1.2.4.L150.B0",eotf:"smpte2084",priority:3}),n={type:a.Track.Type.VIDEO,name:"Dolby Vision Profile 4","class":[a.MediaFormat.Video.DOVI,a.MediaFormat.Video.DOVI4],codecs:"hev1.2.4.L150.B0,dvhe.dtr",priority:4,canbe:["hev1.2.4.L120.B0"]},o={type:a.Track.Type.VIDEO,name:"Dolby Vision P4 2K 24fps","class":[a.MediaFormat.Video.DOVI,a.MediaFormat.Video.DOVI4],codecs:"hev1.2.4.L120.B0,dvhe.04.03",priority:4,canbe:["hev1.2.4.L120.B0"]},p={type:a.Track.Type.VIDEO,name:"Dolby Vision P4 2K 30fps","class":[a.MediaFormat.Video.DOVI,a.MediaFormat.Video.DOVI4],codecs:"hev1.2.4.L120.B0,dvhe.04.04",priority:4,canbe:["hev1.2.4.L120.B0"]},q={type:a.Track.Type.VIDEO,name:"Dolby Vision P4 4K 24fps","class":[a.MediaFormat.Video.DOVI,a.MediaFormat.Video.DOVI4],codecs:"hev1.2.4.L150.B0,dvhe.04.06",priority:4,canbe:["hev1.2.4.L150.B0"]},r={type:a.Track.Type.VIDEO,name:"Dolby Vision P4 4K 30fps","class":[a.MediaFormat.Video.DOVI,a.MediaFormat.Video.DOVI4],codecs:"hev1.2.4.L150.B0,dvhe.04.07",priority:4,canbe:["hev1.2.4.L150.B0"]},s={type:a.Track.Type.VIDEO,name:"Dolby Vision P5 2K 24fps","class":[a.MediaFormat.Video.DOVI,a.MediaFormat.Video.DOVI5],codecs:"dvhe.05.03",priority:5},t={type:a.Track.Type.VIDEO,name:"Dolby Vision P5 2K 30fps","class":[a.MediaFormat.Video.DOVI,a.MediaFormat.Video.DOVI5],codecs:"dvhe.05.04",priority:5},u={type:a.Track.Type.VIDEO,name:"Dolby Vision P5 4K 24fps","class":[a.MediaFormat.Video.DOVI,a.MediaFormat.Video.DOVI5],codecs:"dvhe.05.06",priority:5},v={type:a.Track.Type.VIDEO,name:"Dolby Vision P5 4K 30fps","class":[a.MediaFormat.Video.DOVI,a.MediaFormat.Video.DOVI5],codecs:"dvhe.05.07",priority:5},w={makeCodecsString:function(a,b){var c=a+'; codecs="'+b+'"';return c},checkCodecsString:c,removeCodecs:d,PROBABLY:"probably",MAYBE:"maybe",NONE:"",Formats:{audio:[f,g,h,i],video:[j,k,l,m,n,o,p,q,r,s,t,u,v]},Names:{audio:{AACLC:0,AACHE:1,DolbyDigital:2,DolbyDigitalPlus:3},video:{H264:0,H264DASH:1,H265:2,HDR10:3,DOVI:4,DOVI_2k_24:5,DOVI_2k_30:6,DOVI_4k_24:7,DOVI_4k_30:8,DOVI4_2k_24:5,DOVI4_2k_30:6,DOVI4_4k_24:7,DOVI4_4k_30:8,DOVI4:8,DOVI5_2k_24:9,DOVI5_2k_30:10,DOVI5_4k_24:11,DOVI5_4k_30:12,DOVI5:12}}};return w}),define("ensis/dash/manifesttweaks",["ensis/logger/logger","ensis/media/codec","ensis/media/types","ensis/dash/manifestutil"],function(a,b,c,d){"use strict";function e(a){var c=!1,d=a.getAttribute("codecs");if("string"!=typeof d)m.log("Representation has no 'codecs' attribute");else{m.log("Representation has a 'codecs' attribute of: ",d);var e=b.removeCodecs(d,n);null!==e&&(m.log("Updating codecs attribute: ",e),a.setAttribute("codecs",e),c=!0)}return c}function f(a){var c=!1,d=a.getAttribute("codecs");if("string"!=typeof d)m.log("AdaptationSet has no 'codecs' attribute");else{m.log("AdaptationSet has a 'codecs' attribute of: ",d);var f=b.removeCodecs(d,n);null!==f&&(m.log("Updating codecs attribute: ",f),a.setAttribute("codecs",f),c=!0)}var g=a.getElementsByTagName("Representation");if(g&&g.length&&g.length>0)for(var h=0;h!=g.length;++h)c|=e(g[h]);return c}function g(a,b){var c=!1;try{var e=d.parseManifest(a),f=[];e.audio.length>0&&e.audio.forEach(function(a){var c=a.codecs.toLowerCase();-1!==b.indexOf(c)&&(f.push(a.adaptationIndex),m.log("Manifest contains ",a.codecs,": ",a.adaptationIndex))});var g=a.getElementsByTagName("AdaptationSet"),h=f.map(function(a){return m.warn("Removing adaptation ",a),g[a]});h.forEach(function(a){a.parentNode.removeChild(a),c=!0})}catch(i){throw m.error("Problem removing audio adaptation: ",i.message),i}return c}function h(a){var b=!1,c=a.getElementsByTagName("AdaptationSet");if(c&&c.length&&c.length>0)for(var d=0;d!=c.length;++d)b|=f(c[d]);return b}function i(a){var b=!1;try{for(var c=a.getElementsByTagName("SegmentBase"),d=0;d!=c.length;++d){var e=c[d],f=e.getElementsByTagName("Initialization");if(0===f.length){m.log('Vudu manifest has no Initialization, Fabricate an <Initialization range="xxx"> tag');var g,h,i=e.getAttribute("indexRange");if("string"==typeof i){var j=i.split("-");try{var k=parseInt(j[0]);isNaN(k)||k>1&&(h=k-1)}catch(l){m.error("Problem parsing index range")}}"undefined"==typeof h&&(h=1e4),"undefined"==typeof g&&(g=0),h<g&&(m.warn("Manifest initialization range got badly initialized: ",g,"-",h),g=0,h=1e4);var n=""+g+"-"+h,o=a.createElement("Initialization");o.setAttribute("range",n),e.appendChild(o),b=!0}else!function(){for(var a=f.length;0!==a;){--a;var c=f[a],d=c.getAttribute("range");if("string"==typeof d){var e=d.split("-");try{var g=parseInt(e[0]),h=parseInt(e[1]);isNaN(g)||0!==g&&(m.error("Intialization Range do not start from offset 0, correct it here"),g=0,d=""+g+"-"+h,c.setAttribute("range",d),b=!0)}catch(i){m.error("Problem parsing Initializtion range")}}}}()}}catch(l){m.error("Vudu specific Manifest process failed: ",l.message)}return b}function j(a,b){var c=a.some(function(a){return-1!==b.indexOf(a)});return c}function k(a,b){var c=!1;b=b.map(function(a){return a.toUpperCase()});for(var d=a.getElementsByTagName("AdaptationSet"),e=0;e!=d.length;++e){for(var f=[],g=d[e],h=g.getElementsByTagName("ContentProtection"),i=0;i!=h.length;++i){var k=h[i],l=k.getAttribute("schemeIdUri").toUpperCase();j(b,l)||f.push(k)}0!==f.length&&(c=!0),f.forEach(function(a){a.parentNode.removeChild(a)})}return c}function l(a,b){for(var d=!1,e=a.getElementsByTagName("AdaptationSet"),f=0;f!=e.length;++f){for(var g=!1,h=!1,i=e[f],j=i.getElementsByTagName("ContentProtection"),k=0;k!==j.length;++k){var l=j[k],m=l.getAttribute("schemeIdUri").toUpperCase();if(g=!0,-1!==m.indexOf(c.DrmSchemeUUID.playready)){h=!0;var n=[];if(0!==l.childNodes.length){var o=l.firstChild;do{-1!==o.nodeName.toLowerCase().indexOf(":pssh")&&b.skipPssh&&n.push(o),-1!==o.nodeName.toLowerCase().indexOf(":pro")&&b.skipPro&&n.push(o);var p=o;for(o=null;p.nextSibling;)if(p=p.nextSibling,1===p.nodeType){o=p;break}}while(null!==o);0!==n.length&&(d=!0),n.forEach(function(a){a.parentNode.removeChild(a)})}}}if(g&&b.ensurePR&&!h){var q=i.ownerDocument.createElement("ContentProtection");q.setAttribute("schemeIdUri","urn:uuid:"+c.DrmSchemeUUID.playready),b.versionInfo&&q.setAttribute("value",b.versionInfo),i.appendChild(q),d=!0}}return d}var m=a.create("ManifestTweak"),n=[];return n.push(b.Formats.video[b.Names.video.DOVI].codecs.split(",")[1]),n.push(b.Formats.video[b.Names.video.DOVI_2k_24].codecs.split(",")[1]),n.push(b.Formats.video[b.Names.video.DOVI_2k_30].codecs.split(",")[1]),n.push(b.Formats.video[b.Names.video.DOVI_4k_24].codecs.split(",")[1]),
n.push(b.Formats.video[b.Names.video.DOVI_4k_30].codecs.split(",")[1]),{stripAudioAdaptations:g,stripDolbyVision:h,patchVuduManifest:i,restrictContentProtection:k,patchPlayreadyContentProtection:l}}),define("player/VuduManifestModifier",["ensis/logger/logger","ensis/dash/manifesttweaks"],function(a,b){"use strict";function c(a){if(a.firstElementChild&&"undefined"!=typeof a.firstElementChild.outerHTML)return a.firstElementChild.outerHTML;var b=Asteroid.Fills.get("XmlSerializer");if(b&&"function"==typeof b.serialize)return b.serialize(a.documentElement);throw new Error("Can't convert dom back to a string")}function d(a){var d=Asteroid.Modules.get("ManifestModifier");if(d)try{var e=new DOMParser,g=shaka.util.StringUtils.fromUTF8(a),h=e.parseFromString(g,"text/xml"),i=!1,j=d.modify(h);if(j&&(i=!0,h=j),i|=b.patchPlayreadyContentProtection(h,{ensurePR:!0})){g=c(h);for(var k=g.length,l=new Uint8Array(new ArrayBuffer(k)),m=0;m<k;m++)l[m]=g.charCodeAt(m);return l}}catch(n){return f.log("ERROR: Problem processing manifest: ",n.message),null}return null}function e(){return{modify:d}}var f=a.create("DashPlayerShaka");return e()}),define("player/player_buildinfo",{build:"312303.4_wrapper_shaka_255-sta",date:"2020-01-14T20:48:49.735Z",lib_version:"shaka_player-2.5.5.312164.15"}),define("player/PlayerFactory",["ensis/logger/logger","ensis/logger/logclient","ensis/media/types","ensis/lang/function","ensis/lang/arguments","ensis/vudu/player/DashPlayerInterface","ensis/dash/manifestutil","player/Logger","player/ShakaSidxAdapter","player/VuduManifestModifier","player/player_buildinfo"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(a,b,c,e){function f(a){a&&a.byteLength?c(a):e("VUDU DRM: No license data come back from Vudu UI")}try{d.checked(ja.onLicenseRequest,a,b,f)}catch(g){ea.error("License acquisition failed: "+g.message),setTimeout(function(){e("License acquisition failed: "+g.message)},0)}}function m(a,b){if(!a||!a.length)return 0;for(var c=0,d=a.length-1;d>=0&&a[d].end>b;--d)c+=a[d].end-Math.max(a[d].start,b);return c}function n(a,b){ja&&d.checked(ja.onBufferLevel,a,b)}function o(a){var b=0,c=0,d=0;if(ha){var e=ha.getBufferedInfo();b=m(e.total,a),c=m(e.video,a),d=m(e.audio,a)}return{total:b,audio:d,video:c}}function p(){if(ea.log("Buffer Level Report"),ia){var a=o(ia.currentTime);ea.trace("Buffer Level=",a),n(c.AdaptationType.video,a.video),n(c.AdaptationType.audio,a.audio)}ta.tickAfter(3)}function q(){ea.log("cmd:play.");try{var a=ia.play();a&&a["catch"](function(a){ea.warn("play promise threw: ",a),aa({category:fa.mediaelement,message:"notallowed"})})}catch(b){ea.warn("Call to play() threw: ",b),aa({category:fa.mediaelement,message:"notallowed"})}}function r(){ea.log("cmd:pause."),ia.pause()}function s(a){ea.log("cmd:seek:time=",a),ia.currentTime=a}function t(){return ea.trace("getCurrentTime:="+ia.currentTime),ia.readyState>0?ia.currentTime:qa}function u(){return ea.trace("getDuration:=",ia.duration," duration_ =",ka),isNaN(ia.duration)||0===ia.duration?ea.log("getDuration: setting ",ka):ka=ia.duration,ka}function v(){return ea.trace("cmd:getVolume:=",ia.volume),ia.volume}function w(){return ea.trace("cmd:getMute:="+ia.muted),ia.muted}function x(a){return ea.trace("cmd:setVolume:="+a),ia.volume=a}function y(a){return ea.trace("cmd:setMute:="+a),ia.muted=a}function z(a,b){if(ea.trace("cmd:setMaxBitrateFor.type=",a," kbps=",b),ha&&b){var c=ha.getConfiguration();c.abr.restrictions.maxBandwidth=1e3*b,ha.configure(c)}}function A(a,b){if(ea.log("cmd:setInitial BitrateFor.type=",a," kbps=",b),ha&&b){var c=ha.getConfiguration();c.abr.defaultBandwidthEstimate=1e3*b,ha.configure(c)}}function B(a){ea.trace("cmd:getBitratesFor.type="+a);var b=[],d=ha.getVariantTracks();if(d)if(c.AdaptationType.video===a)for(var e=0;e<d.length;e++)ea.trace("track info: ",d[e]),b.push(d[e].videoBandwidth);else d.length>0&&b.push(d[0].audioBandwidth);return b}function C(a){ea.trace("cmd:getCurrentAdaptationFor.type=",a);var b=0;if(c.AdaptationType.video===a){var d=ha.getActiveVideo();d&&(b=na[d.id].adaptIdx)}else{var e=ha.getActiveAudio();e&&(b=oa[e.id].adaptIdx)}return b}function D(){return va}function E(a,b){ea.trace("getVariantInfoFromURI uri = ",a," range = ",b);for(var c,d=null,e=0;e<ma.length&&!d;e++)c=ma[e],c&&c.uris&&c.uris.length>0&&c.uris.indexOf(a)!==-1&&(ea.log("getVariantInfoFromURI variant = ",c.sidxList),d={id:c.id,type:c.type,duration:c.duration||0,pos:Number.NaN,referenceCount:Number.NaN});if(d&&c.sidxList&&"string"==typeof b){d.referenceCount=c.sidxList.referenceCount;var f=c.sidxList.stream;if(b=b.split("-"),2===b.length){var g=Number.parseInt(b[0]),h=Number.parseInt(b[1]);if(isNaN(g)||isNaN(h));else if(g<f.getSegmentReference(0).startByte);else for(var i=0;i!==d.referenceCount&&isNaN(d.pos);++i){var j=f.getSegmentReference(i);g>=j.startByte&&h<=j.endByte&&(d.pos=i)}}}return d}function F(a){var b=g.parseManifest(a);b.audio.forEach(function(a){a.info.forEach(function(b,c){pa[b.url]={adaptIdx:a.adaptationIndex,repIdx:c}})}),b.video.forEach(function(a){a.info.forEach(function(b,c){pa[b.url]={adaptIdx:a.adaptationIndex,repIdx:c}})})}function G(a,b){b&&(ea.trace("createVariantInfo: stream: ",b),ma[b.id]={id:b.id,type:a,sidxList:[]})}function H(a){var b=a.initSegmentReference.getUris();if(b.length){var c=b[0].split("/");return c.length&&c[c.length-1]}}function I(){ea.trace("processManifest:");var a=ha.getManifest();if(a){for(var b=0;b<a.periods.length;b++){var d=a.periods[b];ea.trace("onStreaming: period: ",d);for(var e=0;e<d.variants.length;e++){var f=d.variants[e].audio,g=d.variants[e].video;G(c.AdaptationType.video,g);var h=H(g);if(na[g.id]=pa[h],!ma.hasOwnProperty(f.id)){G(c.AdaptationType.audio,f);var i=H(f);oa[f.id]=pa[i]}}}ea.trace("processManifest: audio_stream_id_mapping_: ",oa),ea.trace("processManifest: video_stream_id_mapping_: ",na)}}function J(a,b){shaka.vudu=shaka.vudu||{},shaka.vudu.vuduParams={suffix:a.uriSuffix},ja=a.eventListener,ea.log("initialize initCustomParams: ",b);var c=!1,e=a.mpdUrl,f=.5;a.bookmarkTime&&(f=a.bookmarkTime,qa=f),ka=Number.POSITIVE_INFINITY,ia=a.mediaElement,oa={},na={},pa={},ra=-1,sa=-1;var g=0,h={disableStallTimeout:!1,useFetch:!1},i=5;if(a.algorithm){var k=parseInt(a.algorithm);isNaN(k)&&(k=0),g=4026531840&k,0!==g?ea.warn("Unsupported algorithm version: ",a.algorithm):(h.useFetch=!!(1&k),h.disableStallTimeout=!!(2&k),h.disableStallTimeout?i=NaN:0!==(240&a.algorithm)&&(i=240&a.algorithm,i>>=4),!shaka.net.HttpFetchPlugin.isSupported()&&h.useFetch&&(ea.warn("HttpFetch not supported, reverting to XHR."),h.useFetch=!1))}va.streamingAlgorithm=h.useFetch?1:0,h.disableStallTimeout?va.streamingAlgorithm|=2:va.streamingAlgorithm|=i<<4,h.useFetch?(ea.log("HttpFetch used for fragment retrieval."),shaka.net.NetworkingEngine.registerScheme("http",shaka.net.HttpFetchPlugin,shaka.net.NetworkingEngine.PluginPriority.APP),shaka.net.NetworkingEngine.registerScheme("https",shaka.net.HttpFetchPlugin,shaka.net.NetworkingEngine.PluginPriority.APP)):(ea.log("XHR used for fragment retrieval."),shaka.net.NetworkingEngine.registerScheme("http",shaka.net.HttpXHRPlugin,shaka.net.NetworkingEngine.PluginPriority.APP),shaka.net.NetworkingEngine.registerScheme("https",shaka.net.HttpXHRPlugin,shaka.net.NetworkingEngine.PluginPriority.APP)),ta=new shaka.util.Timer(p),ha=new shaka.VuduPlayer(l,ia);var m={drm:{servers:{"com.widevine.alpha":"drm://vudu.com/widevine","com.microsoft.playready":"drm://vudu.com/playready"}},streaming:{bufferBehind:20,bufferingGoal:20,rebufferingGoal:6,retryParameters:{stallTimeout:i}},abr:{defaultBandwidthEstimate:0}};ea.log("Setting Shaka config: ",m),ha.configure(m),m=ha.getConfiguration(),ea.log("Shaka reported config: ",m),ha.addEventListener("error",ba),ha.addEventListener("adaptation",Y),ha.addEventListener("buffering",$),ha.addEventListener("streaming",_),ha.addEventListener("updatestate",W),ha.addEventListener("vudukeystatuseschanged",M),ha.addEventListener("vuduSegmentIndexCreated",K),ia.addEventListener("canplay",S),ia.addEventListener("volumechange",Q),ia.addEventListener("seeked",U),ia.addEventListener("seeking",T),ia.addEventListener("progress",P),ia.addEventListener("waiting",O),ia.addEventListener("timeupdate",Z),ia.addEventListener("ratechange",R),ia.addEventListener("ended",V),ha.load(e,f).then(function(){ea.log("The video has now been loaded: duration: ",ia.duration),c&&ia.play();var a=ia.volume,b=ia.muted;d.checked(ja.onVolumeChanged,a,b),ta.tickAfter(3)})["catch"](aa),ha.getNetworkingEngine().registerRequestFilter(function(a,b){if(ea.trace("request filter: type=",a," request=",b),a===shaka.net.NetworkingEngine.RequestType.SEGMENT){var c=b.headers.Range,d="";c?(ea.trace("request filter: range=",b.headers.Range),c=c.split("=")[1],d="/range/"+c,delete b.headers.Range):c="";var e=E(b.uris[0],c),f=0;e&&(f=e.pos);var g=!0;b.uris.length>0&&b.uris[0].split("?").length<2&&("?"!==shaka.vudu.vuduParams.suffix[0]&&(d+="?"),d+=shaka.vudu.vuduParams.suffix,g=!1);var h="";Asteroid.InitDataCache.isWatermarked(b.uris[0])&&(h=Asteroid.InitDataCache.getFragmentSignature(b.uris[0],f),h=String.fromCharCode.apply(null,h),d+=g?"?ssig="+btoa(h):"&ssig="+btoa(h));for(var i=0;i<b.uris.length;i++)b.uris[i]=b.uris[i]+d;var j=b.isInit;return j?void ea.log("request filter: skipping init data request."):void(e?(ea.trace("request filter: info=",e),la[b.uris[0]]={id:e.id,type:e.type,startDate:new Date,pos:e.pos,duration:e.duration}):ea.log("request filter: info not found."))}}),ha.getNetworkingEngine().registerResponseFilter(function(a,b){switch(a){case shaka.net.NetworkingEngine.RequestType.MANIFEST:if(b&&"object"==typeof b.data){try{var c=new DOMParser,e=shaka.util.StringUtils.fromUTF8(b.data),f=c.parseFromString(e,"text/xml");F(f),d.checked(ja.onManifestLoaded,f)}catch(g){ea.error("Failed to parse MPD for onManifestLoaded event",g.message)}var h=j.modify(b.data);h&&(b.data=h)}else ea.warning("Network manifest response had no DOM object: ",typeof b.data);break;case shaka.net.NetworkingEngine.RequestType.SEGMENT:ea.trace(" response filter: uri="+b.uri+" byte length="+b.data.byteLength),la[b.uri]&&(la[b.uri].bytes=b.data.byteLength,la[b.uri].endDate=new Date,ca(la[b.uri]))}})}function K(){var a=ha.getManifest();if(a)for(var b=0;b<a.periods.length;b++){var d=a.periods[b];ea.trace("onSegmentIndexCreated");for(var e=0;e<d.variants.length;e++){var f=d.variants[e];0===ma[f.audio.id].sidxList.length&&(L(c.AdaptationType.audio,f.audio),X(c.AdaptationType.audio,oa[f.audio.id].repIdx,ma[f.audio.id].sidxList)),0===ma[f.video.id].sidxList.length&&(L(c.AdaptationType.video,f.video),X(c.AdaptationType.video,na[f.video.id].repIdx,ma[f.video.id].sidxList))}}}function L(a,b){var c=b.id,d=i.createRepresentationSidx(a,b),e=b.getSegmentReference(d.referenceCount-1);ma[c].uris=e.createUris(),ma[c].duration=1e3*(e.getEndTime()-e.getStartTime()),ma[c].sidxList=d}function M(a){ea.trace("onKeyStatusesChanged:keyStatusMap =",a.keyStatusMap);var b,c=a.keyStatusMap;d.checked(ja.onKeyStatusesChanged,b,c)}function N(b){ea.warn("setLogging: params =",b),a.setDefaultLogLevel(b.level)}function O(){ea.log("onPlaybackWaiting."),d.checked(ja.onWaiting)}function P(){ea.trace("onPlaybackProgress."),d.checked(ja.onProgress)}function Q(){ea.log("onVolumeChanged.");var a=ia.volume,b=ia.muted;d.checked(ja.onVolumeChanged(a,b))}function R(){ea.log("onRatechange: ",ia.playbackRate),d.checked(ja.onPlaybackRangeChanged,ia.playbackRate)}function S(){ea.log("onCanPlay: "),d.checked(ja.onCanPlay)}function T(){ea.log("onSeeking: "),d.checked(ja.onSeeking)}function U(){ea.log("onSeeked:currentTime: ",ia.currentTime),d.checked(ja.onSeeked),p();var a=ha.isBuffering();if(!a){var b=o(ia.currentTime);ea.log("onSeeked, shaka reporting enough buffer: Buffer Level=",b),d.checked(ja.onBufferLoaded,c.AdaptationType.video),d.checked(ja.onBufferLoaded,c.AdaptationType.audio)}}function V(){ea.log("onEnded:"),d.checked(ja.onEnded)}function W(a){ea.trace("onUpdateState: "+a.state),"playing"===a.state?d.checked(ja.onPlay):"paused"===a.state?d.checked(ja.onPause):"ended"===a.state&&d.checked(ja.onEnded)}function X(a,b,c){var e=i.createAdapter(c),g=f.SegmentIndexDetails(a,b,e);d.checked(ja.onSidxParsed,a,g)}function Y(){ea.trace("onAdaptation: ",event);var a=ha.getActiveVideo(),b=ha.getActiveAudio();ea.trace(" - Audio Adaptation ID: ",b.id),ea.trace(" - Video Adaptation ID: ",a.id);var e;sa!==a.id&&(sa=a.id,d.checked(ja.onRepresentationSelected,c.AdaptationType.video,na[a.id].repIdx,e)),ra!==b.id&&(ra=b.id,d.checked(ja.onRepresentationSelected,c.AdaptationType.audio,oa[b.id].repIdx,e)),p()}function Z(){ea.trace("onVideoTime: "),d.checked(ja.onPositionUpdate)}function $(){var a=ha.isBuffering();if(a){if(ua)return ua=!1,void ea.log("onBuffering: ignored initial loading.");if(ia.seeking)return void ea.log("onBuffering: ignored while seeking.");ea.log("onBuffering: Buffer Level=",o(ia.currentTime)),d.checked(ja.onBufferUnderrun,c.AdaptationType.video),d.checked(ja.onBufferUnderrun,c.AdaptationType.audio)}else ea.log("onBuffering but not buffering: Buffer Level=",o(ia.currentTime)),d.checked(ja.onBufferLoaded,c.AdaptationType.video),d.checked(ja.onBufferLoaded,c.AdaptationType.audio)}function _(){var a=ha.getManifest();ka=a.presentationTimeline.getDuration(),ea.trace("onStreaming: duration_="+ka),I();var b;d.checked(ja.onAdaptationSelected,c.AdaptationType.video,b)}function aa(a){var b="unknown";switch(a.category){case 1:b="network";break;case 2:b="text";break;case 3:b="media";break;case 4:b="manifest";break;case 5:b="streaming";break;case 6:b="drm";break;case 7:b="player";break;case fa.mediaelement:b="mediaelement"}if("manifest"!==b||4012!==a.code){var c=f.ErrorDetails(b,a.message,a.code);d.checked(ja.onError,c)}}function ba(a){ea.warn("onErrorEvent: ",a.detail),aa(a.detail)}function ca(a){if(a&&(ea.trace("onDownloadFragmentStats: ",a," took=",a.endDate.getTime()-a.startDate.getTime()," milli secs"),!isNaN(a.pos))){var b=f.FragDownloadDetails(a.type,a.pos,a.duration,a.type===c.AdaptationType.audio?oa[a.id].repIdx:na[a.id].repIdx,a.bytes,a.startDate.getTime(),a.endDate.getTime());d.checked(ja.onFragmentLoaded,a.type,b),p()}}function da(){ta.stop(),ka=0,ma=[],la=[],oa={},na={},pa={};try{ha.removeEventListener("error",ba),ha.removeEventListener("adaptation",Y),ha.removeEventListener("buffering",$),ha.removeEventListener("streaming",_),ha.removeEventListener("updatestate",W),ha.removeEventListener("vudukeystatuseschanged",M),ha.removeEventListener("vuduSegmentIndexCreated",K),ia.removeEventListener("canplay",S),ia.removeEventListener("volumechange",Q),ia.removeEventListener("seeked",U),ia.removeEventListener("seeking",T),ia.removeEventListener("progress",P),ia.removeEventListener("waiting",O),ia.removeEventListener("timeupdate",Z),ia.removeEventListener("ratechange",R),ia.removeEventListener("ended",V),ha.destroy()}catch(a){ea.error("Error during reset: ",a)}ha=null}var ea=h.create(),fa={mediaelement:32769},ga=f.createAbstractPlayerFactory();ga.getVersionInfo=function(){return f.VersionDetails("shaka_2.5.5","Google Shaka DASH Player(v2.5.5)",k.build)},ga.getInterfaceVersion=function(){return 2};var ha,ia,ja,ka=0,la=[],ma=[],na={},oa={},pa={},qa=0,ra=-1,sa=-1,ta=null,ua=!0,va=f.PlayerSettingDetails(),wa=a.create("DashPlayerShaka"),xa=b.createAbstractClient();return xa.report=function(a,c){ja?d.checked(ja.onLogMessage,c,a):b.getConsoleClient().report(a,c)},wa.setClient(xa),ea.setClient(xa),shaka.log.error=function(){wa.error.apply(wa,arguments)},shaka.log.warning=function(){wa.warn.apply(wa,arguments)},shaka.log.alwaysWarn=function(){wa.warn.apply(wa,arguments)},shaka.log.info=function(){wa.log.apply(wa,arguments)},shaka.log.debug=function(){wa.trace.apply(wa,arguments)},shaka.log.v1=function(){wa.trace.apply(wa,arguments)},shaka.log.v2=function(){wa.trace.apply(wa,arguments)},shaka.dash.DashParser.prototype.requestInitSegment_=function(a,b,c){ea.trace("requestInitSegment_ : uris=",a," startByte=",b," endByte=",c);var d=Asteroid.Util.uri.getResourceFromPath(a[0]),e=Asteroid.InitDataCache.getCacheRange(d,b,c);if(e)return ea.log("requestInitSegment_ : uris=",a," startByte=",b," endByte=",c," returning cached data."),e;var f=shaka.util.Networking.createSegmentRequest(a,b,c,this.config_.retryParameters);f.isInit=!0;var g=this.playerInterface_.networkingEngine,h=g.request(shaka.net.NetworkingEngine.RequestType.SEGMENT,f);return this.operationManager_.manage(h),h.promise.then(function(a){return a.data})},ga.createPlayer=function(a){ea.log("create player: configOptions: ",a);var b=window.MediaSource;shaka.polyfill.installAll(),window.MediaSource=b,ma=[],oa={},na={},pa={},ra=-1,sa=-1;var c=f.createAbstractPlayer();return c.play=q,c.pause=r,c.seek=s,c.getCurrentTime=t,c.getDuration=u,c.getVolume=v,c.getMute=w,c.setVolume=x,c.setMute=y,c.setMaxBitrateFor=z,c.setInitialBitrateFor=A,c.getBitratesFor=B,c.getCurrentAdaptationFor=C,c.initialize=J,c.setLogging=N,c.reset=da,c.getPlayerSettings=D,c},ga});